!function(a,b){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){"use strict";function c(a,b){b=b||_;var c=b.createElement("script");c.text=a,b.head.appendChild(c).parentNode.removeChild(c)}function d(a){var b=!!a&&"length"in a&&a.length,c=ma.type(a);return"function"===c||ma.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function e(a,b,c){if(ma.isFunction(b))return ma.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return ma.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(wa.test(b))return ma.filter(b,a,c);b=ma.filter(b,a)}return ma.grep(a,function(a){return ea.call(b,a)>-1!==c&&1===a.nodeType})}function f(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function g(a){var b={};return ma.each(a.match(Ca)||[],function(a,c){b[c]=!0}),b}function h(a){return a}function i(a){throw a}function j(a,b,c){var d;try{a&&ma.isFunction(d=a.promise)?d.call(a).done(b).fail(c):a&&ma.isFunction(d=a.then)?d.call(a,b,c):b.call(void 0,a)}catch(a){c.call(void 0,a)}}function k(){_.removeEventListener("DOMContentLoaded",k),a.removeEventListener("load",k),ma.ready()}function l(){this.expando=ma.expando+l.uid++}function m(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(Ka,"-$&").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:Ja.test(c)?JSON.parse(c):c}catch(e){}Ia.set(a,b,c)}else c=void 0;return c}function n(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return ma.css(a,b,"")},i=h(),j=c&&c[3]||(ma.cssNumber[b]?"":"px"),k=(ma.cssNumber[b]||"px"!==j&&+i)&&Ma.exec(ma.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,ma.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}function o(a){var b,c=a.ownerDocument,d=a.nodeName,e=Qa[d];return e?e:(b=c.body.appendChild(c.createElement(d)),e=ma.css(b,"display"),b.parentNode.removeChild(b),"none"===e&&(e="block"),Qa[d]=e,e)}function p(a,b){for(var c,d,e=[],f=0,g=a.length;g>f;f++)d=a[f],d.style&&(c=d.style.display,b?("none"===c&&(e[f]=Ha.get(d,"display")||null,e[f]||(d.style.display="")),""===d.style.display&&Oa(d)&&(e[f]=o(d))):"none"!==c&&(e[f]="none",Ha.set(d,"display",c)));for(f=0;g>f;f++)null!=e[f]&&(a[f].style.display=e[f]);return a}function q(a,b){var c="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&ma.nodeName(a,b)?ma.merge([a],c):c}function r(a,b){for(var c=0,d=a.length;d>c;c++)Ha.set(a[c],"globalEval",!b||Ha.get(b[c],"globalEval"))}function s(a,b,c,d,e){for(var f,g,h,i,j,k,l=b.createDocumentFragment(),m=[],n=0,o=a.length;o>n;n++)if(f=a[n],f||0===f)if("object"===ma.type(f))ma.merge(m,f.nodeType?[f]:f);else if(Va.test(f)){for(g=g||l.appendChild(b.createElement("div")),h=(Sa.exec(f)||["",""])[1].toLowerCase(),i=Ua[h]||Ua._default,g.innerHTML=i[1]+ma.htmlPrefilter(f)+i[2],k=i[0];k--;)g=g.lastChild;ma.merge(m,g.childNodes),g=l.firstChild,g.textContent=""}else m.push(b.createTextNode(f));for(l.textContent="",n=0;f=m[n++];)if(d&&ma.inArray(f,d)>-1)e&&e.push(f);else if(j=ma.contains(f.ownerDocument,f),g=q(l.appendChild(f),"script"),j&&r(g),c)for(k=0;f=g[k++];)Ta.test(f.type||"")&&c.push(f);return l}function t(){return!0}function u(){return!1}function v(){try{return _.activeElement}catch(a){}}function w(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)w(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=u;else if(!e)return a;return 1===f&&(g=e,e=function(a){return ma().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=ma.guid++)),a.each(function(){ma.event.add(this,b,e,d,c)})}function x(a,b){return ma.nodeName(a,"table")&&ma.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a:a}function y(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function z(a){var b=bb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function A(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(Ha.hasData(a)&&(f=Ha.access(a),g=Ha.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)ma.event.add(b,e,j[e][c])}Ia.hasData(a)&&(h=Ia.access(a),i=ma.extend({},h),Ia.set(b,i))}}function B(a,b){var c=b.nodeName.toLowerCase();"input"===c&&Ra.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function C(a,b,d,e){b=ca.apply([],b);var f,g,h,i,j,k,l=0,m=a.length,n=m-1,o=b[0],p=ma.isFunction(o);if(p||m>1&&"string"==typeof o&&!ka.checkClone&&ab.test(o))return a.each(function(c){var f=a.eq(c);p&&(b[0]=o.call(this,c,f.html())),C(f,b,d,e)});if(m&&(f=s(b,a[0].ownerDocument,!1,a,e),g=f.firstChild,1===f.childNodes.length&&(f=g),g||e)){for(h=ma.map(q(f,"script"),y),i=h.length;m>l;l++)j=f,l!==n&&(j=ma.clone(j,!0,!0),i&&ma.merge(h,q(j,"script"))),d.call(a[l],j,l);if(i)for(k=h[h.length-1].ownerDocument,ma.map(h,z),l=0;i>l;l++)j=h[l],Ta.test(j.type||"")&&!Ha.access(j,"globalEval")&&ma.contains(k,j)&&(j.src?ma._evalUrl&&ma._evalUrl(j.src):c(j.textContent.replace(cb,""),k))}return a}function D(a,b,c){for(var d,e=b?ma.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||ma.cleanData(q(d)),d.parentNode&&(c&&ma.contains(d.ownerDocument,d)&&r(q(d,"script")),d.parentNode.removeChild(d));return a}function E(a,b,c){var d,e,f,g,h=a.style;return c=c||fb(a),c&&(g=c.getPropertyValue(b)||c[b],""!==g||ma.contains(a.ownerDocument,a)||(g=ma.style(a,b)),!ka.pixelMarginRight()&&eb.test(g)&&db.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function F(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function G(a){if(a in kb)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=jb.length;c--;)if(a=jb[c]+b,a in kb)return a}function H(a,b,c){var d=Ma.exec(b);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):b}function I(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=ma.css(a,c+Na[f],!0,e)),d?("content"===c&&(g-=ma.css(a,"padding"+Na[f],!0,e)),"margin"!==c&&(g-=ma.css(a,"border"+Na[f]+"Width",!0,e))):(g+=ma.css(a,"padding"+Na[f],!0,e),"padding"!==c&&(g+=ma.css(a,"border"+Na[f]+"Width",!0,e)));return g}function J(a,b,c){var d,e=!0,f=fb(a),g="border-box"===ma.css(a,"boxSizing",!1,f);if(a.getClientRects().length&&(d=a.getBoundingClientRect()[b]),0>=d||null==d){if(d=E(a,b,f),(0>d||null==d)&&(d=a.style[b]),eb.test(d))return d;e=g&&(ka.boxSizingReliable()||d===a.style[b]),d=parseFloat(d)||0}return d+I(a,b,c||(g?"border":"content"),e,f)+"px"}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function L(){mb&&(a.requestAnimationFrame(L),ma.fx.tick())}function M(){return a.setTimeout(function(){lb=void 0}),lb=ma.now()}function N(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=Na[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function O(a,b,c){for(var d,e=(R.tweeners[b]||[]).concat(R.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function P(a,b,c){var d,e,f,g,h,i,j,k,l="width"in b||"height"in b,m=this,n={},o=a.style,q=a.nodeType&&Oa(a),r=Ha.get(a,"fxshow");c.queue||(g=ma._queueHooks(a,"fx"),null==g.unqueued&&(g.unqueued=0,h=g.empty.fire,g.empty.fire=function(){g.unqueued||h()}),g.unqueued++,m.always(function(){m.always(function(){g.unqueued--,ma.queue(a,"fx").length||g.empty.fire()})}));for(d in b)if(e=b[d],nb.test(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}n[d]=r&&r[d]||ma.style(a,d)}if(i=!ma.isEmptyObject(b),i||!ma.isEmptyObject(n)){l&&1===a.nodeType&&(c.overflow=[o.overflow,o.overflowX,o.overflowY],j=r&&r.display,null==j&&(j=Ha.get(a,"display")),k=ma.css(a,"display"),"none"===k&&(j?k=j:(p([a],!0),j=a.style.display||j,k=ma.css(a,"display"),p([a]))),("inline"===k||"inline-block"===k&&null!=j)&&"none"===ma.css(a,"float")&&(i||(m.done(function(){o.display=j}),null==j&&(k=o.display,j="none"===k?"":k)),o.display="inline-block")),c.overflow&&(o.overflow="hidden",m.always(function(){o.overflow=c.overflow[0],o.overflowX=c.overflow[1],o.overflowY=c.overflow[2]})),i=!1;for(d in n)i||(r?"hidden"in r&&(q=r.hidden):r=Ha.access(a,"fxshow",{display:j}),f&&(r.hidden=!q),q&&p([a],!0),m.done(function(){q||p([a]),Ha.remove(a,"fxshow");for(d in n)ma.style(a,d,n[d])})),i=O(q?r[d]:0,d,m),d in r||(r[d]=i.start,q&&(i.end=i.start,i.start=0))}}function Q(a,b){var c,d,e,f,g;for(c in a)if(d=ma.camelCase(c),e=b[d],f=a[c],ma.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=ma.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function R(a,b,c){var d,e,f=0,g=R.prefilters.length,h=ma.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=lb||M(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:ma.extend({},b),opts:ma.extend(!0,{specialEasing:{},easing:ma.easing._default},c),originalProperties:b,originalOptions:c,startTime:lb||M(),duration:c.duration,tweens:[],createTween:function(b,c){var d=ma.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(Q(k,j.opts.specialEasing);g>f;f++)if(d=R.prefilters[f].call(j,a,k,j.opts))return ma.isFunction(d.stop)&&(ma._queueHooks(j.elem,j.opts.queue).stop=ma.proxy(d.stop,d)),d;return ma.map(k,O,j),ma.isFunction(j.opts.start)&&j.opts.start.call(a,j),ma.fx.timer(ma.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function S(a){return a.getAttribute&&a.getAttribute("class")||""}function T(a,b,c,d){var e;if(ma.isArray(b))ma.each(b,function(b,e){c||Ab.test(a)?d(a,e):T(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==ma.type(b))d(a,b);else for(e in b)T(a+"["+e+"]",b[e],c,d)}function U(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(Ca)||[];if(ma.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function V(a,b,c,d){function e(h){var i;return f[h]=!0,ma.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===Mb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function W(a,b){var c,d,e=ma.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&ma.extend(!0,a,d),a}function X(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Y(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Z(a){return ma.isWindow(a)?a:9===a.nodeType&&a.defaultView}var $=[],_=a.document,aa=Object.getPrototypeOf,ba=$.slice,ca=$.concat,da=$.push,ea=$.indexOf,fa={},ga=fa.toString,ha=fa.hasOwnProperty,ia=ha.toString,ja=ia.call(Object),ka={},la="3.1.0",ma=function(a,b){return new ma.fn.init(a,b)},na=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,oa=/^-ms-/,pa=/-([a-z])/g,qa=function(a,b){return b.toUpperCase()};ma.fn=ma.prototype={jquery:la,constructor:ma,length:0,toArray:function(){return ba.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:ba.call(this)},pushStack:function(a){var b=ma.merge(this.constructor(),a);return b.prevObject=this,b},each:function(a){return ma.each(this,a)},map:function(a){return this.pushStack(ma.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(ba.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:da,sort:$.sort,splice:$.splice},ma.extend=ma.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||ma.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(ma.isPlainObject(d)||(e=ma.isArray(d)))?(e?(e=!1,f=c&&ma.isArray(c)?c:[]):f=c&&ma.isPlainObject(c)?c:{},g[b]=ma.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},ma.extend({expando:"jQuery"+(la+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===ma.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){var b=ma.type(a);return("number"===b||"string"===b)&&!isNaN(a-parseFloat(a))},isPlainObject:function(a){var b,c;return a&&"[object Object]"===ga.call(a)?(b=aa(a))?(c=ha.call(b,"constructor")&&b.constructor,"function"==typeof c&&ia.call(c)===ja):!0:!1},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?fa[ga.call(a)]||"object":typeof a},globalEval:function(a){c(a)},camelCase:function(a){return a.replace(oa,"ms-").replace(pa,qa)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,e=0;if(d(a))for(c=a.length;c>e&&b.call(a[e],e,a[e])!==!1;e++);else for(e in a)if(b.call(a[e],e,a[e])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(na,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(d(Object(a))?ma.merge(c,"string"==typeof a?[a]:a):da.call(c,a)),c},inArray:function(a,b,c){return null==b?-1:ea.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var e,f,g=0,h=[];if(d(a))for(e=a.length;e>g;g++)f=b(a[g],g,c),null!=f&&h.push(f);else for(g in a)f=b(a[g],g,c),null!=f&&h.push(f);return ca.apply([],h)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),ma.isFunction(a)?(d=ba.call(arguments,2),e=function(){return a.apply(b||this,d.concat(ba.call(arguments)))},e.guid=a.guid=a.guid||ma.guid++,e):void 0},now:Date.now,support:ka}),"function"==typeof Symbol&&(ma.fn[Symbol.iterator]=$[Symbol.iterator]),ma.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){fa["[object "+b+"]"]=b.toLowerCase()});var ra=function(a){function b(a,b,c,d){var e,f,g,h,i,j,k,m=b&&b.ownerDocument,o=b?b.nodeType:9;if(c=c||[],"string"!=typeof a||!a||1!==o&&9!==o&&11!==o)return c;if(!d&&((b?b.ownerDocument||b:P)!==H&&G(b),b=b||H,J)){if(11!==o&&(i=ra.exec(a)))if(e=i[1]){if(9===o){if(!(g=b.getElementById(e)))return c;if(g.id===e)return c.push(g),c}else if(m&&(g=m.getElementById(e))&&N(b,g)&&g.id===e)return c.push(g),c}else{if(i[2])return $.apply(c,b.getElementsByTagName(a)),c;if((e=i[3])&&w.getElementsByClassName&&b.getElementsByClassName)return $.apply(c,b.getElementsByClassName(e)),c}if(w.qsa&&!U[a+" "]&&(!K||!K.test(a))){if(1!==o)m=b,k=a;else if("object"!==b.nodeName.toLowerCase()){for((h=b.getAttribute("id"))?h=h.replace(va,wa):b.setAttribute("id",h=O),j=A(a),f=j.length;f--;)j[f]="#"+h+" "+n(j[f]);k=j.join(","),m=sa.test(a)&&l(b.parentNode)||b}if(k)try{return $.apply(c,m.querySelectorAll(k)),c}catch(p){}finally{h===O&&b.removeAttribute("id")}}}return C(a.replace(ha,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>x.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[O]=!0,a}function e(a){var b=H.createElement("fieldset");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=c.length;d--;)x.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return function(b){return"label"in b&&b.disabled===a||"form"in b&&b.disabled===a||"form"in b&&b.disabled===!1&&(b.isDisabled===a||b.isDisabled!==!a&&("label"in b||!ya(b))!==a)}}function k(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function l(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function m(){}function n(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function o(a,b,c){var d=b.dir,e=b.next,f=e||d,g=c&&"parentNode"===f,h=R++;return b.first?function(b,c,e){for(;b=b[d];)if(1===b.nodeType||g)return a(b,c,e)}:function(b,c,i){var j,k,l,m=[Q,h];if(i){for(;b=b[d];)if((1===b.nodeType||g)&&a(b,c,i))return!0}else for(;b=b[d];)if(1===b.nodeType||g)if(l=b[O]||(b[O]={}),k=l[b.uniqueID]||(l[b.uniqueID]={}),e&&e===b.nodeName.toLowerCase())b=b[d]||b;else{if((j=k[f])&&j[0]===Q&&j[1]===h)return m[2]=j[2];if(k[f]=m,m[2]=a(b,c,i))return!0}}}function p(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function q(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function r(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function s(a,b,c,e,f,g){return e&&!e[O]&&(e=s(e)),f&&!f[O]&&(f=s(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=d||q(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?p:r(p,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=r(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?aa(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=r(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function t(a){for(var b,c,d,e=a.length,f=x.relative[a[0].type],g=f||x.relative[" "],h=f?1:0,i=o(function(a){return a===b},g,!0),j=o(function(a){return aa(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==D)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=x.relative[a[h].type])k=[o(p(k),c)];else{if(c=x.filter[a[h].type].apply(null,a[h].matches),c[O]){for(d=++h;e>d&&!x.relative[a[d].type];d++);return s(h>1&&p(k),h>1&&n(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ha,"$1"),c,d>h&&t(a.slice(h,d)),e>d&&t(a=a.slice(d)),e>d&&n(a))}k.push(c)}return p(k)}function u(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],q=[],s=D,t=d||f&&x.find.TAG("*",j),u=Q+=null==s?1:Math.random()||.1,v=t.length;for(j&&(D=g===H||g||j);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0,g||k.ownerDocument===H||(G(k),h=!J);m=a[l++];)if(m(k,g||H,h)){i.push(k);break}j&&(Q=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,q,g,h);if(d){if(n>0)for(;o--;)p[o]||q[o]||(q[o]=Y.call(i));q=r(q)}$.apply(i,q),j&&!d&&q.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(Q=u,D=s),p};return e?d(g):g}var v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O="sizzle"+1*new Date,P=a.document,Q=0,R=0,S=c(),T=c(),U=c(),V=function(a,b){return a===b&&(F=!0),0},W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,aa=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},ba="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ca="[\\x20\\t\\r\\n\\f]",da="(?:\\\\.|[\\w-]|[^\x00-\\xa0])+",ea="\\["+ca+"*("+da+")(?:"+ca+"*([*^$|!~]?=)"+ca+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+da+"))|)"+ca+"*\\]",fa=":("+da+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ea+")*)|.*)\\)|)",ga=new RegExp(ca+"+","g"),ha=new RegExp("^"+ca+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ca+"+$","g"),ia=new RegExp("^"+ca+"*,"+ca+"*"),ja=new RegExp("^"+ca+"*([>+~]|"+ca+")"+ca+"*"),ka=new RegExp("="+ca+"*([^\\]'\"]*?)"+ca+"*\\]","g"),la=new RegExp(fa),ma=new RegExp("^"+da+"$"),na={ID:new RegExp("^#("+da+")"),CLASS:new RegExp("^\\.("+da+")"),TAG:new RegExp("^("+da+"|[*])"),ATTR:new RegExp("^"+ea),PSEUDO:new RegExp("^"+fa),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ca+"*(even|odd|(([+-]|)(\\d*)n|)"+ca+"*(?:([+-]|)"+ca+"*(\\d+)|))"+ca+"*\\)|)","i"),bool:new RegExp("^(?:"+ba+")$","i"),needsContext:new RegExp("^"+ca+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ca+"*((?:-\\d)?\\d*)"+ca+"*\\)|)(?=[^-]|$)","i")},oa=/^(?:input|select|textarea|button)$/i,pa=/^h\d$/i,qa=/^[^{]+\{\s*\[native \w/,ra=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,sa=/[+~]/,ta=new RegExp("\\\\([\\da-f]{1,6}"+ca+"?|("+ca+")|.)","ig"),ua=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},va=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g,wa=function(a,b){return b?"\x00"===a?"�":a.slice(0,-1)+"\\"+a.charCodeAt(a.length-1).toString(16)+" ":"\\"+a},xa=function(){G()},ya=o(function(a){return a.disabled===!0},{dir:"parentNode",next:"legend"});try{$.apply(X=_.call(P.childNodes),P.childNodes),X[P.childNodes.length].nodeType}catch(za){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}w=b.support={},z=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},G=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:P;return d!==H&&9===d.nodeType&&d.documentElement?(H=d,I=H.documentElement,J=!z(H),P!==H&&(c=H.defaultView)&&c.top!==c&&(c.addEventListener?c.addEventListener("unload",xa,!1):c.attachEvent&&c.attachEvent("onunload",xa)),w.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),w.getElementsByTagName=e(function(a){return a.appendChild(H.createComment("")),!a.getElementsByTagName("*").length}),w.getElementsByClassName=qa.test(H.getElementsByClassName),w.getById=e(function(a){return I.appendChild(a).id=O,!H.getElementsByName||!H.getElementsByName(O).length}),w.getById?(x.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&J){var c=b.getElementById(a);return c?[c]:[]}},x.filter.ID=function(a){var b=a.replace(ta,ua);return function(a){return a.getAttribute("id")===b}}):(delete x.find.ID,x.filter.ID=function(a){var b=a.replace(ta,ua);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),x.find.TAG=w.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):w.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},x.find.CLASS=w.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&J?b.getElementsByClassName(a):void 0},L=[],K=[],(w.qsa=qa.test(H.querySelectorAll))&&(e(function(a){I.appendChild(a).innerHTML="<a id='"+O+"'></a><select id='"+O+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&K.push("[*^$]="+ca+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||K.push("\\["+ca+"*(?:value|"+ba+")"),a.querySelectorAll("[id~="+O+"-]").length||K.push("~="),a.querySelectorAll(":checked").length||K.push(":checked"),a.querySelectorAll("a#"+O+"+*").length||K.push(".#.+[+~]")}),e(function(a){a.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var b=H.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&K.push("name"+ca+"*[*^$|!~]?="),2!==a.querySelectorAll(":enabled").length&&K.push(":enabled",":disabled"),I.appendChild(a).disabled=!0,2!==a.querySelectorAll(":disabled").length&&K.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),K.push(",.*:")})),(w.matchesSelector=qa.test(M=I.matches||I.webkitMatchesSelector||I.mozMatchesSelector||I.oMatchesSelector||I.msMatchesSelector))&&e(function(a){w.disconnectedMatch=M.call(a,"*"),M.call(a,"[s!='']:x"),L.push("!=",fa)}),K=K.length&&new RegExp(K.join("|")),L=L.length&&new RegExp(L.join("|")),b=qa.test(I.compareDocumentPosition),N=b||qa.test(I.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},V=b?function(a,b){if(a===b)return F=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!w.sortDetached&&b.compareDocumentPosition(a)===c?a===H||a.ownerDocument===P&&N(P,a)?-1:b===H||b.ownerDocument===P&&N(P,b)?1:E?aa(E,a)-aa(E,b):0:4&c?-1:1)}:function(a,b){if(a===b)return F=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===H?-1:b===H?1:e?-1:f?1:E?aa(E,a)-aa(E,b):0;if(e===f)return g(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?g(h[d],i[d]):h[d]===P?-1:i[d]===P?1:0},H):H},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==H&&G(a),c=c.replace(ka,"='$1']"),w.matchesSelector&&J&&!U[c+" "]&&(!L||!L.test(c))&&(!K||!K.test(c)))try{var d=M.call(a,c);if(d||w.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,H,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==H&&G(a),N(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==H&&G(a);var c=x.attrHandle[b.toLowerCase()],d=c&&W.call(x.attrHandle,b.toLowerCase())?c(a,b,!J):void 0;return void 0!==d?d:w.attributes||!J?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.escape=function(a){return(a+"").replace(va,wa)},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(F=!w.detectDuplicates,E=!w.sortStable&&a.slice(0),a.sort(V),F){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return E=null,a},y=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=y(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=y(b);return c},x=b.selectors={cacheLength:50,createPseudo:d,match:na,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ta,ua),a[3]=(a[3]||a[4]||a[5]||"").replace(ta,ua),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return na.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&la.test(c)&&(b=A(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ta,ua).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=S[a+" "];return b||(b=new RegExp("(^|"+ca+")"+a+"("+ca+"|$)"))&&S(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ga," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(m=q,l=m[O]||(m[O]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===Q&&j[1],t=n&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[Q,n,t];break}}else if(s&&(m=b,l=m[O]||(m[O]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===Q&&j[1],t=n),t===!1)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&(l=m[O]||(m[O]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[Q,t]),m!==b)););return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,c){var e,f=x.pseudos[a]||x.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[O]?f(c):f.length>1?(e=[a,a,"",c],x.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=aa(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=B(a.replace(ha,"$1"));return e[O]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(ta,ua),function(b){return(b.textContent||b.innerText||y(b)).indexOf(a)>-1}}),lang:d(function(a){return ma.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(ta,ua).toLowerCase(),function(b){var c;do if(c=J?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===I},focus:function(a){return a===H.activeElement&&(!H.hasFocus||H.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:j(!1),disabled:j(!0),checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0;
},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!x.pseudos.empty(a)},header:function(a){return pa.test(a.nodeName)},input:function(a){return oa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:k(function(){return[0]}),last:k(function(a,b){return[b-1]}),eq:k(function(a,b,c){return[0>c?c+b:c]}),even:k(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:k(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:k(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:k(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},x.pseudos.nth=x.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[v]=h(v);for(v in{submit:!0,reset:!0})x.pseudos[v]=i(v);return m.prototype=x.filters=x.pseudos,x.setFilters=new m,A=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=T[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=x.preFilter;h;){(!d||(e=ia.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ja.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ha," ")}),h=h.slice(d.length));for(g in x.filter)!(e=na[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):T(a,i).slice(0)},B=b.compile=function(a,b){var c,d=[],e=[],f=U[a+" "];if(!f){for(b||(b=A(a)),c=b.length;c--;)f=t(b[c]),f[O]?d.push(f):e.push(f);f=U(a,u(e,d)),f.selector=a}return f},C=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,k=!d&&A(a=j.selector||a);if(c=c||[],1===k.length){if(f=k[0]=k[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&w.getById&&9===b.nodeType&&J&&x.relative[f[1].type]){if(b=(x.find.ID(g.matches[0].replace(ta,ua),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=na.needsContext.test(a)?0:f.length;e--&&(g=f[e],!x.relative[h=g.type]);)if((i=x.find[h])&&(d=i(g.matches[0].replace(ta,ua),sa.test(f[0].type)&&l(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&n(f),!a)return $.apply(c,d),c;break}}return(j||B(a,k))(d,b,!J,c,!b||sa.test(a)&&l(b.parentNode)||b),c},w.sortStable=O.split("").sort(V).join("")===O,w.detectDuplicates=!!F,G(),w.sortDetached=e(function(a){return 1&a.compareDocumentPosition(H.createElement("fieldset"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),w.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(ba,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);ma.find=ra,ma.expr=ra.selectors,ma.expr[":"]=ma.expr.pseudos,ma.uniqueSort=ma.unique=ra.uniqueSort,ma.text=ra.getText,ma.isXMLDoc=ra.isXML,ma.contains=ra.contains,ma.escapeSelector=ra.escape;var sa=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&ma(a).is(c))break;d.push(a)}return d},ta=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},ua=ma.expr.match.needsContext,va=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,wa=/^.[^:#\[\.,]*$/;ma.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?ma.find.matchesSelector(d,a)?[d]:[]:ma.find.matches(a,ma.grep(b,function(a){return 1===a.nodeType}))},ma.fn.extend({find:function(a){var b,c,d=this.length,e=this;if("string"!=typeof a)return this.pushStack(ma(a).filter(function(){for(b=0;d>b;b++)if(ma.contains(e[b],this))return!0}));for(c=this.pushStack([]),b=0;d>b;b++)ma.find(a,e[b],c);return d>1?ma.uniqueSort(c):c},filter:function(a){return this.pushStack(e(this,a||[],!1))},not:function(a){return this.pushStack(e(this,a||[],!0))},is:function(a){return!!e(this,"string"==typeof a&&ua.test(a)?ma(a):a||[],!1).length}});var xa,ya=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,za=ma.fn.init=function(a,b,c){var d,e;if(!a)return this;if(c=c||xa,"string"==typeof a){if(d="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:ya.exec(a),!d||!d[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(d[1]){if(b=b instanceof ma?b[0]:b,ma.merge(this,ma.parseHTML(d[1],b&&b.nodeType?b.ownerDocument||b:_,!0)),va.test(d[1])&&ma.isPlainObject(b))for(d in b)ma.isFunction(this[d])?this[d](b[d]):this.attr(d,b[d]);return this}return e=_.getElementById(d[2]),e&&(this[0]=e,this.length=1),this}return a.nodeType?(this[0]=a,this.length=1,this):ma.isFunction(a)?void 0!==c.ready?c.ready(a):a(ma):ma.makeArray(a,this)};za.prototype=ma.fn,xa=ma(_);var Aa=/^(?:parents|prev(?:Until|All))/,Ba={children:!0,contents:!0,next:!0,prev:!0};ma.fn.extend({has:function(a){var b=ma(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(ma.contains(this,b[a]))return!0})},closest:function(a,b){var c,d=0,e=this.length,f=[],g="string"!=typeof a&&ma(a);if(!ua.test(a))for(;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&ma.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?ma.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?ea.call(ma(a),this[0]):ea.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(ma.uniqueSort(ma.merge(this.get(),ma(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),ma.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return sa(a,"parentNode")},parentsUntil:function(a,b,c){return sa(a,"parentNode",c)},next:function(a){return f(a,"nextSibling")},prev:function(a){return f(a,"previousSibling")},nextAll:function(a){return sa(a,"nextSibling")},prevAll:function(a){return sa(a,"previousSibling")},nextUntil:function(a,b,c){return sa(a,"nextSibling",c)},prevUntil:function(a,b,c){return sa(a,"previousSibling",c)},siblings:function(a){return ta((a.parentNode||{}).firstChild,a)},children:function(a){return ta(a.firstChild)},contents:function(a){return a.contentDocument||ma.merge([],a.childNodes)}},function(a,b){ma.fn[a]=function(c,d){var e=ma.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=ma.filter(d,e)),this.length>1&&(Ba[a]||ma.uniqueSort(e),Aa.test(a)&&e.reverse()),this.pushStack(e)}});var Ca=/\S+/g;ma.Callbacks=function(a){a="string"==typeof a?g(a):ma.extend({},a);var b,c,d,e,f=[],h=[],i=-1,j=function(){for(e=a.once,d=b=!0;h.length;i=-1)for(c=h.shift();++i<f.length;)f[i].apply(c[0],c[1])===!1&&a.stopOnFalse&&(i=f.length,c=!1);a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},k={add:function(){return f&&(c&&!b&&(i=f.length-1,h.push(c)),function d(b){ma.each(b,function(b,c){ma.isFunction(c)?a.unique&&k.has(c)||f.push(c):c&&c.length&&"string"!==ma.type(c)&&d(c)})}(arguments),c&&!b&&j()),this},remove:function(){return ma.each(arguments,function(a,b){for(var c;(c=ma.inArray(b,f,c))>-1;)f.splice(c,1),i>=c&&i--}),this},has:function(a){return a?ma.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=h=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=h=[],c||b||(f=c=""),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],h.push(c),b||j()),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},ma.extend({Deferred:function(b){var c=[["notify","progress",ma.Callbacks("memory"),ma.Callbacks("memory"),2],["resolve","done",ma.Callbacks("once memory"),ma.Callbacks("once memory"),0,"resolved"],["reject","fail",ma.Callbacks("once memory"),ma.Callbacks("once memory"),1,"rejected"]],d="pending",e={state:function(){return d},always:function(){return f.done(arguments).fail(arguments),this},"catch":function(a){return e.then(null,a)},pipe:function(){var a=arguments;return ma.Deferred(function(b){ma.each(c,function(c,d){var e=ma.isFunction(a[d[4]])&&a[d[4]];f[d[1]](function(){var a=e&&e.apply(this,arguments);a&&ma.isFunction(a.promise)?a.promise().progress(b.notify).done(b.resolve).fail(b.reject):b[d[0]+"With"](this,e?[a]:arguments)})}),a=null}).promise()},then:function(b,d,e){function f(b,c,d,e){return function(){var j=this,k=arguments,l=function(){var a,l;if(!(g>b)){if(a=d.apply(j,k),a===c.promise())throw new TypeError("Thenable self-resolution");l=a&&("object"==typeof a||"function"==typeof a)&&a.then,ma.isFunction(l)?e?l.call(a,f(g,c,h,e),f(g,c,i,e)):(g++,l.call(a,f(g,c,h,e),f(g,c,i,e),f(g,c,h,c.notifyWith))):(d!==h&&(j=void 0,k=[a]),(e||c.resolveWith)(j,k))}},m=e?l:function(){try{l()}catch(a){ma.Deferred.exceptionHook&&ma.Deferred.exceptionHook(a,m.stackTrace),b+1>=g&&(d!==i&&(j=void 0,k=[a]),c.rejectWith(j,k))}};b?m():(ma.Deferred.getStackHook&&(m.stackTrace=ma.Deferred.getStackHook()),a.setTimeout(m))}}var g=0;return ma.Deferred(function(a){c[0][3].add(f(0,a,ma.isFunction(e)?e:h,a.notifyWith)),c[1][3].add(f(0,a,ma.isFunction(b)?b:h)),c[2][3].add(f(0,a,ma.isFunction(d)?d:i))}).promise()},promise:function(a){return null!=a?ma.extend(a,e):e}},f={};return ma.each(c,function(a,b){var g=b[2],h=b[5];e[b[1]]=g.add,h&&g.add(function(){d=h},c[3-a][2].disable,c[0][2].lock),g.add(b[3].fire),f[b[0]]=function(){return f[b[0]+"With"](this===f?void 0:this,arguments),this},f[b[0]+"With"]=g.fireWith}),e.promise(f),b&&b.call(f,f),f},when:function(a){var b=arguments.length,c=b,d=Array(c),e=ba.call(arguments),f=ma.Deferred(),g=function(a){return function(c){d[a]=this,e[a]=arguments.length>1?ba.call(arguments):c,--b||f.resolveWith(d,e)}};if(1>=b&&(j(a,f.done(g(c)).resolve,f.reject),"pending"===f.state()||ma.isFunction(e[c]&&e[c].then)))return f.then();for(;c--;)j(e[c],g(c),f.reject);return f.promise()}});var Da=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ma.Deferred.exceptionHook=function(b,c){a.console&&a.console.warn&&b&&Da.test(b.name)&&a.console.warn("jQuery.Deferred exception: "+b.message,b.stack,c)},ma.readyException=function(b){a.setTimeout(function(){throw b})};var Ea=ma.Deferred();ma.fn.ready=function(a){return Ea.then(a)["catch"](function(a){ma.readyException(a)}),this},ma.extend({isReady:!1,readyWait:1,holdReady:function(a){a?ma.readyWait++:ma.ready(!0)},ready:function(a){(a===!0?--ma.readyWait:ma.isReady)||(ma.isReady=!0,a!==!0&&--ma.readyWait>0||Ea.resolveWith(_,[ma]))}}),ma.ready.then=Ea.then,"complete"===_.readyState||"loading"!==_.readyState&&!_.documentElement.doScroll?a.setTimeout(ma.ready):(_.addEventListener("DOMContentLoaded",k),a.addEventListener("load",k));var Fa=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===ma.type(c)){e=!0;for(h in c)Fa(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,ma.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(ma(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Ga=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType};l.uid=1,l.prototype={cache:function(a){var b=a[this.expando];return b||(b={},Ga(a)&&(a.nodeType?a[this.expando]=b:Object.defineProperty(a,this.expando,{value:b,configurable:!0}))),b},set:function(a,b,c){var d,e=this.cache(a);if("string"==typeof b)e[ma.camelCase(b)]=c;else for(d in b)e[ma.camelCase(d)]=b[d];return e},get:function(a,b){return void 0===b?this.cache(a):a[this.expando]&&a[this.expando][ma.camelCase(b)]},access:function(a,b,c){return void 0===b||b&&"string"==typeof b&&void 0===c?this.get(a,b):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d=a[this.expando];if(void 0!==d){if(void 0!==b){ma.isArray(b)?b=b.map(ma.camelCase):(b=ma.camelCase(b),b=b in d?[b]:b.match(Ca)||[]),c=b.length;for(;c--;)delete d[b[c]]}(void 0===b||ma.isEmptyObject(d))&&(a.nodeType?a[this.expando]=void 0:delete a[this.expando])}},hasData:function(a){var b=a[this.expando];return void 0!==b&&!ma.isEmptyObject(b)}};var Ha=new l,Ia=new l,Ja=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ka=/[A-Z]/g;ma.extend({hasData:function(a){return Ia.hasData(a)||Ha.hasData(a)},data:function(a,b,c){return Ia.access(a,b,c)},removeData:function(a,b){Ia.remove(a,b)},_data:function(a,b,c){return Ha.access(a,b,c)},_removeData:function(a,b){Ha.remove(a,b)}}),ma.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=Ia.get(f),1===f.nodeType&&!Ha.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=ma.camelCase(d.slice(5)),m(f,d,e[d])));Ha.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){Ia.set(this,a)}):Fa(this,function(b){var c;if(f&&void 0===b){if(c=Ia.get(f,a),void 0!==c)return c;if(c=m(f,a),void 0!==c)return c}else this.each(function(){Ia.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){Ia.remove(this,a)})}}),ma.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=Ha.get(a,b),c&&(!d||ma.isArray(c)?d=Ha.access(a,b,ma.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=ma.queue(a,b),d=c.length,e=c.shift(),f=ma._queueHooks(a,b),g=function(){ma.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return Ha.get(a,c)||Ha.access(a,c,{empty:ma.Callbacks("once memory").add(function(){Ha.remove(a,[b+"queue",c])})})}}),ma.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?ma.queue(this[0],a):void 0===b?this:this.each(function(){var c=ma.queue(this,a,b);ma._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&ma.dequeue(this,a)})},dequeue:function(a){return this.each(function(){ma.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=ma.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=Ha.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var La=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ma=new RegExp("^(?:([+-])=|)("+La+")([a-z%]*)$","i"),Na=["Top","Right","Bottom","Left"],Oa=function(a,b){return a=b||a,"none"===a.style.display||""===a.style.display&&ma.contains(a.ownerDocument,a)&&"none"===ma.css(a,"display")},Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa={};ma.fn.extend({show:function(){return p(this,!0)},hide:function(){return p(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){Oa(this)?ma(this).show():ma(this).hide()})}});var Ra=/^(?:checkbox|radio)$/i,Sa=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Ta=/^$|\/(?:java|ecma)script/i,Ua={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ua.optgroup=Ua.option,Ua.tbody=Ua.tfoot=Ua.colgroup=Ua.caption=Ua.thead,Ua.th=Ua.td;var Va=/<|&#?\w+;/;!function(){var a=_.createDocumentFragment(),b=a.appendChild(_.createElement("div")),c=_.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),ka.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",ka.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var Wa=_.documentElement,Xa=/^key/,Ya=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Za=/^([^.]*)(?:\.(.+)|)/;ma.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ha.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),e&&ma.find.matchesSelector(Wa,e),c.guid||(c.guid=ma.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return"undefined"!=typeof ma&&ma.event.triggered!==b.type?ma.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(Ca)||[""],j=b.length;j--;)h=Za.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=ma.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=ma.event.special[n]||{},k=ma.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&ma.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),ma.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=Ha.hasData(a)&&Ha.get(a);if(q&&(i=q.events)){for(b=(b||"").match(Ca)||[""],j=b.length;j--;)if(h=Za.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=ma.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||ma.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)ma.event.remove(a,n+b[j],c,d,!0);ma.isEmptyObject(i)&&Ha.remove(a,"handle events")}},dispatch:function(a){var b,c,d,e,f,g,h=ma.event.fix(a),i=new Array(arguments.length),j=(Ha.get(this,"events")||{})[h.type]||[],k=ma.event.special[h.type]||{};for(i[0]=h,b=1;b<arguments.length;b++)i[b]=arguments[b];if(h.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,h)!==!1){for(g=ma.event.handlers.call(this,h,j),b=0;(e=g[b++])&&!h.isPropagationStopped();)for(h.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!h.isImmediatePropagationStopped();)(!h.rnamespace||h.rnamespace.test(f.namespace))&&(h.handleObj=f,h.data=f.data,d=((ma.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,i),void 0!==d&&(h.result=d)===!1&&(h.preventDefault(),h.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,h),h.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!==this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?ma(e,this).index(i)>-1:ma.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},addProp:function(a,b){Object.defineProperty(ma.Event.prototype,a,{enumerable:!0,configurable:!0,get:ma.isFunction(b)?function(){return this.originalEvent?b(this.originalEvent):void 0}:function(){return this.originalEvent?this.originalEvent[a]:void 0},set:function(b){Object.defineProperty(this,a,{enumerable:!0,configurable:!0,writable:!0,value:b})}})},fix:function(a){return a[ma.expando]?a:new ma.Event(a)},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==v()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===v()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&ma.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return ma.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}}},ma.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)},ma.Event=function(a,b){return this instanceof ma.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?t:u,this.target=a.target&&3===a.target.nodeType?a.target.parentNode:a.target,this.currentTarget=a.currentTarget,this.relatedTarget=a.relatedTarget):this.type=a,b&&ma.extend(this,b),this.timeStamp=a&&a.timeStamp||ma.now(),void(this[ma.expando]=!0)):new ma.Event(a,b)},ma.Event.prototype={constructor:ma.Event,isDefaultPrevented:u,isPropagationStopped:u,isImmediatePropagationStopped:u,isSimulated:!1,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=t,a&&!this.isSimulated&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=t,a&&!this.isSimulated&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=t,a&&!this.isSimulated&&a.stopImmediatePropagation(),this.stopPropagation()}},ma.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(a){var b=a.button;return null==a.which&&Xa.test(a.type)?null!=a.charCode?a.charCode:a.keyCode:!a.which&&void 0!==b&&Ya.test(a.type)?1&b?1:2&b?3:4&b?2:0:a.which}},ma.event.addProp),ma.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){ma.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!ma.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),ma.fn.extend({on:function(a,b,c,d){return w(this,a,b,c,d)},one:function(a,b,c,d){return w(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,ma(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=u),this.each(function(){ma.event.remove(this,a,c,b)})}});var $a=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,_a=/<script|<style|<link/i,ab=/checked\s*(?:[^=]|=\s*.checked.)/i,bb=/^true\/(.*)/,cb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ma.extend({htmlPrefilter:function(a){return a.replace($a,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=ma.contains(a.ownerDocument,a);if(!(ka.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||ma.isXMLDoc(a)))for(g=q(h),f=q(a),d=0,e=f.length;e>d;d++)B(f[d],g[d]);if(b)if(c)for(f=f||q(a),g=g||q(h),d=0,e=f.length;e>d;d++)A(f[d],g[d]);else A(a,h);return g=q(h,"script"),g.length>0&&r(g,!i&&q(a,"script")),h},cleanData:function(a){for(var b,c,d,e=ma.event.special,f=0;void 0!==(c=a[f]);f++)if(Ga(c)){if(b=c[Ha.expando]){if(b.events)for(d in b.events)e[d]?ma.event.remove(c,d):ma.removeEvent(c,d,b.handle);c[Ha.expando]=void 0}c[Ia.expando]&&(c[Ia.expando]=void 0)}}}),ma.fn.extend({detach:function(a){return D(this,a,!0)},remove:function(a){return D(this,a)},text:function(a){return Fa(this,function(a){return void 0===a?ma.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return C(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=x(this,a);b.appendChild(a)}})},prepend:function(){return C(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=x(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return C(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return C(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(ma.cleanData(q(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return ma.clone(this,a,b)})},html:function(a){return Fa(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!_a.test(a)&&!Ua[(Sa.exec(a)||["",""])[1].toLowerCase()]){a=ma.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(ma.cleanData(q(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return C(this,arguments,function(b){var c=this.parentNode;ma.inArray(this,a)<0&&(ma.cleanData(q(this)),c&&c.replaceChild(b,this))},a)}}),ma.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){ma.fn[a]=function(a){for(var c,d=[],e=ma(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),ma(e[g])[b](c),da.apply(d,c.get());return this.pushStack(d)}});var db=/^margin/,eb=new RegExp("^("+La+")(?!px)[a-z%]+$","i"),fb=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)};!function(){function b(){if(h){h.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",h.innerHTML="",Wa.appendChild(g);var b=a.getComputedStyle(h);c="1%"!==b.top,f="2px"===b.marginLeft,d="4px"===b.width,h.style.marginRight="50%",e="4px"===b.marginRight,Wa.removeChild(g),h=null}}var c,d,e,f,g=_.createElement("div"),h=_.createElement("div");h.style&&(h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",ka.clearCloneStyle="content-box"===h.style.backgroundClip,g.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",g.appendChild(h),ma.extend(ka,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return b(),d},pixelMarginRight:function(){return b(),e},reliableMarginLeft:function(){return b(),f}}))}();var gb=/^(none|table(?!-c[ea]).+)/,hb={position:"absolute",visibility:"hidden",display:"block"},ib={letterSpacing:"0",fontWeight:"400"},jb=["Webkit","Moz","ms"],kb=_.createElement("div").style;ma.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=E(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=ma.camelCase(b),i=a.style;return b=ma.cssProps[h]||(ma.cssProps[h]=G(h)||h),g=ma.cssHooks[b]||ma.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ma.exec(c))&&e[1]&&(c=n(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(ma.cssNumber[h]?"":"px")),ka.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=ma.camelCase(b);return b=ma.cssProps[h]||(ma.cssProps[h]=G(h)||h),g=ma.cssHooks[b]||ma.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=E(a,b,d)),"normal"===e&&b in ib&&(e=ib[b]),""===c||c?(f=parseFloat(e),c===!0||isFinite(f)?f||0:e):e}}),ma.each(["height","width"],function(a,b){ma.cssHooks[b]={get:function(a,c,d){return c?!gb.test(ma.css(a,"display"))||a.getClientRects().length&&a.getBoundingClientRect().width?J(a,b,d):Pa(a,hb,function(){return J(a,b,d)}):void 0},set:function(a,c,d){var e,f=d&&fb(a),g=d&&I(a,b,d,"border-box"===ma.css(a,"boxSizing",!1,f),f);return g&&(e=Ma.exec(c))&&"px"!==(e[3]||"px")&&(a.style[b]=c,c=ma.css(a,b)),H(a,c,g)}}}),ma.cssHooks.marginLeft=F(ka.reliableMarginLeft,function(a,b){return b?(parseFloat(E(a,"marginLeft"))||a.getBoundingClientRect().left-Pa(a,{marginLeft:0},function(){return a.getBoundingClientRect().left}))+"px":void 0}),ma.each({margin:"",padding:"",border:"Width"},function(a,b){ma.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+Na[d]+b]=f[d]||f[d-2]||f[0];return e}},db.test(a)||(ma.cssHooks[a+b].set=H)}),ma.fn.extend({css:function(a,b){return Fa(this,function(a,b,c){var d,e,f={},g=0;if(ma.isArray(b)){for(d=fb(a),e=b.length;e>g;g++)f[b[g]]=ma.css(a,b[g],!1,d);return f}return void 0!==c?ma.style(a,b,c):ma.css(a,b)},a,b,arguments.length>1)}}),ma.Tween=K,K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||ma.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(ma.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.options.duration?this.pos=b=ma.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}},K.prototype.init.prototype=K.prototype,K.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=ma.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){ma.fx.step[a.prop]?ma.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[ma.cssProps[a.prop]]&&!ma.cssHooks[a.prop]?a.elem[a.prop]=a.now:ma.style(a.elem,a.prop,a.now+a.unit)}}},K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},ma.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},ma.fx=K.prototype.init,ma.fx.step={};var lb,mb,nb=/^(?:toggle|show|hide)$/,ob=/queueHooks$/;ma.Animation=ma.extend(R,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return n(c.elem,a,Ma.exec(b),c),c}]},tweener:function(a,b){ma.isFunction(a)?(b=a,a=["*"]):a=a.match(Ca);for(var c,d=0,e=a.length;e>d;d++)c=a[d],R.tweeners[c]=R.tweeners[c]||[],R.tweeners[c].unshift(b)},prefilters:[P],prefilter:function(a,b){b?R.prefilters.unshift(a):R.prefilters.push(a)}}),ma.speed=function(a,b,c){var d=a&&"object"==typeof a?ma.extend({},a):{complete:c||!c&&b||ma.isFunction(a)&&a,duration:a,easing:c&&b||b&&!ma.isFunction(b)&&b};return ma.fx.off||_.hidden?d.duration=0:d.duration="number"==typeof d.duration?d.duration:d.duration in ma.fx.speeds?ma.fx.speeds[d.duration]:ma.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){ma.isFunction(d.old)&&d.old.call(this),d.queue&&ma.dequeue(this,d.queue)},d},ma.fn.extend({fadeTo:function(a,b,c,d){return this.filter(Oa).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=ma.isEmptyObject(a),f=ma.speed(b,c,d),g=function(){var b=R(this,ma.extend({},a),f);(e||Ha.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=ma.timers,g=Ha.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ob.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&ma.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=Ha.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=ma.timers,g=d?d.length:0;for(c.finish=!0,
ma.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),ma.each(["toggle","show","hide"],function(a,b){var c=ma.fn[b];ma.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(N(b,!0),a,d,e)}}),ma.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){ma.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),ma.timers=[],ma.fx.tick=function(){var a,b=0,c=ma.timers;for(lb=ma.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||ma.fx.stop(),lb=void 0},ma.fx.timer=function(a){ma.timers.push(a),a()?ma.fx.start():ma.timers.pop()},ma.fx.interval=13,ma.fx.start=function(){mb||(mb=a.requestAnimationFrame?a.requestAnimationFrame(L):a.setInterval(ma.fx.tick,ma.fx.interval))},ma.fx.stop=function(){a.cancelAnimationFrame?a.cancelAnimationFrame(mb):a.clearInterval(mb),mb=null},ma.fx.speeds={slow:600,fast:200,_default:400},ma.fn.delay=function(b,c){return b=ma.fx?ma.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a=_.createElement("input"),b=_.createElement("select"),c=b.appendChild(_.createElement("option"));a.type="checkbox",ka.checkOn=""!==a.value,ka.optSelected=c.selected,a=_.createElement("input"),a.value="t",a.type="radio",ka.radioValue="t"===a.value}();var pb,qb=ma.expr.attrHandle;ma.fn.extend({attr:function(a,b){return Fa(this,ma.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){ma.removeAttr(this,a)})}}),ma.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?ma.prop(a,b,c):(1===f&&ma.isXMLDoc(a)||(e=ma.attrHooks[b.toLowerCase()]||(ma.expr.match.bool.test(b)?pb:void 0)),void 0!==c?null===c?void ma.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=ma.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!ka.radioValue&&"radio"===b&&ma.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d=0,e=b&&b.match(Ca);if(e&&1===a.nodeType)for(;c=e[d++];)a.removeAttribute(c)}}),pb={set:function(a,b,c){return b===!1?ma.removeAttr(a,c):a.setAttribute(c,c),c}},ma.each(ma.expr.match.bool.source.match(/\w+/g),function(a,b){var c=qb[b]||ma.find.attr;qb[b]=function(a,b,d){var e,f,g=b.toLowerCase();return d||(f=qb[g],qb[g]=e,e=null!=c(a,b,d)?g:null,qb[g]=f),e}});var rb=/^(?:input|select|textarea|button)$/i,sb=/^(?:a|area)$/i;ma.fn.extend({prop:function(a,b){return Fa(this,ma.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[ma.propFix[a]||a]})}}),ma.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&ma.isXMLDoc(a)||(b=ma.propFix[b]||b,e=ma.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=ma.find.attr(a,"tabindex");return b?parseInt(b,10):rb.test(a.nodeName)||sb.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),ka.optSelected||(ma.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),ma.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ma.propFix[this.toLowerCase()]=this});var tb=/[\t\r\n\f]/g;ma.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(ma.isFunction(a))return this.each(function(b){ma(this).addClass(a.call(this,b,S(this)))});if("string"==typeof a&&a)for(b=a.match(Ca)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(tb," ")){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=ma.trim(d),e!==h&&c.setAttribute("class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(ma.isFunction(a))return this.each(function(b){ma(this).removeClass(a.call(this,b,S(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(Ca)||[];c=this[i++];)if(e=S(c),d=1===c.nodeType&&(" "+e+" ").replace(tb," ")){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");h=ma.trim(d),e!==h&&c.setAttribute("class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):ma.isFunction(a)?this.each(function(c){ma(this).toggleClass(a.call(this,c,S(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c)for(d=0,e=ma(this),f=a.match(Ca)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(void 0===a||"boolean"===c)&&(b=S(this),b&&Ha.set(this,"__className__",b),this.setAttribute&&this.setAttribute("class",b||a===!1?"":Ha.get(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+S(c)+" ").replace(tb," ").indexOf(b)>-1)return!0;return!1}});var ub=/\r/g,vb=/[\x20\t\r\n\f]+/g;ma.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=ma.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,ma(this).val()):a,null==e?e="":"number"==typeof e?e+="":ma.isArray(e)&&(e=ma.map(e,function(a){return null==a?"":a+""})),b=ma.valHooks[this.type]||ma.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=ma.valHooks[e.type]||ma.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ub,""):null==c?"":c)}}}),ma.extend({valHooks:{option:{get:function(a){var b=ma.find.attr(a,"value");return null!=b?b:ma.trim(ma.text(a)).replace(vb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&!c.disabled&&(!c.parentNode.disabled||!ma.nodeName(c.parentNode,"optgroup"))){if(b=ma(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=ma.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=ma.inArray(ma.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),ma.each(["radio","checkbox"],function(){ma.valHooks[this]={set:function(a,b){return ma.isArray(b)?a.checked=ma.inArray(ma(a).val(),b)>-1:void 0}},ka.checkOn||(ma.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var wb=/^(?:focusinfocus|focusoutblur)$/;ma.extend(ma.event,{trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||_],n=ha.call(b,"type")?b.type:b,o=ha.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||_,3!==d.nodeType&&8!==d.nodeType&&!wb.test(n+ma.event.triggered)&&(n.indexOf(".")>-1&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[ma.expando]?b:new ma.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:ma.makeArray(c,[b]),l=ma.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!ma.isWindow(d)){for(i=l.delegateType||n,wb.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||_)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(Ha.get(g,"events")||{})[b.type]&&Ha.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&Ga(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!Ga(d)||j&&ma.isFunction(d[n])&&!ma.isWindow(d)&&(h=d[j],h&&(d[j]=null),ma.event.triggered=n,d[n](),ma.event.triggered=void 0,h&&(d[j]=h)),b.result}},simulate:function(a,b,c){var d=ma.extend(new ma.Event,c,{type:a,isSimulated:!0});ma.event.trigger(d,null,b)}}),ma.fn.extend({trigger:function(a,b){return this.each(function(){ma.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?ma.event.trigger(a,b,c,!0):void 0}}),ma.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(a,b){ma.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),ma.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),ka.focusin="onfocusin"in a,ka.focusin||ma.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){ma.event.simulate(b,a.target,ma.event.fix(a))};ma.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=Ha.access(d,b);e||d.addEventListener(a,c,!0),Ha.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=Ha.access(d,b)-1;e?Ha.access(d,b,e):(d.removeEventListener(a,c,!0),Ha.remove(d,b))}}});var xb=a.location,yb=ma.now(),zb=/\?/;ma.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{c=(new a.DOMParser).parseFromString(b,"text/xml")}catch(d){c=void 0}return(!c||c.getElementsByTagName("parsererror").length)&&ma.error("Invalid XML: "+b),c};var Ab=/\[\]$/,Bb=/\r?\n/g,Cb=/^(?:submit|button|image|reset|file)$/i,Db=/^(?:input|select|textarea|keygen)/i;ma.param=function(a,b){var c,d=[],e=function(a,b){var c=ma.isFunction(b)?b():b;d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(null==c?"":c)};if(ma.isArray(a)||a.jquery&&!ma.isPlainObject(a))ma.each(a,function(){e(this.name,this.value)});else for(c in a)T(c,a[c],b,e);return d.join("&")},ma.fn.extend({serialize:function(){return ma.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=ma.prop(this,"elements");return a?ma.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!ma(this).is(":disabled")&&Db.test(this.nodeName)&&!Cb.test(a)&&(this.checked||!Ra.test(a))}).map(function(a,b){var c=ma(this).val();return null==c?null:ma.isArray(c)?ma.map(c,function(a){return{name:b.name,value:a.replace(Bb,"\r\n")}}):{name:b.name,value:c.replace(Bb,"\r\n")}}).get()}});var Eb=/%20/g,Fb=/#.*$/,Gb=/([?&])_=[^&]*/,Hb=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ib=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Jb=/^(?:GET|HEAD)$/,Kb=/^\/\//,Lb={},Mb={},Nb="*/".concat("*"),Ob=_.createElement("a");Ob.href=xb.href,ma.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xb.href,type:"GET",isLocal:Ib.test(xb.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Nb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ma.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?W(W(a,ma.ajaxSettings),b):W(ma.ajaxSettings,a)},ajaxPrefilter:U(Lb),ajaxTransport:U(Mb),ajax:function(b,c){function d(b,c,d,h){var j,m,n,u,v,w=c;k||(k=!0,i&&a.clearTimeout(i),e=void 0,g=h||"",x.readyState=b>0?4:0,j=b>=200&&300>b||304===b,d&&(u=X(o,x,d)),u=Y(o,u,x,j),j?(o.ifModified&&(v=x.getResponseHeader("Last-Modified"),v&&(ma.lastModified[f]=v),v=x.getResponseHeader("etag"),v&&(ma.etag[f]=v)),204===b||"HEAD"===o.type?w="nocontent":304===b?w="notmodified":(w=u.state,m=u.data,n=u.error,j=!n)):(n=w,(b||!w)&&(w="error",0>b&&(b=0))),x.status=b,x.statusText=(c||w)+"",j?r.resolveWith(p,[m,w,x]):r.rejectWith(p,[x,w,n]),x.statusCode(t),t=void 0,l&&q.trigger(j?"ajaxSuccess":"ajaxError",[x,o,j?m:n]),s.fireWith(p,[x,w]),l&&(q.trigger("ajaxComplete",[x,o]),--ma.active||ma.event.trigger("ajaxStop")))}"object"==typeof b&&(c=b,b=void 0),c=c||{};var e,f,g,h,i,j,k,l,m,n,o=ma.ajaxSetup({},c),p=o.context||o,q=o.context&&(p.nodeType||p.jquery)?ma(p):ma.event,r=ma.Deferred(),s=ma.Callbacks("once memory"),t=o.statusCode||{},u={},v={},w="canceled",x={readyState:0,getResponseHeader:function(a){var b;if(k){if(!h)for(h={};b=Hb.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return k?g:null},setRequestHeader:function(a,b){return null==k&&(a=v[a.toLowerCase()]=v[a.toLowerCase()]||a,u[a]=b),this},overrideMimeType:function(a){return null==k&&(o.mimeType=a),this},statusCode:function(a){var b;if(a)if(k)x.always(a[x.status]);else for(b in a)t[b]=[t[b],a[b]];return this},abort:function(a){var b=a||w;return e&&e.abort(b),d(0,b),this}};if(r.promise(x),o.url=((b||o.url||xb.href)+"").replace(Kb,xb.protocol+"//"),o.type=c.method||c.type||o.method||o.type,o.dataTypes=(o.dataType||"*").toLowerCase().match(Ca)||[""],null==o.crossDomain){j=_.createElement("a");try{j.href=o.url,j.href=j.href,o.crossDomain=Ob.protocol+"//"+Ob.host!=j.protocol+"//"+j.host}catch(y){o.crossDomain=!0}}if(o.data&&o.processData&&"string"!=typeof o.data&&(o.data=ma.param(o.data,o.traditional)),V(Lb,o,c,x),k)return x;l=ma.event&&o.global,l&&0===ma.active++&&ma.event.trigger("ajaxStart"),o.type=o.type.toUpperCase(),o.hasContent=!Jb.test(o.type),f=o.url.replace(Fb,""),o.hasContent?o.data&&o.processData&&0===(o.contentType||"").indexOf("application/x-www-form-urlencoded")&&(o.data=o.data.replace(Eb,"+")):(n=o.url.slice(f.length),o.data&&(f+=(zb.test(f)?"&":"?")+o.data,delete o.data),o.cache===!1&&(f=f.replace(Gb,""),n=(zb.test(f)?"&":"?")+"_="+yb++ +n),o.url=f+n),o.ifModified&&(ma.lastModified[f]&&x.setRequestHeader("If-Modified-Since",ma.lastModified[f]),ma.etag[f]&&x.setRequestHeader("If-None-Match",ma.etag[f])),(o.data&&o.hasContent&&o.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",o.contentType),x.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Nb+"; q=0.01":""):o.accepts["*"]);for(m in o.headers)x.setRequestHeader(m,o.headers[m]);if(o.beforeSend&&(o.beforeSend.call(p,x,o)===!1||k))return x.abort();if(w="abort",s.add(o.complete),x.done(o.success),x.fail(o.error),e=V(Mb,o,c,x)){if(x.readyState=1,l&&q.trigger("ajaxSend",[x,o]),k)return x;o.async&&o.timeout>0&&(i=a.setTimeout(function(){x.abort("timeout")},o.timeout));try{k=!1,e.send(u,d)}catch(y){if(k)throw y;d(-1,y)}}else d(-1,"No Transport");return x},getJSON:function(a,b,c){return ma.get(a,b,c,"json")},getScript:function(a,b){return ma.get(a,void 0,b,"script")}}),ma.each(["get","post"],function(a,b){ma[b]=function(a,c,d,e){return ma.isFunction(c)&&(e=e||d,d=c,c=void 0),ma.ajax(ma.extend({url:a,type:b,dataType:e,data:c,success:d},ma.isPlainObject(a)&&a))}}),ma._evalUrl=function(a){return ma.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},ma.fn.extend({wrapAll:function(a){var b;return this[0]&&(ma.isFunction(a)&&(a=a.call(this[0])),b=ma(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this},wrapInner:function(a){return ma.isFunction(a)?this.each(function(b){ma(this).wrapInner(a.call(this,b))}):this.each(function(){var b=ma(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=ma.isFunction(a);return this.each(function(c){ma(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(a){return this.parent(a).not("body").each(function(){ma(this).replaceWith(this.childNodes)}),this}}),ma.expr.pseudos.hidden=function(a){return!ma.expr.pseudos.visible(a)},ma.expr.pseudos.visible=function(a){return!!(a.offsetWidth||a.offsetHeight||a.getClientRects().length)},ma.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch(b){}};var Pb={0:200,1223:204},Qb=ma.ajaxSettings.xhr();ka.cors=!!Qb&&"withCredentials"in Qb,ka.ajax=Qb=!!Qb,ma.ajaxTransport(function(b){var c,d;return ka.cors||Qb&&!b.crossDomain?{send:function(e,f){var g,h=b.xhr();if(h.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(g in b.xhrFields)h[g]=b.xhrFields[g];b.mimeType&&h.overrideMimeType&&h.overrideMimeType(b.mimeType),b.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");for(g in e)h.setRequestHeader(g,e[g]);c=function(a){return function(){c&&(c=d=h.onload=h.onerror=h.onabort=h.onreadystatechange=null,"abort"===a?h.abort():"error"===a?"number"!=typeof h.status?f(0,"error"):f(h.status,h.statusText):f(Pb[h.status]||h.status,h.statusText,"text"!==(h.responseType||"text")||"string"!=typeof h.responseText?{binary:h.response}:{text:h.responseText},h.getAllResponseHeaders()))}},h.onload=c(),d=h.onerror=c("error"),void 0!==h.onabort?h.onabort=d:h.onreadystatechange=function(){4===h.readyState&&a.setTimeout(function(){c&&d()})},c=c("abort");try{h.send(b.hasContent&&b.data||null)}catch(i){if(c)throw i}},abort:function(){c&&c()}}:void 0}),ma.ajaxPrefilter(function(a){a.crossDomain&&(a.contents.script=!1)}),ma.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return ma.globalEval(a),a}}}),ma.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),ma.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=ma("<script>").prop({charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),_.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Rb=[],Sb=/(=)\?(?=&|$)|\?\?/;ma.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Rb.pop()||ma.expando+"_"+yb++;return this[a]=!0,a}}),ma.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Sb.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Sb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=ma.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Sb,"$1"+e):b.jsonp!==!1&&(b.url+=(zb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||ma.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?ma(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Rb.push(e)),g&&ma.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),ka.createHTMLDocument=function(){var a=_.implementation.createHTMLDocument("").body;return a.innerHTML="<form></form><form></form>",2===a.childNodes.length}(),ma.parseHTML=function(a,b,c){if("string"!=typeof a)return[];"boolean"==typeof b&&(c=b,b=!1);var d,e,f;return b||(ka.createHTMLDocument?(b=_.implementation.createHTMLDocument(""),d=b.createElement("base"),d.href=_.location.href,b.head.appendChild(d)):b=_),e=va.exec(a),f=!c&&[],e?[b.createElement(e[1])]:(e=s([a],b,f),f&&f.length&&ma(f).remove(),ma.merge([],e.childNodes))},ma.fn.load=function(a,b,c){var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=ma.trim(a.slice(h)),a=a.slice(0,h)),ma.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&ma.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?ma("<div>").append(ma.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},ma.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){ma.fn[b]=function(a){return this.on(b,a)}}),ma.expr.pseudos.animated=function(a){return ma.grep(ma.timers,function(b){return a===b.elem}).length},ma.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=ma.css(a,"position"),l=ma(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=ma.css(a,"top"),i=ma.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),ma.isFunction(b)&&(b=b.call(a,c,ma.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},ma.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){ma.offset.setOffset(this,a,b)});var b,c,d,e,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),d.width||d.height?(e=f.ownerDocument,c=Z(e),b=e.documentElement,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):d):{top:0,left:0}},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===ma.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),ma.nodeName(a[0],"html")||(d=a.offset()),d={top:d.top+ma.css(a[0],"borderTopWidth",!0),left:d.left+ma.css(a[0],"borderLeftWidth",!0)}),{top:b.top-d.top-ma.css(c,"marginTop",!0),left:b.left-d.left-ma.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent;a&&"static"===ma.css(a,"position");)a=a.offsetParent;return a||Wa})}}),ma.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c="pageYOffset"===b;ma.fn[a]=function(d){return Fa(this,function(a,d,e){var f=Z(a);return void 0===e?f?f[b]:a[d]:void(f?f.scrollTo(c?f.pageXOffset:e,c?e:f.pageYOffset):a[d]=e)},a,d,arguments.length)}}),ma.each(["top","left"],function(a,b){ma.cssHooks[b]=F(ka.pixelPosition,function(a,c){return c?(c=E(a,b),eb.test(c)?ma(a).position()[b]+"px":c):void 0})}),ma.each({Height:"height",Width:"width"},function(a,b){ma.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){ma.fn[d]=function(e,f){var g=arguments.length&&(c||"boolean"!=typeof e),h=c||(e===!0||f===!0?"margin":"border");return Fa(this,function(b,c,e){var f;return ma.isWindow(b)?0===d.indexOf("outer")?b["inner"+a]:b.document.documentElement["client"+a]:9===b.nodeType?(f=b.documentElement,Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])):void 0===e?ma.css(b,c,h):ma.style(b,c,e,h)},b,g?e:void 0,g)}})}),ma.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),ma.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ma});var Tb=a.jQuery,Ub=a.$;return ma.noConflict=function(b){return a.$===ma&&(a.$=Ub),b&&a.jQuery===ma&&(a.jQuery=Tb),ma},b||(a.jQuery=a.$=ma),ma});var __decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=3>f?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(3>f?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},BABYLON;!function(a){a.ToGammaSpace=1/2.2,a.ToLinearSpace=2.2,a.Epsilon=.001;var b=function(){function a(){}return a.WithinEpsilon=function(a,b,c){void 0===c&&(c=1.401298e-45);var d=a-b;return d>=-c&&c>=d},a.ToHex=function(a){var b=a.toString(16);return 15>=a?("0"+b).toUpperCase():b.toUpperCase()},a.Sign=function(a){return a=+a,0===a||isNaN(a)?a:a>0?1:-1},a.Clamp=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=1),Math.min(c,Math.max(b,a))},a}();a.MathTools=b;var c=function(){function c(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.r=a,this.g=b,this.b=c}return c.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},c.prototype.getClassName=function(){return"Color3"},c.prototype.getHashCode=function(){var a=this.r||0;return a=397*a^(this.g||0),a=397*a^(this.b||0)},c.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,this},c.prototype.toColor4=function(a){return void 0===a&&(a=1),new d(this.r,this.g,this.b,a)},c.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},c.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},c.prototype.multiply=function(a){return new c(this.r*a.r,this.g*a.g,this.b*a.b)},c.prototype.multiplyToRef=function(a,b){return b.r=this.r*a.r,b.g=this.g*a.g,b.b=this.b*a.b,this},c.prototype.equals=function(a){return a&&this.r===a.r&&this.g===a.g&&this.b===a.b},c.prototype.equalsFloats=function(a,b,c){return this.r===a&&this.g===b&&this.b===c},c.prototype.scale=function(a){return new c(this.r*a,this.g*a,this.b*a)},c.prototype.scaleToRef=function(a,b){return b.r=this.r*a,b.g=this.g*a,b.b=this.b*a,this},c.prototype.add=function(a){return new c(this.r+a.r,this.g+a.g,this.b+a.b)},c.prototype.addToRef=function(a,b){return b.r=this.r+a.r,b.g=this.g+a.g,b.b=this.b+a.b,this},c.prototype.subtract=function(a){return new c(this.r-a.r,this.g-a.g,this.b-a.b)},c.prototype.subtractToRef=function(a,b){return b.r=this.r-a.r,b.g=this.g-a.g,b.b=this.b-a.b,this},c.prototype.clone=function(){return new c(this.r,this.g,this.b)},c.prototype.copyFrom=function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},c.prototype.copyFromFloats=function(a,b,c){return this.r=a,this.g=b,this.b=c,this},c.prototype.toHexString=function(){var a=255*this.r|0,c=255*this.g|0,d=255*this.b|0;return"#"+b.ToHex(a)+b.ToHex(c)+b.ToHex(d)},c.prototype.toLinearSpace=function(){var a=new c;return this.toLinearSpaceToRef(a),a},c.prototype.toLinearSpaceToRef=function(b){return b.r=Math.pow(this.r,a.ToLinearSpace),b.g=Math.pow(this.g,a.ToLinearSpace),b.b=Math.pow(this.b,a.ToLinearSpace),this},c.prototype.toGammaSpace=function(){var a=new c;return this.toGammaSpaceToRef(a),a},c.prototype.toGammaSpaceToRef=function(b){return b.r=Math.pow(this.r,a.ToGammaSpace),b.g=Math.pow(this.g,a.ToGammaSpace),b.b=Math.pow(this.b,a.ToGammaSpace),this},c.FromHexString=function(a){if("#"!==a.substring(0,1)||7!==a.length)return new c(0,0,0);var b=parseInt(a.substring(1,3),16),d=parseInt(a.substring(3,5),16),e=parseInt(a.substring(5,7),16);return c.FromInts(b,d,e)},c.FromArray=function(a,b){return void 0===b&&(b=0),new c(a[b],a[b+1],a[b+2])},c.FromInts=function(a,b,d){return new c(a/255,b/255,d/255)},c.Lerp=function(a,b,d){var e=a.r+(b.r-a.r)*d,f=a.g+(b.g-a.g)*d,g=a.b+(b.b-a.b)*d;return new c(e,f,g)},c.Red=function(){return new c(1,0,0)},c.Green=function(){return new c(0,1,0)},c.Blue=function(){return new c(0,0,1)},c.Black=function(){return new c(0,0,0)},c.White=function(){return new c(1,1,1)},c.Purple=function(){return new c(.5,0,.5)},c.Magenta=function(){return new c(1,0,1)},c.Yellow=function(){return new c(1,1,0)},c.Gray=function(){return new c(.5,.5,.5)},c}();a.Color3=c;var d=function(){function a(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d}return a.prototype.addInPlace=function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this.a+=a.a,this},a.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},a.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a[b+3]=this.a,this},a.prototype.add=function(b){return new a(this.r+b.r,this.g+b.g,this.b+b.b,this.a+b.a)},a.prototype.subtract=function(b){return new a(this.r-b.r,this.g-b.g,this.b-b.b,this.a-b.a)},a.prototype.subtractToRef=function(a,b){return b.r=this.r-a.r,b.g=this.g-a.g,b.b=this.b-a.b,b.a=this.a-a.a,this},a.prototype.scale=function(b){return new a(this.r*b,this.g*b,this.b*b,this.a*b)},a.prototype.scaleToRef=function(a,b){return b.r=this.r*a,b.g=this.g*a,b.b=this.b*a,b.a=this.a*a,this},a.prototype.multiply=function(b){return new a(this.r*b.r,this.g*b.g,this.b*b.b,this.a*b.a)},a.prototype.multiplyToRef=function(a,b){return b.r=this.r*a.r,b.g=this.g*a.g,b.b=this.b*a.b,b.a=this.a*a.a,b},a.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},a.prototype.getClassName=function(){return"Color4"},a.prototype.getHashCode=function(){var a=this.r||0;return a=397*a^(this.g||0),a=397*a^(this.b||0),a=397*a^(this.a||0)},a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a.prototype.copyFrom=function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a,this},a.prototype.toHexString=function(){var a=255*this.r|0,c=255*this.g|0,d=255*this.b|0,e=255*this.a|0;return"#"+b.ToHex(a)+b.ToHex(c)+b.ToHex(d)+b.ToHex(e)},a.FromHexString=function(b){if("#"!==b.substring(0,1)||9!==b.length)return new a(0,0,0,0);var c=parseInt(b.substring(1,3),16),d=parseInt(b.substring(3,5),16),e=parseInt(b.substring(5,7),16),f=parseInt(b.substring(7,9),16);return a.FromInts(c,d,e,f)},a.Lerp=function(b,c,d){var e=new a(0,0,0,0);return a.LerpToRef(b,c,d,e),e},a.LerpToRef=function(a,b,c,d){d.r=a.r+(b.r-a.r)*c,d.g=a.g+(b.g-a.g)*c,d.b=a.b+(b.b-a.b)*c,d.a=a.a+(b.a-a.a)*c},a.FromArray=function(b,c){return void 0===c&&(c=0),new a(b[c],b[c+1],b[c+2],b[c+3])},a.FromInts=function(b,c,d,e){return new a(b/255,c/255,d/255,e/255)},a.CheckColors4=function(a,b){if(a.length===3*b){for(var c=[],d=0;d<a.length;d+=3){var e=d/3*4;c[e]=a[d],c[e+1]=a[d+1],c[e+2]=a[d+2],c[e+3]=1}return c}return a},a}();a.Color4=d;var e=function(){function c(a,b){this.x=a,this.y=b}return c.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},c.prototype.getClassName=function(){return"Vector2"},c.prototype.getHashCode=function(){var a=this.x||0;return a=397*a^(this.y||0)},c.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,this},c.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},c.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this},c.prototype.copyFromFloats=function(a,b){return this.x=a,this.y=b,this},c.prototype.add=function(a){return new c(this.x+a.x,this.y+a.y)},c.prototype.addToRef=function(a,b){return b.x=this.x+a.x,b.y=this.y+a.y,this},c.prototype.addVector3=function(a){return new c(this.x+a.x,this.y+a.y)},c.prototype.subtract=function(a){return new c(this.x-a.x,this.y-a.y)},c.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,b.y=this.y-a.y,this},c.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this},c.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this},c.prototype.multiply=function(a){return new c(this.x*a.x,this.y*a.y)},c.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,this},c.prototype.multiplyByFloats=function(a,b){return new c(this.x*a,this.y*b)},c.prototype.divide=function(a){return new c(this.x/a.x,this.y/a.y)},c.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,this},c.prototype.negate=function(){return new c(-this.x,-this.y)},c.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this},c.prototype.scale=function(a){return new c(this.x*a,this.y*a)},c.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y},c.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=a.Epsilon),c&&b.WithinEpsilon(this.x,c.x,d)&&b.WithinEpsilon(this.y,c.y,d)},c.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},c.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},c.prototype.normalize=function(){var a=this.length();if(0===a)return this;var b=1/a;return this.x*=b,this.y*=b,this},c.prototype.clone=function(){return new c(this.x,this.y)},c.Zero=function(){return new c(0,0)},c.FromArray=function(a,b){return void 0===b&&(b=0),new c(a[b],a[b+1])},c.FromArrayToRef=function(a,b,c){c.x=a[b],c.y=a[b+1]},c.CatmullRom=function(a,b,d,e,f){var g=f*f,h=f*g,i=.5*(2*b.x+(-a.x+d.x)*f+(2*a.x-5*b.x+4*d.x-e.x)*g+(-a.x+3*b.x-3*d.x+e.x)*h),j=.5*(2*b.y+(-a.y+d.y)*f+(2*a.y-5*b.y+4*d.y-e.y)*g+(-a.y+3*b.y-3*d.y+e.y)*h);
return new c(i,j)},c.Clamp=function(a,b,d){var e=a.x;e=e>d.x?d.x:e,e=e<b.x?b.x:e;var f=a.y;return f=f>d.y?d.y:f,f=f<b.y?b.y:f,new c(e,f)},c.Hermite=function(a,b,d,e,f){var g=f*f,h=f*g,i=2*h-3*g+1,j=-2*h+3*g,k=h-2*g+f,l=h-g,m=a.x*i+d.x*j+b.x*k+e.x*l,n=a.y*i+d.y*j+b.y*k+e.y*l;return new c(m,n)},c.Lerp=function(a,b,d){var e=a.x+(b.x-a.x)*d,f=a.y+(b.y-a.y)*d;return new c(e,f)},c.Dot=function(a,b){return a.x*b.x+a.y*b.y},c.Normalize=function(a){var b=a.clone();return b.normalize(),b},c.Minimize=function(a,b){var d=a.x<b.x?a.x:b.x,e=a.y<b.y?a.y:b.y;return new c(d,e)},c.Maximize=function(a,b){var d=a.x>b.x?a.x:b.x,e=a.y>b.y?a.y:b.y;return new c(d,e)},c.Transform=function(a,b){var d=c.Zero();return c.TransformToRef(a,b,d),d},c.TransformToRef=function(a,b,c){var d=a.x*b.m[0]+a.y*b.m[4]+b.m[12],e=a.x*b.m[1]+a.y*b.m[5]+b.m[13];c.x=d,c.y=e},c.PointInTriangle=function(a,b,c,d){var e=.5*(-c.y*d.x+b.y*(-c.x+d.x)+b.x*(c.y-d.y)+c.x*d.y),f=0>e?-1:1,g=(b.y*d.x-b.x*d.y+(d.y-b.y)*a.x+(b.x-d.x)*a.y)*f,h=(b.x*c.y-b.y*c.x+(b.y-c.y)*a.x+(c.x-b.x)*a.y)*f;return g>0&&h>0&&2*e*f>g+h},c.Distance=function(a,b){return Math.sqrt(c.DistanceSquared(a,b))},c.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},c.DistanceOfPointFromSegment=function(a,b,d){var e=c.DistanceSquared(b,d);if(0===e)return c.Distance(a,b);var f=d.subtract(b),g=Math.max(0,Math.min(1,c.Dot(a.subtract(b),f)/e)),h=b.add(f.multiplyByFloats(g,g));return c.Distance(a,h)},c}();a.Vector2=e;var f=function(){function c(a,b,c){this.x=a,this.y=b,this.z=c}return c.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},c.prototype.getClassName=function(){return"Vector3"},c.prototype.getHashCode=function(){var a=this.x||0;return a=397*a^(this.y||0),a=397*a^(this.z||0)},c.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},c.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,this},c.prototype.toQuaternion=function(){var a=new i(0,0,0,1),b=Math.cos(.5*(this.x+this.z)),c=Math.sin(.5*(this.x+this.z)),d=Math.cos(.5*(this.z-this.x)),e=Math.sin(.5*(this.z-this.x)),f=Math.cos(.5*this.y),g=Math.sin(.5*this.y);return a.x=d*g,a.y=-e*g,a.z=c*f,a.w=b*f,a},c.prototype.addInPlace=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},c.prototype.add=function(a){return new c(this.x+a.x,this.y+a.y,this.z+a.z)},c.prototype.addToRef=function(a,b){return b.x=this.x+a.x,b.y=this.y+a.y,b.z=this.z+a.z,this},c.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},c.prototype.subtract=function(a){return new c(this.x-a.x,this.y-a.y,this.z-a.z)},c.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z,this},c.prototype.subtractFromFloats=function(a,b,d){return new c(this.x-a,this.y-b,this.z-d)},c.prototype.subtractFromFloatsToRef=function(a,b,c,d){return d.x=this.x-a,d.y=this.y-b,d.z=this.z-c,this},c.prototype.negate=function(){return new c(-this.x,-this.y,-this.z)},c.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this.z*=a,this},c.prototype.scale=function(a){return new c(this.x*a,this.y*a,this.z*a)},c.prototype.scaleToRef=function(a,b){b.x=this.x*a,b.y=this.y*a,b.z=this.z*a},c.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z},c.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=a.Epsilon),c&&b.WithinEpsilon(this.x,c.x,d)&&b.WithinEpsilon(this.y,c.y,d)&&b.WithinEpsilon(this.z,c.z,d)},c.prototype.equalsToFloats=function(a,b,c){return this.x===a&&this.y===b&&this.z===c},c.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},c.prototype.multiply=function(a){return new c(this.x*a.x,this.y*a.y,this.z*a.z)},c.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,b.z=this.z*a.z,this},c.prototype.multiplyByFloats=function(a,b,d){return new c(this.x*a,this.y*b,this.z*d)},c.prototype.divide=function(a){return new c(this.x/a.x,this.y/a.y,this.z/a.z)},c.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,b.z=this.z/a.z,this},c.prototype.MinimizeInPlace=function(a){return a.x<this.x&&(this.x=a.x),a.y<this.y&&(this.y=a.y),a.z<this.z&&(this.z=a.z),this},c.prototype.MaximizeInPlace=function(a){return a.x>this.x&&(this.x=a.x),a.y>this.y&&(this.y=a.y),a.z>this.z&&(this.z=a.z),this},c.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},c.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},c.prototype.normalize=function(){var a=this.length();if(0===a||1===a)return this;var b=1/a;return this.x*=b,this.y*=b,this.z*=b,this},c.prototype.clone=function(){return new c(this.x,this.y,this.z)},c.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},c.prototype.copyFromFloats=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},c.GetClipFactor=function(a,b,d,e){var f=c.Dot(a,d)-e,g=c.Dot(b,d)-e,h=f/(f-g);return h},c.FromArray=function(a,b){return b||(b=0),new c(a[b],a[b+1],a[b+2])},c.FromFloatArray=function(a,b){return b||(b=0),new c(a[b],a[b+1],a[b+2])},c.FromArrayToRef=function(a,b,c){c.x=a[b],c.y=a[b+1],c.z=a[b+2]},c.FromFloatArrayToRef=function(a,b,c){c.x=a[b],c.y=a[b+1],c.z=a[b+2]},c.FromFloatsToRef=function(a,b,c,d){d.x=a,d.y=b,d.z=c},c.Zero=function(){return new c(0,0,0)},c.Up=function(){return new c(0,1,0)},c.TransformCoordinates=function(a,b){var d=c.Zero();return c.TransformCoordinatesToRef(a,b,d),d},c.TransformCoordinatesToRef=function(a,b,c){var d=a.x*b.m[0]+a.y*b.m[4]+a.z*b.m[8]+b.m[12],e=a.x*b.m[1]+a.y*b.m[5]+a.z*b.m[9]+b.m[13],f=a.x*b.m[2]+a.y*b.m[6]+a.z*b.m[10]+b.m[14],g=a.x*b.m[3]+a.y*b.m[7]+a.z*b.m[11]+b.m[15];c.x=d/g,c.y=e/g,c.z=f/g},c.TransformCoordinatesFromFloatsToRef=function(a,b,c,d,e){var f=a*d.m[0]+b*d.m[4]+c*d.m[8]+d.m[12],g=a*d.m[1]+b*d.m[5]+c*d.m[9]+d.m[13],h=a*d.m[2]+b*d.m[6]+c*d.m[10]+d.m[14],i=a*d.m[3]+b*d.m[7]+c*d.m[11]+d.m[15];e.x=f/i,e.y=g/i,e.z=h/i},c.TransformNormal=function(a,b){var d=c.Zero();return c.TransformNormalToRef(a,b,d),d},c.TransformNormalToRef=function(a,b,c){c.x=a.x*b.m[0]+a.y*b.m[4]+a.z*b.m[8],c.y=a.x*b.m[1]+a.y*b.m[5]+a.z*b.m[9],c.z=a.x*b.m[2]+a.y*b.m[6]+a.z*b.m[10]},c.TransformNormalFromFloatsToRef=function(a,b,c,d,e){e.x=a*d.m[0]+b*d.m[4]+c*d.m[8],e.y=a*d.m[1]+b*d.m[5]+c*d.m[9],e.z=a*d.m[2]+b*d.m[6]+c*d.m[10]},c.CatmullRom=function(a,b,d,e,f){var g=f*f,h=f*g,i=.5*(2*b.x+(-a.x+d.x)*f+(2*a.x-5*b.x+4*d.x-e.x)*g+(-a.x+3*b.x-3*d.x+e.x)*h),j=.5*(2*b.y+(-a.y+d.y)*f+(2*a.y-5*b.y+4*d.y-e.y)*g+(-a.y+3*b.y-3*d.y+e.y)*h),k=.5*(2*b.z+(-a.z+d.z)*f+(2*a.z-5*b.z+4*d.z-e.z)*g+(-a.z+3*b.z-3*d.z+e.z)*h);return new c(i,j,k)},c.Clamp=function(a,b,d){var e=a.x;e=e>d.x?d.x:e,e=e<b.x?b.x:e;var f=a.y;f=f>d.y?d.y:f,f=f<b.y?b.y:f;var g=a.z;return g=g>d.z?d.z:g,g=g<b.z?b.z:g,new c(e,f,g)},c.Hermite=function(a,b,d,e,f){var g=f*f,h=f*g,i=2*h-3*g+1,j=-2*h+3*g,k=h-2*g+f,l=h-g,m=a.x*i+d.x*j+b.x*k+e.x*l,n=a.y*i+d.y*j+b.y*k+e.y*l,o=a.z*i+d.z*j+b.z*k+e.z*l;return new c(m,n,o)},c.Lerp=function(a,b,d){var e=a.x+(b.x-a.x)*d,f=a.y+(b.y-a.y)*d,g=a.z+(b.z-a.z)*d;return new c(e,f,g)},c.Dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},c.Cross=function(a,b){var d=c.Zero();return c.CrossToRef(a,b,d),d},c.CrossToRef=function(a,b,c){z.Vector3[0].x=a.y*b.z-a.z*b.y,z.Vector3[0].y=a.z*b.x-a.x*b.z,z.Vector3[0].z=a.x*b.y-a.y*b.x,c.copyFrom(z.Vector3[0])},c.Normalize=function(a){var b=c.Zero();return c.NormalizeToRef(a,b),b},c.NormalizeToRef=function(a,b){b.copyFrom(a),b.normalize()},c.Project=function(a,b,d,e){var f=e.width,g=e.height,h=e.x,i=e.y,k=j.FromValues(f/2,0,0,0,0,-g/2,0,0,0,0,1,0,h+f/2,g/2+i,0,1),l=b.multiply(d).multiply(k);return c.TransformCoordinates(a,l)},c.UnprojectFromTransform=function(a,d,e,f,g){var h=f.multiply(g);h.invert(),a.x=a.x/d*2-1,a.y=-(a.y/e*2-1);var i=c.TransformCoordinates(a,h),j=a.x*h.m[3]+a.y*h.m[7]+a.z*h.m[11]+h.m[15];return b.WithinEpsilon(j,1)&&(i=i.scale(1/j)),i},c.Unproject=function(a,d,e,f,g,h){var i=f.multiply(g).multiply(h);i.invert();var j=new c(a.x/d*2-1,-(a.y/e*2-1),a.z),k=c.TransformCoordinates(j,i),l=j.x*i.m[3]+j.y*i.m[7]+j.z*i.m[11]+i.m[15];return b.WithinEpsilon(l,1)&&(k=k.scale(1/l)),k},c.Minimize=function(a,b){var c=a.clone();return c.MinimizeInPlace(b),c},c.Maximize=function(a,b){var c=a.clone();return c.MaximizeInPlace(b),c},c.Distance=function(a,b){return Math.sqrt(c.DistanceSquared(a,b))},c.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e},c.Center=function(a,b){var c=a.add(b);return c.scaleInPlace(.5),c},c.RotationFromAxis=function(a,b,d){var e=c.Zero();return c.RotationFromAxisToRef(a,b,d,e),e},c.RotationFromAxisToRef=function(d,e,f,g){var h=d.normalize(),i=f.normalize(),j=n.X,k=n.Y,l=0,m=0,o=0,p=0,q=0,r=0,s=0,t=-1,u=0,v=z.Vector3[0],w=0,x=z.Vector3[1];b.WithinEpsilon(i.z,0,a.Epsilon)?r=1:b.WithinEpsilon(i.x,0,a.Epsilon)?p=1:(s=i.z/i.x,p=-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s))),x.x=p,x.y=q,x.z=r,x.normalize(),c.CrossToRef(h,x,v),v.normalize(),c.Dot(i,v)<0&&(t=1),w=c.Dot(h,x),w=Math.min(1,Math.max(-1,w)),o=Math.acos(w)*t,c.Dot(x,j)<0&&(o=Math.PI+o,x=x.scaleInPlace(-1),u++);var y=z.Vector3[2],A=z.Vector3[3];p=0,q=0,r=0,t=-1,b.WithinEpsilon(i.z,0,a.Epsilon)?p=1:(s=x.z/x.x,p=-s*Math.sqrt(1/(1+s*s)),r=Math.sqrt(1/(1+s*s))),y.x=p,y.y=q,y.z=r,y.normalize(),c.CrossToRef(y,x,A),A.normalize(),c.CrossToRef(i,y,v),v.normalize(),c.Dot(x,v)<0&&(t=1),w=c.Dot(i,y),w=Math.min(1,Math.max(-1,w)),m=Math.acos(w)*t,c.Dot(A,k)<0&&(m=Math.PI+m,u++),t=-1,c.CrossToRef(j,x,v),v.normalize(),c.Dot(v,k)<0&&(t=1),w=c.Dot(x,j),w=Math.min(1,Math.max(-1,w)),l=-Math.acos(w)*t,0>w&&2>u&&(l=Math.PI+l),g.x=m,g.y=l,g.z=o},c}();a.Vector3=f;var g=function(){function c(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d}return c.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},c.prototype.getClassName=function(){return"Vector4"},c.prototype.getHashCode=function(){var a=this.x||0;return a=397*a^(this.y||0),a=397*a^(this.z||0),a=397*a^(this.w||0)},c.prototype.asArray=function(){var a=[];return this.toArray(a,0),a},c.prototype.toArray=function(a,b){return void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,this},c.prototype.addInPlace=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this},c.prototype.add=function(a){return new c(this.x+a.x,this.y+a.y,this.z+a.z,this.w+a.w)},c.prototype.addToRef=function(a,b){return b.x=this.x+a.x,b.y=this.y+a.y,b.z=this.z+a.z,b.w=this.w+a.w,this},c.prototype.subtractInPlace=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this},c.prototype.subtract=function(a){return new c(this.x-a.x,this.y-a.y,this.z-a.z,this.w-a.w)},c.prototype.subtractToRef=function(a,b){return b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z,b.w=this.w-a.w,this},c.prototype.subtractFromFloats=function(a,b,d,e){return new c(this.x-a,this.y-b,this.z-d,this.w-e)},c.prototype.subtractFromFloatsToRef=function(a,b,c,d,e){return e.x=this.x-a,e.y=this.y-b,e.z=this.z-c,e.w=this.w-d,this},c.prototype.negate=function(){return new c(-this.x,-this.y,-this.z,-this.w)},c.prototype.scaleInPlace=function(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},c.prototype.scale=function(a){return new c(this.x*a,this.y*a,this.z*a,this.w*a)},c.prototype.scaleToRef=function(a,b){b.x=this.x*a,b.y=this.y*a,b.z=this.z*a,b.w=this.w*a},c.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},c.prototype.equalsWithEpsilon=function(c,d){return void 0===d&&(d=a.Epsilon),c&&b.WithinEpsilon(this.x,c.x,d)&&b.WithinEpsilon(this.y,c.y,d)&&b.WithinEpsilon(this.z,c.z,d)&&b.WithinEpsilon(this.w,c.w,d)},c.prototype.equalsToFloats=function(a,b,c,d){return this.x===a&&this.y===b&&this.z===c&&this.w===d},c.prototype.multiplyInPlace=function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this},c.prototype.multiply=function(a){return new c(this.x*a.x,this.y*a.y,this.z*a.z,this.w*a.w)},c.prototype.multiplyToRef=function(a,b){return b.x=this.x*a.x,b.y=this.y*a.y,b.z=this.z*a.z,b.w=this.w*a.w,this},c.prototype.multiplyByFloats=function(a,b,d,e){return new c(this.x*a,this.y*b,this.z*d,this.w*e)},c.prototype.divide=function(a){return new c(this.x/a.x,this.y/a.y,this.z/a.z,this.w/a.w)},c.prototype.divideToRef=function(a,b){return b.x=this.x/a.x,b.y=this.y/a.y,b.z=this.z/a.z,b.w=this.w/a.w,this},c.prototype.MinimizeInPlace=function(a){return a.x<this.x&&(this.x=a.x),a.y<this.y&&(this.y=a.y),a.z<this.z&&(this.z=a.z),a.w<this.w&&(this.w=a.w),this},c.prototype.MaximizeInPlace=function(a){return a.x>this.x&&(this.x=a.x),a.y>this.y&&(this.y=a.y),a.z>this.z&&(this.z=a.z),a.w>this.w&&(this.w=a.w),this},c.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},c.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},c.prototype.normalize=function(){var a=this.length();if(0===a)return this;var b=1/a;return this.x*=b,this.y*=b,this.z*=b,this.w*=b,this},c.prototype.toVector3=function(){return new f(this.x,this.y,this.z)},c.prototype.clone=function(){return new c(this.x,this.y,this.z,this.w)},c.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},c.prototype.copyFromFloats=function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},c.FromArray=function(a,b){return b||(b=0),new c(a[b],a[b+1],a[b+2],a[b+3])},c.FromArrayToRef=function(a,b,c){c.x=a[b],c.y=a[b+1],c.z=a[b+2],c.w=a[b+3]},c.FromFloatArrayToRef=function(a,b,c){c.x=a[b],c.y=a[b+1],c.z=a[b+2],c.w=a[b+3]},c.FromFloatsToRef=function(a,b,c,d,e){e.x=a,e.y=b,e.z=c,e.w=d},c.Zero=function(){return new c(0,0,0,0)},c.Normalize=function(a){var b=c.Zero();return c.NormalizeToRef(a,b),b},c.NormalizeToRef=function(a,b){b.copyFrom(a),b.normalize()},c.Minimize=function(a,b){var c=a.clone();return c.MinimizeInPlace(b),c},c.Maximize=function(a,b){var c=a.clone();return c.MaximizeInPlace(b),c},c.Distance=function(a,b){return Math.sqrt(c.DistanceSquared(a,b))},c.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z,f=a.w-b.w;return c*c+d*d+e*e+f*f},c.Center=function(a,b){var c=a.add(b);return c.scaleInPlace(.5),c},c}();a.Vector4=g;var h=function(){function a(a,b){this.width=a,this.height=b}return a.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},a.prototype.getClassName=function(){return"Size"},a.prototype.getHashCode=function(){var a=this.width||0;return a=397*a^(this.height||0)},a.prototype.copyFrom=function(a){this.width=a.width,this.height=a.height},a.prototype.clone=function(){return new a(this.width,this.height)},a.prototype.equals=function(a){return a?this.width===a.width&&this.height===a.height:!1},Object.defineProperty(a.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),a.Zero=function(){return new a(0,0)},a.prototype.add=function(b){var c=new a(this.width+b.width,this.height+b.height);return c},a.prototype.substract=function(b){var c=new a(this.width-b.width,this.height-b.height);return c},a.Lerp=function(b,c,d){var e=b.width+(c.width-b.width)*d,f=b.height+(c.height-b.height)*d;return new a(e,f)},a}();a.Size=h;var i=function(){function a(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=1),this.x=a,this.y=b,this.z=c,this.w=d}return a.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},a.prototype.getClassName=function(){return"Quaternion"},a.prototype.getHashCode=function(){var a=this.x||0;return a=397*a^(this.y||0),a=397*a^(this.z||0),a=397*a^(this.w||0)},a.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},a.prototype.equals=function(a){return a&&this.x===a.x&&this.y===a.y&&this.z===a.z&&this.w===a.w},a.prototype.clone=function(){return new a(this.x,this.y,this.z,this.w)},a.prototype.copyFrom=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},a.prototype.copyFromFloats=function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z,this.w+b.w)},a.prototype.subtract=function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z,this.w-b.w)},a.prototype.scale=function(b){return new a(this.x*b,this.y*b,this.z*b,this.w*b)},a.prototype.multiply=function(b){var c=new a(0,0,0,1);return this.multiplyToRef(b,c),c},a.prototype.multiplyToRef=function(a,b){var c=this.x*a.w+this.y*a.z-this.z*a.y+this.w*a.x,d=-this.x*a.z+this.y*a.w+this.z*a.x+this.w*a.y,e=this.x*a.y-this.y*a.x+this.z*a.w+this.w*a.z,f=-this.x*a.x-this.y*a.y-this.z*a.z+this.w*a.w;return b.copyFromFloats(c,d,e,f),this},a.prototype.multiplyInPlace=function(a){return this.multiplyToRef(a,this),this},a.prototype.conjugateToRef=function(a){return a.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},a.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},a.prototype.conjugate=function(){var b=new a(-this.x,-this.y,-this.z,this.w);return b},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},a.prototype.normalize=function(){var a=1/this.length();return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this},a.prototype.toEulerAngles=function(a){void 0===a&&(a="YZX");var b=f.Zero();return this.toEulerAnglesToRef(b,a),b},a.prototype.toEulerAnglesToRef=function(a,b){void 0===b&&(b="YZX");var c,d,e,f=this.x,g=this.y,h=this.z,i=this.w;switch(b){case"YZX":var j=f*g+h*i;if(j>.499&&(c=2*Math.atan2(f,i),d=Math.PI/2,e=0),-.499>j&&(c=-2*Math.atan2(f,i),d=-Math.PI/2,e=0),isNaN(c)){var k=f*f,l=g*g,m=h*h;c=Math.atan2(2*g*i-2*f*h,1-2*l-2*m),d=Math.asin(2*j),e=Math.atan2(2*f*i-2*g*h,1-2*k-2*m)}break;default:throw new Error("Euler order "+b+" not supported yet.")}return a.y=c,a.z=d,a.x=e,this},a.prototype.toRotationMatrix=function(a){var b=this.x*this.x,c=this.y*this.y,d=this.z*this.z,e=this.x*this.y,f=this.z*this.w,g=this.z*this.x,h=this.y*this.w,i=this.y*this.z,j=this.x*this.w;return a.m[0]=1-2*(c+d),a.m[1]=2*(e+f),a.m[2]=2*(g-h),a.m[3]=0,a.m[4]=2*(e-f),a.m[5]=1-2*(d+b),a.m[6]=2*(i+j),a.m[7]=0,a.m[8]=2*(g+h),a.m[9]=2*(i-j),a.m[10]=1-2*(c+b),a.m[11]=0,a.m[12]=0,a.m[13]=0,a.m[14]=0,a.m[15]=1,this},a.prototype.fromRotationMatrix=function(b){return a.FromRotationMatrixToRef(b,this),this},a.FromRotationMatrix=function(b){var c=new a;return a.FromRotationMatrixToRef(b,c),c},a.FromRotationMatrixToRef=function(a,b){var c,d=a.m,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10],n=e+i+m;n>0?(c=.5/Math.sqrt(n+1),b.w=.25/c,b.x=(l-j)*c,b.y=(g-k)*c,b.z=(h-f)*c):e>i&&e>m?(c=2*Math.sqrt(1+e-i-m),b.w=(l-j)/c,b.x=.25*c,b.y=(f+h)/c,b.z=(g+k)/c):i>m?(c=2*Math.sqrt(1+i-e-m),b.w=(g-k)/c,b.x=(f+h)/c,b.y=.25*c,b.z=(j+l)/c):(c=2*Math.sqrt(1+m-e-i),b.w=(h-f)/c,b.x=(g+k)/c,b.y=(j+l)/c,b.z=.25*c)},a.Inverse=function(b){return new a(-b.x,-b.y,-b.z,b.w)},a.Identity=function(){return new a(0,0,0,1)},a.RotationAxis=function(b,c){var d=new a,e=Math.sin(c/2);return b.normalize(),d.w=Math.cos(c/2),d.x=b.x*e,d.y=b.y*e,d.z=b.z*e,d},a.FromArray=function(b,c){return c||(c=0),new a(b[c],b[c+1],b[c+2],b[c+3])},a.RotationYawPitchRoll=function(b,c,d){var e=new a;return a.RotationYawPitchRollToRef(b,c,d,e),e},a.RotationYawPitchRollToRef=function(a,b,c,d){var e=.5*c,f=.5*b,g=.5*a,h=Math.sin(e),i=Math.cos(e),j=Math.sin(f),k=Math.cos(f),l=Math.sin(g),m=Math.cos(g);d.x=m*j*i+l*k*h,d.y=l*k*i-m*j*h,d.z=m*k*h-l*j*i,d.w=m*k*i+l*j*h},a.RotationAlphaBetaGamma=function(b,c,d){var e=new a;return a.RotationAlphaBetaGammaToRef(b,c,d,e),e},a.RotationAlphaBetaGammaToRef=function(a,b,c,d){var e=.5*(c+a),f=.5*(c-a),g=.5*b;d.x=Math.cos(f)*Math.sin(g),d.y=Math.sin(f)*Math.sin(g),d.z=Math.sin(e)*Math.cos(g),d.w=Math.cos(e)*Math.cos(g)},a.Slerp=function(b,c,d){var e,f,g=d,h=b.x*c.x+b.y*c.y+b.z*c.z+b.w*c.w,i=!1;if(0>h&&(i=!0,h=-h),h>.999999)f=1-g,e=i?-g:g;else{var j=Math.acos(h),k=1/Math.sin(j);f=Math.sin((1-g)*j)*k,e=i?-Math.sin(g*j)*k:Math.sin(g*j)*k}return new a(f*b.x+e*c.x,f*b.y+e*c.y,f*b.z+e*c.z,f*b.w+e*c.w)},a}();a.Quaternion=i;var j=function(){function a(){this.m=new Float32Array(16)}return a.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},a.prototype.determinant=function(){var a=this.m[10]*this.m[15]-this.m[11]*this.m[14],b=this.m[9]*this.m[15]-this.m[11]*this.m[13],c=this.m[9]*this.m[14]-this.m[10]*this.m[13],d=this.m[8]*this.m[15]-this.m[11]*this.m[12],e=this.m[8]*this.m[14]-this.m[10]*this.m[12],f=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*a-this.m[6]*b+this.m[7]*c)-this.m[1]*(this.m[4]*a-this.m[6]*d+this.m[7]*e)+this.m[2]*(this.m[4]*b-this.m[5]*d+this.m[7]*f)-this.m[3]*(this.m[4]*c-this.m[5]*e+this.m[6]*f)},a.prototype.toArray=function(){return this.m},a.prototype.asArray=function(){return this.toArray()},a.prototype.invert=function(){return this.invertToRef(this),this},a.prototype.reset=function(){for(var a=0;16>a;a++)this.m[a]=0;return this},a.prototype.add=function(b){var c=new a;return this.addToRef(b,c),c},a.prototype.addToRef=function(a,b){for(var c=0;16>c;c++)b.m[c]=this.m[c]+a.m[c];return this},a.prototype.addToSelf=function(a){for(var b=0;16>b;b++)this.m[b]+=a.m[b];return this},a.prototype.invertToRef=function(a){var b=this.m[0],c=this.m[1],d=this.m[2],e=this.m[3],f=this.m[4],g=this.m[5],h=this.m[6],i=this.m[7],j=this.m[8],k=this.m[9],l=this.m[10],m=this.m[11],n=this.m[12],o=this.m[13],p=this.m[14],q=this.m[15],r=l*q-m*p,s=k*q-m*o,t=k*p-l*o,u=j*q-m*n,v=j*p-l*n,w=j*o-k*n,x=g*r-h*s+i*t,y=-(f*r-h*u+i*v),z=f*s-g*u+i*w,A=-(f*t-g*v+h*w),B=1/(b*x+c*y+d*z+e*A),C=h*q-i*p,D=g*q-i*o,E=g*p-h*o,F=f*q-i*n,G=f*p-h*n,H=f*o-g*n,I=h*m-i*l,J=g*m-i*k,K=g*l-h*k,L=f*m-i*j,M=f*l-h*j,N=f*k-g*j;return a.m[0]=x*B,a.m[4]=y*B,a.m[8]=z*B,a.m[12]=A*B,a.m[1]=-(c*r-d*s+e*t)*B,a.m[5]=(b*r-d*u+e*v)*B,a.m[9]=-(b*s-c*u+e*w)*B,a.m[13]=(b*t-c*v+d*w)*B,a.m[2]=(c*C-d*D+e*E)*B,a.m[6]=-(b*C-d*F+e*G)*B,a.m[10]=(b*D-c*F+e*H)*B,a.m[14]=-(b*E-c*G+d*H)*B,a.m[3]=-(c*I-d*J+e*K)*B,a.m[7]=(b*I-d*L+e*M)*B,a.m[11]=-(b*J-c*L+e*N)*B,a.m[15]=(b*K-c*M+d*N)*B,this},a.prototype.setTranslation=function(a){return this.m[12]=a.x,this.m[13]=a.y,this.m[14]=a.z,this},a.prototype.getTranslation=function(){return new f(this.m[12],this.m[13],this.m[14])},a.prototype.multiply=function(b){var c=new a;return this.multiplyToRef(b,c),c},a.prototype.copyFrom=function(a){for(var b=0;16>b;b++)this.m[b]=a.m[b];return this},a.prototype.copyToArray=function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)a[b+c]=this.m[c];return this},a.prototype.multiplyToRef=function(a,b){return this.multiplyToArray(a,b.m,0),this},a.prototype.multiplyToArray=function(a,b,c){var d=this.m[0],e=this.m[1],f=this.m[2],g=this.m[3],h=this.m[4],i=this.m[5],j=this.m[6],k=this.m[7],l=this.m[8],m=this.m[9],n=this.m[10],o=this.m[11],p=this.m[12],q=this.m[13],r=this.m[14],s=this.m[15],t=a.m[0],u=a.m[1],v=a.m[2],w=a.m[3],x=a.m[4],y=a.m[5],z=a.m[6],A=a.m[7],B=a.m[8],C=a.m[9],D=a.m[10],E=a.m[11],F=a.m[12],G=a.m[13],H=a.m[14],I=a.m[15];return b[c]=d*t+e*x+f*B+g*F,b[c+1]=d*u+e*y+f*C+g*G,b[c+2]=d*v+e*z+f*D+g*H,b[c+3]=d*w+e*A+f*E+g*I,b[c+4]=h*t+i*x+j*B+k*F,b[c+5]=h*u+i*y+j*C+k*G,b[c+6]=h*v+i*z+j*D+k*H,b[c+7]=h*w+i*A+j*E+k*I,b[c+8]=l*t+m*x+n*B+o*F,b[c+9]=l*u+m*y+n*C+o*G,b[c+10]=l*v+m*z+n*D+o*H,b[c+11]=l*w+m*A+n*E+o*I,b[c+12]=p*t+q*x+r*B+s*F,b[c+13]=p*u+q*y+r*C+s*G,b[c+14]=p*v+q*z+r*D+s*H,b[c+15]=p*w+q*A+r*E+s*I,this},a.prototype.equals=function(a){return a&&this.m[0]===a.m[0]&&this.m[1]===a.m[1]&&this.m[2]===a.m[2]&&this.m[3]===a.m[3]&&this.m[4]===a.m[4]&&this.m[5]===a.m[5]&&this.m[6]===a.m[6]&&this.m[7]===a.m[7]&&this.m[8]===a.m[8]&&this.m[9]===a.m[9]&&this.m[10]===a.m[10]&&this.m[11]===a.m[11]&&this.m[12]===a.m[12]&&this.m[13]===a.m[13]&&this.m[14]===a.m[14]&&this.m[15]===a.m[15]},a.prototype.clone=function(){return a.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},a.prototype.getClassName=function(){return"Matrix"},a.prototype.getHashCode=function(){for(var a=this.m[0]||0,b=1;16>b;b++)a=397*a^(this.m[b]||0);return a},a.prototype.decompose=function(c,d,e){e.x=this.m[12],e.y=this.m[13],e.z=this.m[14];var f=b.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,g=b.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=b.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(c.x=f*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),c.y=g*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),c.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===c.x||0===c.y||0===c.z)return d.x=0,d.y=0,d.z=0,d.w=1,!1;var j=a.FromValues(this.m[0]/c.x,this.m[1]/c.x,this.m[2]/c.x,0,this.m[4]/c.y,this.m[5]/c.y,this.m[6]/c.y,0,this.m[8]/c.z,this.m[9]/c.z,this.m[10]/c.z,0,0,0,0,1);return i.FromRotationMatrixToRef(j,d),!0},a.FromArray=function(b,c){var d=new a;return c||(c=0),a.FromArrayToRef(b,c,d),d},a.FromArrayToRef=function(a,b,c){for(var d=0;16>d;d++)c.m[d]=a[d+b]},a.FromFloat32ArrayToRefScaled=function(a,b,c,d){for(var e=0;16>e;e++)d.m[e]=a[e+b]*c},a.FromValuesToRef=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){q.m[0]=a,q.m[1]=b,q.m[2]=c,q.m[3]=d,q.m[4]=e,q.m[5]=f,q.m[6]=g,q.m[7]=h,q.m[8]=i,q.m[9]=j,q.m[10]=k,q.m[11]=l,q.m[12]=m,q.m[13]=n,q.m[14]=o,q.m[15]=p},a.prototype.getRow=function(a){if(0>a||a>3)return null;var b=4*a;return new g(this.m[b+0],this.m[b+1],this.m[b+2],this.m[b+3])},a.prototype.setRow=function(a,b){if(0>a||a>3)return this;var c=4*a;return this.m[c+0]=b.x,this.m[c+1]=b.y,this.m[c+2]=b.z,this.m[c+3]=b.w,this},a.FromValues=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=new a;return r.m[0]=b,r.m[1]=c,r.m[2]=d,r.m[3]=e,r.m[4]=f,r.m[5]=g,r.m[6]=h,r.m[7]=i,r.m[8]=j,r.m[9]=k,r.m[10]=l,r.m[11]=m,r.m[12]=n,r.m[13]=o,r.m[14]=p,r.m[15]=q,r},a.Compose=function(b,c,d){var e=a.FromValues(b.x,0,0,0,0,b.y,0,0,0,0,b.z,0,0,0,0,1),f=a.Identity();return c.toRotationMatrix(f),e=e.multiply(f),e.setTranslation(d),e},a.Identity=function(){return a.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},a.IdentityToRef=function(b){a.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,b)},a.Zero=function(){return a.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},a.RotationX=function(b){var c=new a;return a.RotationXToRef(b,c),c},a.Invert=function(b){var c=new a;return b.invertToRef(c),c},a.RotationXToRef=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.m[0]=1,b.m[15]=1,b.m[5]=d,b.m[10]=d,b.m[9]=-c,b.m[6]=c,b.m[1]=0,b.m[2]=0,b.m[3]=0,b.m[4]=0,b.m[7]=0,b.m[8]=0,b.m[11]=0,b.m[12]=0,b.m[13]=0,b.m[14]=0},a.RotationY=function(b){var c=new a;return a.RotationYToRef(b,c),c},a.RotationYToRef=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.m[5]=1,b.m[15]=1,b.m[0]=d,b.m[2]=-c,b.m[8]=c,b.m[10]=d,b.m[1]=0,b.m[3]=0,b.m[4]=0,b.m[6]=0,b.m[7]=0,b.m[9]=0,b.m[11]=0,b.m[12]=0,b.m[13]=0,b.m[14]=0},a.RotationZ=function(b){var c=new a;return a.RotationZToRef(b,c),c},a.RotationZToRef=function(a,b){var c=Math.sin(a),d=Math.cos(a);b.m[10]=1,b.m[15]=1,b.m[0]=d,b.m[1]=c,b.m[4]=-c,b.m[5]=d,b.m[2]=0,b.m[3]=0,b.m[6]=0,b.m[7]=0,b.m[8]=0,b.m[9]=0,b.m[11]=0,b.m[12]=0,b.m[13]=0,b.m[14]=0},a.RotationAxis=function(b,c){var d=a.Zero();return a.RotationAxisToRef(b,c,d),d},a.RotationAxisToRef=function(a,b,c){var d=Math.sin(-b),e=Math.cos(-b),f=1-e;a.normalize(),c.m[0]=a.x*a.x*f+e,c.m[1]=a.x*a.y*f-a.z*d,c.m[2]=a.x*a.z*f+a.y*d,c.m[3]=0,c.m[4]=a.y*a.x*f+a.z*d,c.m[5]=a.y*a.y*f+e,c.m[6]=a.y*a.z*f-a.x*d,c.m[7]=0,c.m[8]=a.z*a.x*f-a.y*d,c.m[9]=a.z*a.y*f+a.x*d,c.m[10]=a.z*a.z*f+e,c.m[11]=0,c.m[15]=1},a.RotationYawPitchRoll=function(b,c,d){var e=new a;return a.RotationYawPitchRollToRef(b,c,d,e),e},a.RotationYawPitchRollToRef=function(a,b,c,d){i.RotationYawPitchRollToRef(a,b,c,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(d)},a.Scaling=function(b,c,d){var e=a.Zero();return a.ScalingToRef(b,c,d,e),e},a.ScalingToRef=function(a,b,c,d){d.m[0]=a,d.m[1]=0,d.m[2]=0,d.m[3]=0,d.m[4]=0,d.m[5]=b,d.m[6]=0,d.m[7]=0,d.m[8]=0,d.m[9]=0,d.m[10]=c,d.m[11]=0,d.m[12]=0,d.m[13]=0,d.m[14]=0,d.m[15]=1},a.Translation=function(b,c,d){var e=a.Identity();return a.TranslationToRef(b,c,d,e),e},a.TranslationToRef=function(b,c,d,e){a.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,b,c,d,1,e)},a.Lerp=function(b,c,d){for(var e=a.Zero(),f=0;16>f;f++)e.m[f]=b.m[f]*(1-d)+c.m[f]*d;return e},a.DecomposeLerp=function(b,c,d){var e=new f(0,0,0),g=new i,h=new f(0,0,0);b.decompose(e,g,h);var j=new f(0,0,0),k=new i,l=new f(0,0,0);c.decompose(j,k,l);var m=f.Lerp(e,j,d),n=i.Slerp(g,k,d),o=f.Lerp(h,l,d);return a.Compose(m,n,o)},a.LookAtLH=function(b,c,d){var e=a.Zero();return a.LookAtLHToRef(b,c,d,e),e},a.LookAtLHToRef=function(b,c,d,e){c.subtractToRef(b,this._zAxis),this._zAxis.normalize(),f.CrossToRef(d,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),f.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var g=-f.Dot(this._xAxis,b),h=-f.Dot(this._yAxis,b),i=-f.Dot(this._zAxis,b);return a.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,g,h,i,1,e)},a.OrthoLH=function(b,c,d,e){var f=a.Zero();return a.OrthoLHToRef(b,c,d,e,f),f},a.OrthoLHToRef=function(b,c,d,e,f){var g=2/b,h=2/c,i=1/(e-d),j=d/(d-e);a.FromValuesToRef(g,0,0,0,0,h,0,0,0,0,i,0,0,0,j,1,f)},a.OrthoOffCenterLH=function(b,c,d,e,f,g){var h=a.Zero();return a.OrthoOffCenterLHToRef(b,c,d,e,f,g,h),h},a.OrthoOffCenterLHToRef=function(a,b,c,d,e,f,g){g.m[0]=2/(b-a),g.m[1]=g.m[2]=g.m[3]=0,g.m[5]=2/(d-c),g.m[4]=g.m[6]=g.m[7]=0,g.m[10]=-1/(e-f),g.m[8]=g.m[9]=g.m[11]=0,g.m[12]=(a+b)/(a-b),g.m[13]=(d+c)/(c-d),g.m[14]=e/(e-f),g.m[15]=1},a.PerspectiveLH=function(b,c,d,e){var f=a.Zero();return f.m[0]=2*d/b,f.m[1]=f.m[2]=f.m[3]=0,f.m[5]=2*d/c,f.m[4]=f.m[6]=f.m[7]=0,f.m[10]=-e/(d-e),f.m[8]=f.m[9]=0,f.m[11]=1,f.m[12]=f.m[13]=f.m[15]=0,f.m[14]=d*e/(d-e),f},a.PerspectiveFovLH=function(b,c,d,e){var f=a.Zero();return a.PerspectiveFovLHToRef(b,c,d,e,f),f},a.PerspectiveFovLHToRef=function(a,b,c,d,e,f){void 0===f&&(f=!0);var g=1/Math.tan(.5*a);f?e.m[0]=g/b:e.m[0]=g,e.m[1]=e.m[2]=e.m[3]=0,f?e.m[5]=g:e.m[5]=g*b,e.m[4]=e.m[6]=e.m[7]=0,e.m[8]=e.m[9]=0,e.m[10]=-d/(c-d),e.m[11]=1,e.m[12]=e.m[13]=e.m[15]=0,e.m[14]=c*d/(c-d)},a.GetFinalMatrix=function(b,c,d,e,f,g){var h=b.width,i=b.height,j=b.x,k=b.y,l=a.FromValues(h/2,0,0,0,0,-i/2,0,0,0,0,g-f,0,j+h/2,i/2+k,f,1);return c.multiply(d).multiply(e).multiply(l)},a.GetAsMatrix2x2=function(a){return new Float32Array([a.m[0],a.m[1],a.m[4],a.m[5]])},a.GetAsMatrix3x3=function(a){return new Float32Array([a.m[0],a.m[1],a.m[2],a.m[4],a.m[5],a.m[6],a.m[8],a.m[9],a.m[10]])},a.Transpose=function(b){var c=new a;return c.m[0]=b.m[0],c.m[1]=b.m[4],c.m[2]=b.m[8],c.m[3]=b.m[12],c.m[4]=b.m[1],c.m[5]=b.m[5],c.m[6]=b.m[9],c.m[7]=b.m[13],c.m[8]=b.m[2],c.m[9]=b.m[6],c.m[10]=b.m[10],c.m[11]=b.m[14],c.m[12]=b.m[3],c.m[13]=b.m[7],c.m[14]=b.m[11],c.m[15]=b.m[15],c},a.Reflection=function(b){var c=new a;return a.ReflectionToRef(b,c),c},a.ReflectionToRef=function(a,b){a.normalize();var c=a.normal.x,d=a.normal.y,e=a.normal.z,f=-2*c,g=-2*d,h=-2*e;b.m[0]=f*c+1,b.m[1]=g*c,b.m[2]=h*c,b.m[3]=0,b.m[4]=f*d,b.m[5]=g*d+1,b.m[6]=h*d,b.m[7]=0,b.m[8]=f*e,b.m[9]=g*e,b.m[10]=h*e+1,b.m[11]=0,b.m[12]=f*a.d,b.m[13]=g*a.d,b.m[14]=h*a.d,b.m[15]=1},a._tempQuaternion=new i,a._xAxis=f.Zero(),a._yAxis=f.Zero(),a._zAxis=f.Zero(),a}();a.Matrix=j;var k=function(){function a(a,b,c,d){this.normal=new f(a,b,c),this.d=d}return a.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},a.prototype.clone=function(){return new a(this.normal.x,this.normal.y,this.normal.z,this.d)},a.prototype.getClassName=function(){return"Plane"},a.prototype.getHashCode=function(){var a=this.normal.getHashCode();return a=397*a^(this.d||0)},a.prototype.normalize=function(){var a=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),b=0;
return 0!==a&&(b=1/a),this.normal.x*=b,this.normal.y*=b,this.normal.z*=b,this.d*=b,this},a.prototype.transform=function(b){var c=j.Transpose(b),d=this.normal.x,e=this.normal.y,f=this.normal.z,g=this.d,h=d*c.m[0]+e*c.m[1]+f*c.m[2]+g*c.m[3],i=d*c.m[4]+e*c.m[5]+f*c.m[6]+g*c.m[7],k=d*c.m[8]+e*c.m[9]+f*c.m[10]+g*c.m[11],l=d*c.m[12]+e*c.m[13]+f*c.m[14]+g*c.m[15];return new a(h,i,k,l)},a.prototype.dotCoordinate=function(a){return this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d},a.prototype.copyFromPoints=function(a,b,c){var d,e=b.x-a.x,f=b.y-a.y,g=b.z-a.z,h=c.x-a.x,i=c.y-a.y,j=c.z-a.z,k=f*j-g*i,l=g*h-e*j,m=e*i-f*h,n=Math.sqrt(k*k+l*l+m*m);return d=0!==n?1/n:0,this.normal.x=k*d,this.normal.y=l*d,this.normal.z=m*d,this.d=-(this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z),this},a.prototype.isFrontFacingTo=function(a,b){var c=f.Dot(this.normal,a);return b>=c},a.prototype.signedDistanceTo=function(a){return f.Dot(a,this.normal)+this.d},a.FromArray=function(b){return new a(b[0],b[1],b[2],b[3])},a.FromPoints=function(b,c,d){var e=new a(0,0,0,0);return e.copyFromPoints(b,c,d),e},a.FromPositionAndNormal=function(b,c){var d=new a(0,0,0,0);return c.normalize(),d.normal=c,d.d=-(c.x*b.x+c.y*b.y+c.z*b.z),d},a.SignedDistanceToPlaneFromPositionAndNormal=function(a,b,c){var d=-(b.x*a.x+b.y*a.y+b.z*a.z);return f.Dot(c,b)+d},a}();a.Plane=k;var l=function(){function a(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d}return a.prototype.toGlobal=function(b,c){return new a(this.x*b,this.y*c,this.width*b,this.height*c)},a}();a.Viewport=l;var m=function(){function a(){}return a.GetPlanes=function(b){for(var c=[],d=0;6>d;d++)c.push(new k(0,0,0,0));return a.GetPlanesToRef(b,c),c},a.GetPlanesToRef=function(a,b){b[0].normal.x=a.m[3]+a.m[2],b[0].normal.y=a.m[7]+a.m[6],b[0].normal.z=a.m[11]+a.m[10],b[0].d=a.m[15]+a.m[14],b[0].normalize(),b[1].normal.x=a.m[3]-a.m[2],b[1].normal.y=a.m[7]-a.m[6],b[1].normal.z=a.m[11]-a.m[10],b[1].d=a.m[15]-a.m[14],b[1].normalize(),b[2].normal.x=a.m[3]+a.m[0],b[2].normal.y=a.m[7]+a.m[4],b[2].normal.z=a.m[11]+a.m[8],b[2].d=a.m[15]+a.m[12],b[2].normalize(),b[3].normal.x=a.m[3]-a.m[0],b[3].normal.y=a.m[7]-a.m[4],b[3].normal.z=a.m[11]-a.m[8],b[3].d=a.m[15]-a.m[12],b[3].normalize(),b[4].normal.x=a.m[3]-a.m[1],b[4].normal.y=a.m[7]-a.m[5],b[4].normal.z=a.m[11]-a.m[9],b[4].d=a.m[15]-a.m[13],b[4].normalize(),b[5].normal.x=a.m[3]+a.m[1],b[5].normal.y=a.m[7]+a.m[5],b[5].normal.z=a.m[11]+a.m[9],b[5].d=a.m[15]+a.m[13],b[5].normalize()},a}();a.Frustum=m,function(a){a[a.LOCAL=0]="LOCAL",a[a.WORLD=1]="WORLD"}(a.Space||(a.Space={}));var n=(a.Space,function(){function a(){}return a.X=new f(1,0,0),a.Y=new f(0,1,0),a.Z=new f(0,0,1),a}());a.Axis=n;var o=function(){function a(){}return a.interpolate=function(a,b,c,d,e){for(var f=1-3*d+3*b,g=3*d-6*b,h=3*b,i=a,j=0;5>j;j++){var k=i*i,l=k*i,m=f*l+g*k+h*i,n=1/(3*f*k+2*g*i+h);i-=(m-a)*n,i=Math.min(1,Math.max(0,i))}return 3*Math.pow(1-i,2)*i*c+3*(1-i)*Math.pow(i,2)*e+Math.pow(i,3)},a}();a.BezierCurve=o,function(a){a[a.CW=0]="CW",a[a.CCW=1]="CCW"}(a.Orientation||(a.Orientation={}));var p=a.Orientation,q=function(){function a(a){var b=this;this.degrees=function(){return 180*b._radians/Math.PI},this.radians=function(){return b._radians},this._radians=a,this._radians<0&&(this._radians+=2*Math.PI)}return a.BetweenTwoPoints=function(b,c){var d=c.subtract(b),e=Math.atan2(d.y,d.x);return new a(e)},a.FromRadians=function(b){return new a(b)},a.FromDegrees=function(b){return new a(b*Math.PI/180)},a}();a.Angle=q;var r=function(){function a(a,b,c){this.startPoint=a,this.midPoint=b,this.endPoint=c;var d=Math.pow(b.x,2)+Math.pow(b.y,2),f=(Math.pow(a.x,2)+Math.pow(a.y,2)-d)/2,g=(d-Math.pow(c.x,2)-Math.pow(c.y,2))/2,h=(a.x-b.x)*(b.y-c.y)-(b.x-c.x)*(a.y-b.y);this.centerPoint=new e((f*(b.y-c.y)-g*(a.y-b.y))/h,((a.x-b.x)*g-(b.x-c.x)*f)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=q.BetweenTwoPoints(this.centerPoint,this.startPoint);var i=this.startAngle.degrees(),j=q.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),k=q.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();j-i>180&&(j-=360),-180>j-i&&(j+=360),k-j>180&&(k-=360),-180>k-j&&(k+=360),this.orientation=0>j-i?p.CW:p.CCW,this.angle=q.FromDegrees(this.orientation===p.CW?i-k:k-i)}return a}();a.Arc2=r;var s=function(){function a(a,b){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new e(a,b))}return a.prototype.addLineTo=function(a,b){if(closed)return this;var c=new e(a,b),d=this._points[this._points.length-1];return this._points.push(c),this._length+=c.subtract(d).length(),this},a.prototype.addArcTo=function(a,b,c,d,f){if(void 0===f&&(f=36),closed)return this;var g=this._points[this._points.length-1],h=new e(a,b),i=new e(c,d),j=new r(g,h,i),k=j.angle.radians()/f;j.orientation===p.CW&&(k*=-1);for(var l=j.startAngle.radians()+k,m=0;f>m;m++){var n=Math.cos(l)*j.radius+j.centerPoint.x,o=Math.sin(l)*j.radius+j.centerPoint.y;this.addLineTo(n,o),l+=k}return this},a.prototype.close=function(){return this.closed=!0,this},a.prototype.length=function(){var a=this._length;if(!this.closed){var b=this._points[this._points.length-1],c=this._points[0];a+=c.subtract(b).length()}return a},a.prototype.getPoints=function(){return this._points},a.prototype.getPointAtLengthPosition=function(a){if(0>a||a>1)return e.Zero();for(var b=a*this.length(),c=0,d=0;d<this._points.length;d++){var f=(d+1)%this._points.length,g=this._points[d],h=this._points[f],i=h.subtract(g),j=i.length()+c;if(b>=c&&j>=b){var k=i.normalize(),l=b-c;return new e(g.x+k.x*l,g.y+k.y*l)}c=j}return e.Zero()},a.StartingAt=function(b,c){return new a(b,c)},a}();a.Path2=s;var t=function(){function c(a,b,c){this.path=a,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var d=0;d<a.length;d++)this._curve[d]=a[d].clone();this._raw=c||!1,this._compute(b)}return c.prototype.getCurve=function(){return this._curve},c.prototype.getTangents=function(){return this._tangents},c.prototype.getNormals=function(){return this._normals},c.prototype.getBinormals=function(){return this._binormals},c.prototype.getDistances=function(){return this._distances},c.prototype.update=function(a,b){for(var c=0;c<a.length;c++)this._curve[c].x=a[c].x,this._curve[c].y=a[c].y,this._curve[c].z=a[c].z;return this._compute(b),this},c.prototype._compute=function(a){var b=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[b-1]=this._curve[b-1].subtract(this._curve[b-2]),this._raw||this._tangents[b-1].normalize();var c=this._tangents[0],d=this._normalVector(this._curve[0],c,a);this._normals[0]=d,this._raw||this._normals[0].normalize(),this._binormals[0]=f.Cross(c,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var e,g,h,i,j=1;b>j;j++)e=this._getLastNonNullVector(j),b-1>j&&(g=this._getFirstNonNullVector(j),this._tangents[j]=e.add(g),this._tangents[j].normalize()),this._distances[j]=this._distances[j-1]+e.length(),h=this._tangents[j],i=this._binormals[j-1],this._normals[j]=f.Cross(i,h),this._raw||this._normals[j].normalize(),this._binormals[j]=f.Cross(h,this._normals[j]),this._raw||this._binormals[j].normalize()},c.prototype._getFirstNonNullVector=function(a){for(var b=1,c=this._curve[a+b].subtract(this._curve[a]);0===c.length()&&a+b+1<this._curve.length;)b++,c=this._curve[a+b].subtract(this._curve[a]);return c},c.prototype._getLastNonNullVector=function(a){for(var b=1,c=this._curve[a].subtract(this._curve[a-b]);0===c.length()&&a>b+1;)b++,c=this._curve[a].subtract(this._curve[a-b]);return c},c.prototype._normalVector=function(c,d,e){var g;if(void 0===e||null===e){var h;b.WithinEpsilon(d.y,1,a.Epsilon)?b.WithinEpsilon(d.x,1,a.Epsilon)?b.WithinEpsilon(d.z,1,a.Epsilon)||(h=new f(0,0,1)):h=new f(1,0,0):h=new f(0,-1,0),g=f.Cross(d,h)}else g=f.Cross(d,e),f.CrossToRef(g,d,g);return g.normalize(),g},c}();a.Path3D=t;var u=function(){function a(a){this._length=0,this._points=a,this._length=this._computeLength(a)}return a.CreateQuadraticBezier=function(b,c,d,e){e=e>2?e:3;for(var g=new Array,h=function(a,b,c,d){var e=(1-a)*(1-a)*b+2*a*(1-a)*c+a*a*d;return e},i=0;e>=i;i++)g.push(new f(h(i/e,b.x,c.x,d.x),h(i/e,b.y,c.y,d.y),h(i/e,b.z,c.z,d.z)));return new a(g)},a.CreateCubicBezier=function(b,c,d,e,g){g=g>3?g:4;for(var h=new Array,i=function(a,b,c,d,e){var f=(1-a)*(1-a)*(1-a)*b+3*a*(1-a)*(1-a)*c+3*a*a*(1-a)*d+a*a*a*e;return f},j=0;g>=j;j++)h.push(new f(i(j/g,b.x,c.x,d.x,e.x),i(j/g,b.y,c.y,d.y,e.y),i(j/g,b.z,c.z,d.z,e.z)));return new a(h)},a.CreateHermiteSpline=function(b,c,d,e,g){for(var h=new Array,i=1/g,j=0;g>=j;j++)h.push(f.Hermite(b,c,d,e,j*i));return new a(h)},a.prototype.getPoints=function(){return this._points},a.prototype.length=function(){return this._length},a.prototype["continue"]=function(b){for(var c=this._points[this._points.length-1],d=this._points.slice(),e=b.getPoints(),f=1;f<e.length;f++)d.push(e[f].subtract(e[0]).add(c));var g=new a(d);return g},a.prototype._computeLength=function(a){for(var b=0,c=1;c<a.length;c++)b+=a[c].subtract(a[c-1]).length();return b},a}();a.Curve3=u;var v=function(){function a(){this.L00=f.Zero(),this.L1_1=f.Zero(),this.L10=f.Zero(),this.L11=f.Zero(),this.L2_2=f.Zero(),this.L2_1=f.Zero(),this.L20=f.Zero(),this.L21=f.Zero(),this.L22=f.Zero()}return a.prototype.addLight=function(a,b,c){var d=new f(b.r,b.g,b.b),e=d.scale(c);this.L00=this.L00.add(e.scale(.282095)),this.L1_1=this.L1_1.add(e.scale(.488603*a.y)),this.L10=this.L10.add(e.scale(.488603*a.z)),this.L11=this.L11.add(e.scale(.488603*a.x)),this.L2_2=this.L2_2.add(e.scale(1.092548*a.x*a.y)),this.L2_1=this.L2_1.add(e.scale(1.092548*a.y*a.z)),this.L21=this.L21.add(e.scale(1.092548*a.x*a.z)),this.L20=this.L20.add(e.scale(.315392*(3*a.z*a.z-1))),this.L22=this.L22.add(e.scale(.546274*(a.x*a.x-a.y*a.y)))},a.prototype.scale=function(a){this.L00=this.L00.scale(a),this.L1_1=this.L1_1.scale(a),this.L10=this.L10.scale(a),this.L11=this.L11.scale(a),this.L2_2=this.L2_2.scale(a),this.L2_1=this.L2_1.scale(a),this.L20=this.L20.scale(a),this.L21=this.L21.scale(a),this.L22=this.L22.scale(a)},a}();a.SphericalHarmonics=v;var w=function(){function a(){this.x=f.Zero(),this.y=f.Zero(),this.z=f.Zero(),this.xx=f.Zero(),this.yy=f.Zero(),this.zz=f.Zero(),this.xy=f.Zero(),this.yz=f.Zero(),this.zx=f.Zero()}return a.prototype.addAmbient=function(a){var b=new f(a.r,a.g,a.b);this.xx=this.xx.add(b),this.yy=this.yy.add(b),this.zz=this.zz.add(b)},a.getSphericalPolynomialFromHarmonics=function(b){var c=new a;return c.x=b.L11.scale(1.02333),c.y=b.L1_1.scale(1.02333),c.z=b.L10.scale(1.02333),c.xx=b.L00.scale(.886277).subtract(b.L20.scale(.247708)).add(b.L22.scale(.429043)),c.yy=b.L00.scale(.886277).subtract(b.L20.scale(.247708)).subtract(b.L22.scale(.429043)),c.zz=b.L00.scale(.886277).add(b.L20.scale(.495417)),c.yz=b.L2_1.scale(.858086),c.zx=b.L21.scale(.858086),c.xy=b.L2_2.scale(.858086),c},a}();a.SphericalPolynomial=w;var x=function(){function a(a,b){void 0===a&&(a=f.Zero()),void 0===b&&(b=f.Up()),this.position=a,this.normal=b}return a.prototype.clone=function(){return new a(this.position.clone(),this.normal.clone())},a}();a.PositionNormalVertex=x;var y=function(){function a(a,b,c){void 0===a&&(a=f.Zero()),void 0===b&&(b=f.Up()),void 0===c&&(c=e.Zero()),this.position=a,this.normal=b,this.uv=c}return a.prototype.clone=function(){return new a(this.position.clone(),this.normal.clone(),this.uv.clone())},a}();a.PositionNormalTextureVertex=y;var z=function(){function a(){}return a.Color3=[c.Black(),c.Black(),c.Black()],a.Vector2=[e.Zero(),e.Zero(),e.Zero()],a.Vector3=[f.Zero(),f.Zero(),f.Zero(),f.Zero(),f.Zero(),f.Zero(),f.Zero(),f.Zero(),f.Zero()],a.Vector4=[g.Zero(),g.Zero(),g.Zero()],a.Quaternion=[new i(0,0,0,0)],a.Matrix=[j.Zero(),j.Zero(),j.Zero(),j.Zero(),j.Zero(),j.Zero(),j.Zero(),j.Zero()],a}();a.Tmp=z}(BABYLON||(BABYLON={}));var BABYLON;!function(a){function b(a,b){return function(c,d){c.__serializableMembers||(c.__serializableMembers={}),c.__serializableMembers[d]={type:a,sourceName:b}}}function c(a){return b(0,a)}function d(a){return b(1,a)}function e(a){return b(2,a)}function f(a){return b(3,a)}function g(a){return b(4,a)}function h(a){return b(5,a)}function i(a){return b(6,a)}function j(a){return b(7,a)}a.serialize=c,a.serializeAsTexture=d,a.serializeAsColor3=e,a.serializeAsFresnelParameters=f,a.serializeAsVector2=g,a.serializeAsVector3=h,a.serializeAsMeshReference=i,a.serializeAsColorCurves=j;var k=function(){function b(){}return b.Serialize=function(b,c){c||(c={}),c.tags=a.Tags.GetTags(b);for(var d in b.__serializableMembers){var e=b.__serializableMembers[d],f=e.sourceName||d,g=e.type,h=b[d];if(void 0!==h&&null!==h)switch(g){case 0:c[f]=h;break;case 1:c[f]=h.serialize();break;case 2:c[f]=h.asArray();break;case 3:c[f]=h.serialize();break;case 4:c[f]=h.asArray();break;case 5:c[f]=h.asArray();break;case 6:c[f]=h.id;break;case 7:c[f]=h.serialize()}}return c},b.Parse=function(b,c,d,e){var f=b();a.Tags.AddTagsTo(f,c.tags);for(var g in f.__serializableMembers){var h=f.__serializableMembers[g],i=c[h.sourceName||g],j=h.type;if(void 0!==i&&null!==i)switch(j){case 0:f[g]=i;break;case 1:f[g]=a.Texture.Parse(i,d,e);break;case 2:f[g]=a.Color3.FromArray(i);break;case 3:f[g]=a.FresnelParameters.Parse(i);break;case 4:f[g]=a.Vector2.FromArray(i);break;case 5:f[g]=a.Vector3.FromArray(i);break;case 6:f[g]=d.getLastMeshByID(i);break;case 7:f[g]=a.ColorCurves.Parse(i)}}return f},b.Clone=function(b,c){var d=b();a.Tags.AddTagsTo(d,c.tags);for(var e in d.__serializableMembers){var f=d.__serializableMembers[e],g=c[e],h=f.type;if(void 0!==g&&null!==g)switch(h){case 0:case 6:d[e]=g;break;case 1:case 2:case 3:case 4:case 5:case 7:d[e]=g.clone()}}return d},b}();a.SerializationHelper=k}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b){void 0===b&&(b=!1),this.mask=a,this.skipNextObservers=b}return a}();a.EventState=b;var c=function(){function a(a,b){this.callback=a,this.mask=b}return a}();a.Observer=c;var d=function(){function a(){this._observers=new Array}return a.prototype.add=function(a,b,d){if(void 0===b&&(b=-1),void 0===d&&(d=!1),!a)return null;var e=new c(a,b);return d?this._observers.unshift(e):this._observers.push(e),e},a.prototype.remove=function(a){var b=this._observers.indexOf(a);return-1!==b?(this._observers.splice(b,1),!0):!1},a.prototype.removeCallback=function(a){for(var b=0;b<this._observers.length;b++)if(this._observers[b].callback===a)return this._observers.splice(b,1),!0;return!1},a.prototype.notifyObservers=function(a,c){void 0===c&&(c=-1);for(var d=new b(c),e=0,f=this._observers;e<f.length;e++){var g=f[e];if(g.mask&c&&g.callback(a,d),d.skipNextObservers)break}},a.prototype.hasObservers=function(){return this._observers.length>0},a.prototype.clear=function(){this._observers=new Array},a.prototype.clone=function(){var b=new a;return b._observers=this._observers.slice(0),b},a}();a.Observable=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,c){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=c,this.currentSceneUrl=b.ReturnFullUrlLocation(a),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,b.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return b.prototype.checkManifestFile=function(){function b(){d.enableSceneOffline=!1,d.enableTexturesOffline=!1,d.callbackManifestChecked(!1)}var c=this,d=this,e=!1,f=this.currentSceneUrl+".manifest",g=new XMLHttpRequest;navigator.onLine&&(e=!0,f=f+(null==f.match(/\?/)?"?":"&")+(new Date).getTime()),g.open("GET",f,!0),g.addEventListener("load",function(){if(200===g.status||a.Tools.ValidateXHRData(g,1))try{var d=JSON.parse(g.response);c.enableSceneOffline=d.enableSceneOffline,c.enableTexturesOffline=d.enableTexturesOffline,d.version&&!isNaN(parseInt(d.version))&&(c.manifestVersionFound=d.version),c.callbackManifestChecked&&c.callbackManifestChecked(!0)}catch(e){b()}else b()},!1),g.addEventListener("error",function(a){if(e){e=!1;var d=c.currentSceneUrl+".manifest";g.open("GET",d,!0),g.send()}else b()},!1);try{g.send()}catch(h){a.Tools.Error("Error on XHR send request."),d.callbackManifestChecked(!1)}},b.prototype.openAsync=function(b,c){function d(){f.isSupported=!1,c&&c()}var e=this,f=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)b&&b();else{this.hasReachedQuota=!1,this.isSupported=!0;var g=this.idbFactory.open("babylonjs",1);g.onerror=function(a){d()},g.onblocked=function(b){a.Tools.Error("IDB request blocked. Please reload the page."),d()},g.onsuccess=function(a){e.db=g.result,b()},g.onupgradeneeded=function(b){e.db=b.target.result;try{e.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),e.db.createObjectStore("versions",{keyPath:"sceneUrl"}),e.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(c){a.Tools.Error("Error while creating object stores. Exception: "+c.message),d()}}}else this.isSupported=!1,c&&c()},b.prototype.loadImageFromDB=function(a,c){var d=this,e=b.ReturnFullUrlLocation(a),f=function(){d.hasReachedQuota||null===d.db?c.src=a:d._saveImageIntoDBAsync(e,c)};this.mustUpdateRessources?f():this._loadImageFromDBAsync(e,c,f)},b.prototype._loadImageFromDBAsync=function(b,c,d){if(this.isSupported&&null!==this.db){var e,f=this.db.transaction(["textures"]);f.onabort=function(a){c.src=b},f.oncomplete=function(f){var g;if(e){var h=window.URL||window.webkitURL;g=h.createObjectURL(e.data,{oneTimeOnly:!0}),c.onerror=function(){a.Tools.Error("Error loading image from blob URL: "+g+" switching back to web url: "+b),c.src=b},c.src=g}else d()};var g=f.objectStore("textures").get(b);g.onsuccess=function(a){e=a.target.result},g.onerror=function(d){a.Tools.Error("Error loading texture "+b+" from DB."),c.src=b}}else a.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),c.src=b},b.prototype._saveImageIntoDBAsync=function(c,d){var e=this;if(this.isSupported){var f=function(){var a;if(g){var b=window.URL||window.webkitURL;try{a=b.createObjectURL(g,{oneTimeOnly:!0})}catch(c){a=b.createObjectURL(g)}}d.src=a};if(b.IsUASupportingBlobStorage){var g,h=new XMLHttpRequest;h.open("GET",c,!0),h.responseType="blob",h.addEventListener("load",function(){if(200===h.status){g=h.response;var a=e.db.transaction(["textures"],"readwrite");a.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(b){}f()},a.oncomplete=function(a){f()};var i={textureUrl:c,data:g};try{var j=a.objectStore("textures").put(i);j.onsuccess=function(a){},j.onerror=function(a){f()}}catch(k){25===k.code&&(b.IsUASupportingBlobStorage=!1),d.src=c}}else d.src=c},!1),h.addEventListener("error",function(b){a.Tools.Error("Error in XHR request in BABYLON.Database."),d.src=c},!1),h.send()}else d.src=c}else a.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),d.src=c},b.prototype._checkVersionFromDB=function(a,b){var c=this,d=function(d){c._saveVersionIntoDBAsync(a,b)};this._loadVersionFromDBAsync(a,b,d)},b.prototype._loadVersionFromDBAsync=function(b,c,d){var e=this;if(this.isSupported){var f;try{var g=this.db.transaction(["versions"]);g.oncomplete=function(a){f?e.manifestVersionFound>f.data?(e.mustUpdateRessources=!0,d()):c(f.data):(e.mustUpdateRessources=!0,d())},g.onabort=function(a){c(-1)};var h=g.objectStore("versions").get(b);h.onsuccess=function(a){f=a.target.result},h.onerror=function(d){a.Tools.Error("Error loading version for scene "+b+" from DB."),c(-1)}}catch(i){a.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+i.message),c(-1)}}else a.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),c(-1)},b.prototype._saveVersionIntoDBAsync=function(b,c){var d=this;if(this.isSupported&&!this.hasReachedQuota)try{var e=this.db.transaction(["versions"],"readwrite");e.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(d.hasReachedQuota=!0)}catch(b){}c(-1)},e.oncomplete=function(a){c(d.manifestVersionFound)};var f={sceneUrl:b,data:this.manifestVersionFound},g=e.objectStore("versions").put(f);g.onsuccess=function(a){},g.onerror=function(b){a.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(h){a.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+h.message),c(-1)}else c(-1)},b.prototype.loadFileFromDB=function(a,c,d,e,f){var g=this,h=b.ReturnFullUrlLocation(a),i=function(a){g._saveFileIntoDBAsync(h,c,d)};this._checkVersionFromDB(h,function(a){-1!==a?g.mustUpdateRessources?g._saveFileIntoDBAsync(h,c,d,f):g._loadFileFromDBAsync(h,c,i,f):e()})},b.prototype._loadFileFromDBAsync=function(b,c,d,e){if(this.isSupported){var f;f=-1!==b.indexOf(".babylon")?"scenes":"textures";var g,h=this.db.transaction([f]);h.oncomplete=function(a){g?c(g.data):d()},h.onabort=function(a){d()};var i=h.objectStore(f).get(b);i.onsuccess=function(a){g=a.target.result},i.onerror=function(c){a.Tools.Error("Error loading file "+b+" from DB."),d()}}else a.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),c()},b.prototype._saveFileIntoDBAsync=function(b,c,d,e){var f=this;if(this.isSupported){var g;g=-1!==b.indexOf(".babylon")?"scenes":"textures";var h,i=new XMLHttpRequest;i.open("GET",b,!0),e&&(i.responseType="arraybuffer"),i.onprogress=d,i.addEventListener("load",function(){if(200===i.status||a.Tools.ValidateXHRData(i,e?6:1))if(h=e?i.response:i.responseText,f.hasReachedQuota)c(h);else{var d=f.db.transaction([g],"readwrite");d.onabort=function(a){try{a.srcElement.error&&"QuotaExceededError"===a.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(b){}c(h)},d.oncomplete=function(a){c(h)};var j;j="scenes"===g?{sceneUrl:b,data:h,version:f.manifestVersionFound}:{textureUrl:b,data:h};try{var k=d.objectStore(g).put(j);k.onsuccess=function(a){},k.onerror=function(b){a.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(l){c(h)}}else c()},!1),i.addEventListener("error",function(b){a.Tools.Error("error on XHR request."),c()},!1),i.send()}else a.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),c()},b.IsUASupportingBlobStorage=!0,b.IDBStorageEnabled=!0,b.parseURL=function(a){var b=document.createElement("a");b.href=a;var c=a.substring(0,a.lastIndexOf("#")),d=a.substring(c.lastIndexOf("/")+1,a.length),e=a.substring(0,a.indexOf(d,0));return e},b.ReturnFullUrlLocation=function(a){return-1===a.indexOf("http:/")?b.parseURL(window.location.href)+a:a},b}();a.Database=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(){function b(){}return b.GetTGAHeader=function(a){var b=0,c={id_length:a[b++],colormap_type:a[b++],image_type:a[b++],colormap_index:a[b++]|a[b++]<<8,colormap_length:a[b++]|a[b++]<<8,colormap_size:a[b++],origin:[a[b++]|a[b++]<<8,a[b++]|a[b++]<<8],width:a[b++]|a[b++]<<8,height:a[b++]|a[b++]<<8,pixel_size:a[b++],flags:a[b++]};return c},b.UploadContent=function(c,d){if(d.length<19)return void a.Tools.Error("Unable to load TGA file - Not enough data to contain header");var e=18,f=b.GetTGAHeader(d);if(f.id_length+e>d.length)return void a.Tools.Error("Unable to load TGA file - Not enough data");e+=f.id_length;var g=!1,h=!1,i=!1,j=!1;switch(f.image_type){case b._TYPE_RLE_INDEXED:g=!0;case b._TYPE_INDEXED:h=!0;break;case b._TYPE_RLE_RGB:g=!0;case b._TYPE_RGB:i=!0;break;case b._TYPE_RLE_GREY:g=!0;case b._TYPE_GREY:j=!0}var k,l,m=(15&f.flags,f.pixel_size>>3),n=f.width*f.height*m;if(h&&(l=d.subarray(e,e+=f.colormap_length*(f.colormap_size>>3))),g){k=new Uint8Array(n);for(var o,p,q,r=0,s=new Uint8Array(m);n>e&&n>r;)if(o=d[e++],p=(127&o)+1,128&o){for(q=0;m>q;++q)s[q]=d[e++];for(q=0;p>q;++q)k.set(s,r+q*m);r+=m*p}else{for(p*=m,q=0;p>q;++q)k[r+q]=d[e++];r+=p}}else k=d.subarray(e,e+=h?f.width*f.height:n);var t,u,v,w,x,y;switch((f.flags&b._ORIGIN_MASK)>>b._ORIGIN_SHIFT){default:case b._ORIGIN_UL:t=0,v=1,y=f.width,u=0,w=1,x=f.height;break;case b._ORIGIN_BL:t=0,v=1,y=f.width,u=f.height-1,w=-1,x=-1;break;case b._ORIGIN_UR:t=f.width-1,v=-1,y=-1,u=0,w=1,x=f.height;break;case b._ORIGIN_BR:t=f.width-1,v=-1,y=-1,u=f.height-1,w=-1,x=-1}var z="_getImageData"+(j?"Grey":"")+f.pixel_size+"bits",A=b[z](f,l,k,u,w,x,t,v,y);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f.width,f.height,0,c.RGBA,c.UNSIGNED_BYTE,A)},b._getImageData8bits=function(a,b,c,d,e,f,g,h,i){var j,k,l,m=c,n=b,o=a.width,p=a.height,q=0,r=new Uint8Array(o*p*4);for(l=d;l!==f;l+=e)for(k=g;k!==i;k+=h,q++)j=m[q],r[4*(k+o*l)+3]=255,r[4*(k+o*l)+2]=n[3*j+0],r[4*(k+o*l)+1]=n[3*j+1],r[4*(k+o*l)+0]=n[3*j+2];return r},b._getImageData16bits=function(a,b,c,d,e,f,g,h,i){var j,k,l,m=c,n=a.width,o=a.height,p=0,q=new Uint8Array(n*o*4);for(l=d;l!==f;l+=e)for(k=g;k!==i;k+=h,p+=2)j=m[p+0]+(m[p+1]<<8),q[4*(k+n*l)+0]=(31744&j)>>7,q[4*(k+n*l)+1]=(992&j)>>2,q[4*(k+n*l)+2]=(31&j)>>3,q[4*(k+n*l)+3]=32768&j?0:255;return q},b._getImageData24bits=function(a,b,c,d,e,f,g,h,i){var j,k,l=c,m=a.width,n=a.height,o=0,p=new Uint8Array(m*n*4);for(k=d;k!==f;k+=e)for(j=g;j!==i;j+=h,o+=3)p[4*(j+m*k)+3]=255,p[4*(j+m*k)+2]=l[o+0],p[4*(j+m*k)+1]=l[o+1],p[4*(j+m*k)+0]=l[o+2];return p},b._getImageData32bits=function(a,b,c,d,e,f,g,h,i){var j,k,l=c,m=a.width,n=a.height,o=0,p=new Uint8Array(m*n*4);for(k=d;k!==f;k+=e)for(j=g;j!==i;j+=h,o+=4)p[4*(j+m*k)+2]=l[o+0],p[4*(j+m*k)+1]=l[o+1],p[4*(j+m*k)+0]=l[o+2],p[4*(j+m*k)+3]=l[o+3];return p},b._getImageDataGrey8bits=function(a,b,c,d,e,f,g,h,i){var j,k,l,m=c,n=a.width,o=a.height,p=0,q=new Uint8Array(n*o*4);for(l=d;l!==f;l+=e)for(k=g;k!==i;k+=h,p++)j=m[p],q[4*(k+n*l)+0]=j,q[4*(k+n*l)+1]=j,q[4*(k+n*l)+2]=j,q[4*(k+n*l)+3]=255;return q},b._getImageDataGrey16bits=function(a,b,c,d,e,f,g,h,i){var j,k,l=c,m=a.width,n=a.height,o=0,p=new Uint8Array(m*n*4);for(k=d;k!==f;k+=e)for(j=g;j!==i;j+=h,o+=2)p[4*(j+m*k)+0]=l[o+0],p[4*(j+m*k)+1]=l[o+0],p[4*(j+m*k)+2]=l[o+0],p[4*(j+m*k)+3]=l[o+1];return p},b._TYPE_NO_DATA=0,b._TYPE_INDEXED=1,b._TYPE_RGB=2,b._TYPE_GREY=3,b._TYPE_RLE_INDEXED=9,b._TYPE_RLE_RGB=10,b._TYPE_RLE_GREY=11,b._ORIGIN_MASK=48,b._ORIGIN_SHIFT=4,b._ORIGIN_BL=0,b._ORIGIN_BR=1,b._ORIGIN_UL=2,b._ORIGIN_UR=3,b}();b.TGATools=c}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(b){this.length=0,this._duplicateId=0,this.data=new Array(b),this._id=a._GlobalId++}return a.prototype.push=function(a){this.data[this.length++]=a,this.length>this.data.length&&(this.data.length*=2),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId},a.prototype.pushNoDuplicate=function(a){return a.__smartArrayFlags&&a.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(a),!0)},a.prototype.sort=function(a){this.data.sort(a)},a.prototype.reset=function(){this.length=0,this._duplicateId++},a.prototype.concat=function(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(var b=0;b<a.length;b++)this.data[this.length++]=(a.data||a)[b]}},a.prototype.concatWithNoDuplicate=function(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(var b=0;b<a.length;b++){var c=(a.data||a)[b];this.pushNoDuplicate(c)}}},a.prototype.indexOf=function(a){var b=this.data.indexOf(a);return b>=this.length?-1:b},a._GlobalId=0,a}();a.SmartArray=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this._count=0,this._data={}}return a.prototype.get=function(a){var b=this._data[a];return void 0!==b?b:void 0},a.prototype.getOrAddWithFactory=function(a,b){var c=this.get(a);return void 0!==c?c:(c=b(a),c&&this.add(a,c),c)},a.prototype.getOrAdd=function(a,b){var c=this.get(a);return void 0!==c?c:(this.add(a,b),b)},a.prototype.contains=function(a){return void 0!==this._data[a]},a.prototype.add=function(a,b){return void 0!==this._data[a]?!1:(this._data[a]=b,++this._count,!0)},a.prototype.set=function(a,b){return void 0===this._data[a]?!1:(this._data[a]=b,!0)},a.prototype.remove=function(a){return this.contains(a)?(delete this._data[a],--this._count,!0):!1},a.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),a.prototype.forEach=function(a){for(var b in this._data){var c=this._data[b];a(b,c)}},a.prototype.first=function(a){for(var b in this._data){var c=this._data[b],d=a(b,c);if(d)return d}return null},a}();a.StringDictionary=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){function b(a){return function(b){b.__bjsclassName__=a}}var c,d=function(b,c){return b?b instanceof a.Mesh?null:b instanceof a.SubMesh?b.clone(c):b.clone?b.clone():null:null},e=function(){function b(){}return b.Instantiate=function(a){for(var b=a.split("."),c=window||this,d=0,e=b.length;e>d;d++)c=c[b[d]];return"function"!=typeof c?null:c},b.SetImmediate=function(a){window.setImmediate?window.setImmediate(a):setTimeout(a,1)},b.IsExponentOfTwo=function(a){var b=1;do b*=2;while(a>b);return b===a},b.GetExponentOfTwo=function(a,b){var c=1;do c*=2;while(a>c);return c>b&&(c=b),c},b.GetFilename=function(a){var b=a.lastIndexOf("/");return 0>b?a:a.substring(b+1)},b.GetDOMTextContent=function(a){for(var b="",c=a.firstChild;c;)3===c.nodeType&&(b+=c.textContent),c=c.nextSibling;return b},b.ToDegrees=function(a){return 180*a/Math.PI},b.ToRadians=function(a){return a*Math.PI/180},b.EncodeArrayBufferTobase64=function(a){for(var b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k=0,l=new Uint8Array(a);k<l.length;)b=l[k++],c=k<l.length?l[k++]:Number.NaN,d=k<l.length?l[k++]:Number.NaN,e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),j+=i.charAt(e)+i.charAt(f)+i.charAt(g)+i.charAt(h);return"data:image/png;base64,"+j},b.ExtractMinAndMaxIndexed=function(b,c,d,e,f){void 0===f&&(f=null);for(var g=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new a.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=d;d+e>i;i++){var j=new a.Vector3(b[3*c[i]],b[3*c[i]+1],b[3*c[i]+2]);g=a.Vector3.Minimize(j,g),h=a.Vector3.Maximize(j,h)}return f&&(g.x-=g.x*f.x+f.y,g.y-=g.y*f.x+f.y,g.z-=g.z*f.x+f.y,h.x+=h.x*f.x+f.y,h.y+=h.y*f.x+f.y,h.z+=h.z*f.x+f.y),{minimum:g,maximum:h}},b.ExtractMinAndMax=function(b,c,d,e,f){void 0===e&&(e=null);var g=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new a.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);f||(f=3);for(var i=c;c+d>i;i++){var j=new a.Vector3(b[i*f],b[i*f+1],b[i*f+2]);g=a.Vector3.Minimize(j,g),h=a.Vector3.Maximize(j,h)}return e&&(g.x-=g.x*e.x+e.y,g.y-=g.y*e.x+e.y,g.z-=g.z*e.x+e.y,h.x+=h.x*e.x+e.y,h.y+=h.y*e.x+e.y,h.z+=h.z*e.x+e.y),{minimum:g,maximum:h}},b.Vector2ArrayFeeder=function(b){return function(c){var d=void 0!==b.BYTES_PER_ELEMENT,e=d?b.length/2:b.length;if(c>=e)return null;if(d){var f=b;return new a.Vector2(f[2*c+0],f[2*c+1])}var g=b;return g[c]}},b.ExtractMinAndMaxVector2=function(b,c){void 0===c&&(c=null);for(var d=new a.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),e=new a.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),f=0,g=b(f++);g;)d=a.Vector2.Minimize(g,d),e=a.Vector2.Maximize(g,e),g=b(f++);return c&&(d.x-=d.x*c.x+c.y,d.y-=d.y*c.x+c.y,e.x+=e.x*c.x+c.y,e.y+=e.y*c.x+c.y),{minimum:d,maximum:e}},b.MakeArray=function(a,b){return b===!0||void 0!==a&&null!=a?Array.isArray(a)?a:[a]:void 0},b.GetPointerPrefix=function(){var a="pointer";return window.PointerEvent||navigator.pointerEnabled||(a="mouse"),a},b.QueueNewFrame=function(a){window.requestAnimationFrame?window.requestAnimationFrame(a):window.msRequestAnimationFrame?window.msRequestAnimationFrame(a):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(a):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(a):window.oRequestAnimationFrame?window.oRequestAnimationFrame(a):window.setTimeout(a,16);
},b.RequestFullscreen=function(a,b){var c=a.requestFullscreen||a.msRequestFullscreen||a.webkitRequestFullscreen||a.mozRequestFullScreen;c&&c.call(a,b)},b.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},b.CleanUrl=function(a){return a=a.replace(/#/gm,"%23")},b.LoadImage=function(c,d,e,f){c instanceof ArrayBuffer&&(c=b.EncodeArrayBufferTobase64(c)),c=b.CleanUrl(c);var g=new Image;if("data:"!==c.substr(0,5)&&b.CorsBehavior)switch(typeof b.CorsBehavior){case"function":var h=b.CorsBehavior(c);h&&(g.crossOrigin=h);break;case"string":default:g.crossOrigin=b.CorsBehavior}g.onload=function(){d(g)},g.onerror=function(a){b.Error("Error while trying to load texture: "+c),b.UseFallbackTexture?(g.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",d(g)):e()};var i=function(){g.src=c},j=function(){f.loadImageFromDB(c,g)};if("data:"!==c.substr(0,5)&&f&&f.enableTexturesOffline&&a.Database.IsUASupportingBlobStorage)f.openAsync(j,i);else if(-1===c.indexOf("file:"))i();else try{var k,l=c.substring(5).toLowerCase();try{k=URL.createObjectURL(a.FilesInput.FilesTextures[l],{oneTimeOnly:!0})}catch(m){k=URL.createObjectURL(a.FilesInput.FilesTextures[l])}g.src=k}catch(n){g.src=null}return g},b.LoadFile=function(c,d,e,f,g,h){c=b.CleanUrl(c);var i=function(){var a=new XMLHttpRequest,f=b.BaseUrl+c;a.open("GET",f,!0),g&&(a.responseType="arraybuffer"),a.onprogress=e,a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status||b.ValidateXHRData(a,g?6:1))d(g?a.response:a.responseText);else{if(!h)throw new Error("Error status: "+a.status+" - Unable to load "+f);h()}},a.send(null)},j=function(){f.loadFileFromDB(c,d,e,i,g)};if(-1!==c.indexOf("file:")){var k=c.substring(5).toLowerCase();b.ReadFile(a.FilesInput.FilesToLoad[k],d,e,g)}else f&&f.enableSceneOffline?f.openAsync(j,i):i()},b.ReadFileAsDataURL=function(a,b,c){var d=new FileReader;d.onload=function(a){b(a.target.result)},d.onprogress=c,d.readAsDataURL(a)},b.ReadFile=function(a,c,d,e){var f=new FileReader;f.onerror=function(d){b.Log("Error while reading file: "+a.name),c(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},f.onload=function(a){c(a.target.result)},f.onprogress=d,e?f.readAsArrayBuffer(a):f.readAsText(a)},b.FileAsURL=function(a){var b=new Blob([a]),c=window.URL||window.webkitURL,d=c.createObjectURL(b);return d},b.Format=function(a,b){return void 0===b&&(b=2),a.toFixed(b)},b.CheckExtends=function(a,b,c){a.x<b.x&&(b.x=a.x),a.y<b.y&&(b.y=a.y),a.z<b.z&&(b.z=a.z),a.x>c.x&&(c.x=a.x),a.y>c.y&&(c.y=a.y),a.z>c.z&&(c.z=a.z)},b.DeepCopy=function(a,b,c,e){for(var f in a)if(("_"!==f[0]||e&&-1!==e.indexOf(f))&&(!c||-1===c.indexOf(f))){var g=a[f],h=typeof g;if("function"!==h)if("object"===h)if(g instanceof Array){if(b[f]=[],g.length>0)if("object"==typeof g[0])for(var i=0;i<g.length;i++){var j=d(g[i],b);-1===b[f].indexOf(j)&&b[f].push(j)}else b[f]=g.slice(0)}else b[f]=d(g,b);else b[f]=g}},b.IsEmpty=function(a){for(var b in a)return!1;return!0},b.RegisterTopRootEvents=function(a){for(var b=0;b<a.length;b++){var c=a[b];window.addEventListener(c.name,c.handler,!1);try{window.parent&&window.parent.addEventListener(c.name,c.handler,!1)}catch(d){}}},b.UnregisterTopRootEvents=function(a){for(var b=0;b<a.length;b++){var c=a[b];window.removeEventListener(c.name,c.handler);try{window.parent&&window.parent.removeEventListener(c.name,c.handler)}catch(d){}}},b.DumpFramebuffer=function(a,b,d,e){for(var f=4*a,g=b/2,h=d.readPixels(0,0,a,b),i=0;g>i;i++)for(var j=0;f>j;j++){var k=j+i*f,l=b-i-1,m=j+l*f,n=h[k];h[k]=h[m],h[m]=n}c||(c=document.createElement("canvas")),c.width=a,c.height=b;var o=c.getContext("2d"),p=o.createImageData(a,b),q=p.data;q.set(h),o.putImageData(p,0,0);var r=c.toDataURL();if(e)e(r);else if("download"in document.createElement("a")){var s=window.document.createElement("a");s.href=r;var t=new Date,u=(t.getFullYear()+"-"+(t.getMonth()+1)).slice(-2)+"-"+t.getDate()+"_"+t.getHours()+"-"+("0"+t.getMinutes()).slice(-2);s.setAttribute("download","screenshot_"+u+".png"),window.document.body.appendChild(s),s.addEventListener("click",function(){s.parentElement.removeChild(s)}),s.click()}else{var v=window.open(""),w=v.document.createElement("img");w.src=r,v.document.body.appendChild(w)}},b.CreateScreenshot=function(c,d,e,f){var g,h;if(e.precision)g=Math.round(c.getRenderWidth()*e.precision),h=Math.round(g/c.getAspectRatio(d)),e={width:g,height:h};else if(e.width&&e.height)g=e.width,h=e.height;else if(e.width&&!e.height)g=e.width,h=Math.round(g/c.getAspectRatio(d)),e={width:g,height:h};else if(e.height&&!e.width)h=e.height,g=Math.round(h*c.getAspectRatio(d)),e={width:g,height:h};else{if(isNaN(e))return void b.Error("Invalid 'size' parameter !");h=e,g=e}var i=d.getScene(),j=null;i.activeCamera!==d&&(j=i.activeCamera,i.activeCamera=d);var k=new a.RenderTargetTexture("screenShot",e,i,!1,!1);k.renderList=i.meshes,k.onAfterRenderObservable.add(function(){b.DumpFramebuffer(g,h,c,f)}),i.incrementRenderId(),i.resetCachedMaterial(),k.render(!0),k.dispose(),j&&(i.activeCamera=j),d.getProjectionMatrix(!0)},b.ValidateXHRData=function(b,c){void 0===c&&(c=7);try{if(1&c){if(b.responseText&&b.responseText.length>0)return!0;if(1===c)return!1}if(2&c){var d=a.Internals.TGATools.GetTGAHeader(b.response);if(d.width&&d.height&&d.width>0&&d.height>0)return!0;if(2===c)return!1}if(4&c){var e=new Uint8Array(b.response,0,3);return 68===e[0]&&68===e[1]&&83===e[2]}}catch(f){}return!1},Object.defineProperty(b,"NoneLogLevel",{get:function(){return b._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MessageLogLevel",{get:function(){return b._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"WarningLogLevel",{get:function(){return b._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorLogLevel",{get:function(){return b._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"AllLogLevel",{get:function(){return b._MessageLogLevel|b._WarningLogLevel|b._ErrorLogLevel},enumerable:!0,configurable:!0}),b._AddLogEntry=function(a){b._LogCache=a+b._LogCache,b.OnNewCacheEntry&&b.OnNewCacheEntry(a)},b._FormatMessage=function(a){var b=function(a){return 10>a?"0"+a:""+a},c=new Date;return"["+b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())+"]: "+a},b._LogDisabled=function(a){},b._LogEnabled=function(a){var c=b._FormatMessage(a);console.log("BJS - "+c);var d="<div style='color:white'>"+c+"</div><br>";b._AddLogEntry(d)},b._WarnDisabled=function(a){},b._WarnEnabled=function(a){var c=b._FormatMessage(a);console.warn("BJS - "+c);var d="<div style='color:orange'>"+c+"</div><br>";b._AddLogEntry(d)},b._ErrorDisabled=function(a){},b._ErrorEnabled=function(a){b.errorsCount++;var c=b._FormatMessage(a);console.error("BJS - "+c);var d="<div style='color:red'>"+c+"</div><br>";b._AddLogEntry(d)},Object.defineProperty(b,"LogCache",{get:function(){return b._LogCache},enumerable:!0,configurable:!0}),b.ClearLogCache=function(){b._LogCache="",b.errorsCount=0},Object.defineProperty(b,"LogLevels",{set:function(a){(a&b.MessageLogLevel)===b.MessageLogLevel?b.Log=b._LogEnabled:b.Log=b._LogDisabled,(a&b.WarningLogLevel)===b.WarningLogLevel?b.Warn=b._WarnEnabled:b.Warn=b._WarnDisabled,(a&b.ErrorLogLevel)===b.ErrorLogLevel?b.Error=b._ErrorEnabled:b.Error=b._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceNoneLogLevel",{get:function(){return b._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceUserMarkLogLevel",{get:function(){return b._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceConsoleLogLevel",{get:function(){return b._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PerformanceLogLevel",{set:function(a){return(a&b.PerformanceUserMarkLogLevel)===b.PerformanceUserMarkLogLevel?(b.StartPerformanceCounter=b._StartUserMark,void(b.EndPerformanceCounter=b._EndUserMark)):(a&b.PerformanceConsoleLogLevel)===b.PerformanceConsoleLogLevel?(b.StartPerformanceCounter=b._StartPerformanceConsole,void(b.EndPerformanceCounter=b._EndPerformanceConsole)):(b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,void(b.EndPerformanceCounter=b._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),b._StartPerformanceCounterDisabled=function(a,b){},b._EndPerformanceCounterDisabled=function(a,b){},b._StartUserMark=function(a,c){void 0===c&&(c=!0),c&&b._performance.mark&&b._performance.mark(a+"-Begin")},b._EndUserMark=function(a,c){void 0===c&&(c=!0),c&&b._performance.mark&&(b._performance.mark(a+"-End"),b._performance.measure(a,a+"-Begin",a+"-End"))},b._StartPerformanceConsole=function(a,c){void 0===c&&(c=!0),c&&(b._StartUserMark(a,c),console.time&&console.time(a))},b._EndPerformanceConsole=function(a,c){void 0===c&&(c=!0),c&&(b._EndUserMark(a,c),console.time&&console.timeEnd(a))},Object.defineProperty(b,"Now",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),b.getClassName=function(a,b){void 0===b&&(b=!1);var c=null;if(!b&&a.getClassName)c=a.getClassName();else{if(a instanceof Object){var d=b?a:Object.getPrototypeOf(a);c=d.constructor.__bjsclassName__}c||(c=typeof a)}return c},b.first=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b(d))return d}},b.arrayOrStringFeeder=function(a){return function(c){if(c>=a.length)return null;var d=a.charCodeAt?a.charCodeAt(c):a[c];return d&&d.getHashCode&&(d=d.getHashCode()),"string"==typeof d?b.hashCodeFromStream(b.arrayOrStringFeeder(d)):d}},b.hashCodeFromStream=function(a){for(var b=0,c=0,d=a(c++);null!=d;)b=(b<<5)-b+d,b|=0,d=a(c++);return b},b.BaseUrl="",b.CorsBehavior="anonymous",b.UseFallbackTexture=!0,b._NoneLogLevel=0,b._MessageLogLevel=1,b._WarningLogLevel=2,b._ErrorLogLevel=4,b._LogCache="",b.errorsCount=0,b.Log=b._LogEnabled,b.Warn=b._WarnEnabled,b.Error=b._ErrorEnabled,b._PerformanceNoneLogLevel=0,b._PerformanceUserMarkLogLevel=1,b._PerformanceConsoleLogLevel=2,b._performance=window.performance,b.StartPerformanceCounter=b._StartPerformanceCounterDisabled,b.EndPerformanceCounter=b._EndPerformanceCounterDisabled,b}();a.Tools=e,a.className=b;var f=function(){function a(a,b,c,d){void 0===d&&(d=0),this.iterations=a,this._fn=b,this._successCallback=c,this.index=d-1,this._done=!1}return a.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},a.prototype.breakLoop=function(){this._done=!0,this._successCallback()},a.Run=function(b,c,d,e){void 0===e&&(e=0);var f=new a(b,c,d,e);return f.executeNext(),f},a.SyncAsyncForLoop=function(b,c,d,e,f,g){void 0===g&&(g=0),a.Run(Math.ceil(b/c),function(a){f&&f()?a.breakLoop():setTimeout(function(){for(var e=0;c>e;++e){var g=a.index*c+e;if(g>=b)break;if(d(g),f&&f()){a.breakLoop();break}}a.executeNext()},g)},e)},a}();a.AsyncLoop=f}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(a){var b=function(){function a(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(a.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(a){this._alphaBlend!==a&&(this._alphaBlend=a,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),a.prototype.setAlphaBlendFunctionParameters=function(a,b,c,d){this._blendFunctionParameters[0]===a&&this._blendFunctionParameters[1]===b&&this._blendFunctionParameters[2]===c&&this._blendFunctionParameters[3]===d||(this._blendFunctionParameters[0]=a,this._blendFunctionParameters[1]=b,this._blendFunctionParameters[2]=c,this._blendFunctionParameters[3]=d,this._isBlendFunctionParametersDirty=!0)},a.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},a.prototype.apply=function(a){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?a.enable(a.BLEND):a.disable(a.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(a.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},a}();a._AlphaState=b}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(a){var b=function(){function a(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(a.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"zOffset",{get:function(){return this._zOffset},set:function(a){this._zOffset!==a&&(this._zOffset=a,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cullFace",{get:function(){return this._cullFace},set:function(a){this._cullFace!==a&&(this._cullFace=a,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"cull",{get:function(){return this._cull},set:function(a){this._cull!==a&&(this._cull=a,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(a){this._depthFunc!==a&&(this._depthFunc=a,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"depthMask",{get:function(){return this._depthMask},set:function(a){this._depthMask!==a&&(this._depthMask=a,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"depthTest",{get:function(){return this._depthTest},set:function(a){this._depthTest!==a&&(this._depthTest=a,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),a.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},a.prototype.apply=function(a){this.isDirty&&(this._isCullDirty&&(this.cull?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(a.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(a.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(a.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(a.enable(a.POLYGON_OFFSET_FILL),a.polygonOffset(this.zOffset,0)):a.disable(a.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},a}();a._DepthCullingState=b}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a,b,c,d){var e=a.createShader("vertex"===c?a.VERTEX_SHADER:a.FRAGMENT_SHADER);if(a.shaderSource(e,(d?d+"\n":"")+b),a.compileShader(e),!a.getShaderParameter(e,a.COMPILE_STATUS))throw new Error(a.getShaderInfoLog(e));return e},c=function(a,b){var c=a.UNSIGNED_BYTE;return b===j.TEXTURETYPE_FLOAT&&(c=a.FLOAT),c},d=function(b,c,d){var e=d.NEAREST,f=d.NEAREST;return b===a.Texture.BILINEAR_SAMPLINGMODE?(e=d.LINEAR,f=c?d.LINEAR_MIPMAP_NEAREST:d.LINEAR):b===a.Texture.TRILINEAR_SAMPLINGMODE?(e=d.LINEAR,f=c?d.LINEAR_MIPMAP_LINEAR:d.LINEAR):b===a.Texture.NEAREST_SAMPLINGMODE&&(e=d.NEAREST,f=c?d.NEAREST_MIPMAP_LINEAR:d.NEAREST),{min:f,mag:e}},e=function(b,c,e,f,g,h,i,j,k,l,m){void 0===m&&(m=a.Texture.TRILINEAR_SAMPLINGMODE);var n=e.getEngine(),o=a.Tools.GetExponentOfTwo(f,n.getCaps().maxTextureSize),p=a.Tools.GetExponentOfTwo(g,n.getCaps().maxTextureSize);c.bindTexture(c.TEXTURE_2D,b),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,void 0===h?1:h?1:0),b._baseWidth=f,b._baseHeight=g,b._width=o,b._height=p,b.isReady=!0,k(o,p);var q=d(m,!i,c);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,q.mag),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,q.min),i||j||c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null),n.resetTextureCache(),e._removePendingData(b),l&&l()},f=function(b,c,d,e,f){var g,h=function(){d[c]=g,d._internalCount++,e._removePendingData(g),6===d._internalCount&&f(d)},i=function(){e._removePendingData(g)};g=a.Tools.LoadImage(b,h,i,e.database),e._addPendingData(g)},g=function(a,b,c,d){var e=[];e._internalCount=0;for(var g=0;6>g;g++)f(d[g],g,e,b,c)},h=function(){function a(){}return a}();a.InstancingAttributeInfo=h;var i=function(){function a(){}return a}();a.EngineCapabilities=i;var j=function(){function f(b,c,d,e){var g=this;if(void 0===e&&(e=!0),this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=new Array,this._windowIsBackground=!1,this._webGLVersion="1.0",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new a.Internals._DepthCullingState,this._alphaState=new a.Internals._AlphaState,this._alphaMode=f.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._maxTextureChannels=16,this._activeTexturesCache=new Array(this._maxTextureChannels),this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._renderingCanvas=b,this._externalData=new a.StringDictionary,d=d||{},d.antialias=c,void 0===d.preserveDrawingBuffer&&(d.preserveDrawingBuffer=!1),!this._gl)try{this._gl=b.getContext("webgl",d)||b.getContext("experimental-webgl",d)}catch(h){throw new Error("WebGL not supported")}if(!this._gl)throw new Error("WebGL not supported");this._onBlur=function(){g._windowIsBackground=!0},this._onFocus=function(){g._windowIsBackground=!1},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus);var j=d.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=e?1/Math.min(j,window.devicePixelRatio||1):1,this.resize(),this._caps=new i,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var k=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=k&&(this._glRenderer=this._gl.getParameter(k.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(k.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers"),this._caps.textureFloatLinearFiltering=this._gl.getExtension("OES_texture_float_linear"),this._caps.textureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._gl.getShaderPrecisionFormat){var l=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!==l.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?g.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?g.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?g.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(g.isFullscreen=document.msIsFullScreen),g.isFullscreen&&g._pointerLockRequested&&(b.requestPointerLock=b.requestPointerLock||b.msRequestPointerLock||b.mozRequestPointerLock||b.webkitRequestPointerLock,b.requestPointerLock&&b.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){g.isPointerLock=document.mozPointerLockElement===b||document.webkitPointerLockElement===b||document.msPointerLockElement===b||document.pointerLockElement===b},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),a.AudioEngine&&!f.audioEngine&&(f.audioEngine=new a.AudioEngine),this._loadingScreen=new a.DefaultLoadingScreen(this._renderingCanvas),a.Tools.Log("Babylon.js engine (v"+f.Version+") launched")}return Object.defineProperty(f,"ALPHA_DISABLE",{get:function(){return f._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_ONEONE",{get:function(){return f._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_ADD",{get:function(){return f._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_COMBINE",{get:function(){return f._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_SUBTRACT",{get:function(){return f._ALPHA_SUBTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_MULTIPLY",{get:function(){return f._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ALPHA_MAXIMIZED",{get:function(){return f._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(f,"DELAYLOADSTATE_NONE",{get:function(){return f._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(f,"DELAYLOADSTATE_LOADED",{get:function(){return f._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(f,"DELAYLOADSTATE_LOADING",{get:function(){return f._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(f,"DELAYLOADSTATE_NOTLOADED",{get:function(){return f._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTUREFORMAT_ALPHA",{get:function(){return f._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTUREFORMAT_LUMINANCE",{get:function(){return f._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return f._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTUREFORMAT_RGB",{get:function(){return f._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTUREFORMAT_RGBA",{get:function(){return f._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return f._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(f,"TEXTURETYPE_FLOAT",{get:function(){return f._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(f,"Version",{get:function(){return"2.4.0"},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),f.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=this._workingCanvas.getContext("2d"))},f.prototype.resetTextureCache=function(){for(var a=0;a<this._maxTextureChannels;a++)this._activeTexturesCache[a]=null},f.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},f.prototype.getAspectRatio=function(a,b){void 0===b&&(b=!1);var c=a.viewport;return this.getRenderWidth(b)*c.width/(this.getRenderHeight(b)*c.height)},f.prototype.getRenderWidth=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},f.prototype.getRenderHeight=function(a){return void 0===a&&(a=!1),!a&&this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},f.prototype.getRenderingCanvas=function(){return this._renderingCanvas},f.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},f.prototype.setHardwareScalingLevel=function(a){this._hardwareScalingLevel=a,this.resize()},f.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},f.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},f.prototype.getCaps=function(){return this._caps},Object.defineProperty(f.prototype,"drawCalls",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),f.prototype.resetDrawCalls=function(){this._drawCalls=0},f.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},f.prototype.setDepthFunction=function(a){this._depthCullingState.depthFunc=a},f.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},f.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},f.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},f.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},f.prototype.stopRenderLoop=function(a){if(!a)return void(this._activeRenderLoops=[]);var b=this._activeRenderLoops.indexOf(a);b>=0&&this._activeRenderLoops.splice(b,1)},f.prototype._renderLoop=function(){var b=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(b=!1),b){this.beginFrame();for(var c=0;c<this._activeRenderLoops.length;c++){var d=this._activeRenderLoops[c];d()}this.endFrame()}this._activeRenderLoops.length>0?a.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},f.prototype.runRenderLoop=function(b){-1===this._activeRenderLoops.indexOf(b)&&(this._activeRenderLoops.push(b),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),a.Tools.QueueNewFrame(this._bindedRenderFunction)))},f.prototype.switchFullscreen=function(b,c){this.isFullscreen?a.Tools.ExitFullscreen():(this._pointerLockRequested=b,a.Tools.RequestFullscreen(this._renderingCanvas,c))},f.prototype.clear=function(a,b,c){this.applyStates(),b&&this._gl.clearColor(a.r,a.g,a.b,void 0!==a.a?a.a:1),c&&this._depthCullingState.depthMask&&this._gl.clearDepth(1);var d=0;b&&(d|=this._gl.COLOR_BUFFER_BIT),c&&this._depthCullingState.depthMask&&(d|=this._gl.DEPTH_BUFFER_BIT),
this._gl.clear(d)},f.prototype.scissorClear=function(a,b,c,d,e){var f=this._gl,g=f.getParameter(f.SCISSOR_TEST),h=f.getParameter(f.SCISSOR_BOX);f.enable(f.SCISSOR_TEST),f.scissor(a,b,c,d),this.clear(e,!0,!0),f.scissor(h[0],h[1],h[2],h[3]),g===!0?f.enable(f.SCISSOR_TEST):f.disable(f.SCISSOR_TEST)},f.prototype.setViewport=function(a,b,c){var d=b||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),e=c||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),f=a.x||0,g=a.y||0;this._cachedViewport=a,this._gl.viewport(f*d,g*e,d*a.width,e*a.height)},f.prototype.setDirectViewport=function(a,b,c,d){var e=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(a,b,c,d),e},f.prototype.beginFrame=function(){this._measureFps()},f.prototype.endFrame=function(){},f.prototype.resize=function(){var a=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,b=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(a/this._hardwareScalingLevel,b/this._hardwareScalingLevel);for(var c=0;c<this.scenes.length;c++){var d=this.scenes[c];d.debugLayer.isVisible()&&d.debugLayer._syncPositions()}},f.prototype.setSize=function(a,b){this._renderingCanvas.width=a,this._renderingCanvas.height=b;for(var c=0;c<this.scenes.length;c++)for(var d=this.scenes[c],e=0;e<d.cameras.length;e++){var f=d.cameras[e];f._currentRenderId=0}},f.prototype.bindFramebuffer=function(a,b,c,d){this._currentRenderTarget=a;var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,a._framebuffer),a.isCube?e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+b,a,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),this._gl.viewport(0,0,c||a._width,d||a._height),this.wipeCaches()},f.prototype.unBindFramebuffer=function(a,b){if(void 0===b&&(b=!1),this._currentRenderTarget=null,a.generateMipMaps&&!b){var c=this._gl;c.bindTexture(c.TEXTURE_2D,a),c.generateMipmap(c.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},f.prototype.generateMipMapsForCubemap=function(a){if(a.generateMipMaps){var b=this._gl;b.bindTexture(b.TEXTURE_CUBE_MAP,a),b.generateMipmap(b.TEXTURE_CUBE_MAP),b.bindTexture(b.TEXTURE_CUBE_MAP,null)}},f.prototype.flushFramebuffer=function(){this._gl.flush()},f.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},f.prototype._resetVertexBufferBinding=function(){this.bindBuffer(null,this._gl.ARRAY_BUFFER),this._cachedVertexBuffers=null},f.prototype.createVertexBuffer=function(a){var b=this._gl.createBuffer();return this.bindBuffer(b,this._gl.ARRAY_BUFFER),a instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),b.references=1,b},f.prototype.createDynamicVertexBuffer=function(a){var b=this._gl.createBuffer();return this.bindBuffer(b,this._gl.ARRAY_BUFFER),a instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(a),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),b.references=1,b},f.prototype.updateDynamicVertexBuffer=function(a,b,c,d){this.bindBuffer(a,this._gl.ARRAY_BUFFER),void 0===c&&(c=0),void 0===d?b instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,c,b):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,c,new Float32Array(b)):b instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b.subarray(c,c+d)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(b).subarray(c,c+d)),this._resetVertexBufferBinding()},f.prototype._resetIndexBufferBinding=function(){this.bindBuffer(null,this._gl.ELEMENT_ARRAY_BUFFER),this._cachedIndexBuffer=null},f.prototype.createIndexBuffer=function(a){var b=this._gl.createBuffer();this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER);var c,d=!1;if(this._caps.uintIndices){for(var e=0;e<a.length;e++)if(a[e]>65535){d=!0;break}c=d?new Uint32Array(a):new Uint16Array(a)}else c=new Uint16Array(a);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,c,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),b.references=1,b.is32Bits=d,b},f.prototype.bindArrayBuffer=function(a){this.bindBuffer(a,this._gl.ARRAY_BUFFER)},f.prototype.updateArrayBuffer=function(a){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,a)},f.prototype.bindBuffer=function(a,b){this._currentBoundBuffer[b]!==a&&(this._gl.bindBuffer(b,a),this._currentBoundBuffer[b]=a)},f.prototype.bindBuffersDirectly=function(a,b,c,d,e){if(this._cachedVertexBuffers!==a||this._cachedEffectForVertexBuffers!==e){this._cachedVertexBuffers=a,this._cachedEffectForVertexBuffers=e,this.bindBuffer(a,this._gl.ARRAY_BUFFER);for(var f=0,g=0;g<c.length;g++){var h=e.getAttributeLocation(g);h>=0&&this._gl.vertexAttribPointer(h,c[g],this._gl.FLOAT,!1,d,f),f+=4*c[g]}}this._cachedIndexBuffer!==b&&(this._cachedIndexBuffer=b,this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=b.is32Bits)},f.prototype.bindBuffers=function(a,b,c){if(this._cachedVertexBuffers!==a||this._cachedEffectForVertexBuffers!==c){this._cachedVertexBuffers=a,this._cachedEffectForVertexBuffers=c;for(var d=c.getAttributesNames(),e=0;e<d.length;e++){var f=c.getAttributeLocation(e);if(f>=0){var g=a[d[e]];if(!g)continue;var h=g.getBuffer();this.bindBuffer(h,this._gl.ARRAY_BUFFER),this._gl.vertexAttribPointer(f,g.getSize(),this._gl.FLOAT,!1,4*g.getStrideSize(),4*g.getOffset()),g.getIsInstanced()&&(this._caps.instancedArrays.vertexAttribDivisorANGLE(f,1),this._currentInstanceLocations.push(f),this._currentInstanceBuffers.push(h))}}}null!=b&&this._cachedIndexBuffer!==b&&(this._cachedIndexBuffer=b,this.bindBuffer(b,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=b.is32Bits)},f.prototype.unbindInstanceAttributes=function(){for(var a,b=0,c=this._currentInstanceLocations.length;c>b;b++){var d=this._currentInstanceBuffers[b];a!=d&&(a=d,this.bindBuffer(d,this._gl.ARRAY_BUFFER));var e=this._currentInstanceLocations[b];this._caps.instancedArrays.vertexAttribDivisorANGLE(e,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},f.prototype._releaseBuffer=function(a){return a.references--,0===a.references?(this._gl.deleteBuffer(a),!0):!1},f.prototype.createInstancesBuffer=function(a){var b=this._gl.createBuffer();return b.capacity=a,this.bindBuffer(b,this._gl.ARRAY_BUFFER),this._gl.bufferData(this._gl.ARRAY_BUFFER,a,this._gl.DYNAMIC_DRAW),b},f.prototype.deleteInstancesBuffer=function(a){this._gl.deleteBuffer(a)},f.prototype.updateAndBindInstancesBuffer=function(a,b,c){if(this.bindBuffer(a,this._gl.ARRAY_BUFFER),b&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b),void 0!==c[0].index){for(var d=0,e=0;e<c.length;e++){var f=c[e];d+=4*f.attributeSize}for(var e=0;e<c.length;e++){var f=c[e];this._gl.enableVertexAttribArray(f.index),this._gl.vertexAttribPointer(f.index,f.attributeSize,f.attribyteType||this._gl.FLOAT,f.normalized||!1,d,f.offset),this._caps.instancedArrays.vertexAttribDivisorANGLE(f.index,1),this._currentInstanceLocations.push(f.index),this._currentInstanceBuffers.push(a)}}else for(var g=0;4>g;g++){var h=c[g];this._gl.enableVertexAttribArray(h),this._gl.vertexAttribPointer(h,4,this._gl.FLOAT,!1,64,16*g),this._caps.instancedArrays.vertexAttribDivisorANGLE(h,1),this._currentInstanceLocations.push(h),this._currentInstanceBuffers.push(a)}},f.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},f.prototype.draw=function(a,b,c,d){this.applyStates(),this._drawCalls++;var e=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,f=this._uintIndicesCurrentlySet?4:2;return d?void this._caps.instancedArrays.drawElementsInstancedANGLE(a?this._gl.TRIANGLES:this._gl.LINES,c,e,b*f,d):void this._gl.drawElements(a?this._gl.TRIANGLES:this._gl.LINES,c,e,b*f)},f.prototype.drawPointClouds=function(a,b,c){return this.applyStates(),this._drawCalls++,c?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,a,b,c):void this._gl.drawArrays(this._gl.POINTS,a,b)},f.prototype.drawUnIndexed=function(a,b,c,d){return this.applyStates(),this._drawCalls++,d?void this._caps.instancedArrays.drawArraysInstancedANGLE(a?this._gl.TRIANGLES:this._gl.LINES,b,c,d):void this._gl.drawArrays(a?this._gl.TRIANGLES:this._gl.LINES,b,c)},f.prototype._releaseEffect=function(a){this._compiledEffects[a._key]&&(delete this._compiledEffects[a._key],a.getProgram()&&this._gl.deleteProgram(a.getProgram()))},f.prototype.createEffect=function(b,c,d,e,f,g,h,i,j){var k=b.vertexElement||b.vertex||b,l=b.fragmentElement||b.fragment||b,m=k+"+"+l+"@"+f;if(this._compiledEffects[m])return this._compiledEffects[m];var n=new a.Effect(b,c,d,e,this,f,g,h,i,j);return n._key=m,this._compiledEffects[m]=n,n},f.prototype.createEffectForParticles=function(a,b,c,d,e,f,g){return void 0===b&&(b=[]),void 0===c&&(c=[]),void 0===d&&(d=""),this.createEffect({vertex:"particles",fragmentElement:a},["position","color","options"],["view","projection"].concat(b),["diffuseSampler"].concat(c),d,e,f,g)},f.prototype.createShaderProgram=function(a,c,d){var e=b(this._gl,a,"vertex",d),f=b(this._gl,c,"fragment",d),g=this._gl.createProgram();this._gl.attachShader(g,e),this._gl.attachShader(g,f),this._gl.linkProgram(g);var h=this._gl.getProgramParameter(g,this._gl.LINK_STATUS);if(!h){var i=this._gl.getProgramInfoLog(g);if(i)throw new Error(i)}return this._gl.deleteShader(e),this._gl.deleteShader(f),g},f.prototype.getUniforms=function(a,b){for(var c=[],d=0;d<b.length;d++)c.push(this._gl.getUniformLocation(a,b[d]));return c},f.prototype.getAttributes=function(a,b){for(var c=[],d=0;d<b.length;d++)try{c.push(this._gl.getAttribLocation(a,b[d]))}catch(e){c.push(-1)}return c},f.prototype.enableEffect=function(a){if(!a||!a.getAttributesCount()||this._currentEffect===a)return void(a&&a.onBind&&a.onBind(a));this._vertexAttribArraysToUse=this._vertexAttribArraysToUse||[],this._vertexAttribArraysEnabled=this._vertexAttribArraysEnabled||[],this._gl.useProgram(a.getProgram());var b,c;for(b=0,c=this._vertexAttribArraysToUse.length;c>b;b++)this._vertexAttribArraysToUse[b]=!1;var d=a.getAttributesCount();for(b=0;d>b;b++){var e=a.getAttributeLocation(b);e>=0&&(this._vertexAttribArraysToUse[e]=!0)}for(b=0,c=this._vertexAttribArraysEnabled.length;c>b;b++)b>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[b]||this._vertexAttribArraysToUse[b]||(this._vertexAttribArraysEnabled[b]=!1,this._gl.disableVertexAttribArray(b));for(b=0,c=this._vertexAttribArraysToUse.length;c>b;b++)this._vertexAttribArraysToUse[b]&&!this._vertexAttribArraysEnabled[b]&&(this._vertexAttribArraysEnabled[b]=!0,this._gl.enableVertexAttribArray(b));this._currentEffect=a,a.onBind&&a.onBind(a)},f.prototype.setArray=function(a,b){a&&this._gl.uniform1fv(a,b)},f.prototype.setArray2=function(a,b){a&&b.length%2===0&&this._gl.uniform2fv(a,b)},f.prototype.setArray3=function(a,b){a&&b.length%3===0&&this._gl.uniform3fv(a,b)},f.prototype.setArray4=function(a,b){a&&b.length%4===0&&this._gl.uniform4fv(a,b)},f.prototype.setMatrices=function(a,b){a&&this._gl.uniformMatrix4fv(a,!1,b)},f.prototype.setMatrix=function(a,b){a&&this._gl.uniformMatrix4fv(a,!1,b.toArray())},f.prototype.setMatrix3x3=function(a,b){a&&this._gl.uniformMatrix3fv(a,!1,b)},f.prototype.setMatrix2x2=function(a,b){a&&this._gl.uniformMatrix2fv(a,!1,b)},f.prototype.setFloat=function(a,b){a&&this._gl.uniform1f(a,b)},f.prototype.setFloat2=function(a,b,c){a&&this._gl.uniform2f(a,b,c)},f.prototype.setFloat3=function(a,b,c,d){a&&this._gl.uniform3f(a,b,c,d)},f.prototype.setBool=function(a,b){a&&this._gl.uniform1i(a,b)},f.prototype.setFloat4=function(a,b,c,d,e){a&&this._gl.uniform4f(a,b,c,d,e)},f.prototype.setColor3=function(a,b){a&&this._gl.uniform3f(a,b.r,b.g,b.b)},f.prototype.setColor4=function(a,b,c){a&&this._gl.uniform4f(a,b.r,b.g,b.b,c)},f.prototype.setState=function(a,b,c,d){void 0===b&&(b=0),void 0===d&&(d=!1);var e=d?this._gl.FRONT:this._gl.BACK,f=d?this._gl.BACK:this._gl.FRONT,g=this.cullBackFaces?e:f;(this._depthCullingState.cull!==a||c||this._depthCullingState.cullFace!==g)&&(a?(this._depthCullingState.cullFace=g,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=b},f.prototype.setDepthBuffer=function(a){this._depthCullingState.depthTest=a},f.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},f.prototype.setDepthWrite=function(a){this._depthCullingState.depthMask=a},f.prototype.setColorWrite=function(a){this._gl.colorMask(a,a,a,a)},f.prototype.setAlphaMode=function(a,b){if(void 0===b&&(b=!1),this._alphaMode!==a){switch(a){case f.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case f.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case f.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case f.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case f.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case f.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case f.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0}b||this.setDepthWrite(a===f.ALPHA_DISABLE),this._alphaMode=a}},f.prototype.getAlphaMode=function(){return this._alphaMode},f.prototype.setAlphaTesting=function(a){this._alphaTest=a},f.prototype.getAlphaTesting=function(){return this._alphaTest},f.prototype.wipeCaches=function(){this.resetTextureCache(),this._currentEffect=null,this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},f.prototype.setSamplingMode=function(b,c){var d=this._gl;d.bindTexture(d.TEXTURE_2D,b);var e=d.NEAREST,f=d.NEAREST;c===a.Texture.BILINEAR_SAMPLINGMODE?(e=d.LINEAR,f=d.LINEAR):c===a.Texture.TRILINEAR_SAMPLINGMODE&&(e=d.LINEAR,f=d.LINEAR_MIPMAP_LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,f),d.bindTexture(d.TEXTURE_2D,null),b.samplingMode=c},f.prototype.createTexture=function(b,c,d,f,g,h,i,j){var k=this;void 0===g&&(g=a.Texture.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===i&&(i=null),void 0===j&&(j=null);var l,m=this._gl.createTexture(),n=!1;if("data:"===b.substr(0,5)&&(n=!0),n){var o=b;n=o.split(":"),b=o,l=n[1].substr(n[1].length-4,4).toLowerCase()}else l=b.substr(b.length-4,4).toLowerCase();var p=this.getCaps().s3tc&&".dds"===l,q=".tga"===l;f._addPendingData(m),m.url=b,m.noMipmap=c,m.references=1,m.samplingMode=g,this._loadedTexturesCache.push(m);var r,s=function(){f._removePendingData(m),i&&i()};if(q)r=function(b){var i=new Uint8Array(b),j=a.Internals.TGATools.GetTGAHeader(i);e(m,k._gl,f,j.width,j.height,d,c,!1,function(){a.Internals.TGATools.UploadContent(k._gl,i)},h,g)},n instanceof Array?r(j):a.Tools.LoadFile(b,function(a){r(a)},s,f.database,!0);else if(p)r=function(b){var i=a.Internals.DDSTools.GetDDSInfo(b),j=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!c&&i.width>>i.mipmapCount-1===1;e(m,k._gl,f,i.width,i.height,d,!j,i.isFourCC,function(){a.Internals.DDSTools.UploadDDSLevels(k._gl,k.getCaps().s3tc,b,i,j,1)},h,g)},n instanceof Array?r(j):a.Tools.LoadFile(b,function(a){r(a)},s,f.database,!0);else{var t=function(b){e(m,k._gl,f,b.width,b.height,d,c,!1,function(c,d){var e=b.width===c&&b.height===d;e||(k._prepareWorkingCanvas(),k._workingCanvas.width=c,k._workingCanvas.height=d,g===a.Texture.NEAREST_SAMPLINGMODE&&(k._workingContext.imageSmoothingEnabled=!1,k._workingContext.mozImageSmoothingEnabled=!1,k._workingContext.oImageSmoothingEnabled=!1,k._workingContext.webkitImageSmoothingEnabled=!1,k._workingContext.msImageSmoothingEnabled=!1),k._workingContext.drawImage(b,0,0,b.width,b.height,0,0,c,d),g===a.Texture.NEAREST_SAMPLINGMODE&&(k._workingContext.imageSmoothingEnabled=!0,k._workingContext.mozImageSmoothingEnabled=!0,k._workingContext.oImageSmoothingEnabled=!0,k._workingContext.webkitImageSmoothingEnabled=!0,k._workingContext.msImageSmoothingEnabled=!0)),k._gl.texImage2D(k._gl.TEXTURE_2D,0,k._gl.RGBA,k._gl.RGBA,k._gl.UNSIGNED_BYTE,e?b:k._workingCanvas)},h,g)};n instanceof Array?a.Tools.LoadImage(j,t,s,f.database):a.Tools.LoadImage(b,t,s,f.database)}return m},f.prototype._getInternalFormat=function(a){var b=this._gl.RGBA;switch(a){case f.TEXTUREFORMAT_ALPHA:b=this._gl.ALPHA;break;case f.TEXTUREFORMAT_LUMINANCE:b=this._gl.LUMINANCE;break;case f.TEXTUREFORMAT_LUMINANCE_ALPHA:b=this._gl.LUMINANCE_ALPHA;break;case f.TEXTUREFORMAT_RGB:b=this._gl.RGB;break;case f.TEXTUREFORMAT_RGBA:b=this._gl.RGBA}return b},f.prototype.updateRawTexture=function(a,b,c,d,e){void 0===e&&(e=null);var f=this._getInternalFormat(c);this._gl.bindTexture(this._gl.TEXTURE_2D,a),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===d?1:d?1:0),a._width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),e?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[e],a._width,a._height,0,b):this._gl.texImage2D(this._gl.TEXTURE_2D,0,f,a._width,a._height,0,f,this._gl.UNSIGNED_BYTE,b),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),a.isReady=!0},f.prototype.createRawTexture=function(a,b,c,e,f,g,h,i){void 0===i&&(i=null);var j=this._gl.createTexture();j._baseWidth=b,j._baseHeight=c,j._width=b,j._height=c,j.references=1,this.updateRawTexture(j,a,e,g,i),this._gl.bindTexture(this._gl.TEXTURE_2D,j);var k=d(h,f,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,k.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,k.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),j.samplingMode=h,this._loadedTexturesCache.push(j),j},f.prototype.createDynamicTexture=function(b,c,d,e){var f=this._gl.createTexture();return f._baseWidth=b,f._baseHeight=c,d&&(b=a.Tools.GetExponentOfTwo(b,this._caps.maxTextureSize),c=a.Tools.GetExponentOfTwo(c,this._caps.maxTextureSize)),this.resetTextureCache(),f._width=b,f._height=c,f.isReady=!1,f.generateMipMaps=d,f.references=1,f.samplingMode=e,this.updateTextureSamplingMode(e,f),this._loadedTexturesCache.push(f),f},f.prototype.updateTextureSamplingMode=function(a,b){var c=d(a,b.generateMipMaps,this._gl);b.isCube?(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,b),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,c.min),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)):(this._gl.bindTexture(this._gl.TEXTURE_2D,b),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null))},f.prototype.updateDynamicTexture=function(a,b,c,d){void 0===d&&(d=!1),this._gl.bindTexture(this._gl.TEXTURE_2D,a),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,c?1:0),d&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),a.isReady=!0},f.prototype.updateVideoTexture=function(a,b,c){if(!a._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,a),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,c?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,b):(a._workingCanvas||(a._workingCanvas=document.createElement("canvas"),a._workingContext=a._workingCanvas.getContext("2d"),a._workingCanvas.width=a._width,a._workingCanvas.height=a._height),a._workingContext.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,a._width,a._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,a._workingCanvas)),a.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),a.isReady=!0}catch(d){a._isDisabled=!0}}},f.prototype.createRenderTargetTexture=function(b,e){var g=!1,h=!0,i=f.TEXTURETYPE_UNSIGNED_INT,j=a.Texture.TRILINEAR_SAMPLINGMODE;void 0!==e&&(g=void 0===e.generateMipMaps?e:e.generateMipMaps,h=void 0===e.generateDepthBuffer?!0:e.generateDepthBuffer,i=void 0===e.type?i:e.type,void 0!==e.samplingMode&&(j=e.samplingMode),i===f.TEXTURETYPE_FLOAT&&(j=a.Texture.NEAREST_SAMPLINGMODE));var k=this._gl,l=k.createTexture();k.bindTexture(k.TEXTURE_2D,l);var m=b.width||b,n=b.height||b,o=d(j,g,k);i!==f.TEXTURETYPE_FLOAT||this._caps.textureFloat||(i=f.TEXTURETYPE_UNSIGNED_INT,a.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,o.mag),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,o.min),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,k.CLAMP_TO_EDGE),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,k.CLAMP_TO_EDGE),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,m,n,0,k.RGBA,c(k,i),null);var p;h&&(p=k.createRenderbuffer(),k.bindRenderbuffer(k.RENDERBUFFER,p),k.renderbufferStorage(k.RENDERBUFFER,k.DEPTH_COMPONENT16,m,n));var q=k.createFramebuffer();return k.bindFramebuffer(k.FRAMEBUFFER,q),h&&k.framebufferRenderbuffer(k.FRAMEBUFFER,k.DEPTH_ATTACHMENT,k.RENDERBUFFER,p),g&&this._gl.generateMipmap(this._gl.TEXTURE_2D),k.bindTexture(k.TEXTURE_2D,null),k.bindRenderbuffer(k.RENDERBUFFER,null),k.bindFramebuffer(k.FRAMEBUFFER,null),l._framebuffer=q,h&&(l._depthBuffer=p),l._baseWidth=m,l._baseHeight=n,l._width=m,l._height=n,l.isReady=!0,l.generateMipMaps=g,l.references=1,l.samplingMode=j,this.resetTextureCache(),this._loadedTexturesCache.push(l),l},f.prototype.createRenderTargetCubeTexture=function(b,c){var e=this._gl,f=e.createTexture(),g=!0,h=a.Texture.TRILINEAR_SAMPLINGMODE;void 0!==c&&(g=void 0===c.generateMipMaps?c:c.generateMipMaps,void 0!==c.samplingMode&&(h=c.samplingMode)),f.isCube=!0,f.references=1,f.generateMipMaps=g,f.references=1,f.samplingMode=h;var i=d(h,g,e);e.bindTexture(e.TEXTURE_CUBE_MAP,f);for(var j=0;6>j;j++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+j,0,e.RGBA,b,b,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,i.mag),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,i.min),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var k=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,k),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,b,b);var l=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,l),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,k),f.generateMipMaps&&(e.bindTexture(e.TEXTURE_CUBE_MAP,f),e.generateMipmap(e.TEXTURE_CUBE_MAP)),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),f._framebuffer=l,f._depthBuffer=k,this.resetTextureCache(),f._width=b,f._height=b,f.isReady=!0,f},f.prototype.createCubeTexture=function(b,c,d,e){var f=this,h=this._gl,i=h.createTexture();i.isCube=!0,i.url=b,i.references=1;var j=b.substr(b.length-4,4).toLowerCase(),k=this.getCaps().s3tc&&".dds"===j;return k?a.Tools.LoadFile(b,function(b){var c=a.Internals.DDSTools.GetDDSInfo(b),d=(c.isRGB||c.isLuminance||c.mipmapCount>1)&&!e;h.bindTexture(h.TEXTURE_CUBE_MAP,i),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,1),a.Internals.DDSTools.UploadDDSLevels(f._gl,f.getCaps().s3tc,b,c,d,6),e||c.isFourCC||1!==c.mipmapCount||h.generateMipmap(h.TEXTURE_CUBE_MAP),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,d?h.LINEAR_MIPMAP_LINEAR:h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.bindTexture(h.TEXTURE_CUBE_MAP,null),f.resetTextureCache(),i._width=c.width,i._height=c.height,i.isReady=!0},null,null,!0):g(b,c,function(b){var c=a.Tools.GetExponentOfTwo(b[0].width,f._caps.maxCubemapTextureSize),d=c;f._prepareWorkingCanvas(),f._workingCanvas.width=c,f._workingCanvas.height=d;var g=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Z];h.bindTexture(h.TEXTURE_CUBE_MAP,i),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,0);for(var j=0;j<g.length;j++)f._workingContext.drawImage(b[j],0,0,b[j].width,b[j].height,0,0,c,d),h.texImage2D(g[j],0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,f._workingCanvas);e||h.generateMipmap(h.TEXTURE_CUBE_MAP),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,e?h.LINEAR:h.LINEAR_MIPMAP_LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.bindTexture(h.TEXTURE_CUBE_MAP,null),f.resetTextureCache(),i._width=c,i._height=d,i.isReady=!0},d),i},f.prototype.updateTextureSize=function(a,b,c){a._width=b,a._height=c,a._size=b*c,a._baseWidth=b,a._baseHeight=c},f.prototype.createRawCubeTexture=function(b,c,d,e,g,h,i,j){var k=this,l=this._gl,m=l.createTexture();c._addPendingData(m),m.isCube=!0,m.references=1,m.url=b;var n=this._getInternalFormat(e),o=l.UNSIGNED_BYTE;g===f.TEXTURETYPE_FLOAT&&(o=l.FLOAT);var p=d,q=p,r=a.Tools.IsExponentOfTwo(p)&&a.Tools.IsExponentOfTwo(q);m._width=p,m._height=q;var s=function(){c._removePendingData(m)},t=function(b){var d=i(b),e=[l.TEXTURE_CUBE_MAP_POSITIVE_X,l.TEXTURE_CUBE_MAP_POSITIVE_Y,l.TEXTURE_CUBE_MAP_POSITIVE_Z,l.TEXTURE_CUBE_MAP_NEGATIVE_X,l.TEXTURE_CUBE_MAP_NEGATIVE_Y,l.TEXTURE_CUBE_MAP_NEGATIVE_Z];if(p=m._width,q=m._height,r=a.Tools.IsExponentOfTwo(p)&&a.Tools.IsExponentOfTwo(q),l.bindTexture(l.TEXTURE_CUBE_MAP,m),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,0),!h&&r)if(j){var f=[];f.push(d[0]),f.push(d[3]),f.push(d[1]),f.push(d[4]),f.push(d[2]),f.push(d[5]);for(var g=j(f),s=0;s<g.length;s++){var t=p>>s;l.texImage2D(e[0],s,n,t,t,0,n,o,g[s][0]),l.texImage2D(e[1],s,n,t,t,0,n,o,g[s][2]),l.texImage2D(e[2],s,n,t,t,0,n,o,g[s][4]),l.texImage2D(e[3],s,n,t,t,0,n,o,g[s][1]),l.texImage2D(e[4],s,n,t,t,0,n,o,g[s][3]),l.texImage2D(e[5],s,n,t,t,0,n,o,g[s][5])}}else{for(var u=0;u<e.length;u++){var v=d[u];l.texImage2D(e[u],0,n,p,q,0,n,o,v)}if(l.generateMipmap(l.TEXTURE_CUBE_MAP),o===l.FLOAT&&n===l.RGB&&1282===l.getError()){a.Tools.Log("RGB32F not renderable on Firefox, trying fallback to RGBA32F.");for(var u=0;u<e.length;u++){for(var v=d[u],w=new Float32Array(p*q*4),x=0;p>x;x++)for(var y=0;q>y;y++){var z=3*(y*p+x),A=4*(y*p+x);w[A+0]=v[z+0],w[A+1]=v[z+1],w[A+2]=v[z+2],w[A+3]=1}l.texImage2D(e[u],0,l.RGBA,p,q,0,l.RGBA,o,w)}l.generateMipmap(l.TEXTURE_CUBE_MAP)}}else h=!0;o!==l.FLOAT||k._caps.textureFloatLinearFiltering?(l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,h?l.LINEAR:l.LINEAR_MIPMAP_LINEAR)):(l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.NEAREST)),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.bindTexture(l.TEXTURE_CUBE_MAP,null),m.isReady=!0,k.resetTextureCache(),c._removePendingData(m)};return a.Tools.LoadFile(b,function(a){t(a)},s,c.database,!0),m},f.prototype._releaseTexture=function(a){var b=this._gl;a._framebuffer&&b.deleteFramebuffer(a._framebuffer),a._depthBuffer&&b.deleteRenderbuffer(a._depthBuffer),b.deleteTexture(a),this.unbindAllTextures();var c=this._loadedTexturesCache.indexOf(a);-1!==c&&this._loadedTexturesCache.splice(c,1)},f.prototype.bindSamplers=function(a){this._gl.useProgram(a.getProgram());for(var b=a.getSamplers(),c=0;c<b.length;c++){var d=a.getUniform(b[c]);this._gl.uniform1i(d,c)}this._currentEffect=null},f.prototype._bindTexture=function(a,b){0>a||(this._gl.activeTexture(this._gl["TEXTURE"+a]),this._gl.bindTexture(this._gl.TEXTURE_2D,b),this._activeTexturesCache[a]=null)},f.prototype.setTextureFromPostProcess=function(a,b){this._bindTexture(a,b._textures.data[b._currentRenderTextureInd])},f.prototype.unbindAllTextures=function(){for(var a=0;a<this._caps.maxTexturesImageUnits;a++)this._gl.activeTexture(this._gl["TEXTURE"+a]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[a]=null},f.prototype.setTexture=function(b,c){if(!(0>b)){if(!c||!c.isReady())return void(null!=this._activeTexturesCache[b]&&(this._gl.activeTexture(this._gl["TEXTURE"+b]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[b]=null));var d=!1;if(c instanceof a.VideoTexture)this._gl.activeTexture(this._gl["TEXTURE"+b]),d=!0,c.update();else if(c.delayLoadState===f.DELAYLOADSTATE_NOTLOADED)return void c.delayLoad();if(this._activeTexturesCache[b]!==c){this._activeTexturesCache[b]=c;var e=c.getInternalTexture();if(d||this._gl.activeTexture(this._gl["TEXTURE"+b]),e.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,e),e._cachedCoordinatesMode!==c.coordinatesMode){e._cachedCoordinatesMode=c.coordinatesMode;var g=c.coordinatesMode!==a.Texture.CUBIC_MODE&&c.coordinatesMode!==a.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,g),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,g)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,c)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,e),e._cachedWrapU!==c.wrapU)switch(e._cachedWrapU=c.wrapU,c.wrapU){case a.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case a.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case a.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(e._cachedWrapV!==c.wrapV)switch(e._cachedWrapV=c.wrapV,c.wrapV){case a.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case a.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case a.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,c)}}}},f.prototype._setAnisotropicLevel=function(b,c){var d=this._caps.textureAnisotropicFilterExtension,e=c.anisotropicFilteringLevel;c.getInternalTexture().samplingMode===a.Texture.NEAREST_SAMPLINGMODE&&(e=1),d&&c._cachedAnisotropicFilteringLevel!==e&&(this._gl.texParameterf(b,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this._caps.maxAnisotropy)),
c._cachedAnisotropicFilteringLevel=e)},f.prototype.readPixels=function(a,b,c,d){var e=new Uint8Array(d*c*4);return this._gl.readPixels(a,b,c,d,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e),e},f.prototype.addExternalData=function(a,b){return this._externalData.add(a,b)},f.prototype.getExternalData=function(a){return this._externalData.get(a)},f.prototype.getOrAddExternalDataWithFactory=function(a,b){return this._externalData.getOrAddWithFactory(a,b)},f.prototype.removeExternalData=function(a){return this._externalData.remove(a)},f.prototype.releaseInternalTexture=function(a){if(a&&(a.references--,0===a.references)){var b=this.getLoadedTexturesCache(),c=b.indexOf(a);c>-1&&b.splice(c,1),this._releaseTexture(a)}},f.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();f.audioEngine.dispose();for(var a in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[a]._program);if(this._vertexAttribArraysEnabled)for(var b=0,c=this._vertexAttribArraysEnabled.length;c>b;b++)b>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[b]||this._gl.disableVertexAttribArray(b);this._gl=null,window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},f.prototype.displayLoadingUI=function(){this._loadingScreen.displayLoadingUI()},f.prototype.hideLoadingUI=function(){this._loadingScreen.hideLoadingUI()},Object.defineProperty(f.prototype,"loadingScreen",{get:function(){return this._loadingScreen},set:function(a){this._loadingScreen=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"loadingUIText",{set:function(a){this._loadingScreen.loadingUIText=a},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"loadingUIBackgroundColor",{set:function(a){this._loadingScreen.loadingUIBackgroundColor=a},enumerable:!0,configurable:!0}),f.prototype.getFps=function(){return this.fps},f.prototype.getDeltaTime=function(){return this.deltaTime},f.prototype._measureFps=function(){this.previousFramesDuration.push(a.Tools.Now);var b=this.previousFramesDuration.length;if(b>=2&&(this.deltaTime=this.previousFramesDuration[b-1]-this.previousFramesDuration[b-2]),b>=this.fpsRange){b>this.fpsRange&&(this.previousFramesDuration.splice(0,1),b=this.previousFramesDuration.length);for(var c=0,d=0;b-1>d;d++)c+=this.previousFramesDuration[d+1]-this.previousFramesDuration[d];this.fps=1e3/(c/(b-1))}},f.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var a=document.createElement("canvas"),b=a.getContext("webgl")||a.getContext("experimental-webgl");return null!=b&&!!window.WebGLRenderingContext}catch(c){return!1}},f._ALPHA_DISABLE=0,f._ALPHA_ADD=1,f._ALPHA_COMBINE=2,f._ALPHA_SUBTRACT=3,f._ALPHA_MULTIPLY=4,f._ALPHA_MAXIMIZED=5,f._ALPHA_ONEONE=6,f._DELAYLOADSTATE_NONE=0,f._DELAYLOADSTATE_LOADED=1,f._DELAYLOADSTATE_LOADING=2,f._DELAYLOADSTATE_NOTLOADED=4,f._TEXTUREFORMAT_ALPHA=0,f._TEXTUREFORMAT_LUMINANCE=1,f._TEXTUREFORMAT_LUMINANCE_ALPHA=2,f._TEXTUREFORMAT_RGB=4,f._TEXTUREFORMAT_RGBA=5,f._TEXTURETYPE_UNSIGNED_INT=0,f._TEXTURETYPE_FLOAT=1,f.CollisionsEpsilon=.001,f.CodeRepository="src/",f.ShadersRepository="src/Shaders/",f}();a.Engine=j}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b){this.state="",this.animations=new Array,this._ranges={},this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=a,this.id=a,this._scene=b,this._initCache()}return Object.defineProperty(b.prototype,"parent",{get:function(){return this._parentNode},set:function(a){if(this._parentNode!==a){if(this._parentNode){var b=this._parentNode._children.indexOf(this);-1!==b&&this._parentNode._children.splice(b,1)}this._parentNode=a,this._parentNode&&(this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getEngine=function(){return this._scene.getEngine()},b.prototype.getWorldMatrix=function(){return a.Matrix.Identity()},b.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},b.prototype.updateCache=function(a){!a&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},b.prototype._updateCache=function(a){},b.prototype._isSynchronized=function(){return!0},b.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},b.prototype.isSynchronizedWithParent=function(){return this.parent?this._parentRenderId!==this.parent._currentRenderId?!1:this.parent.isSynchronized():!0},b.prototype.isSynchronized=function(a){var b=this.hasNewParent();return b=b||!this.isSynchronizedWithParent(),b=b||!this._isSynchronized(),a&&this.updateCache(!0),!b},b.prototype.hasNewParent=function(a){return this._cache.parent===this.parent?!1:(a&&(this._cache.parent=this.parent),!0)},b.prototype.isReady=function(){return this._isReady},b.prototype.isEnabled=function(){return this._isEnabled?this.parent?this.parent.isEnabled():!0:!1},b.prototype.setEnabled=function(a){this._isEnabled=a},b.prototype.isDescendantOf=function(a){return this.parent?this.parent===a?!0:this.parent.isDescendantOf(a):!1},b.prototype._getDescendants=function(a,b,c){if(void 0===b&&(b=!1),this._children)for(var d=0;d<this._children.length;d++){var e=this._children[d];c&&!c(e)||a.push(e),b||e._getDescendants(a,!1,c)}},b.prototype.getDescendants=function(a,b){var c=[];return this._getDescendants(c,a,b),c},b.prototype.getChildren=function(a){return this.getDescendants(!0,a)},b.prototype.getChildMeshes=function(b,c){var d=[];return this._getDescendants(d,b,function(b){return(!c||c(b))&&b instanceof a.AbstractMesh}),d},b.prototype._setReady=function(a){if(a!==this._isReady){if(!a)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},b.prototype.getAnimationByName=function(a){for(var b=0;b<this.animations.length;b++){var c=this.animations[b];if(c.name===a)return c}return null},b.prototype.createAnimationRange=function(b,c,d){if(!this._ranges[b]){this._ranges[b]=new a.AnimationRange(b,c,d);for(var e=0,f=this.animations.length;f>e;e++)this.animations[e]&&this.animations[e].createRange(b,c,d)}},b.prototype.deleteAnimationRange=function(a,b){void 0===b&&(b=!0);for(var c=0,d=this.animations.length;d>c;c++)this.animations[c]&&this.animations[c].deleteRange(a,b);this._ranges[a]=void 0},b.prototype.getAnimationRange=function(a){return this._ranges[a]},b.prototype.beginAnimation=function(a,b,c,d){var e=this.getAnimationRange(a);return e?void this._scene.beginAnimation(this,e.from,e.to,b,c,d):null},b.prototype.serializeAnimationRanges=function(){var a=[];for(var b in this._ranges){var c={};c.name=b,c.from=this._ranges[b].from,c.to=this._ranges[b].to,a.push(c)}return a},b.prototype.dispose=function(){this.parent=null},b.ParseAnimationRanges=function(a,b,c){if(b.ranges)for(var d=0;d<b.ranges.length;d++){var e=b.ranges[d];a.createAnimationRange(e.name,e.from,e.to)}},__decorate([a.serialize()],b.prototype,"name",void 0),__decorate([a.serialize()],b.prototype,"id",void 0),__decorate([a.serialize()],b.prototype,"uniqueId",void 0),__decorate([a.serialize()],b.prototype,"state",void 0),b}();a.Node=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d,e,f,g,h){this._engine=a,this._canvas=c,this._currentScene=b,this._sceneLoadedCallback=d,this._progressCallback=e,this._additionnalRenderLoopLogicCallback=f,this._textureLoadingCallback=g,this._startingProcessingFilesCallback=h}return b.prototype.monitorElementForDragNDrop=function(a){var b=this;a&&(this._elementToMonitor=a,this._elementToMonitor.addEventListener("dragenter",function(a){b.drag(a)},!1),this._elementToMonitor.addEventListener("dragover",function(a){b.drag(a)},!1),this._elementToMonitor.addEventListener("drop",function(a){b.drop(a)},!1))},b.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var a=this._currentScene.getWaitingItemsCount();a>0&&this._textureLoadingCallback(a)}this._currentScene.render()}},b.prototype.drag=function(a){a.stopPropagation(),a.preventDefault()},b.prototype.drop=function(a){a.stopPropagation(),a.preventDefault(),this.loadFiles(a)},b.prototype.loadFiles=function(a){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),a&&a.dataTransfer&&a.dataTransfer.files&&(this._filesToLoad=a.dataTransfer.files),a&&a.target&&a.target.files&&(this._filesToLoad=a.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var c=0;c<this._filesToLoad.length;c++)switch(this._filesToLoad[c].type){case"image/jpeg":case"image/png":case"image/bmp":b.FilesTextures[this._filesToLoad[c].name.toLowerCase()]=this._filesToLoad[c];break;case"image/targa":case"image/vnd.ms-dds":case"audio/wav":case"audio/x-wav":case"audio/mp3":case"audio/mpeg":case"audio/mpeg3":case"audio/x-mpeg-3":case"audio/ogg":b.FilesToLoad[this._filesToLoad[c].name.toLowerCase()]=this._filesToLoad[c];break;default:-1!==this._filesToLoad[c].name.indexOf(".mtl")?b.FilesToLoad[this._filesToLoad[c].name.toLowerCase()]=this._filesToLoad[c]:-1===this._filesToLoad[c].name.indexOf(".babylon")&&-1===this._filesToLoad[c].name.indexOf(".stl")&&-1===this._filesToLoad[c].name.indexOf(".obj")||-1!==this._filesToLoad[c].name.indexOf(".manifest")||-1!==this._filesToLoad[c].name.indexOf(".incremental")||-1!==this._filesToLoad[c].name.indexOf(".babylonmeshdata")||-1!==this._filesToLoad[c].name.indexOf(".babylongeometrydata")||-1!==this._filesToLoad[c].name.indexOf(".babylonbinarymeshdata")||-1!==this._filesToLoad[c].name.indexOf(".binary.babylon")||(this._sceneFileToLoad=this._filesToLoad[c])}this.reload()}},b.prototype.reload=function(){var b=this,c=this;this._sceneFileToLoad?(this._currentScene&&(a.Tools.errorsCount>0&&(a.Tools.ClearLogCache(),a.Tools.Log("Babylon.js engine (v"+a.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),a.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(a){c._currentScene=a,c._currentScene.executeWhenReady(function(){c._currentScene.activeCamera&&0!==c._currentScene.lights.length||c._currentScene.createDefaultCameraOrLight(),c._currentScene.activeCamera.attachControl(c._canvas),c._sceneLoadedCallback&&c._sceneLoadedCallback(b._sceneFileToLoad,c._currentScene),c._engine.runRenderLoop(function(){c.renderFunction()})})},function(a){b._progressCallback&&b._progressCallback(a)})):a.Tools.Error("Please provide a valid .babylon file.")},b.FilesTextures=new Array,b.FilesToLoad=new Array,b}();a.FilesInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c){this.bu=a,this.bv=b,this.distance=c,this.faceId=0,this.subMeshId=0}return a}();a.IntersectionInfo=b;var c=function(){function b(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null}return b.prototype.getNormal=function(b,c){if(void 0===b&&(b=!1),void 0===c&&(c=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(a.VertexBuffer.NormalKind))return null;var d,e=this.pickedMesh.getIndices();if(c){var f=this.pickedMesh.getVerticesData(a.VertexBuffer.NormalKind),g=a.Vector3.FromArray(f,3*e[3*this.faceId]),h=a.Vector3.FromArray(f,3*e[3*this.faceId+1]),i=a.Vector3.FromArray(f,3*e[3*this.faceId+2]);g=g.scale(this.bu),h=h.scale(this.bv),i=i.scale(1-this.bu-this.bv),d=new a.Vector3(g.x+h.x+i.x,g.y+h.y+i.y,g.z+h.z+i.z)}else{var j=this.pickedMesh.getVerticesData(a.VertexBuffer.PositionKind),k=a.Vector3.FromArray(j,3*e[3*this.faceId]),l=a.Vector3.FromArray(j,3*e[3*this.faceId+1]),m=a.Vector3.FromArray(j,3*e[3*this.faceId+2]),n=k.subtract(l),o=m.subtract(l);d=a.Vector3.Cross(n,o)}return b&&(d=a.Vector3.TransformNormal(d,this.pickedMesh.getWorldMatrix())),a.Vector3.Normalize(d)},b.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(a.VertexBuffer.UVKind))return null;var b=this.pickedMesh.getIndices(),c=this.pickedMesh.getVerticesData(a.VertexBuffer.UVKind),d=a.Vector2.FromArray(c,2*b[3*this.faceId]),e=a.Vector2.FromArray(c,2*b[3*this.faceId+1]),f=a.Vector2.FromArray(c,2*b[3*this.faceId+2]);return d=d.scale(1-this.bu-this.bv),e=e.scale(this.bu),f=f.scale(this.bv),new a.Vector2(d.x+e.x+f.x,d.y+e.y+f.y)},b}();a.PickingInfo=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){this.minimum=b,this.maximum=c,this._tempRadiusVector=a.Vector3.Zero();var d=a.Vector3.Distance(b,c);this.center=a.Vector3.Lerp(b,c,.5),this.radius=.5*d,this.centerWorld=a.Vector3.Zero(),this._update(a.Matrix.Identity())}return b.prototype._update=function(b){a.Vector3.TransformCoordinatesToRef(this.center,b,this.centerWorld),a.Vector3.TransformNormalFromFloatsToRef(1,1,1,b,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},b.prototype.isInFrustum=function(a){for(var b=0;6>b;b++)if(a[b].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},b.prototype.intersectsPoint=function(b){var c=this.centerWorld.x-b.x,d=this.centerWorld.y-b.y,e=this.centerWorld.z-b.z,f=Math.sqrt(c*c+d*d+e*e);return!(Math.abs(this.radiusWorld-f)<a.Epsilon)},b.Intersects=function(a,b){var c=a.centerWorld.x-b.centerWorld.x,d=a.centerWorld.y-b.centerWorld.y,e=a.centerWorld.z-b.centerWorld.z,f=Math.sqrt(c*c+d*d+e*e);return!(a.radiusWorld+b.radiusWorld<f)},b}();a.BoundingSphere=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){this.minimum=b,this.maximum=c,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[a.Vector3.Zero(),a.Vector3.Zero(),a.Vector3.Zero()];for(var d=0;d<this.vectors.length;d++)this.vectorsWorld[d]=a.Vector3.Zero();this.minimumWorld=a.Vector3.Zero(),this.maximumWorld=a.Vector3.Zero(),this._update(a.Matrix.Identity())}return b.prototype.getWorldMatrix=function(){return this._worldMatrix},b.prototype.setWorldMatrix=function(a){return this._worldMatrix.copyFrom(a),this},b.prototype._update=function(b){a.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),a.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var c=0;c<this.vectors.length;c++){var d=this.vectorsWorld[c];a.Vector3.TransformCoordinatesToRef(this.vectors[c],b,d),d.x<this.minimumWorld.x&&(this.minimumWorld.x=d.x),d.y<this.minimumWorld.y&&(this.minimumWorld.y=d.y),d.z<this.minimumWorld.z&&(this.minimumWorld.z=d.z),d.x>this.maximumWorld.x&&(this.maximumWorld.x=d.x),d.y>this.maximumWorld.y&&(this.maximumWorld.y=d.y),d.z>this.maximumWorld.z&&(this.maximumWorld.z=d.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),a.Vector3.FromFloatArrayToRef(b.m,0,this.directions[0]),a.Vector3.FromFloatArrayToRef(b.m,4,this.directions[1]),a.Vector3.FromFloatArrayToRef(b.m,8,this.directions[2]),this._worldMatrix=b},b.prototype.isInFrustum=function(a){return b.IsInFrustum(this.vectorsWorld,a)},b.prototype.isCompletelyInFrustum=function(a){return b.IsCompletelyInFrustum(this.vectorsWorld,a)},b.prototype.intersectsPoint=function(b){var c=-a.Epsilon;return this.maximumWorld.x-b.x<c||c>b.x-this.minimumWorld.x?!1:this.maximumWorld.y-b.y<c||c>b.y-this.minimumWorld.y?!1:!(this.maximumWorld.z-b.z<c||c>b.z-this.minimumWorld.z)},b.prototype.intersectsSphere=function(a){return b.IntersectsSphere(this.minimumWorld,this.maximumWorld,a.centerWorld,a.radiusWorld)},b.prototype.intersectsMinMax=function(a,b){return this.maximumWorld.x<a.x||this.minimumWorld.x>b.x?!1:this.maximumWorld.y<a.y||this.minimumWorld.y>b.y?!1:!(this.maximumWorld.z<a.z||this.minimumWorld.z>b.z)},b.Intersects=function(a,b){return a.maximumWorld.x<b.minimumWorld.x||a.minimumWorld.x>b.maximumWorld.x?!1:a.maximumWorld.y<b.minimumWorld.y||a.minimumWorld.y>b.maximumWorld.y?!1:!(a.maximumWorld.z<b.minimumWorld.z||a.minimumWorld.z>b.maximumWorld.z)},b.IntersectsSphere=function(b,c,d,e){var f=a.Vector3.Clamp(d,b,c),g=a.Vector3.DistanceSquared(d,f);return e*e>=g},b.IsCompletelyInFrustum=function(a,b){for(var c=0;6>c;c++)for(var d=0;8>d;d++)if(b[c].dotCoordinate(a[d])<0)return!1;return!0},b.IsInFrustum=function(a,b){for(var c=0;6>c;c++){for(var d=8,e=0;8>e&&b[c].dotCoordinate(a[e])<0;e++)--d;if(0===d)return!1}return!0},b}();a.BoundingBox=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b,c){var d=a.Vector3.Dot(c.center,b),e=Math.abs(a.Vector3.Dot(c.directions[0],b))*c.extendSize.x,f=Math.abs(a.Vector3.Dot(c.directions[1],b))*c.extendSize.y,g=Math.abs(a.Vector3.Dot(c.directions[2],b))*c.extendSize.z,h=e+f+g;return{min:d-h,max:d+h}},c=function(a,b,c,d){return!(a>d||c>b)},d=function(a,d,e){var f=b(a,d),g=b(a,e);return c(f.min,f.max,g.min,g.max)},e=function(){function b(b,c){this.minimum=b,this.maximum=c,this._isLocked=!1,this.boundingBox=new a.BoundingBox(b,c),this.boundingSphere=new a.BoundingSphere(b,c)}return Object.defineProperty(b.prototype,"isLocked",{get:function(){return this._isLocked},set:function(a){this._isLocked=a},enumerable:!0,configurable:!0}),b.prototype.update=function(a){this._isLocked||(this.boundingBox._update(a),this.boundingSphere._update(a))},b.prototype.isInFrustum=function(a){return this.boundingSphere.isInFrustum(a)?this.boundingBox.isInFrustum(a):!1},b.prototype.isCompletelyInFrustum=function(a){return this.boundingBox.isCompletelyInFrustum(a)},b.prototype._checkCollision=function(a){return a._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},b.prototype.intersectsPoint=function(a){return this.boundingSphere.centerWorld&&this.boundingSphere.intersectsPoint(a)?!!this.boundingBox.intersectsPoint(a):!1},b.prototype.intersects=function(b,c){if(!this.boundingSphere.centerWorld||!b.boundingSphere.centerWorld)return!1;if(!a.BoundingSphere.Intersects(this.boundingSphere,b.boundingSphere))return!1;if(!a.BoundingBox.Intersects(this.boundingBox,b.boundingBox))return!1;if(!c)return!0;var e=this.boundingBox,f=b.boundingBox;return d(e.directions[0],e,f)&&d(e.directions[1],e,f)&&d(e.directions[2],e,f)&&d(f.directions[0],e,f)&&d(f.directions[1],e,f)&&d(f.directions[2],e,f)&&d(a.Vector3.Cross(e.directions[0],f.directions[0]),e,f)&&d(a.Vector3.Cross(e.directions[0],f.directions[1]),e,f)&&d(a.Vector3.Cross(e.directions[0],f.directions[2]),e,f)&&d(a.Vector3.Cross(e.directions[1],f.directions[0]),e,f)&&d(a.Vector3.Cross(e.directions[1],f.directions[1]),e,f)&&d(a.Vector3.Cross(e.directions[1],f.directions[2]),e,f)&&d(a.Vector3.Cross(e.directions[2],f.directions[0]),e,f)&&d(a.Vector3.Cross(e.directions[2],f.directions[1]),e,f)?!!d(a.Vector3.Cross(e.directions[2],f.directions[2]),e,f):!1},b}();a.BoundingInfo=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c){void 0===c&&(c=Number.MAX_VALUE),this.origin=a,this.direction=b,this.length=c}return b.prototype.intersectsBoxMinMax=function(a,b){var c,d,e,f,g=0,h=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>b.x)return!1}else if(c=1/this.direction.x,d=(a.x-this.origin.x)*c,e=(b.x-this.origin.x)*c,e===-(1/0)&&(e=1/0),d>e&&(f=d,d=e,e=f),g=Math.max(d,g),h=Math.min(e,h),g>h)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>b.y)return!1}else if(c=1/this.direction.y,d=(a.y-this.origin.y)*c,e=(b.y-this.origin.y)*c,e===-(1/0)&&(e=1/0),d>e&&(f=d,d=e,e=f),g=Math.max(d,g),h=Math.min(e,h),g>h)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>b.z)return!1}else if(c=1/this.direction.z,d=(a.z-this.origin.z)*c,e=(b.z-this.origin.z)*c,e===-(1/0)&&(e=1/0),d>e&&(f=d,d=e,e=f),g=Math.max(d,g),h=Math.min(e,h),g>h)return!1;return!0},b.prototype.intersectsBox=function(a){return this.intersectsBoxMinMax(a.minimum,a.maximum)},b.prototype.intersectsSphere=function(a){var b=a.center.x-this.origin.x,c=a.center.y-this.origin.y,d=a.center.z-this.origin.z,e=b*b+c*c+d*d,f=a.radius*a.radius;if(f>=e)return!0;var g=b*this.direction.x+c*this.direction.y+d*this.direction.z;if(0>g)return!1;var h=e-g*g;return f>=h},b.prototype.intersectsTriangle=function(b,c,d){this._edge1||(this._edge1=a.Vector3.Zero(),this._edge2=a.Vector3.Zero(),this._pvec=a.Vector3.Zero(),this._tvec=a.Vector3.Zero(),this._qvec=a.Vector3.Zero()),c.subtractToRef(b,this._edge1),d.subtractToRef(b,this._edge2),a.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var e=a.Vector3.Dot(this._edge1,this._pvec);if(0===e)return null;var f=1/e;this.origin.subtractToRef(b,this._tvec);var g=a.Vector3.Dot(this._tvec,this._pvec)*f;if(0>g||g>1)return null;a.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var h=a.Vector3.Dot(this.direction,this._qvec)*f;if(0>h||g+h>1)return null;var i=a.Vector3.Dot(this._edge2,this._qvec)*f;return i>this.length?null:new a.IntersectionInfo(g,h,i)},b.prototype.intersectsPlane=function(b){var c,d=a.Vector3.Dot(b.normal,this.direction);if(Math.abs(d)<9.99999997475243e-7)return null;var e=a.Vector3.Dot(b.normal,this.origin);return c=(-b.d-e)/d,0>c?-9.99999997475243e-7>c?null:0:c},b.prototype.intersectionSegment=function(c,d,e){var f,g,h,i,j=this.origin.add(this.direction.multiplyByFloats(b.rayl,b.rayl,b.rayl)),k=d.subtract(c),l=j.subtract(this.origin),m=c.subtract(this.origin),n=a.Vector3.Dot(k,k),o=a.Vector3.Dot(k,l),p=a.Vector3.Dot(l,l),q=a.Vector3.Dot(k,m),r=a.Vector3.Dot(l,m),s=n*p-o*o,t=s,u=s;s<b.smallnum?(g=0,t=1,i=r,u=p):(g=o*r-p*q,i=n*r-o*q,0>g?(g=0,i=r,u=p):g>t&&(g=t,i=r+o,u=p)),0>i?(i=0,0>-q?g=0:-q>n?g=t:(g=-q,t=n)):i>u&&(i=u,0>-q+o?g=0:-q+o>n?g=t:(g=-q+o,t=n)),f=Math.abs(g)<b.smallnum?0:g/t,h=Math.abs(i)<b.smallnum?0:i/u;var v=l.multiplyByFloats(h,h,h),w=m.add(k.multiplyByFloats(f,f,f)).subtract(v),x=h>0&&h<=this.length&&w.lengthSquared()<e*e;return x?v.length():-1},b.CreateNew=function(c,d,e,f,g,h,i){var j=a.Vector3.Unproject(new a.Vector3(c,d,0),e,f,g,h,i),k=a.Vector3.Unproject(new a.Vector3(c,d,1),e,f,g,h,i),l=k.subtract(j);return l.normalize(),new b(j,l)},b.CreateNewFromTo=function(c,d,e){void 0===e&&(e=a.Matrix.Identity());var f=d.subtract(c),g=Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z);return f.normalize(),b.Transform(new b(c,f,g),e)},b.Transform=function(c,d){var e=a.Vector3.TransformCoordinates(c.origin,d),f=a.Vector3.TransformNormal(c.direction,d);return f.normalize(),new b(e,f,c.length)},b.smallnum=1e-8,b.rayl=1e9,b}();a.Ray=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(d,e){var f=this;b.call(this,d,e),this.onDisposeObservable=new a.Observable,this.onCollideObservable=new a.Observable,this.onCollisionPositionChangeObservable=new a.Observable,this.onAfterWorldMatrixUpdateObservable=new a.Observable,this.definedFacingForward=!0,this.position=new a.Vector3(0,0,0),this._rotation=new a.Vector3(0,0,0),this._scaling=new a.Vector3(1,1,1),this.billboardMode=c.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=a.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=a.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.computeBonesUsingShaders=!0,this.scalingDeterminant=1,this.numBoneInfluencers=4,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._checkCollisions=!1,this.ellipsoid=new a.Vector3(.5,1,.5),this.ellipsoidOffset=new a.Vector3(0,0,0),this._collider=new a.Collider,this._oldPositionForCollisions=new a.Vector3(0,0,0),this._diffPositionForCollisions=new a.Vector3(0,0,0),this._newPositionForCollisions=new a.Vector3(0,0,0),this.edgesWidth=1,this.edgesColor=new a.Color4(1,0,0,1),this._localWorld=a.Matrix.Zero(),this._worldMatrix=a.Matrix.Zero(),this._rotateYByPI=a.Matrix.RotationY(Math.PI),this._absolutePosition=a.Vector3.Zero(),this._collisionsTransformMatrix=a.Matrix.Zero(),this._collisionsScalingMatrix=a.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=a.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._isWorldMatrixFrozen=!1,this._unIndexed=!1,this._onCollisionPositionChange=function(b,c,d){void 0===d&&(d=null),f.getScene().workerCollisions&&c.multiplyInPlace(f._collider.radius),c.subtractToRef(f._oldPositionForCollisions,f._diffPositionForCollisions),f._diffPositionForCollisions.length()>a.Engine.CollisionsEpsilon&&f.position.addInPlace(f._diffPositionForCollisions),d&&f.onCollideObservable.notifyObservers(d),f.onCollisionPositionChangeObservable.notifyObservers(f.position)},e.addMesh(this)}return __extends(c,b),Object.defineProperty(c,"BILLBOARDMODE_NONE",{get:function(){return c._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_X",{get:function(){return c._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Y",{get:function(){return c._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_Z",{get:function(){return c._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(c,"BILLBOARDMODE_ALL",{get:function(){return c._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollide",{set:function(a){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onCollisionPositionChange",{set:function(a){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skeleton",{get:function(){return this._skeleton},set:function(a){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),a&&a.needInitialSkinMatrix&&a._registerMeshWithPoseMatrix(this),this._skeleton=a,this._skeleton||(this._bonesTransformMatrices=null)},enumerable:!0,configurable:!0}),c.prototype.toString=function(b){var c="Name: "+this.name+", isInstance: "+(this instanceof a.InstancedMesh?"YES":"NO");return c+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(c+=", skeleton: "+this._skeleton.name),b&&(c+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],c+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),c},Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scaling",{get:function(){return this._scaling},set:function(a){this._scaling=a,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(a){this._rotationQuaternion=a,a&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),c.prototype.updatePoseMatrix=function(a){this._poseMatrix.copyFrom(a)},c.prototype.getPoseMatrix=function(){return this._poseMatrix},c.prototype.disableEdgesRendering=function(){void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0)},c.prototype.enableEdgesRendering=function(b,c){void 0===b&&(b=.95),void 0===c&&(c=!1),this.disableEdgesRendering(),this._edgesRenderer=new a.EdgesRenderer(this,b,c)},Object.defineProperty(c.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype.getLOD=function(a){return this},c.prototype.getTotalVertices=function(){return 0},c.prototype.getIndices=function(){return null},c.prototype.getVerticesData=function(a){return null},c.prototype.isVerticesDataPresent=function(a){return!1},c.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(c.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),c.prototype._preActivate=function(){},c.prototype._preActivateForIntermediateRendering=function(a){},c.prototype._activate=function(a){this._renderId=a},c.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(c.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),c.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},c.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(c.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),c.prototype.rotate=function(b,c,d){b.normalize(),this.rotationQuaternion||(this.rotationQuaternion=a.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=a.Vector3.Zero());var e;if(d&&d!==a.Space.LOCAL){if(this.parent){var f=this.parent.getWorldMatrix().clone();f.invert(),b=a.Vector3.TransformNormal(b,f)}e=a.Quaternion.RotationAxis(b,c),this.rotationQuaternion=e.multiply(this.rotationQuaternion)}else e=a.Quaternion.RotationAxis(b,c),this.rotationQuaternion=this.rotationQuaternion.multiply(e)},c.prototype.translate=function(b,c,d){var e=b.scale(c);if(d&&d!==a.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(e));else{var f=this.getPositionExpressedInLocalSpace().add(e);
this.setPositionWithLocalVector(f)}},c.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},c.prototype.setAbsolutePosition=function(b){if(b){var c,d,e;if(void 0===b.x){if(arguments.length<3)return;c=arguments[0],d=arguments[1],e=arguments[2]}else c=b.x,d=b.y,e=b.z;if(this.parent){var f=this.parent.getWorldMatrix().clone();f.invert();var g=new a.Vector3(c,d,e);this.position=a.Vector3.TransformCoordinates(g,f)}else this.position.x=c,this.position.y=d,this.position.z=e}},c.prototype.movePOV=function(a,b,c){this.position.addInPlace(this.calcMovePOV(a,b,c))},c.prototype.calcMovePOV=function(b,c,d){var e=new a.Matrix,f=this.rotationQuaternion?this.rotationQuaternion:a.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);f.toRotationMatrix(e);var g=a.Vector3.Zero(),h=this.definedFacingForward?-1:1;return a.Vector3.TransformCoordinatesFromFloatsToRef(b*h,c,d*h,e,g),g},c.prototype.rotatePOV=function(a,b,c){this.rotation.addInPlace(this.calcRotatePOV(a,b,c))},c.prototype.calcRotatePOV=function(b,c,d){var e=this.definedFacingForward?1:-1;return new a.Vector3(b*e,c,d*e)},c.prototype.setPivotMatrix=function(a){this._pivotMatrix=a,this._cache.pivotMatrixUpdated=!0},c.prototype.getPivotMatrix=function(){return this._pivotMatrix},c.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==this._cache.billboardMode||this.billboardMode!==c.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return!!this._cache.scaling.equals(this.scaling)},c.prototype._initCache=function(){b.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=a.Vector3.Zero(),this._cache.scaling=a.Vector3.Zero(),this._cache.rotation=a.Vector3.Zero(),this._cache.rotationQuaternion=new a.Quaternion(0,0,0,0),this._cache.billboardMode=-1},c.prototype.markAsDirty=function(a){"rotation"===a&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},c.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new a.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},c.prototype._updateSubMeshesBoundingInfo=function(a){if(this.subMeshes)for(var b=0;b<this.subMeshes.length;b++){var c=this.subMeshes[b];c.IsGlobal||c.updateBoundingInfo(a)}},c.prototype.computeWorldMatrix=function(b){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!b&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,a.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,a.Tmp.Matrix[1]),this.rotationQuaternion){var d=this.rotation.length();d&&(this.rotationQuaternion.multiplyInPlace(a.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0))}if(this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(a.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(a.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,a.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var e=this.getScene().activeCamera;if(e){var f=e.getWorldMatrix(),g=new a.Vector3(f.m[12],f.m[13],f.m[14]);a.Matrix.TranslationToRef(this.position.x+g.x,this.position.y+g.y,this.position.z+g.z,a.Tmp.Matrix[2])}}else a.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,a.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(a.Tmp.Matrix[1],a.Tmp.Matrix[4]),a.Tmp.Matrix[4].multiplyToRef(a.Tmp.Matrix[0],a.Tmp.Matrix[5]),this.billboardMode!==c.BILLBOARDMODE_NONE&&this.getScene().activeCamera){a.Tmp.Vector3[0].copyFrom(this.position);var h=a.Tmp.Vector3[0];if(this.parent&&this.parent.getWorldMatrix){this._markSyncedWithParent();var i;this._meshToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),a.Tmp.Matrix[6]),i=a.Tmp.Matrix[6]):i=this.parent.getWorldMatrix(),a.Vector3.TransformNormalToRef(h,i,a.Tmp.Vector3[1]),h=a.Tmp.Vector3[1]}var j=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(h.addInPlace(this.parent.position),a.Matrix.TranslationToRef(h.x,h.y,h.z,a.Tmp.Matrix[2])),(this.billboardMode&c.BILLBOARDMODE_ALL)!==c.BILLBOARDMODE_ALL&&(this.billboardMode&c.BILLBOARDMODE_X&&(j.x=h.x+a.Epsilon),this.billboardMode&c.BILLBOARDMODE_Y&&(j.y=h.y+a.Epsilon),this.billboardMode&c.BILLBOARDMODE_Z&&(j.z=h.z+a.Epsilon)),a.Matrix.LookAtLHToRef(h,j,a.Vector3.Up(),a.Tmp.Matrix[3]),a.Tmp.Matrix[3].m[12]=a.Tmp.Matrix[3].m[13]=a.Tmp.Matrix[3].m[14]=0,a.Tmp.Matrix[3].invert(),a.Tmp.Matrix[5].multiplyToRef(a.Tmp.Matrix[3],this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,a.Tmp.Matrix[5])}return a.Tmp.Matrix[5].multiplyToRef(a.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===c.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),a.Tmp.Matrix[6]),a.Tmp.Matrix[6].multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=a.Matrix.Invert(this._worldMatrix)),this._worldMatrix},c.prototype.registerAfterWorldMatrixUpdate=function(a){this.onAfterWorldMatrixUpdateObservable.add(a)},c.prototype.unregisterAfterWorldMatrixUpdate=function(a){this.onAfterWorldMatrixUpdateObservable.removeCallback(a)},c.prototype.setPositionWithLocalVector=function(b){this.computeWorldMatrix(),this.position=a.Vector3.TransformNormal(b,this._localWorld)},c.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var b=this._localWorld.clone();return b.invert(),a.Vector3.TransformNormal(this.position,b)},c.prototype.locallyTranslate=function(b){this.computeWorldMatrix(!0),this.position=a.Vector3.TransformCoordinates(b,this._localWorld)},c.prototype.lookAt=function(b,c,d,e){c=c||0,d=d||0,e=e||0;var f=b.subtract(this.position),g=-Math.atan2(f.z,f.x)-Math.PI/2,h=Math.sqrt(f.x*f.x+f.z*f.z),i=Math.atan2(f.y,h);this.rotationQuaternion=a.Quaternion.RotationYawPitchRoll(g+c,i+d,e)},c.prototype.attachToBone=function(a,b){this._meshToBoneReferal=b,this.parent=a,a.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1)},c.prototype.detachFromBone=function(){this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._meshToBoneReferal=null,this.parent=null},c.prototype.isInFrustum=function(a){return this._boundingInfo.isInFrustum(a)},c.prototype.isCompletelyInFrustum=function(b){b||(b=this.getScene().activeCamera);var c=b.getViewMatrix().multiply(b.getProjectionMatrix());return!!this._boundingInfo.isCompletelyInFrustum(a.Frustum.GetPlanes(c))},c.prototype.intersectsMesh=function(a,b){return this._boundingInfo&&a._boundingInfo?this._boundingInfo.intersects(a._boundingInfo,b):!1},c.prototype.intersectsPoint=function(a){return this._boundingInfo?this._boundingInfo.intersectsPoint(a):!1},c.prototype.setPhysicsState=function(b,c){return b.impostor&&(c=b,b=b.impostor),this.physicsImpostor=new a.PhysicsImpostor(this,b,c,this.getScene()),this.physicsImpostor.physicsBody},c.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},c.prototype.getPhysicsMass=function(){return this.physicsImpostor.getParam("mass")},c.prototype.getPhysicsFriction=function(){return this.physicsImpostor.getParam("friction")},c.prototype.getPhysicsRestitution=function(){return this.physicsImpostor.getParam("resitution")},c.prototype.getPositionInCameraSpace=function(b){return b||(b=this.getScene().activeCamera),a.Vector3.TransformCoordinates(this.absolutePosition,b.getViewMatrix())},c.prototype.getDistanceToCamera=function(a){return a||(a=this.getScene().activeCamera),this.absolutePosition.subtract(a.position).length()},c.prototype.applyImpulse=function(a,b){this.physicsImpostor&&this.physicsImpostor.applyImpulse(a,b)},c.prototype.setPhysicsLinkWith=function(b,c,d,e){this.physicsImpostor&&b.physicsImpostor&&this.physicsImpostor.createJoint(b.physicsImpostor,a.PhysicsJoint.HingeJoint,{mainPivot:c,connectedPivot:d,nativeParams:e})},c.prototype.updatePhysicsBodyPosition=function(){a.Tools.Warn("updatePhysicsBodyPosition() is deprecated, please use updatePhysicsBody()"),this.updatePhysicsBody()},c.prototype.updatePhysicsBody=function(){},Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(a){this._checkCollisions=a,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),c.prototype.moveWithCollisions=function(a){var b=this.getAbsolutePosition();b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,a,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},c.prototype.createOrUpdateSubmeshesOctree=function(b,c){void 0===b&&(b=64),void 0===c&&(c=2),this._submeshesOctree||(this._submeshesOctree=new a.Octree(a.Octree.CreationFuncForSubMeshes,b,c)),this.computeWorldMatrix(!0);var d=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(d.minimumWorld,d.maximumWorld,this.subMeshes),this._submeshesOctree},c.prototype._collideForSubMesh=function(b,c,d){if(this._generatePointsArray(),!b._lastColliderWorldVertices||!b._lastColliderTransformMatrix.equals(c)){b._lastColliderTransformMatrix=c.clone(),b._lastColliderWorldVertices=[],b._trianglePlanes=[];for(var e=b.verticesStart,f=b.verticesStart+b.verticesCount,g=e;f>g;g++)b._lastColliderWorldVertices.push(a.Vector3.TransformCoordinates(this._positions[g],c))}d._collide(b._trianglePlanes,b._lastColliderWorldVertices,this.getIndices(),b.indexStart,b.indexStart+b.indexCount,b.verticesStart,!!b.getMaterial()),d.collisionFound&&(d.collidedMesh=this)},c.prototype._processCollisionsForSubMeshes=function(a,b){var c,d;if(this._submeshesOctree&&this.useOctreeForCollisions){var e=a.velocityWorldLength+Math.max(a.radius.x,a.radius.y,a.radius.z),f=this._submeshesOctree.intersects(a.basePointWorld,e);d=f.length,c=f.data}else c=this.subMeshes,d=c.length;for(var g=0;d>g;g++){var h=c[g];d>1&&!h._checkCollision(a)||this._collideForSubMesh(h,b,a)}},c.prototype._checkCollision=function(b){this._boundingInfo._checkCollision(b)&&(a.Matrix.ScalingToRef(1/b.radius.x,1/b.radius.y,1/b.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(b,this._collisionsTransformMatrix))},c.prototype._generatePointsArray=function(){return!1},c.prototype.intersects=function(b,c){var d=new a.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&b.intersectsSphere(this._boundingInfo.boundingSphere)&&b.intersectsBox(this._boundingInfo.boundingBox)))return d;if(!this._generatePointsArray())return d;var e,f,g=null;if(this._submeshesOctree&&this.useOctreeForPicking){var h=a.Ray.Transform(b,this.getWorldMatrix()),i=this._submeshesOctree.intersectsRay(h);f=i.length,e=i.data}else e=this.subMeshes,f=e.length;for(var j=0;f>j;j++){var k=e[j];if(!(f>1)||k.canIntersects(b)){var l=k.intersects(b,this._positions,this.getIndices(),c);if(l&&(c||!g||l.distance<g.distance)&&(g=l,g.subMeshId=j,c))break}}if(g){var m=this.getWorldMatrix(),n=a.Vector3.TransformCoordinates(b.origin,m),o=b.direction.clone();o=o.scale(g.distance);var p=a.Vector3.TransformNormal(o,m),q=n.add(p);return d.hit=!0,d.distance=a.Vector3.Distance(n,q),d.pickedPoint=q,d.pickedMesh=this,d.bu=g.bu,d.bv=g.bv,d.faceId=g.faceId,d.subMeshId=g.subMeshId,d}return d},c.prototype.clone=function(a,b,c){return null},c.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},c.prototype.dispose=function(a){var c,d=this;for(this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this.skeleton=null,this.getScene().stopAnimation(this),this.physicsImpostor&&this.physicsImpostor.dispose(),c=0;c<this._intersectionsInProgress.length;c++){var e=this._intersectionsInProgress[c],f=e._intersectionsInProgress.indexOf(this);e._intersectionsInProgress.splice(f,1)}this._intersectionsInProgress=[];var g=this.getScene().lights;if(g.forEach(function(a){var b=a.includedOnlyMeshes.indexOf(d);-1!==b&&a.includedOnlyMeshes.splice(b,1),b=a.excludedMeshes.indexOf(d),-1!==b&&a.excludedMeshes.splice(b,1)}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),a){var h=this.getChildMeshes(!0);for(c=0;c<h.length;c++){var i=h[c];i.parent=null,i.computeWorldMatrix(!0)}}else{for(c=0;c<this.getScene().particleSystems.length;c++)this.getScene().particleSystems[c].emitter===this&&(this.getScene().particleSystems[c].dispose(),c--);var j=this.getDescendants(!0);for(c=0;c<j.length;c++)j[c].dispose()}b.prototype.dispose.call(this),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this._isDisposed=!0,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},c._BILLBOARDMODE_NONE=0,c._BILLBOARDMODE_X=1,c._BILLBOARDMODE_Y=2,c._BILLBOARDMODE_Z=4,c._BILLBOARDMODE_ALL=7,c}(a.Node);a.AbstractMesh=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d){b.call(this,c,d),this.diffuse=new a.Color3(1,1,1),this.specular=new a.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.includeOnlyWithLayerMask=0,this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this.excludeWithLayerMask=0,this.radius=1e-5,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,d.addLight(this)}return __extends(c,b),c.prototype.toString=function(a){var b="Name: "+this.name;if(b+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var c=0;c<this.animations.length;c++)b+=", animation[0]: "+this.animations[c].toString(a);return b},c.prototype.getShadowGenerator=function(){return this._shadowGenerator},c.prototype.getAbsolutePosition=function(){return a.Vector3.Zero()},c.prototype.transferToEffect=function(a,b,c){},c.prototype._getWorldMatrix=function(){return a.Matrix.Identity()},c.prototype.canAffectMesh=function(a){return a?this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(a)?!1:this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(a)?!1:0!==this.includeOnlyWithLayerMask&&0===(this.includeOnlyWithLayerMask&a.layerMask)?!1:!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&a.layerMask):!0},c.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var b=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=a.Matrix.Identity()),b.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):b},c.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this.getScene().removeLight(this),b.prototype.dispose.call(this)},c.prototype.getTypeID=function(){return 0},c.prototype.clone=function(b){return a.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeID(),b,this.getScene()),this)},c.prototype.serialize=function(){var b=a.SerializationHelper.Serialize(this);return b.type=this.getTypeID(),this.parent&&(b.parentId=this.parent.id),this.excludedMeshes.length>0&&(b.excludedMeshesIds=[],this.excludedMeshes.forEach(function(a){b.excludedMeshesIds.push(a.id)})),this.includedOnlyMeshes.length>0&&(b.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(a){b.includedOnlyMeshesIds.push(a.id)})),a.Animation.AppendSerializedAnimations(this,b),b.ranges=this.serializeAnimationRanges(),b},c.GetConstructorFromName=function(b,c,d){switch(b){case 0:return function(){return new a.PointLight(c,a.Vector3.Zero(),d)};case 1:return function(){return new a.DirectionalLight(c,a.Vector3.Zero(),d)};case 2:return function(){return new a.SpotLight(c,a.Vector3.Zero(),a.Vector3.Zero(),0,0,d)};case 3:return function(){return new a.HemisphericLight(c,a.Vector3.Zero(),d)}}},c.Parse=function(b,d){var e=a.SerializationHelper.Parse(c.GetConstructorFromName(b.type,b.name,d),b,d);if(b.excludedMeshesIds&&(e._excludedMeshesIds=b.excludedMeshesIds),b.includedOnlyMeshesIds&&(e._includedOnlyMeshesIds=b.includedOnlyMeshesIds),b.parentId&&(e._waitingParentId=b.parentId),b.animations){for(var f=0;f<b.animations.length;f++){var g=b.animations[f];e.animations.push(a.Animation.Parse(g))}a.Node.ParseAnimationRanges(e,b,d)}return b.autoAnimate&&d.beginAnimation(e,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),e},__decorate([a.serializeAsColor3()],c.prototype,"diffuse",void 0),__decorate([a.serializeAsColor3()],c.prototype,"specular",void 0),__decorate([a.serialize()],c.prototype,"intensity",void 0),__decorate([a.serialize()],c.prototype,"range",void 0),__decorate([a.serialize()],c.prototype,"includeOnlyWithLayerMask",void 0),__decorate([a.serialize()],c.prototype,"excludeWithLayerMask",void 0),__decorate([a.serialize()],c.prototype,"radius",void 0),c}(a.Node);a.Light=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d){b.call(this,a,d),this.position=c}return __extends(c,b),c.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},c.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=a.Vector3.Zero()),a.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},c.prototype.transferToEffect=function(a,b){return this.parent&&this.parent.getWorldMatrix?(this.computeTransformedPosition(),void a.setFloat4(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0)):void a.setFloat4(b,this.position.x,this.position.y,this.position.z,0)},c.prototype.needCube=function(){return!0},c.prototype.supportsVSM=function(){return!1},c.prototype.needRefreshPerFrame=function(){return!1},c.prototype.getShadowDirection=function(b){switch(b){case 0:return new a.Vector3(1,0,0);case 1:return new a.Vector3(-1,0,0);case 2:return new a.Vector3(0,-1,0);case 3:return new a.Vector3(0,1,0);case 4:return new a.Vector3(0,0,1);case 5:return new a.Vector3(0,0,-1)}return a.Vector3.Zero()},c.prototype.setShadowProjectionMatrix=function(b,c,d){var e=this.getScene().activeCamera;a.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,e.minZ,e.maxZ,b)},c.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),a.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},c.prototype.getTypeID=function(){return 0},__decorate([a.serializeAsVector3()],c.prototype,"position",void 0),c}(a.Light);a.PointLight=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d,e,f,g){b.call(this,a,g),this.position=c,this.direction=d,this.angle=e,this.exponent=f}return __extends(c,b),c.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},c.prototype.setShadowProjectionMatrix=function(b,c,d){var e=this.getScene().activeCamera;a.Matrix.PerspectiveFovLHToRef(this.angle,1,e.minZ,e.maxZ,b)},c.prototype.needCube=function(){return!1},c.prototype.supportsVSM=function(){return!0},c.prototype.needRefreshPerFrame=function(){return!1},c.prototype.getShadowDirection=function(a){return this.direction},c.prototype.setDirectionToTarget=function(b){return this.direction=a.Vector3.Normalize(b.subtract(this.position)),this.direction},c.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=a.Vector3.Zero()),a.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},c.prototype.transferToEffect=function(b,c,d){var e;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=a.Vector3.Zero()),this.computeTransformedPosition(),a.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),b.setFloat4(c,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),e=a.Vector3.Normalize(this._transformedDirection)):(b.setFloat4(c,this.position.x,this.position.y,this.position.z,this.exponent),e=a.Vector3.Normalize(this.direction)),b.setFloat4(d,e.x,e.y,e.z,Math.cos(.5*this.angle))},c.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),a.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},c.prototype.getTypeID=function(){return 2},__decorate([a.serializeAsVector3()],c.prototype,"position",void 0),__decorate([a.serializeAsVector3()],c.prototype,"direction",void 0),__decorate([a.serialize()],c.prototype,"angle",void 0),__decorate([a.serialize()],c.prototype,"exponent",void 0),c}(a.Light);a.SpotLight=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e){b.call(this,c,e),this.groundColor=new a.Color3(0,0,0),this.direction=d}return __extends(c,b),c.prototype.setDirectionToTarget=function(b){return this.direction=a.Vector3.Normalize(b.subtract(a.Vector3.Zero())),this.direction},c.prototype.getShadowGenerator=function(){return null},c.prototype.transferToEffect=function(b,c,d){var e=a.Vector3.Normalize(this.direction);b.setFloat4(c,e.x,e.y,e.z,0),b.setColor3(d,this.groundColor.scale(this.intensity))},c.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),this._worldMatrix},c.prototype.getTypeID=function(){return 3},__decorate([a.serializeAsColor3()],c.prototype,"groundColor",void 0),__decorate([a.serializeAsVector3()],c.prototype,"direction",void 0),c}(a.Light);a.HemisphericLight=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d){b.call(this,a,d),this.shadowOrthoScale=.5,this.autoUpdateExtends=!0,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=c.scale(-1),this.direction=c}return __extends(c,b),c.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},c.prototype.setDirectionToTarget=function(b){return this.direction=a.Vector3.Normalize(b.subtract(this.position)),this.direction},c.prototype.setShadowProjectionMatrix=function(b,c,d){var e=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var f=a.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var g=0;g<d.length;g++){var h=d[g];if(h){var i=h.getBoundingInfo();if(i)for(var j=i.boundingBox,k=0;k<j.vectorsWorld.length;k++)a.Vector3.TransformCoordinatesToRef(j.vectorsWorld[k],c,f),f.x<this._orthoLeft&&(this._orthoLeft=f.x),f.y<this._orthoBottom&&(this._orthoBottom=f.y),f.x>this._orthoRight&&(this._orthoRight=f.x),f.y>this._orthoTop&&(this._orthoTop=f.y)}}}var l=this._orthoRight-this._orthoLeft,m=this._orthoTop-this._orthoBottom;a.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-l*this.shadowOrthoScale,this._orthoRight+l*this.shadowOrthoScale,this._orthoBottom-m*this.shadowOrthoScale,this._orthoTop+m*this.shadowOrthoScale,-e.maxZ,e.maxZ,b)},c.prototype.supportsVSM=function(){return!0},c.prototype.needRefreshPerFrame=function(){return!0},c.prototype.needCube=function(){return!1},c.prototype.getShadowDirection=function(a){return this.direction},c.prototype.computeTransformedPosition=function(){return this.parent&&this.parent.getWorldMatrix?(this.transformedPosition||(this.transformedPosition=a.Vector3.Zero()),a.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0):!1},c.prototype.transferToEffect=function(b,c){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=a.Vector3.Zero()),a.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void b.setFloat4(c,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void b.setFloat4(c,this.direction.x,this.direction.y,this.direction.z,1)},c.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),a.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},c.prototype.getTypeID=function(){return 1},__decorate([a.serializeAsVector3()],c.prototype,"position",void 0),__decorate([a.serializeAsVector3()],c.prototype,"direction",void 0),__decorate([a.serialize()],c.prototype,"shadowOrthoScale",void 0),__decorate([a.serialize()],c.prototype,"autoUpdateExtends",void 0),c}(a.Light);a.DirectionalLight=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(c,d){var e=this;this._filter=b.FILTER_NONE,this.blurScale=2,this._blurBoxOffset=0,this._bias=5e-5,this._lightDirection=a.Vector3.Zero(),this.forceBackFacesOnly=!1,this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=a.Matrix.Zero(),this._projectionMatrix=a.Matrix.Zero(),this._transformMatrix=a.Matrix.Zero(),this._worldViewProjection=a.Matrix.Zero(),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._light=d,this._scene=d.getScene(),this._mapSize=c,d._shadowGenerator=this,this._shadowMap=new a.RenderTargetTexture(d.name+"_shadowMap",c,this._scene,!1,!0,a.Engine.TEXTURETYPE_UNSIGNED_INT,d.needCube()),this._shadowMap.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(a.Texture.NEAREST_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.onBeforeRenderObservable.add(function(a){e._currentFaceIndex=a}),this._shadowMap.onAfterUnbindObservable.add(function(){e.useBlurVarianceShadowMap&&(e._shadowMap2||(e._shadowMap2=new a.RenderTargetTexture(d.name+"_shadowMap",c,e._scene,!1),e._shadowMap2.wrapU=a.Texture.CLAMP_ADDRESSMODE,e._shadowMap2.wrapV=a.Texture.CLAMP_ADDRESSMODE,e._shadowMap2.updateSamplingMode(a.Texture.TRILINEAR_SAMPLINGMODE),e._downSamplePostprocess=new a.PassPostProcess("downScale",1/e.blurScale,null,a.Texture.BILINEAR_SAMPLINGMODE,e._scene.getEngine()),e._downSamplePostprocess.onApplyObservable.add(function(a){a.setTexture("textureSampler",e._shadowMap)}),e.blurBoxOffset=1),e._scene.postProcessManager.directRender([e._downSamplePostprocess,e._boxBlurPostprocess],e._shadowMap2.getInternalTexture()))});var f=function(b){var c=b.getRenderingMesh(),d=e._scene,f=d.getEngine();f.setState(b.getMaterial().backFaceCulling);var g=c._getInstancesRenderList(b._id);if(!g.mustReturn){var h=null!==f.getCaps().instancedArrays&&null!==g.visibleInstances[b._id]&&void 0!==g.visibleInstances[b._id];if(e.isReady(b,h)){f.enableEffect(e._effect),c._bind(b,e._effect,a.Material.TriangleFillMode);var i=b.getMaterial();if(e._effect.setMatrix("viewProjection",e.getTransformMatrix()),e._effect.setVector3("lightPosition",e.getLight().position),e.getLight().needCube()&&e._effect.setFloat2("depthValues",d.activeCamera.minZ,d.activeCamera.maxZ),i&&i.needAlphaTesting()){var j=i.getAlphaTestTexture();e._effect.setTexture("diffuseSampler",j),e._effect.setMatrix("diffuseMatrix",j.getTextureMatrix())}c.useBones&&c.computeBonesUsingShaders&&e._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c)),e.forceBackFacesOnly&&f.setState(!0,0,!1,!0),c._processRendering(b,e._effect,a.Material.TriangleFillMode,g,h,function(a,b){return e._effect.setMatrix("world",b)}),e.forceBackFacesOnly&&f.setState(!0,0,!1,!1)}else e._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(a,b,c){var d;for(d=0;d<a.length;d++)f(a.data[d]);for(d=0;d<b.length;d++)f(b.data[d]);if(e._transparencyShadow)for(d=0;d<c.length;d++)f(c.data[d])},this._shadowMap.onClearObservable.add(function(b){e.useBlurVarianceShadowMap||e.useVarianceShadowMap?b.clear(new a.Color4(0,0,0,0),!0,!0):b.clear(new a.Color4(1,1,1,1),!0,!0)})}return Object.defineProperty(b,"FILTER_NONE",{get:function(){return b._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FILTER_VARIANCESHADOWMAP",{get:function(){return b._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FILTER_POISSONSAMPLING",{get:function(){return b._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return b._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"bias",{get:function(){return this._bias},set:function(a){this._bias=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(b){var c=this;this._blurBoxOffset!==b&&(this._blurBoxOffset=b,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new a.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,a.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+b),this._boxBlurPostprocess.onApplyObservable.add(function(a){a.setFloat2("screenSize",c._mapSize/c.blurScale,c._mapSize/c.blurScale)}))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"filter",{get:function(){return this._filter},set:function(b){this._filter!==b&&(this._filter=b,this.useVarianceShadowMap||this.useBlurVarianceShadowMap||this.usePoissonSampling?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(a.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(a.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useVarianceShadowMap",{get:function(){return this.filter===b.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(a){this.filter=a?b.FILTER_VARIANCESHADOWMAP:b.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"usePoissonSampling",{get:function(){return this.filter===b.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===b.FILTER_VARIANCESHADOWMAP||this.filter===b.FILTER_BLURVARIANCESHADOWMAP)},set:function(a){this.filter=a?b.FILTER_POISSONSAMPLING:b.FILTER_NONE;
},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"useBlurVarianceShadowMap",{get:function(){return this.filter===b.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(a){this.filter=a?b.FILTER_BLURVARIANCESHADOWMAP:b.FILTER_NONE},enumerable:!0,configurable:!0}),b.prototype.isReady=function(b,c){var d=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&d.push("#define VSM"),this.getLight().needCube()&&d.push("#define CUBEMAP");var e=[a.VertexBuffer.PositionKind],f=b.getMesh(),g=b.getMaterial();g&&g.needAlphaTesting()&&(d.push("#define ALPHATEST"),f.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(e.push(a.VertexBuffer.UVKind),d.push("#define UV1")),f.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(e.push(a.VertexBuffer.UV2Kind),d.push("#define UV2"))),f.useBones&&f.computeBonesUsingShaders?(e.push(a.VertexBuffer.MatricesIndicesKind),e.push(a.VertexBuffer.MatricesWeightsKind),f.numBoneInfluencers>4&&(e.push(a.VertexBuffer.MatricesIndicesExtraKind),e.push(a.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),d.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0"),c&&(d.push("#define INSTANCES"),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"));var h=d.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,this._effect=this._scene.getEngine().createEffect("shadowMap",e,["world","mBones","viewProjection","diffuseMatrix","lightPosition","depthValues"],["diffuseSampler"],h)),this._effect.isReady()},b.prototype.getShadowMap=function(){return this._shadowMap},b.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},b.prototype.getLight=function(){return this._light},b.prototype.getTransformMatrix=function(){var b=this._scene;if(this._currentRenderID===b.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=b.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var c=this._light.position;return a.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(a.Vector3.Dot(this._lightDirection,a.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.computeTransformedPosition()&&(c=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&c.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=c.clone(),this._cachedDirection=this._lightDirection.clone(),a.Matrix.LookAtLHToRef(c,c.add(this._lightDirection),a.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},b.prototype.getDarkness=function(){return this._darkness},b.prototype.setDarkness=function(a){a>=1?this._darkness=1:0>=a?this._darkness=0:this._darkness=a},b.prototype.setTransparencyShadow=function(a){this._transparencyShadow=a},b.prototype._packHalf=function(b){var c=255*b,d=c-Math.floor(c);return new a.Vector2(b-d/255,d)},b.prototype.dispose=function(){this._shadowMap.dispose(),this._shadowMap2&&this._shadowMap2.dispose(),this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},b.prototype.serialize=function(){var a={};a.lightId=this._light.id,a.mapSize=this.getShadowMap().getRenderSize(),a.useVarianceShadowMap=this.useVarianceShadowMap,a.usePoissonSampling=this.usePoissonSampling,a.forceBackFacesOnly=this.forceBackFacesOnly,a.renderList=[];for(var b=0;b<this.getShadowMap().renderList.length;b++){var c=this.getShadowMap().renderList[b];a.renderList.push(c.id)}return a},b.Parse=function(a,c){for(var d=c.getLightByID(a.lightId),e=new b(a.mapSize,d),f=0;f<a.renderList.length;f++){var g=c.getMeshesByID(a.renderList[f]);g.forEach(function(a){e.getShadowMap().renderList.push(a)})}return a.usePoissonSampling?e.usePoissonSampling=!0:a.useVarianceShadowMap?e.useVarianceShadowMap=!0:a.useBlurVarianceShadowMap&&(e.useBlurVarianceShadowMap=!0,a.blurScale&&(e.blurScale=a.blurScale),a.blurBoxOffset&&(e.blurBoxOffset=a.blurBoxOffset)),void 0!==a.bias&&(e.bias=a.bias),e.forceBackFacesOnly=a.forceBackFacesOnly,e},b._FILTER_NONE=0,b._FILTER_VARIANCESHADOWMAP=1,b._FILTER_POISSONSAMPLING=2,b._FILTER_BLURVARIANCESHADOWMAP=3,b}();a.ShadowGenerator=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a,b,c,d){return a.x>c.x+d?!1:c.x-d>b.x?!1:a.y>c.y+d?!1:c.y-d>b.y?!1:a.z>c.z+d?!1:!(c.z-d>b.z)},c=function(a,b,c,d){var e=b*b-4*a*c,f={root:0,found:!1};if(0>e)return f;var g=Math.sqrt(e),h=(-b-g)/(2*a),i=(-b+g)/(2*a);if(h>i){var j=i;i=h,h=j}return h>0&&d>h?(f.root=h,f.found=!0,f):i>0&&d>i?(f.root=i,f.found=!0,f):f},d=function(){function d(){this.radius=new a.Vector3(1,1,1),this.retry=0,this.basePointWorld=a.Vector3.Zero(),this.velocityWorld=a.Vector3.Zero(),this.normalizedVelocity=a.Vector3.Zero(),this._collisionPoint=a.Vector3.Zero(),this._planeIntersectionPoint=a.Vector3.Zero(),this._tempVector=a.Vector3.Zero(),this._tempVector2=a.Vector3.Zero(),this._tempVector3=a.Vector3.Zero(),this._tempVector4=a.Vector3.Zero(),this._edge=a.Vector3.Zero(),this._baseToVertex=a.Vector3.Zero(),this._destinationPoint=a.Vector3.Zero(),this._slidePlaneNormal=a.Vector3.Zero(),this._displacementVector=a.Vector3.Zero()}return d.prototype._initialize=function(b,c,d){this.velocity=c,a.Vector3.NormalizeToRef(c,this.normalizedVelocity),this.basePoint=b,b.multiplyToRef(this.radius,this.basePointWorld),c.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=d,this.collisionFound=!1},d.prototype._checkPointInTriangle=function(b,c,d,e,f){c.subtractToRef(b,this._tempVector),d.subtractToRef(b,this._tempVector2),a.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var g=a.Vector3.Dot(this._tempVector4,f);return 0>g?!1:(e.subtractToRef(b,this._tempVector3),a.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),g=a.Vector3.Dot(this._tempVector4,f),0>g?!1:(a.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),g=a.Vector3.Dot(this._tempVector4,f),g>=0))},d.prototype._canDoCollision=function(c,d,e,f){var g=a.Vector3.Distance(this.basePointWorld,c),h=Math.max(this.radius.x,this.radius.y,this.radius.z);return g>this.velocityWorldLength+h+d?!1:!!b(e,f,this.basePointWorld,this.velocityWorldLength+h)},d.prototype._testTriangle=function(b,d,e,f,g,h){var i,j=!1;d||(d=[]),d[b]||(d[b]=new a.Plane(0,0,0,0),d[b].copyFromPoints(e,f,g));var k=d[b];if(h||k.isFrontFacingTo(this.normalizedVelocity,0)){var l=k.signedDistanceTo(this.basePoint),m=a.Vector3.Dot(k.normal,this.velocity);if(0==m){if(Math.abs(l)>=1)return;j=!0,i=0}else{i=(-1-l)/m;var n=(1-l)/m;if(i>n){var o=n;n=i,i=o}if(i>1||0>n)return;0>i&&(i=0),i>1&&(i=1)}this._collisionPoint.copyFromFloats(0,0,0);var p=!1,q=1;if(j||(this.basePoint.subtractToRef(k.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(i,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,e,f,g,k.normal)&&(p=!0,q=i,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!p){var r=this.velocity.lengthSquared(),s=r;this.basePoint.subtractToRef(e,this._tempVector);var t=2*a.Vector3.Dot(this.velocity,this._tempVector),u=this._tempVector.lengthSquared()-1,v=c(s,t,u,q);v.found&&(q=v.root,p=!0,this._collisionPoint.copyFrom(e)),this.basePoint.subtractToRef(f,this._tempVector),t=2*a.Vector3.Dot(this.velocity,this._tempVector),u=this._tempVector.lengthSquared()-1,v=c(s,t,u,q),v.found&&(q=v.root,p=!0,this._collisionPoint.copyFrom(f)),this.basePoint.subtractToRef(g,this._tempVector),t=2*a.Vector3.Dot(this.velocity,this._tempVector),u=this._tempVector.lengthSquared()-1,v=c(s,t,u,q),v.found&&(q=v.root,p=!0,this._collisionPoint.copyFrom(g)),f.subtractToRef(e,this._edge),e.subtractToRef(this.basePoint,this._baseToVertex);var w=this._edge.lengthSquared(),x=a.Vector3.Dot(this._edge,this.velocity),y=a.Vector3.Dot(this._edge,this._baseToVertex);if(s=w*-r+x*x,t=w*(2*a.Vector3.Dot(this.velocity,this._baseToVertex))-2*x*y,u=w*(1-this._baseToVertex.lengthSquared())+y*y,v=c(s,t,u,q),v.found){var z=(x*v.root-y)/w;z>=0&&1>=z&&(q=v.root,p=!0,this._edge.scaleInPlace(z),e.addToRef(this._edge,this._collisionPoint))}g.subtractToRef(f,this._edge),f.subtractToRef(this.basePoint,this._baseToVertex),w=this._edge.lengthSquared(),x=a.Vector3.Dot(this._edge,this.velocity),y=a.Vector3.Dot(this._edge,this._baseToVertex),s=w*-r+x*x,t=w*(2*a.Vector3.Dot(this.velocity,this._baseToVertex))-2*x*y,u=w*(1-this._baseToVertex.lengthSquared())+y*y,v=c(s,t,u,q),v.found&&(z=(x*v.root-y)/w,z>=0&&1>=z&&(q=v.root,p=!0,this._edge.scaleInPlace(z),f.addToRef(this._edge,this._collisionPoint))),e.subtractToRef(g,this._edge),g.subtractToRef(this.basePoint,this._baseToVertex),w=this._edge.lengthSquared(),x=a.Vector3.Dot(this._edge,this.velocity),y=a.Vector3.Dot(this._edge,this._baseToVertex),s=w*-r+x*x,t=w*(2*a.Vector3.Dot(this.velocity,this._baseToVertex))-2*x*y,u=w*(1-this._baseToVertex.lengthSquared())+y*y,v=c(s,t,u,q),v.found&&(z=(x*v.root-y)/w,z>=0&&1>=z&&(q=v.root,p=!0,this._edge.scaleInPlace(z),g.addToRef(this._edge,this._collisionPoint)))}if(p){var A=q*this.velocity.length();(!this.collisionFound||A<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=A,this.collisionFound=!0)}}},d.prototype._collide=function(a,b,c,d,e,f,g){for(var h=d;e>h;h+=3){var i=b[c[h]-f],j=b[c[h+1]-f],k=b[c[h+2]-f];this._testTriangle(h,a,k,j,i,g)}},d.prototype._getResponse=function(b,c){b.addToRef(c,this._destinationPoint),c.scaleInPlace(this.nearestDistance/c.length()),this.basePoint.addToRef(c,b),b.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),b.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(a.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,c)},d}();a.Collider=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){a.CollisionWorker="",function(a){a[a.INIT=0]="INIT",a[a.UPDATE=1]="UPDATE",a[a.COLLIDE=2]="COLLIDE"}(a.WorkerTaskType||(a.WorkerTaskType={}));var b=a.WorkerTaskType;!function(a){a[a.SUCCESS=0]="SUCCESS",a[a.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(a.WorkerReplyType||(a.WorkerReplyType={}));var c=a.WorkerReplyType,d=function(){function d(){var e=this;this._scaledPosition=a.Vector3.Zero(),this._scaledVelocity=a.Vector3.Zero(),this.onMeshUpdated=function(a){e._addUpdateMeshesList[a.uniqueId]=d.SerializeMesh(a)},this.onGeometryUpdated=function(a){e._addUpdateGeometriesList[a.id]=d.SerializeGeometry(a)},this._afterRender=function(){if(e._init&&!(0==e._toRemoveGeometryArray.length&&0==e._toRemoveMeshesArray.length&&0==Object.keys(e._addUpdateGeometriesList).length&&0==Object.keys(e._addUpdateMeshesList).length||e._runningUpdated>4)){++e._runningUpdated;var a={updatedMeshes:e._addUpdateMeshesList,updatedGeometries:e._addUpdateGeometriesList,removedGeometries:e._toRemoveGeometryArray,removedMeshes:e._toRemoveMeshesArray},c={payload:a,taskType:b.UPDATE},d=[];for(var f in a.updatedGeometries)a.updatedGeometries.hasOwnProperty(f)&&(d.push(c.payload.updatedGeometries[f].indices.buffer),d.push(c.payload.updatedGeometries[f].normals.buffer),d.push(c.payload.updatedGeometries[f].positions.buffer));e._worker.postMessage(c,d),e._addUpdateMeshesList={},e._addUpdateGeometriesList={},e._toRemoveGeometryArray=[],e._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(d){var f=d.data;if(f.error!=c.SUCCESS)return void a.Tools.Warn("error returned from worker!");switch(f.taskType){case b.INIT:e._init=!0,e._scene.meshes.forEach(function(a){e.onMeshAdded(a)}),e._scene.getGeometries().forEach(function(a){e.onGeometryAdded(a)});break;case b.UPDATE:e._runningUpdated--;break;case b.COLLIDE:e._runningCollisionTask=!1;var g=f.payload;if(!e._collisionsCallbackArray[g.collisionId])return;e._collisionsCallbackArray[g.collisionId](g.collisionId,a.Vector3.FromArray(g.newPosition),e._scene.getMeshByUniqueID(g.collidedMeshUniqueId)),e._collisionsCallbackArray[g.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return d.prototype.getNewPosition=function(a,c,d,e,f,g,h){if(this._init&&!this._collisionsCallbackArray[h]&&!this._collisionsCallbackArray[h+1e5]){a.divideToRef(d.radius,this._scaledPosition),c.divideToRef(d.radius,this._scaledVelocity),this._collisionsCallbackArray[h]=g;var i={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:d.radius.asArray()},collisionId:h,excludedMeshUniqueId:f?f.uniqueId:null,maximumRetry:e},j={payload:i,taskType:b.COLLIDE};this._worker.postMessage(j)}},d.prototype.init=function(c){this._scene=c,this._scene.registerAfterRender(this._afterRender);var d=a.WorkerIncluded?a.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([a.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(d),this._worker.onmessage=this._onMessageFromWorker;var e={payload:{},taskType:b.INIT};this._worker.postMessage(e)},d.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},d.prototype.onMeshAdded=function(a){a.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(a)},d.prototype.onMeshRemoved=function(a){this._toRemoveMeshesArray.push(a.uniqueId)},d.prototype.onGeometryAdded=function(a){a.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(a)},d.prototype.onGeometryDeleted=function(a){this._toRemoveGeometryArray.push(a.id)},d.SerializeMesh=function(b){var c=[];b.subMeshes&&(c=b.subMeshes.map(function(a,b){return{position:b,verticesStart:a.verticesStart,verticesCount:a.verticesCount,indexStart:a.indexStart,indexCount:a.indexCount,hasMaterial:!!a.getMaterial(),sphereCenter:a.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:a.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:a.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:a.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var d=null;return b instanceof a.Mesh?d=b.geometry?b.geometry.id:null:b instanceof a.InstancedMesh&&(d=b.sourceMesh&&b.sourceMesh.geometry?b.sourceMesh.geometry.id:null),{uniqueId:b.uniqueId,id:b.id,name:b.name,geometryId:d,sphereCenter:b.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:b.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:b.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:b.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:b.worldMatrixFromCache.asArray(),subMeshes:c,checkCollisions:b.checkCollisions}},d.SerializeGeometry=function(b){return{id:b.id,positions:new Float32Array(b.getVerticesData(a.VertexBuffer.PositionKind)||[]),normals:new Float32Array(b.getVerticesData(a.VertexBuffer.NormalKind)||[]),indices:new Int32Array(b.getIndices()||[])}},d}();a.CollisionCoordinatorWorker=d;var e=function(){function b(){this._scaledPosition=a.Vector3.Zero(),this._scaledVelocity=a.Vector3.Zero(),this._finalPosition=a.Vector3.Zero()}return b.prototype.getNewPosition=function(a,b,c,d,e,f,g){a.divideToRef(c.radius,this._scaledPosition),b.divideToRef(c.radius,this._scaledVelocity),c.collidedMesh=null,c.retry=0,c.initialVelocity=this._scaledVelocity,c.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,c,d,this._finalPosition,e),this._finalPosition.multiplyInPlace(c.radius),f(g,this._finalPosition,c.collidedMesh)},b.prototype.init=function(a){this._scene=a},b.prototype.destroy=function(){},b.prototype.onMeshAdded=function(a){},b.prototype.onMeshUpdated=function(a){},b.prototype.onMeshRemoved=function(a){},b.prototype.onGeometryAdded=function(a){},b.prototype.onGeometryUpdated=function(a){},b.prototype.onGeometryDeleted=function(a){},b.prototype._collideWithWorld=function(b,c,d,e,f,g){void 0===g&&(g=null);var h=10*a.Engine.CollisionsEpsilon;if(d.retry>=e)return void f.copyFrom(b);d._initialize(b,c,h);for(var i=0;i<this._scene.meshes.length;i++){var j=this._scene.meshes[i];j.isEnabled()&&j.checkCollisions&&j.subMeshes&&j!==g&&j._checkCollision(d)}return d.collisionFound?(0===c.x&&0===c.y&&0===c.z||d._getResponse(b,c),c.length()<=h?void f.copyFrom(b):(d.retry++,void this._collideWithWorld(b,c,d,e,f,g))):void b.addToRef(c,f)},b}();a.CollisionCoordinatorLegacy=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(d,e,f){b.call(this,d,f),this.upVector=a.Vector3.Up(),this.orthoLeft=null,this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this.mode=c.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new a.Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=c.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=c.RIG_MODE_NONE,this._rigCameras=new Array,this._computedViewMatrix=a.Matrix.Identity(),this._projectionMatrix=new a.Matrix,this._postProcesses=new Array,this._activeMeshes=new a.SmartArray(256),this._globalPosition=a.Vector3.Zero(),f.addCamera(this),f.activeCamera||(f.activeCamera=this),this.position=e}return __extends(c,b),Object.defineProperty(c,"PERSPECTIVE_CAMERA",{get:function(){return c._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ORTHOGRAPHIC_CAMERA",{get:function(){return c._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_VERTICAL_FIXED",{get:function(){return c._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return c._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_NONE",{get:function(){return c._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return c._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return c._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RIG_MODE_VR",{get:function(){return c._RIG_MODE_VR},enumerable:!0,configurable:!0}),c.prototype.toString=function(a){var b="Name: "+this.name;if(b+=", type: "+this.getTypeName(),this.animations)for(var c=0;c<this.animations.length;c++)b+=", animation[0]: "+this.animations[c].toString(a);return b},Object.defineProperty(c.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),c.prototype.getActiveMeshes=function(){return this._activeMeshes},c.prototype.isActiveMesh=function(a){return-1!==this._activeMeshes.indexOf(a)},c.prototype._initCache=function(){b.prototype._initCache.call(this),this._cache.position=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},c.prototype._updateCache=function(a){a||b.prototype._updateCache.call(this);var c=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()},c.prototype._updateFromScene=function(){this.updateCache(),this._update()},c.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},c.prototype._isSynchronizedViewMatrix=function(){return b.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},c.prototype._isSynchronizedProjectionMatrix=function(){var a=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!a)return!1;var b=this.getEngine();return a=this.mode===c.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===b.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight()},c.prototype.attachControl=function(a,b){},c.prototype.detachControl=function(a){},c.prototype._update=function(){this.cameraRigMode!==c.RIG_MODE_NONE&&this._updateRigCameras(),this._checkInputs()},c.prototype._checkInputs=function(){},c.prototype._cascadePostProcessesToRigCams=function(){this._postProcesses.length>0&&this._postProcesses[0].markTextureDirty();for(var b=0,c=this._rigCameras.length;c>b;b++){var d=this._rigCameras[b],e=d._rigPostProcess;if(e){var f=e instanceof a.PassPostProcess;f&&(d.isIntermediate=0===this._postProcesses.length),d._postProcesses=this._postProcesses.slice(0).concat(e),e.markTextureDirty()}else d._postProcesses=this._postProcesses.slice(0)}},c.prototype.attachPostProcess=function(b,c){return void 0===c&&(c=null),!b.isReusable()&&this._postProcesses.indexOf(b)>-1?(a.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==c||0>c?this._postProcesses.push(b):this._postProcesses.splice(c,0,b),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(b))},c.prototype.detachPostProcess=function(a,b){void 0===b&&(b=null);var c,d,e=[];if(b)for(b=b instanceof Array?b:[b],c=b.length-1;c>=0;c--)this._postProcesses[b[c]]===a?this._postProcesses.splice(d,1):e.push(c);else{var f=this._postProcesses.indexOf(a);-1!==f&&this._postProcesses.splice(f,1)}return this._cascadePostProcessesToRigCams(),e},c.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=a.Matrix.Identity());var b=this.getViewMatrix();return b.invertToRef(this._worldMatrix),this._worldMatrix},c.prototype._getViewMatrix=function(){return a.Matrix.Identity()},c.prototype.getViewMatrix=function(b){return this._computedViewMatrix=this._computeViewMatrix(b),!b&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},c.prototype._computeViewMatrix=function(a){return!a&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},c.prototype.getProjectionMatrix=function(b){if(!b&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var d=this.getEngine();if(this.mode===c.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),a.Matrix.PerspectiveFovLHToRef(this.fov,d.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===c.FOVMODE_VERTICAL_FIXED),this._projectionMatrix;var e=d.getRenderWidth()/2,f=d.getRenderHeight()/2;return a.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-e,this.orthoRight||e,this.orthoBottom||-f,this.orthoTop||f,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},c.prototype.dispose=function(){for(this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;)this._rigCameras.pop().dispose();for(var a=0;a<this._postProcesses.length;++a)this._postProcesses[a].dispose(this);b.prototype.dispose.call(this)},c.prototype.setCameraRigMode=function(b,d){for(;this._rigCameras.length>0;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=b,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=d.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=a.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==c.RIG_MODE_NONE&&(this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))),this.cameraRigMode){case c.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new a.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new a.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case c.RIG_MODE_STEREOSCOPIC_OVERUNDER:var e=this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new a.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new a.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,e);break;case c.RIG_MODE_VR:var f=d.vrCameraMetrics||a.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=f,this._rigCameras[0].viewport=new a.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=f.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=f.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=f,this._rigCameras[1].viewport=new a.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new a.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=f.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=f.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,f.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new a.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,f),this._rigCameras[1]._rigPostProcess=new a.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,f))}this._cascadePostProcessesToRigCams(),this._update()},c.prototype._getVRProjectionMatrix=function(){return a.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},c.prototype.setCameraRigParameter=function(b,c){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[b]=c,"interaxialDistance"===b&&(this._cameraRigParams.stereoHalfAngle=a.Tools.ToRadians(c/.0637))},c.prototype.createRigCamera=function(a,b){return null},c.prototype._updateRigCameras=function(){for(var a=0;a<this._rigCameras.length;a++)this._rigCameras[a].minZ=this.minZ,this._rigCameras[a].maxZ=this.maxZ,this._rigCameras[a].fov=this.fov;this.cameraRigMode===c.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},c.prototype._setupInputs=function(){},c.prototype.serialize=function(){var b=a.SerializationHelper.Serialize(this);return b.type=this.getTypeName(),this.parent&&(b.parentId=this.parent.id),this.inputs&&this.inputs.serialize(b),a.Animation.AppendSerializedAnimations(this,b),b.ranges=this.serializeAnimationRanges(),b},c.prototype.getTypeName=function(){return"Camera"},c.prototype.clone=function(b){return a.SerializationHelper.Clone(c.GetConstructorFromName(this.getTypeName(),b,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},c.GetConstructorFromName=function(b,c,d,e,f){switch(void 0===e&&(e=0),void 0===f&&(f=!0),b){case"ArcRotateCamera":return function(){return new a.ArcRotateCamera(c,0,0,1,a.Vector3.Zero(),d)};case"DeviceOrientationCamera":return function(){return new a.DeviceOrientationCamera(c,a.Vector3.Zero(),d)};case"FollowCamera":return function(){return new a.FollowCamera(c,a.Vector3.Zero(),d)};case"ArcFollowCamera":return function(){return new a.ArcFollowCamera(c,0,0,1,null,d)};case"GamepadCamera":return function(){return new a.GamepadCamera(c,a.Vector3.Zero(),d)};case"TouchCamera":return function(){return new a.TouchCamera(c,a.Vector3.Zero(),d)};case"VirtualJoysticksCamera":return function(){return new a.VirtualJoysticksCamera(c,a.Vector3.Zero(),d)};case"WebVRFreeCamera":return function(){return new a.WebVRFreeCamera(c,a.Vector3.Zero(),d)};case"VRDeviceOrientationFreeCamera":return function(){return new a.VRDeviceOrientationFreeCamera(c,a.Vector3.Zero(),d)};case"AnaglyphArcRotateCamera":return function(){return new a.AnaglyphArcRotateCamera(c,0,0,1,a.Vector3.Zero(),e,d)};case"AnaglyphFreeCamera":return function(){return new a.AnaglyphFreeCamera(c,a.Vector3.Zero(),e,d)};case"AnaglyphGamepadCamera":return function(){return new a.AnaglyphGamepadCamera(c,a.Vector3.Zero(),e,d)};case"AnaglyphUniversalCamera":return function(){return new a.AnaglyphUniversalCamera(c,a.Vector3.Zero(),e,d)};case"StereoscopicArcRotateCamera":return function(){return new a.StereoscopicArcRotateCamera(c,0,0,1,a.Vector3.Zero(),e,f,d)};case"StereoscopicFreeCamera":return function(){return new a.StereoscopicFreeCamera(c,a.Vector3.Zero(),e,f,d)};case"StereoscopicGamepadCamera":return function(){return new a.StereoscopicGamepadCamera(c,a.Vector3.Zero(),e,f,d)};case"StereoscopicUniversalCamera":return function(){return new a.StereoscopicUniversalCamera(c,a.Vector3.Zero(),e,f,d)};case"FreeCamera":return function(){return new a.UniversalCamera(c,a.Vector3.Zero(),d)};default:return function(){return new a.UniversalCamera(c,a.Vector3.Zero(),d)}}},c.Parse=function(b,d){var e=b.type,f=c.GetConstructorFromName(e,b.name,d,b.interaxial_distance,b.isStereoscopicSideBySide),g=a.SerializationHelper.Parse(f,b,d);if(b.parentId&&(g._waitingParentId=b.parentId),g.inputs&&(g.inputs.parse(b),g._setupInputs()),b.target&&g.setTarget&&g.setTarget(a.Vector3.FromArray(b.target)),b.cameraRigMode){var h=b.interaxial_distance?{interaxialDistance:b.interaxial_distance}:{};g.setCameraRigMode(b.cameraRigMode,h)}if(b.animations){for(var i=0;i<b.animations.length;i++){var j=b.animations[i];g.animations.push(a.Animation.Parse(j));
}a.Node.ParseAnimationRanges(g,b,d)}return b.autoAnimate&&d.beginAnimation(g,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),g},c._PERSPECTIVE_CAMERA=0,c._ORTHOGRAPHIC_CAMERA=1,c._FOVMODE_VERTICAL_FIXED=0,c._FOVMODE_HORIZONTAL_FIXED=1,c._RIG_MODE_NONE=0,c._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,c._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,c._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,c._RIG_MODE_VR=20,c.ForceAttachControlToAlwaysPreventDefault=!1,__decorate([a.serializeAsVector3()],c.prototype,"position",void 0),__decorate([a.serializeAsVector3()],c.prototype,"upVector",void 0),__decorate([a.serialize()],c.prototype,"orthoLeft",void 0),__decorate([a.serialize()],c.prototype,"orthoRight",void 0),__decorate([a.serialize()],c.prototype,"orthoBottom",void 0),__decorate([a.serialize()],c.prototype,"orthoTop",void 0),__decorate([a.serialize()],c.prototype,"fov",void 0),__decorate([a.serialize()],c.prototype,"minZ",void 0),__decorate([a.serialize()],c.prototype,"maxZ",void 0),__decorate([a.serialize()],c.prototype,"inertia",void 0),__decorate([a.serialize()],c.prototype,"mode",void 0),__decorate([a.serialize()],c.prototype,"layerMask",void 0),__decorate([a.serialize()],c.prototype,"fovMode",void 0),__decorate([a.serialize()],c.prototype,"cameraRigMode",void 0),__decorate([a.serialize()],c.prototype,"interaxialDistance",void 0),__decorate([a.serialize()],c.prototype,"isStereoscopicSideBySide",void 0),c}(a.Node);a.Camera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){a.CameraInputTypes={};var b=function(){function b(a){this.attached={},this.camera=a,this.checkInputs=function(){}}return b.prototype.add=function(b){var c=b.getSimpleName();return this.attached[c]?void a.Tools.Warn("camera input of type "+c+" already exists on camera"):(this.attached[c]=b,b.camera=this.camera,b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b))),void(this.attachedElement&&b.attachControl(this.attachedElement)))},b.prototype.remove=function(a){for(var b in this.attached){var c=this.attached[b];c===a&&(c.detachControl(this.attachedElement),delete this.attached[b],this.rebuildInputCheck())}},b.prototype.removeByType=function(a){for(var b in this.attached){var c=this.attached[b];c.getTypeName()===a&&(c.detachControl(this.attachedElement),delete this.attached[b],this.rebuildInputCheck())}},b.prototype._addCheckInputs=function(a){var b=this.checkInputs;return function(){b(),a()}},b.prototype.attachInput=function(a){a.attachControl(this.attachedElement,this.noPreventDefault)},b.prototype.attachElement=function(b,c){if(!this.attachedElement){c=a.Camera.ForceAttachControlToAlwaysPreventDefault?!1:c,this.attachedElement=b,this.noPreventDefault=c;for(var d in this.attached)this.attached[d],this.attached[d].attachControl(b,c)}},b.prototype.detachElement=function(a){if(this.attachedElement===a){for(var b in this.attached)this.attached[b],this.attached[b].detachControl(a);this.attachedElement=null}},b.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var a in this.attached){var b=this.attached[a];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}},b.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},b.prototype.serialize=function(b){var c={};for(var d in this.attached){var e=this.attached[d],f=a.SerializationHelper.Serialize(e);c[e.getTypeName()]=f}b.inputsmgr=c},b.prototype.parse=function(b){var c=b.inputsmgr;if(c){this.clear();for(var d in c){var e=a.CameraInputTypes[d];if(e){var f=c[d],g=a.SerializationHelper.Parse(function(){return new e},f,null);this.add(g)}}}else for(var d in this.attached){var e=a.CameraInputTypes[this.attached[d].getTypeName()];if(e){var g=a.SerializationHelper.Parse(function(){return new e},b,null);this.remove(this.attached[d]),this.add(g)}}},b}();a.CameraInputsManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a){void 0===a&&(a=!0),this.touchEnabled=a,this.angularSensibility=2e3}return b.prototype.attachControl=function(b,c){var d=this;if(!this._pointerInput){var e=this.camera,f=this.camera.getEngine();this._pointerInput=function(b,g){var h=b.event;if(d.touchEnabled||"touch"!==h.pointerType)if(b.type===a.PointerEventTypes.POINTERDOWN){try{h.srcElement.setPointerCapture(h.pointerId)}catch(i){}d.previousPosition={x:h.clientX,y:h.clientY},c||h.preventDefault()}else if(b.type===a.PointerEventTypes.POINTERUP){try{h.srcElement.releasePointerCapture(h.pointerId)}catch(i){}d.previousPosition=null,c||h.preventDefault()}else if(b.type===a.PointerEventTypes.POINTERMOVE){if(!d.previousPosition&&!f.isPointerLock)return;var j,k;f.isPointerLock?(j=h.movementX||h.mozMovementX||h.webkitMovementX||h.msMovementX||0,k=h.movementY||h.mozMovementY||h.webkitMovementY||h.msMovementY||0):(j=h.clientX-d.previousPosition.x,k=h.clientY-d.previousPosition.y),e.cameraRotation.y+=j/d.angularSensibility,e.cameraRotation.x+=k/d.angularSensibility,d.previousPosition={x:h.clientX,y:h.clientY},c||h.preventDefault()}}}this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.PointerEventTypes.POINTERDOWN|a.PointerEventTypes.POINTERUP|a.PointerEventTypes.POINTERMOVE)},b.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.previousPosition=null)},b.prototype.getTypeName=function(){return"FreeCameraMouseInput"},b.prototype.getSimpleName=function(){return"mouse"},__decorate([a.serialize()],b.prototype,"angularSensibility",void 0),b}();a.FreeCameraMouseInput=b,a.CameraInputTypes.FreeCameraMouseInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._keys=[],this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return b.prototype.attachControl=function(b,c){var d=this;this._onKeyDown||(this._onKeyDown=function(a){if(-1!==d.keysUp.indexOf(a.keyCode)||-1!==d.keysDown.indexOf(a.keyCode)||-1!==d.keysLeft.indexOf(a.keyCode)||-1!==d.keysRight.indexOf(a.keyCode)){var b=d._keys.indexOf(a.keyCode);-1===b&&d._keys.push(a.keyCode),c||a.preventDefault()}},this._onKeyUp=function(a){if(-1!==d.keysUp.indexOf(a.keyCode)||-1!==d.keysDown.indexOf(a.keyCode)||-1!==d.keysLeft.indexOf(a.keyCode)||-1!==d.keysRight.indexOf(a.keyCode)){var b=d._keys.indexOf(a.keyCode);b>=0&&d._keys.splice(b,1),c||a.preventDefault()}},a.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},b.prototype.detachControl=function(b){this._onKeyDown&&(a.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)},b.prototype.checkInputs=function(){if(this._onKeyDown)for(var b=this.camera,c=0;c<this._keys.length;c++){var d=this._keys[c],e=b._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(d)?b._localDirection.copyFromFloats(-e,0,0):-1!==this.keysUp.indexOf(d)?b._localDirection.copyFromFloats(0,0,e):-1!==this.keysRight.indexOf(d)?b._localDirection.copyFromFloats(e,0,0):-1!==this.keysDown.indexOf(d)&&b._localDirection.copyFromFloats(0,0,-e),b.getViewMatrix().invertToRef(b._cameraTransformMatrix),a.Vector3.TransformNormalToRef(b._localDirection,b._cameraTransformMatrix,b._transformedDirection),b.cameraDirection.addInPlace(b._transformedDirection)}},b.prototype.getTypeName=function(){return"FreeCameraKeyboardMoveInput"},b.prototype._onLostFocus=function(a){this._keys=[]},b.prototype.getSimpleName=function(){return"keyboard"},__decorate([a.serialize()],b.prototype,"keysUp",void 0),__decorate([a.serialize()],b.prototype,"keysDown",void 0),__decorate([a.serialize()],b.prototype,"keysLeft",void 0),__decorate([a.serialize()],b.prototype,"keysRight",void 0),b}();a.FreeCameraKeyboardMoveInput=b,a.CameraInputTypes.FreeCameraKeyboardMoveInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.touchAngularSensibility=2e5,this.touchMoveSensibility=250}return b.prototype.attachControl=function(b,c){var d,e=this;void 0===this._pointerInput&&(this._onLostFocus=function(a){e._offsetX=null,e._offsetY=null},this._pointerInput=function(b,f){var g=b.event;if("mouse"!==g.pointerType)if(b.type===a.PointerEventTypes.POINTERDOWN){if(c||g.preventDefault(),e._pointerPressed.push(g.pointerId),1!==e._pointerPressed.length)return;d={x:g.clientX,y:g.clientY}}else if(b.type===a.PointerEventTypes.POINTERUP){c||g.preventDefault();var h=e._pointerPressed.indexOf(g.pointerId);if(-1===h)return;if(e._pointerPressed.splice(h,1),0!=h)return;d=null,e._offsetX=null,e._offsetY=null}else if(b.type===a.PointerEventTypes.POINTERMOVE){if(c||g.preventDefault(),!d)return;var h=e._pointerPressed.indexOf(g.pointerId);if(0!=h)return;e._offsetX=g.clientX-d.x,e._offsetY=-(g.clientY-d.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.PointerEventTypes.POINTERDOWN|a.PointerEventTypes.POINTERUP|a.PointerEventTypes.POINTERMOVE),b.addEventListener("blur",this._onLostFocus)},b.prototype.detachControl=function(a){this._pointerInput&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,a.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null,this._pointerPressed=[],this._offsetX=null,this._offsetY=null,this._pointerCount=0)},b.prototype.checkInputs=function(){if(this._offsetX){var b=this.camera;if(b.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)b.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var c=b._computeLocalCameraSpeed(),d=new a.Vector3(0,0,c*this._offsetY/this.touchMoveSensibility);a.Matrix.RotationYawPitchRollToRef(b.rotation.y,b.rotation.x,0,b._cameraRotationMatrix),b.cameraDirection.addInPlace(a.Vector3.TransformCoordinates(d,b._cameraRotationMatrix))}}},b.prototype.getTypeName=function(){return"FreeCameraTouchInput"},b.prototype.getSimpleName=function(){return"touch"},__decorate([a.serialize()],b.prototype,"touchAngularSensibility",void 0),__decorate([a.serialize()],b.prototype,"touchMoveSensibility",void 0),b}();a.FreeCameraTouchInput=b,a.CameraInputTypes.FreeCameraTouchInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){var b=this;this._screenOrientationAngle=0,this._screenQuaternion=new a.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){b._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,b._screenOrientationAngle=-a.Tools.ToRadians(b._screenOrientationAngle/2),b._screenQuaternion.copyFromFloats(0,Math.sin(b._screenOrientationAngle),0,Math.cos(b._screenOrientationAngle))},this._deviceOrientation=function(a){b._alpha=a.alpha,b._beta=a.beta,b._gamma=a.gamma},this._constantTranform=new a.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(b.prototype,"camera",{get:function(){return this._camera},set:function(b){this._camera=b,this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new a.Quaternion)},enumerable:!0,configurable:!0}),b.prototype.attachControl=function(a,b){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation)},b.prototype.detachControl=function(a){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},b.prototype.checkInputs=function(){a.Quaternion.RotationYawPitchRollToRef(a.Tools.ToRadians(this._alpha),a.Tools.ToRadians(this._beta),-a.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1},b.prototype.getTypeName=function(){return"FreeCameraDeviceOrientationInput"},b.prototype.getSimpleName=function(){return"deviceOrientation"},b}();a.FreeCameraDeviceOrientationInput=b,a.CameraInputTypes.FreeCameraDeviceOrientationInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._beta=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return a.prototype.attachControl=function(a,b){window.addEventListener("deviceorientation",this._deviceOrientationHandler)},a.prototype._onOrientationEvent=function(a){this.camera,this._alpha=a.alpha,this._beta=a.beta,this._gamma=a.gamma,this._dirty=!0},a.prototype.checkInputs=function(){if(this._dirty){this._dirty=!1;var a=this._gamma;a=0>a?90+a:270-a,this.camera.rotation.x=this.gammaCorrection*a/180*Math.PI,this.camera.rotation.y=this.alphaCorrection*-this._alpha/180*Math.PI,this.camera.rotation.z=this.betaCorrection*this._beta/180*Math.PI}},a.prototype.detachControl=function(a){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},a.prototype.getTypeName=function(){return"FreeCameraVRDeviceOrientationInput"},a.prototype.getSimpleName=function(){return"VRDeviceOrientation"},a}();a.FreeCameraVRDeviceOrientationInput=b,a.CameraInputTypes.FreeCameraVRDeviceOrientationInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40}return b.prototype.attachControl=function(b,c){var d=this;this._gamepads=new a.Gamepads(function(a){d._onNewGameConnected(a)})},b.prototype.detachControl=function(a){this._gamepads&&this._gamepads.dispose(),this.gamepad=null},b.prototype.checkInputs=function(){if(this.gamepad){var b=this.camera,c=this.gamepad.leftStick,d=c.x/this.gamepadMoveSensibility,e=c.y/this.gamepadMoveSensibility;c.x=Math.abs(d)>.005?0+d:0,c.y=Math.abs(e)>.005?0+e:0;var f=this.gamepad.rightStick,g=f.x/this.gamepadAngularSensibility,h=f.y/this.gamepadAngularSensibility;f.x=Math.abs(g)>.001?0+g:0,f.y=Math.abs(h)>.001?0+h:0;var i=a.Matrix.RotationYawPitchRoll(b.rotation.y,b.rotation.x,0),j=50*b._computeLocalCameraSpeed(),k=a.Vector3.TransformCoordinates(new a.Vector3(c.x*j,0,-c.y*j),i);b.cameraDirection=b.cameraDirection.add(k),b.cameraRotation=b.cameraRotation.add(new a.Vector2(f.y,f.x))}},b.prototype._onNewGameConnected=function(a){0===a.index&&(this.gamepad=a)},b.prototype.getTypeName=function(){return"FreeCameraGamepadInput"},b.prototype.getSimpleName=function(){return"gamepad"},__decorate([a.serialize()],b.prototype,"gamepadAngularSensibility",void 0),__decorate([a.serialize()],b.prototype,"gamepadMoveSensibility",void 0),b}();a.FreeCameraGamepadInput=b,a.CameraInputTypes.FreeCameraGamepadInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._keys=[],this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return b.prototype.attachControl=function(b,c){var d=this;this._onKeyDown=function(a){if(-1!==d.keysUp.indexOf(a.keyCode)||-1!==d.keysDown.indexOf(a.keyCode)||-1!==d.keysLeft.indexOf(a.keyCode)||-1!==d.keysRight.indexOf(a.keyCode)){var b=d._keys.indexOf(a.keyCode);-1===b&&d._keys.push(a.keyCode),a.preventDefault&&(c||a.preventDefault())}},this._onKeyUp=function(a){if(-1!==d.keysUp.indexOf(a.keyCode)||-1!==d.keysDown.indexOf(a.keyCode)||-1!==d.keysLeft.indexOf(a.keyCode)||-1!==d.keysRight.indexOf(a.keyCode)){var b=d._keys.indexOf(a.keyCode);b>=0&&d._keys.splice(b,1),a.preventDefault&&(c||a.preventDefault())}},this._onLostFocus=function(){d._keys=[]},a.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},b.prototype.detachControl=function(b){a.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null,this._onLostFocus=null},b.prototype.checkInputs=function(){if(this._onKeyDown)for(var a=this.camera,b=0;b<this._keys.length;b++){var c=this._keys[b];-1!==this.keysLeft.indexOf(c)?a.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(c)?a.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(c)?a.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(c)&&(a.inertialBetaOffset+=.01)}},b.prototype.getTypeName=function(){return"ArcRotateCameraKeyboardMoveInput"},b.prototype.getSimpleName=function(){return"keyboard"},__decorate([a.serialize()],b.prototype,"keysUp",void 0),__decorate([a.serialize()],b.prototype,"keysDown",void 0),__decorate([a.serialize()],b.prototype,"keysLeft",void 0),__decorate([a.serialize()],b.prototype,"keysRight",void 0),b}();a.ArcRotateCameraKeyboardMoveInput=b,a.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.wheelPrecision=3}return b.prototype.attachControl=function(b,c){var d=this;this._wheel=function(b,e){if(b.type===a.PointerEventTypes.POINTERWHEEL){var f=b.event,g=0;f.wheelDelta?g=f.wheelDelta/(40*d.wheelPrecision):f.detail&&(g=-f.detail/d.wheelPrecision),g&&(d.camera.inertialRadiusOffset+=g),f.preventDefault&&(c||f.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,a.PointerEventTypes.POINTERWHEEL)},b.prototype.detachControl=function(a){this._observer&&a&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},b.prototype.getTypeName=function(){return"ArcRotateCameraMouseWheelInput"},b.prototype.getSimpleName=function(){return"mousewheel"},__decorate([a.serialize()],b.prototype,"wheelPrecision",void 0),b}();a.ArcRotateCameraMouseWheelInput=b,a.CameraInputTypes.ArcRotateCameraMouseWheelInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=(a.Tools.GetPointerPrefix(),function(){function b(){this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=6,this.panningSensibility=50,this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0}return b.prototype.attachControl=function(b,c){var d,e,f,g=this,h=this.camera.getEngine(),i=0;this._pointerInput=function(b,h){var j=b.event;if(b.type===a.PointerEventTypes.POINTERDOWN){try{j.srcElement.setPointerCapture(j.pointerId)}catch(k){}g._isRightClick=2===j.button,d={x:j.clientX,y:j.clientY,pointerId:j.pointerId,type:j.pointerType},void 0===e?e=d:void 0===f&&(f=d),c||j.preventDefault()}else if(b.type===a.PointerEventTypes.POINTERUP){try{j.srcElement.releasePointerCapture(j.pointerId)}catch(k){}d=null,i=0,e=f=void 0,c||j.preventDefault()}else if(b.type===a.PointerEventTypes.POINTERMOVE)if(c||j.preventDefault(),e&&void 0===f){if(0!==g.panningSensibility&&(g._isCtrlPushed&&g.camera._useCtrlForPanning||!g.camera._useCtrlForPanning&&g._isRightClick))g.camera.inertialPanningX+=-(j.clientX-d.x)/g.panningSensibility,g.camera.inertialPanningY+=(j.clientY-d.y)/g.panningSensibility;else{var l=j.clientX-d.x,m=j.clientY-d.y;g.camera.inertialAlphaOffset-=l/g.angularSensibilityX,g.camera.inertialBetaOffset-=m/g.angularSensibilityY}d.x=j.clientX,d.y=j.clientY}else if(e&&f){var n=e.pointerId===j.pointerId?e:f;n.x=j.clientX,n.y=j.clientY;var o=g.pinchInwards?1:-1,p=e.x-f.x,q=e.y-f.y,r=p*p+q*q;if(0===i)return void(i=r);r!==i&&(g.camera.inertialRadiusOffset+=(r-i)/(g.pinchPrecision*((g.angularSensibilityX+g.angularSensibilityY)/2)*o),i=r)}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,a.PointerEventTypes.POINTERDOWN|a.PointerEventTypes.POINTERUP|a.PointerEventTypes.POINTERMOVE),this._onContextMenu=function(a){a.preventDefault()},this.camera._useCtrlForPanning||b.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){e=f=void 0,i=0,d=null},this._onKeyDown=function(a){g._isCtrlPushed=a.ctrlKey},this._onKeyUp=function(a){g._isCtrlPushed=a.ctrlKey},this._onMouseMove=function(a){if(h.isPointerLock){var b=a.movementX||a.mozMovementX||a.webkitMovementX||a.msMovementX||0,d=a.movementY||a.mozMovementY||a.webkitMovementY||a.msMovementY||0;g.camera.inertialAlphaOffset-=b/g.angularSensibilityX,g.camera.inertialBetaOffset-=d/g.angularSensibilityY,c||a.preventDefault()}},this._onGestureStart=function(a){void 0!==window.MSGesture&&(g._MSGestureHandler||(g._MSGestureHandler=new MSGesture,g._MSGestureHandler.target=b),g._MSGestureHandler.addPointer(a.pointerId))},this._onGesture=function(a){g.camera.radius*=a.scale,a.preventDefault&&(c||(a.stopPropagation(),a.preventDefault()))},b.addEventListener("mousemove",this._onMouseMove,!1),b.addEventListener("MSPointerDown",this._onGestureStart,!1),b.addEventListener("MSGestureChange",this._onGesture,!1),a.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},b.prototype.detachControl=function(b){b&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,b.removeEventListener("contextmenu",this._onContextMenu),b.removeEventListener("mousemove",this._onMouseMove),b.removeEventListener("MSPointerDown",this._onGestureStart),b.removeEventListener("MSGestureChange",this._onGesture),this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0,this._onKeyDown=null,this._onKeyUp=null,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null),a.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},b.prototype.getTypeName=function(){return"ArcRotateCameraPointersInput"},b.prototype.getSimpleName=function(){return"pointers"},__decorate([a.serialize()],b.prototype,"angularSensibilityX",void 0),__decorate([a.serialize()],b.prototype,"angularSensibilityY",void 0),__decorate([a.serialize()],b.prototype,"pinchPrecision",void 0),__decorate([a.serialize()],b.prototype,"panningSensibility",void 0),b}());a.ArcRotateCameraPointersInput=b,a.CameraInputTypes.ArcRotateCameraPointersInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return b.prototype.attachControl=function(b,c){var d=this;this._gamepads=new a.Gamepads(function(a){d._onNewGameConnected(a)})},b.prototype.detachControl=function(a){this._gamepads&&this._gamepads.dispose(),this.gamepad=null},b.prototype.checkInputs=function(){if(this.gamepad){var a=this.camera,b=this.gamepad.rightStick;if(0!=b.x){var c=b.x/this.gamepadRotationSensibility;0!=c&&Math.abs(c)>.005&&(a.inertialAlphaOffset+=c)}if(0!=b.y){var d=b.y/this.gamepadRotationSensibility;0!=d&&Math.abs(d)>.005&&(a.inertialBetaOffset+=d)}var e=this.gamepad.leftStick;if(0!=e.y){var f=e.y/this.gamepadMoveSensibility;0!=f&&Math.abs(f)>.005&&(this.camera.inertialRadiusOffset-=f)}}},b.prototype._onNewGameConnected=function(a){0===a.index&&(this.gamepad=a)},b.prototype.getTypeName=function(){return"ArcRotateCameraGamepadInput"},b.prototype.getSimpleName=function(){return"gamepad"},__decorate([a.serialize()],b.prototype,"gamepadRotationSensibility",void 0),__decorate([a.serialize()],b.prototype,"gamepadMoveSensibility",void 0),b}();a.ArcRotateCameraGamepadInput=b,a.CameraInputTypes.ArcRotateCameraGamepadInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._beta=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return a.prototype.attachControl=function(a,b){this.camera.attachControl(a,b),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},a.prototype._onOrientationEvent=function(a){this.camera,this._alpha=0|+a.alpha,this._beta=0|+a.beta,this._gamma=0|+a.gamma,this._dirty=!0},a.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},a.prototype.detachControl=function(a){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},a.prototype.getTypeName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},a.prototype.getSimpleName=function(){return"VRDeviceOrientation"},a}();a.ArcRotateCameraVRDeviceOrientationInput=b,a.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e){b.call(this,c,d,e),this.cameraDirection=new a.Vector3(0,0,0),this.cameraRotation=new a.Vector2(0,0),this.rotation=new a.Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.lockedTarget=null,this._currentTarget=a.Vector3.Zero(),this._viewMatrix=a.Matrix.Zero(),this._camMatrix=a.Matrix.Zero(),this._cameraTransformMatrix=a.Matrix.Zero(),this._cameraRotationMatrix=a.Matrix.Zero(),this._referencePoint=new a.Vector3(0,0,1),this._defaultUpVector=new a.Vector3(0,1,0),this._transformedReferencePoint=a.Vector3.Zero(),this._lookAtTemp=a.Matrix.Zero(),this._tempMatrix=a.Matrix.Zero()}return __extends(c,b),c.prototype.getFrontPosition=function(a){var b=this.getTarget().subtract(this.position);return b.normalize(),b.scaleInPlace(a),this.globalPosition.add(b)},c.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},c.prototype._initCache=function(){b.prototype._initCache.call(this),this._cache.lockedTarget=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new a.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},c.prototype._updateCache=function(a){a||b.prototype._updateCache.call(this);var c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},c.prototype._isSynchronizedViewMatrix=function(){if(!b.prototype._isSynchronizedViewMatrix.call(this))return!1;var a=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(a):!a)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},c.prototype._computeLocalCameraSpeed=function(){var a=this.getEngine();return this.speed*(a.getDeltaTime()/(10*a.getFps()))},c.prototype.setTarget=function(b){this.upVector.normalize(),a.Matrix.LookAtLHToRef(this.position,b,this._defaultUpVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var c=b.subtract(this.position);c.x>=0?this.rotation.y=-Math.atan(c.z/c.x)+Math.PI/2:this.rotation.y=-Math.atan(c.z/c.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&a.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},c.prototype.getTarget=function(){return this._currentTarget},c.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},c.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},c.prototype._checkInputs=function(){var c=this._decideIfNeedsToMove(),d=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(c&&this._updatePosition(),d&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var e=Math.PI/2*.95;this.rotation.x>e&&(this.rotation.x=e),this.rotation.x<-e&&(this.rotation.x=-e)}c&&(Math.abs(this.cameraDirection.x)<a.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<a.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<a.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),d&&(Math.abs(this.cameraRotation.x)<a.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<a.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),b.prototype._checkInputs.call(this)},c.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix),a.Vector3.TransformNormalToRef(this._defaultUpVector,this._cameraRotationMatrix,this.upVector)):a.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},c.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(this._updateCameraRotationMatrix(),a.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),a.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},c.prototype.createRigCamera=function(b,d){if(this.cameraRigMode!==a.Camera.RIG_MODE_NONE){var e=new c(b,this.position.clone(),this.getScene());return this.cameraRigMode===a.Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new a.Quaternion),e._cameraRigParams={},e.rotationQuaternion=new a.Quaternion),e}return null},c.prototype._updateRigCameras=function(){var c=this._rigCameras[0],d=this._rigCameras[1];switch(this.cameraRigMode){case a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var e=this.cameraRigMode===a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,f=this.cameraRigMode===a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*e,c.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*f,d.position),c.setTarget(this.getTarget()),d.setTarget(this.getTarget());break;case a.Camera.RIG_MODE_VR:c.rotationQuaternion.copyFrom(this.rotationQuaternion),d.rotationQuaternion.copyFrom(this.rotationQuaternion),c.position.copyFrom(this.position),d.position.copyFrom(this.position)}b.prototype._updateRigCameras.call(this)},c.prototype._getRigCamPosition=function(b,c){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new a.Matrix);var d=this.getTarget();a.Matrix.Translation(-d.x,-d.y,-d.z).multiplyToRef(a.Matrix.RotationY(b),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(a.Matrix.Translation(d.x,d.y,d.z)),a.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,c)},c.prototype.getTypeName=function(){return"TargetCamera"},__decorate([a.serializeAsVector3()],c.prototype,"rotation",void 0),__decorate([a.serialize()],c.prototype,"speed",void 0),__decorate([a.serializeAsMeshReference("lockedTargetId")],c.prototype,"lockedTarget",void 0),c}(a.Camera);a.TargetCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e){var f=this;b.call(this,c,d,e),this.ellipsoid=new a.Vector3(.5,1,.5),this.checkCollisions=!1,this.applyGravity=!1,this._collider=new a.Collider,this._needMoveForGravity=!1,
this._oldPosition=a.Vector3.Zero(),this._diffPosition=a.Vector3.Zero(),this._newPosition=a.Vector3.Zero(),this._onCollisionPositionChange=function(b,c,d){void 0===d&&(d=null),f.getScene().workerCollisions&&c.multiplyInPlace(f._collider.radius);var e=function(b){f._newPosition.copyFrom(b),f._newPosition.subtractToRef(f._oldPosition,f._diffPosition),f.position.clone(),f._diffPosition.length()>a.Engine.CollisionsEpsilon&&(f.position.addInPlace(f._diffPosition),f.onCollide&&d&&f.onCollide(d))};e(c)},this.inputs=new a.FreeCameraInputsManager(this),this.inputs.addKeyboard().addMouse()}return __extends(c,b),Object.defineProperty(c.prototype,"angularSensibility",{get:function(){var a=this.inputs.attached.mouse;return a?a.angularSensibility:void 0},set:function(a){var b=this.inputs.attached.mouse;b&&(b.angularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysRight=a)},enumerable:!0,configurable:!0}),c.prototype.attachControl=function(a,b){this.inputs.attachElement(a,b)},c.prototype.detachControl=function(b){this.inputs.detachElement(b),this.cameraDirection=new a.Vector3(0,0,0),this.cameraRotation=new a.Vector2(0,0)},c.prototype._collideWithWorld=function(b){var c;c=this.parent?a.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,c.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid;var d=b;this.applyGravity&&(d=b.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,d,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},c.prototype._checkInputs=function(){this._localDirection||(this._localDirection=a.Vector3.Zero(),this._transformedDirection=a.Vector3.Zero()),this.inputs.checkInputs(),b.prototype._checkInputs.call(this)},c.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},c.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},c.prototype.dispose=function(){this.inputs.clear(),b.prototype.dispose.call(this)},c.prototype.getTypeName=function(){return"FreeCamera"},__decorate([a.serializeAsVector3()],c.prototype,"ellipsoid",void 0),__decorate([a.serialize()],c.prototype,"checkCollisions",void 0),__decorate([a.serialize()],c.prototype,"applyGravity",void 0),c}(a.TargetCamera);a.FreeCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a){b.call(this,a)}return __extends(c,b),c.prototype.addKeyboard=function(){return this.add(new a.FreeCameraKeyboardMoveInput),this},c.prototype.addMouse=function(b){return void 0===b&&(b=!0),this.add(new a.FreeCameraMouseInput(b)),this},c.prototype.addGamepad=function(){return this.add(new a.FreeCameraGamepadInput),this},c.prototype.addDeviceOrientation=function(){return this.add(new a.FreeCameraDeviceOrientationInput),this},c.prototype.addVRDeviceOrientation=function(){return this.add(new a.FreeCameraVRDeviceOrientationInput),this},c.prototype.addTouch=function(){return this.add(new a.FreeCameraTouchInput),this},c.prototype.addVirtualJoystick=function(){return this.add(new a.FreeCameraVirtualJoystickInput),this},c}(a.CameraInputsManager);a.FreeCameraInputsManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d,e){b.call(this,a,c,d),this.radius=12,this.rotationOffset=0,this.heightOffset=4,this.cameraAcceleration=.05,this.maxCameraSpeed=20,this.target=e}return __extends(c,b),c.prototype.getRadians=function(a){return a*Math.PI/180},c.prototype.follow=function(b){if(b){var c;if(b.rotationQuaternion){var d=new a.Matrix;b.rotationQuaternion.toRotationMatrix(d),c=Math.atan2(d.m[8],d.m[10])}else c=b.rotation.y;var e=this.getRadians(this.rotationOffset)+c,f=b.position.x+Math.sin(e)*this.radius,g=b.position.z+Math.cos(e)*this.radius,h=f-this.position.x,i=b.position.y+this.heightOffset-this.position.y,j=g-this.position.z,k=h*this.cameraAcceleration*2,l=i*this.cameraAcceleration,m=j*this.cameraAcceleration*2;(k>this.maxCameraSpeed||k<-this.maxCameraSpeed)&&(k=1>k?-this.maxCameraSpeed:this.maxCameraSpeed),(l>this.maxCameraSpeed||l<-this.maxCameraSpeed)&&(l=1>l?-this.maxCameraSpeed:this.maxCameraSpeed),(m>this.maxCameraSpeed||m<-this.maxCameraSpeed)&&(m=1>m?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new a.Vector3(this.position.x+k,this.position.y+l,this.position.z+m),this.setTarget(b.position)}},c.prototype._checkInputs=function(){b.prototype._checkInputs.call(this),this.follow(this.target)},c.prototype.getTypeName=function(){return"FollowCamera"},__decorate([a.serialize()],c.prototype,"radius",void 0),__decorate([a.serialize()],c.prototype,"rotationOffset",void 0),__decorate([a.serialize()],c.prototype,"heightOffset",void 0),__decorate([a.serialize()],c.prototype,"cameraAcceleration",void 0),__decorate([a.serialize()],c.prototype,"maxCameraSpeed",void 0),__decorate([a.serializeAsMeshReference("lockedTargetId")],c.prototype,"target",void 0),c}(a.TargetCamera);a.FollowCamera=b;var c=function(b){function c(c,d,e,f,g,h){b.call(this,c,a.Vector3.Zero(),h),this.alpha=d,this.beta=e,this.radius=f,this.target=g,this._cartesianCoordinates=a.Vector3.Zero(),this.follow()}return __extends(c,b),c.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta),this.position=this.target.position.add(this._cartesianCoordinates),this.setTarget(this.target.position)},c.prototype._checkInputs=function(){b.prototype._checkInputs.call(this),this.follow()},c.prototype.getTypeName=function(){return"ArcFollowCamera"},c}(a.TargetCamera);a.ArcFollowCamera=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.inputs.addTouch(),this._setupInputs()}return __extends(b,a),Object.defineProperty(b.prototype,"touchAngularSensibility",{get:function(){var a=this.inputs.attached.touch;return a?a.touchAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.touch;b&&(b.touchAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"touchMoveSensibility",{get:function(){var a=this.inputs.attached.touch;return a?a.touchMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.touch;b&&(b.touchMoveSensibility=a)},enumerable:!0,configurable:!0}),b.prototype.getTypeName=function(){return"TouchCamera"},b.prototype._setupInputs=function(){var a=this.inputs.attached.mouse;a&&(a.touchEnabled=!1)},b}(a.FreeCamera);a.TouchCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h){var i=this;b.call(this,c,a.Vector3.Zero(),h),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.zoomOnFactor=1,this.targetScreenOffset=a.Vector2.Zero(),this.allowUpsideDown=!0,this._viewMatrix=new a.Matrix,this.panningAxis=new a.Vector3(1,1,0),this.checkCollisions=!1,this.collisionRadius=new a.Vector3(.5,.5,.5),this._collider=new a.Collider,this._previousPosition=a.Vector3.Zero(),this._collisionVelocity=a.Vector3.Zero(),this._newPosition=a.Vector3.Zero(),this._onCollisionPositionChange=function(b,c,d){void 0===d&&(d=null),i.getScene().workerCollisions&&i.checkCollisions&&c.multiplyInPlace(i._collider.radius),d?(i.setPosition(c),i.onCollide&&i.onCollide(d)):i._previousPosition.copyFrom(i.position);var e=Math.cos(i.alpha),f=Math.sin(i.alpha),g=Math.cos(i.beta),h=Math.sin(i.beta);0===h&&(h=1e-4);var j=i._getTargetPosition();j.addToRef(new a.Vector3(i.radius*e*h,i.radius*g,i.radius*f*h),i._newPosition),i.position.copyFrom(i._newPosition);var k=i.upVector;i.allowUpsideDown&&i.beta<0&&(k=k.clone(),k=k.negate()),a.Matrix.LookAtLHToRef(i.position,j,k,i._viewMatrix),i._viewMatrix.m[12]+=i.targetScreenOffset.x,i._viewMatrix.m[13]+=i.targetScreenOffset.y,i._collisionTriggered=!1},g?this.target=g:this.target=a.Vector3.Zero(),this.alpha=d,this.beta=e,this.radius=f,this.getViewMatrix(),this.inputs=new a.ArcRotateCameraInputsManager(this),this.inputs.addKeyboard().addMouseWheel().addPointers().addGamepad()}return __extends(c,b),Object.defineProperty(c.prototype,"angularSensibilityX",{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityX:void 0},set:function(a){var b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"angularSensibilityY",{get:function(){var a=this.inputs.attached.pointers;return a?a.angularSensibilityY:void 0},set:function(a){var b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pinchPrecision",{get:function(){var a=this.inputs.attached.pointers;return a?a.pinchPrecision:void 0},set:function(a){var b=this.inputs.attached.pointers;b&&(b.pinchPrecision=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"panningSensibility",{get:function(){var a=this.inputs.attached.pointers;return a?a.panningSensibility:void 0},set:function(a){var b=this.inputs.attached.pointers;b&&(b.panningSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysUp",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysUp:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysUp=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysDown",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysDown:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysDown=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysLeft",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysLeft:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysLeft=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"keysRight",{get:function(){var a=this.inputs.attached.keyboard;return a?a.keysRight:void 0},set:function(a){var b=this.inputs.attached.keyboard;b&&(b.keysRight=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"wheelPrecision",{get:function(){var a=this.inputs.attached.mousewheel;return a?a.wheelPrecision:void 0},set:function(a){var b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=a)},enumerable:!0,configurable:!0}),c.prototype._initCache=function(){b.prototype._initCache.call(this),this._cache.target=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=a.Vector2.Zero()},c.prototype._updateCache=function(a){a||b.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},c.prototype._getTargetPosition=function(){return this.target.getAbsolutePosition?this.target.getAbsolutePosition():this.target},c.prototype._isSynchronizedViewMatrix=function(){return b.prototype._isSynchronizedViewMatrix.call(this)?this._cache.target.equals(this.target)&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},c.prototype.attachControl=function(a,b,c){var d=this;void 0===c&&(c=!0),this._useCtrlForPanning=c,this.inputs.attachElement(a,b),this._reset=function(){d.inertialAlphaOffset=0,d.inertialBetaOffset=0,d.inertialRadiusOffset=0}},c.prototype.detachControl=function(a){this.inputs.detachElement(a),this._reset&&this._reset()},c.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<a.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<a.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<a.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=a.Vector3.Zero(),this._transformedDirection=a.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,Math.abs(this.inertialPanningX)<a.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<a.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),a.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this.target.getAbsolutePosition||this.target.addInPlace(this._transformedDirection)),this._checkLimits(),b.prototype._checkInputs.call(this))},c.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},c.prototype.rebuildAnglesAndRadius=function(){var a=this.position.subtract(this._getTargetPosition());this.radius=a.length(),this.alpha=Math.acos(a.x/Math.sqrt(Math.pow(a.x,2)+Math.pow(a.z,2))),a.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(a.y/this.radius),this._checkLimits()},c.prototype.setPosition=function(a){this.position.equals(a)||(this.position=a,this.rebuildAnglesAndRadius())},c.prototype.setTarget=function(a){this._getTargetPosition().equals(a)||(this.target=a,this.rebuildAnglesAndRadius())},c.prototype._getViewMatrix=function(){var b=Math.cos(this.alpha),c=Math.sin(this.alpha),d=Math.cos(this.beta),e=Math.sin(this.beta);0===e&&(e=1e-4);var f=this._getTargetPosition();if(f.addToRef(new a.Vector3(this.radius*b*e,this.radius*d,this.radius*c*e),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var g=this.upVector;this.allowUpsideDown&&this.beta<0&&(g=g.clone(),g=g.negate()),a.Matrix.LookAtLHToRef(this.position,f,g,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._viewMatrix},c.prototype.zoomOn=function(b,c){void 0===c&&(c=!1),b=b||this.getScene().meshes;var d=a.Mesh.MinMax(b),e=a.Vector3.Distance(d.min,d.max);this.radius=e*this.zoomOnFactor,this.focusOn({min:d.min,max:d.max,distance:e},c)},c.prototype.focusOn=function(b,c){void 0===c&&(c=!1);var d,e;void 0===b.min?(d=b||this.getScene().meshes,d=a.Mesh.MinMax(d),e=a.Vector3.Distance(d.min,d.max)):(d=b,e=b.distance),this.target=a.Mesh.Center(d),c||(this.maxZ=2*e)},c.prototype.createRigCamera=function(b,d){var e;switch(this.cameraRigMode){case a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.Camera.RIG_MODE_VR:e=this._cameraRigParams.stereoHalfAngle*(0===d?1:-1);break;case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===d?-1:1)}var f=new c(b,this.alpha+e,this.beta,this.radius,this.target,this.getScene());return f._cameraRigParams={},f},c.prototype._updateRigCameras=function(){var c=this._rigCameras[0],d=this._rigCameras[1];switch(c.beta=d.beta=this.beta,c.radius=d.radius=this.radius,this.cameraRigMode){case a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case a.Camera.RIG_MODE_VR:c.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:c.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}b.prototype._updateRigCameras.call(this)},c.prototype.dispose=function(){this.inputs.clear(),b.prototype.dispose.call(this)},c.prototype.getTypeName=function(){return"ArcRotateCamera"},__decorate([a.serialize()],c.prototype,"alpha",void 0),__decorate([a.serialize()],c.prototype,"beta",void 0),__decorate([a.serialize()],c.prototype,"radius",void 0),__decorate([a.serializeAsVector3()],c.prototype,"target",void 0),__decorate([a.serialize()],c.prototype,"inertialAlphaOffset",void 0),__decorate([a.serialize()],c.prototype,"inertialBetaOffset",void 0),__decorate([a.serialize()],c.prototype,"inertialRadiusOffset",void 0),__decorate([a.serialize()],c.prototype,"lowerAlphaLimit",void 0),__decorate([a.serialize()],c.prototype,"upperAlphaLimit",void 0),__decorate([a.serialize()],c.prototype,"lowerBetaLimit",void 0),__decorate([a.serialize()],c.prototype,"upperBetaLimit",void 0),__decorate([a.serialize()],c.prototype,"lowerRadiusLimit",void 0),__decorate([a.serialize()],c.prototype,"upperRadiusLimit",void 0),__decorate([a.serialize()],c.prototype,"inertialPanningX",void 0),__decorate([a.serialize()],c.prototype,"inertialPanningY",void 0),__decorate([a.serialize()],c.prototype,"zoomOnFactor",void 0),__decorate([a.serialize()],c.prototype,"allowUpsideDown",void 0),c}(a.TargetCamera);a.ArcRotateCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a){b.call(this,a)}return __extends(c,b),c.prototype.addMouseWheel=function(){return this.add(new a.ArcRotateCameraMouseWheelInput),this},c.prototype.addPointers=function(){return this.add(new a.ArcRotateCameraPointersInput),this},c.prototype.addKeyboard=function(){return this.add(new a.ArcRotateCameraKeyboardMoveInput),this},c.prototype.addGamepad=function(){return this.add(new a.ArcRotateCameraGamepadInput),this},c.prototype.addVRDeviceOrientation=function(){return this.add(new a.ArcRotateCameraVRDeviceOrientationInput),this},c}(a.CameraInputsManager);a.ArcRotateCameraInputsManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a){this._renderingGroups=new Array,this._scene=a}return b.prototype._renderParticles=function(b,c){if(0!==this._scene._activeParticleSystems.length){for(var d=this._scene.activeCamera,e=a.Tools.Now,f=0;f<this._scene._activeParticleSystems.length;f++){var g=this._scene._activeParticleSystems.data[f];g.renderingGroupId===b&&0!==(d.layerMask&g.layerMask)&&(this._clearDepthBuffer(),g.emitter.position&&c&&-1===c.indexOf(g.emitter)||(this._scene._activeParticles+=g.render()))}this._scene._particlesDuration+=a.Tools.Now-e}},b.prototype._renderSprites=function(b){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var c=this._scene.activeCamera,d=a.Tools.Now,e=0;e<this._scene.spriteManagers.length;e++){var f=this._scene.spriteManagers[e];f.renderingGroupId===b&&0!==(c.layerMask&f.layerMask)&&(this._clearDepthBuffer(),f.render())}this._scene._spritesDuration+=a.Tools.Now-d}},b.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},b.prototype._renderSpritesAndParticles=function(){this._currentRenderSprites&&this._renderSprites(this._currentIndex),this._currentRenderParticles&&this._renderParticles(this._currentIndex,this._currentActiveMeshes)},b.prototype.render=function(a,c,d,e){this._currentActiveMeshes=c,this._currentRenderParticles=d,this._currentRenderSprites=e;for(var f=0;f<b.MAX_RENDERINGGROUPS;f++){this._depthBufferAlreadyCleaned=0==f;var g=this._renderingGroups[f],h=!1;this._currentIndex=f,g?(this._clearDepthBuffer(),g.onBeforeTransparentRendering||(g.onBeforeTransparentRendering=this._renderSpritesAndParticles.bind(this)),g.render(a)||(this._renderingGroups.splice(f,1),h=!0,this._renderSpritesAndParticles())):this._renderSpritesAndParticles(),h&&f--}},b.prototype.reset=function(){this._renderingGroups.forEach(function(a,b,c){a&&a.prepare()})},b.prototype.dispatch=function(b){var c=b.getMesh(),d=c.renderingGroupId||0;this._renderingGroups[d]||(this._renderingGroups[d]=new a.RenderingGroup(d,this._scene)),this._renderingGroups[d].dispatch(b)},b.MAX_RENDERINGGROUPS=4,b}();a.RenderingManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){this.index=b,this._opaqueSubMeshes=new a.SmartArray(256),this._transparentSubMeshes=new a.SmartArray(256),this._alphaTestSubMeshes=new a.SmartArray(256),this._scene=c}return b.prototype.render=function(b){if(b)return b(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),!1;var c,d,e=this._scene.getEngine();for(c=0;c<this._opaqueSubMeshes.length;c++)d=this._opaqueSubMeshes.data[c],d.render(!1);for(e.setAlphaTesting(!0),c=0;c<this._alphaTestSubMeshes.length;c++)d=this._alphaTestSubMeshes.data[c],d.render(!1);if(e.setAlphaTesting(!1),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length){for(c=0;c<this._transparentSubMeshes.length;c++)d=this._transparentSubMeshes.data[c],d._alphaIndex=d.getMesh().alphaIndex,d._distanceToCamera=d.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();var f=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(f.sort(function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<b._alphaIndex?-1:a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0}),c=0;c<f.length;c++)d=f[c],d.render(!0);e.setAlphaMode(a.Engine.ALPHA_DISABLE)}return!0},b.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},b.prototype.dispatch=function(a){var b=a.getMaterial(),c=a.getMesh();b.needAlphaBlending()||c.visibility<1||c.hasVertexAlpha?this._transparentSubMeshes.push(a):b.needAlphaTesting()?this._alphaTestSubMeshes.push(a):this._opaqueSubMeshes.push(a)},b}();a.RenderingGroup=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"POINTERDOWN",{get:function(){return a._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(a,"POINTERUP",{get:function(){return a._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(a,"POINTERMOVE",{get:function(){return a._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(a,"POINTERWHEEL",{get:function(){return a._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(a,"POINTERPICK",{get:function(){return a._POINTERPICK},enumerable:!0,configurable:!0}),a._POINTERDOWN=1,a._POINTERUP=2,a._POINTERMOVE=4,a._POINTERWHEEL=8,a._POINTERPICK=16,a}();a.PointerEventTypes=b;var c=function(){function a(a,b){this.type=a,this.event=b}return a}();a.PointerInfoBase=c;var d=function(b){function c(c,d,e,f){b.call(this,c,d),this.skipOnPointerObservable=!1,this.localPosition=new a.Vector2(e,f)}return __extends(c,b),c}(c);a.PointerInfoPre=d;var e=function(a){function b(b,c,d){a.call(this,b,c),this.pickInfo=d}return __extends(b,a),b}(c);a.PointerInfo=e;var f=function(){function c(b){this.autoClear=!0,this.clearColor=new a.Color3(.2,.2,.3),this.ambientColor=new a.Color3(0,0,0),this.forceWireframe=!1,this.forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.constantlyUpdateMeshUnderPointer=!1,this.onDisposeObservable=new a.Observable,this.onBeforeRenderObservable=new a.Observable,this.onAfterRenderObservable=new a.Observable,this.onReadyObservable=new a.Observable,this.onBeforeCameraRenderObservable=new a.Observable,this.onAfterCameraRenderObservable=new a.Observable,this.onNewCameraAddedObservable=new a.Observable,this.onCameraRemovedObservable=new a.Observable,this.onNewLightAddedObservable=new a.Observable,this.onLightRemovedObservable=new a.Observable,this.onNewGeometryAddedObservable=new a.Observable,this.onGeometryRemovedObservable=new a.Observable,this.onNewMeshAddedObservable=new a.Observable,this.onMeshRemovedObservable=new a.Observable,this.animations=[],this.onPrePointerObservable=new a.Observable,this.onPointerObservable=new a.Observable,this.cameraToUseForPointers=null,this._startingPointerPosition=new a.Vector2(0,0),this._startingPointerTime=0,this.fogEnabled=!0,this.fogMode=c.FOGMODE_NONE,this.fogColor=new a.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.shadowsEnabled=!0,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new a.StandardMaterial("default material",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.skeletonsEnabled=!0,this.skeletons=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new a.Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this.probesEnabled=!0,this.reflectionProbes=new Array,this._actionManagers=new Array,this._meshesForIntersections=new a.SmartArray(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=0,this._activeIndices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._intermediateRendering=!1,this._toBeDisposed=new a.SmartArray(256),this._pendingData=[],this._activeMeshes=new a.SmartArray(256),this._processedMaterials=new a.SmartArray(256),this._renderTargets=new a.SmartArray(256),this._activeParticleSystems=new a.SmartArray(256),this._activeSkeletons=new a.SmartArray(32),this._softwareSkinnedMeshes=new a.SmartArray(32),this._activeBones=0,this._activeAnimatables=new Array,this._transformMatrix=a.Matrix.Zero(),this._edgesRenderers=new a.SmartArray(16),this._uniqueIdCounter=0,this._engine=b,b.scenes.push(this),this._renderingManager=new a.RenderingManager(this),this.postProcessManager=new a.PostProcessManager(this),this.postProcessRenderPipelineManager=new a.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new a.BoundingBoxRenderer(this),a.OutlineRenderer&&(this._outlineRenderer=new a.OutlineRenderer(this)),this.attachControl(),a.SoundTrack&&(this.mainSoundTrack=new a.SoundTrack(this,{mainTrack:!0})),a.SimplificationQueue&&(this.simplificationQueue=new a.SimplificationQueue),this.workerCollisions=!1}return Object.defineProperty(c,"FOGMODE_NONE",{get:function(){return c._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOGMODE_EXP",{get:function(){return c._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOGMODE_EXP2",{get:function(){return c._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FOGMODE_LINEAR",{get:function(){return c._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"beforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"afterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"beforeCameraRender",{set:function(a){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"afterCameraRender",{set:function(a){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"unTranslatedPointer",{get:function(){return new a.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new a.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(b){b=b&&!!Worker,this._workerCollisions=b,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=b?new a.CollisionCoordinatorWorker:new a.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"SelectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,
configurable:!0}),Object.defineProperty(c.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),c.prototype.getCachedMaterial=function(){return this._cachedMaterial},c.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},c.prototype.getOutlineRenderer=function(){return this._outlineRenderer},c.prototype.getEngine=function(){return this._engine},c.prototype.getTotalVertices=function(){return this._totalVertices},c.prototype.getActiveIndices=function(){return this._activeIndices},c.prototype.getActiveParticles=function(){return this._activeParticles},c.prototype.getActiveBones=function(){return this._activeBones},c.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},c.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},c.prototype.getActiveMeshes=function(){return this._activeMeshes},c.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},c.prototype.getRenderDuration=function(){return this._renderDuration},c.prototype.getParticlesDuration=function(){return this._particlesDuration},c.prototype.getSpritesDuration=function(){return this._spritesDuration},c.prototype.getAnimationRatio=function(){return this._animationRatio},c.prototype.getRenderId=function(){return this._renderId},c.prototype.incrementRenderId=function(){this._renderId++},c.prototype._updatePointerPosition=function(a){var b=this._engine.getRenderingCanvasClientRect();this._pointerX=a.clientX-b.left,this._pointerY=a.clientY-b.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},c.prototype.attachControl=function(c,f,g){var h=this;void 0===c&&(c=!0),void 0===f&&(f=!0),void 0===g&&(g=!0);var i=function(a){return a.isPickable&&a.actionManager&&a.actionManager.hasPointerTriggers};this._onPointerMove=function(a){if(h._updatePointerPosition(a),h.onPrePointerObservable.hasObservers()){var c="mousewheel"===a.type||"DOMMouseScroll"===a.type?b.POINTERWHEEL:b.POINTERMOVE,f=new d(c,a,h._unTranslatedPointerX,h._unTranslatedPointerY);if(h.onPrePointerObservable.notifyObservers(f,c),f.skipOnPointerObservable)return}if(h.cameraToUseForPointers||h.activeCamera){var g=h._engine.getRenderingCanvas();h.pointerMovePredicate||(h.pointerMovePredicate=function(a){return a.isPickable&&a.isVisible&&a.isReady()&&(h.constantlyUpdateMeshUnderPointer||null!==a.actionManager&&void 0!==a.actionManager)});var j=h.pick(h._unTranslatedPointerX,h._unTranslatedPointerY,h.pointerMovePredicate,!1,h.cameraToUseForPointers);if(j.hit&&j.pickedMesh?(h.setPointerOverSprite(null),h.setPointerOverMesh(j.pickedMesh),h._pointerOverMesh.actionManager&&h._pointerOverMesh.actionManager.hasPointerTriggers?g.style.cursor="pointer":g.style.cursor=""):(h.setPointerOverMesh(null),j=h.pickSprite(h._unTranslatedPointerX,h._unTranslatedPointerY,i,!1,h.cameraToUseForPointers),j.hit&&j.pickedSprite?(g.style.cursor="pointer",h.setPointerOverSprite(j.pickedSprite)):(h.setPointerOverSprite(null),g.style.cursor="")),h.onPointerMove&&h.onPointerMove(a,j),h.onPointerObservable.hasObservers()){var c="mousewheel"===a.type||"DOMMouseScroll"===a.type?b.POINTERWHEEL:b.POINTERMOVE,f=new e(c,a,j);h.onPointerObservable.notifyObservers(f,c)}}},this._onPointerDown=function(c){if(h._updatePointerPosition(c),h.onPrePointerObservable.hasObservers()){var f=b.POINTERDOWN,g=new d(f,c,h._unTranslatedPointerX,h._unTranslatedPointerY);if(h.onPrePointerObservable.notifyObservers(g,f),g.skipOnPointerObservable)return}if(h.cameraToUseForPointers||h.activeCamera){h._startingPointerPosition.x=h._pointerX,h._startingPointerPosition.y=h._pointerY,h._startingPointerTime=(new Date).getTime(),h.pointerDownPredicate||(h.pointerDownPredicate=function(a){return a.isPickable&&a.isVisible&&a.isReady()&&(!a.actionManager||a.actionManager.hasPointerTriggers)}),h._pickedDownMesh=null;var j=h.pick(h._unTranslatedPointerX,h._unTranslatedPointerY,h.pointerDownPredicate,!1,h.cameraToUseForPointers);if(j.hit&&j.pickedMesh&&j.pickedMesh.actionManager){if(h._pickedDownMesh=j.pickedMesh,j.pickedMesh.actionManager.hasPickTriggers){switch(c.button){case 0:j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnLeftPickTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c));break;case 1:j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnCenterPickTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c));break;case 2:j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnRightPickTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c))}j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnPickDownTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c))}if(j.pickedMesh.actionManager.hasSpecificTrigger(a.ActionManager.OnLongPressTrigger)){var k=h;window.setTimeout(function(){var b=k.pick(k._unTranslatedPointerX,k._unTranslatedPointerY,function(b){return b.isPickable&&b.isVisible&&b.isReady()&&b.actionManager&&b.actionManager.hasSpecificTrigger(a.ActionManager.OnLongPressTrigger)},!1,k.cameraToUseForPointers);b.hit&&b.pickedMesh&&b.pickedMesh.actionManager&&0!==k._startingPointerTime&&(new Date).getTime()-k._startingPointerTime>a.ActionManager.LongPressDelay&&Math.abs(k._startingPointerPosition.x-k._pointerX)<a.ActionManager.DragMovementThreshold&&Math.abs(k._startingPointerPosition.y-k._pointerY)<a.ActionManager.DragMovementThreshold&&(k._startingPointerTime=0,b.pickedMesh.actionManager.processTrigger(a.ActionManager.OnLongPressTrigger,a.ActionEvent.CreateNew(b.pickedMesh,c)))},a.ActionManager.LongPressDelay)}}if(h.onPointerDown&&h.onPointerDown(c,j),h.onPointerObservable.hasObservers()){var f=b.POINTERDOWN,g=new e(f,c,j);h.onPointerObservable.notifyObservers(g,f)}if(h._pickedDownSprite=null,h.spriteManagers.length>0&&(j=h.pickSprite(h._unTranslatedPointerX,h._unTranslatedPointerY,i,!1,h.cameraToUseForPointers),j.hit&&j.pickedSprite&&j.pickedSprite.actionManager)){switch(h._pickedDownSprite=j.pickedSprite,c.button){case 0:j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnLeftPickTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c));break;case 1:j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnCenterPickTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c));break;case 2:j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnRightPickTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c))}j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnPickDownTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c))}}},this._onPointerUp=function(c){if(h._updatePointerPosition(c),h.onPrePointerObservable.hasObservers()){var f=b.POINTERUP,g=new d(f,c,h._unTranslatedPointerX,h._unTranslatedPointerY);if(h.onPrePointerObservable.notifyObservers(g,f),g.skipOnPointerObservable)return}if(h.cameraToUseForPointers||h.activeCamera){h.pointerUpPredicate||(h.pointerUpPredicate=function(b){return b.isPickable&&b.isVisible&&b.isReady()&&(!b.actionManager||b.actionManager.hasPickTriggers||b.actionManager.hasSpecificTrigger(a.ActionManager.OnLongPressTrigger))});var j=h.pick(h._unTranslatedPointerX,h._unTranslatedPointerY,h.pointerUpPredicate,!1,h.cameraToUseForPointers);if(j.hit&&j.pickedMesh){if(null!=h._pickedDownMesh&&j.pickedMesh==h._pickedDownMesh&&(h.onPointerPick&&h.onPointerPick(c,j),h.onPointerObservable.hasObservers())){var f=b.POINTERPICK,g=new e(f,c,j);h.onPointerObservable.notifyObservers(g,f)}j.pickedMesh.actionManager&&(j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnPickUpTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c)),Math.abs(h._startingPointerPosition.x-h._pointerX)<a.ActionManager.DragMovementThreshold&&Math.abs(h._startingPointerPosition.y-h._pointerY)<a.ActionManager.DragMovementThreshold&&j.pickedMesh.actionManager.processTrigger(a.ActionManager.OnPickTrigger,a.ActionEvent.CreateNew(j.pickedMesh,c)))}if(h._pickedDownMesh&&h._pickedDownMesh!==j.pickedMesh&&h._pickedDownMesh.actionManager.processTrigger(a.ActionManager.OnPickOutTrigger,a.ActionEvent.CreateNew(h._pickedDownMesh,c)),h.onPointerUp&&h.onPointerUp(c,j),h.onPointerObservable.hasObservers()){var f=b.POINTERUP,g=new e(f,c,j);h.onPointerObservable.notifyObservers(g,f)}h._startingPointerTime=0,h.spriteManagers.length>0&&(j=h.pickSprite(h._unTranslatedPointerX,h._unTranslatedPointerY,i,!1,h.cameraToUseForPointers),j.hit&&j.pickedSprite&&j.pickedSprite.actionManager&&(j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnPickUpTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c)),Math.abs(h._startingPointerPosition.x-h._pointerX)<a.ActionManager.DragMovementThreshold&&Math.abs(h._startingPointerPosition.y-h._pointerY)<a.ActionManager.DragMovementThreshold&&j.pickedSprite.actionManager.processTrigger(a.ActionManager.OnPickTrigger,a.ActionEvent.CreateNewFromSprite(j.pickedSprite,h,c))),h._pickedDownSprite&&h._pickedDownSprite!==j.pickedSprite&&h._pickedDownSprite.actionManager.processTrigger(a.ActionManager.OnPickOutTrigger,a.ActionEvent.CreateNewFromSprite(h._pickedDownSprite,h,c)))}},this._onKeyDown=function(b){h.actionManager&&h.actionManager.processTrigger(a.ActionManager.OnKeyDownTrigger,a.ActionEvent.CreateNewFromScene(h,b))},this._onKeyUp=function(b){h.actionManager&&h.actionManager.processTrigger(a.ActionManager.OnKeyUpTrigger,a.ActionEvent.CreateNewFromScene(h,b))};var j=a.Tools.GetPointerPrefix();g&&(this._engine.getRenderingCanvas().addEventListener(j+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1)),f&&this._engine.getRenderingCanvas().addEventListener(j+"down",this._onPointerDown,!1),c&&this._engine.getRenderingCanvas().addEventListener(j+"up",this._onPointerUp,!1),a.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},c.prototype.detachControl=function(){var b=a.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(b+"move",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(b+"down",this._onPointerDown),this._engine.getRenderingCanvas().removeEventListener(b+"up",this._onPointerUp),this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",this._onPointerMove),a.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},c.prototype.isReady=function(){if(this._pendingData.length>0)return!1;var b;for(b=0;b<this._geometries.length;b++){var c=this._geometries[b];if(c.delayLoadState===a.Engine.DELAYLOADSTATE_LOADING)return!1}for(b=0;b<this.meshes.length;b++){var d=this.meshes[b];if(!d.isReady())return!1;var e=d.material;if(e&&!e.isReady(d))return!1}return!0},c.prototype.resetCachedMaterial=function(){this._cachedMaterial=null},c.prototype.registerBeforeRender=function(a){this.onBeforeRenderObservable.add(a)},c.prototype.unregisterBeforeRender=function(a){this.onBeforeRenderObservable.removeCallback(a)},c.prototype.registerAfterRender=function(a){this.onAfterRenderObservable.add(a)},c.prototype.unregisterAfterRender=function(a){this.onAfterRenderObservable.removeCallback(a)},c.prototype._addPendingData=function(a){this._pendingData.push(a)},c.prototype._removePendingData=function(a){var b=this._pendingData.indexOf(a);-1!==b&&this._pendingData.splice(b,1)},c.prototype.getWaitingItemsCount=function(){return this._pendingData.length},c.prototype.executeWhenReady=function(a){var b=this;this.onReadyObservable.add(a),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){b._checkIsReady()},150))},c.prototype._checkIsReady=function(){var a=this;return this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){a._checkIsReady()},150))},c.prototype.beginAnimation=function(b,c,d,e,f,g,h){if(void 0===f&&(f=1),this.stopAnimation(b),h||(h=new a.Animatable(this,b,c,d,e,f,g)),b.animations&&h.appendAnimations(b,b.animations),b.getAnimatables)for(var i=b.getAnimatables(),j=0;j<i.length;j++)this.beginAnimation(i[j],c,d,e,f,g,h);return h.reset(),h},c.prototype.beginDirectAnimation=function(b,c,d,e,f,g,h){void 0===g&&(g=1);var i=new a.Animatable(this,b,d,e,f,g,h,c);return i},c.prototype.getAnimatableByTarget=function(a){for(var b=0;b<this._activeAnimatables.length;b++)if(this._activeAnimatables[b].target===a)return this._activeAnimatables[b];return null},Object.defineProperty(c.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),c.prototype.stopAnimation=function(a){var b=this.getAnimatableByTarget(a);b&&b.stop()},c.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){if(!this._animationStartDate){if(this._pendingData.length>0)return;this._animationStartDate=a.Tools.Now}for(var b=a.Tools.Now,c=b-this._animationStartDate,d=0;d<this._activeAnimatables.length;d++)this._activeAnimatables[d]._animate(c)}},c.prototype.getViewMatrix=function(){return this._viewMatrix},c.prototype.getProjectionMatrix=function(){return this._projectionMatrix},c.prototype.getTransformMatrix=function(){return this._transformMatrix},c.prototype.setTransformMatrix=function(a,b){this._viewMatrix=a,this._projectionMatrix=b,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},c.prototype.addMesh=function(a){a.uniqueId=this._uniqueIdCounter++,this.meshes.push(a),this.collisionCoordinator.onMeshAdded(a),this.onNewMeshAddedObservable.notifyObservers(a)},c.prototype.removeMesh=function(a){var b=this.meshes.indexOf(a);return-1!==b&&this.meshes.splice(b,1),this.collisionCoordinator.onMeshRemoved(a),this.onMeshRemovedObservable.notifyObservers(a),b},c.prototype.removeSkeleton=function(a){var b=this.skeletons.indexOf(a);return-1!==b&&this.skeletons.splice(b,1),b},c.prototype.removeLight=function(a){var b=this.lights.indexOf(a);return-1!==b&&this.lights.splice(b,1),this.onLightRemovedObservable.notifyObservers(a),b},c.prototype.removeCamera=function(a){var b=this.cameras.indexOf(a);-1!==b&&this.cameras.splice(b,1);var c=this.activeCameras.indexOf(a);return-1!==c&&this.activeCameras.splice(c,1),this.activeCamera===a&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(a),b},c.prototype.addLight=function(a){a.uniqueId=this._uniqueIdCounter++,this.lights.push(a),this.onNewLightAddedObservable.notifyObservers(a)},c.prototype.addCamera=function(a){a.uniqueId=this._uniqueIdCounter++,this.cameras.push(a),this.onNewCameraAddedObservable.notifyObservers(a)},c.prototype.swithActiveCamera=function(a,b){void 0===b&&(b=!0);var c=this._engine.getRenderingCanvas();this.activeCamera.detachControl(c),this.activeCamera=a,b&&a.attachControl(c)},c.prototype.setActiveCameraByID=function(a){var b=this.getCameraByID(a);return b?(this.activeCamera=b,b):null},c.prototype.setActiveCameraByName=function(a){var b=this.getCameraByName(a);return b?(this.activeCamera=b,b):null},c.prototype.getMaterialByID=function(a){for(var b=0;b<this.materials.length;b++)if(this.materials[b].id===a)return this.materials[b];return null},c.prototype.getMaterialByName=function(a){for(var b=0;b<this.materials.length;b++)if(this.materials[b].name===a)return this.materials[b];return null},c.prototype.getLensFlareSystemByName=function(a){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].name===a)return this.lensFlareSystems[b];return null},c.prototype.getLensFlareSystemByID=function(a){for(var b=0;b<this.lensFlareSystems.length;b++)if(this.lensFlareSystems[b].id===a)return this.lensFlareSystems[b];return null},c.prototype.getCameraByID=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].id===a)return this.cameras[b];return null},c.prototype.getCameraByUniqueID=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].uniqueId===a)return this.cameras[b];return null},c.prototype.getCameraByName=function(a){for(var b=0;b<this.cameras.length;b++)if(this.cameras[b].name===a)return this.cameras[b];return null},c.prototype.getBoneByID=function(a){for(var b=0;b<this.skeletons.length;b++)for(var c=this.skeletons[b],d=0;d<c.bones.length;d++)if(c.bones[d].id===a)return c.bones[d];return null},c.prototype.getBoneByName=function(a){for(var b=0;b<this.skeletons.length;b++)for(var c=this.skeletons[b],d=0;d<c.bones.length;d++)if(c.bones[d].name===a)return c.bones[d];return null},c.prototype.getLightByName=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].name===a)return this.lights[b];return null},c.prototype.getLightByID=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].id===a)return this.lights[b];return null},c.prototype.getLightByUniqueID=function(a){for(var b=0;b<this.lights.length;b++)if(this.lights[b].uniqueId===a)return this.lights[b];return null},c.prototype.getParticleSystemByID=function(a){for(var b=0;b<this.particleSystems.length;b++)if(this.particleSystems[b].id===a)return this.particleSystems[b];return null},c.prototype.getGeometryByID=function(a){for(var b=0;b<this._geometries.length;b++)if(this._geometries[b].id===a)return this._geometries[b];return null},c.prototype.pushGeometry=function(a,b){return!b&&this.getGeometryByID(a.id)?!1:(this._geometries.push(a),this.collisionCoordinator.onGeometryAdded(a),this.onNewGeometryAddedObservable.notifyObservers(a),!0)},c.prototype.removeGeometry=function(a){var b=this._geometries.indexOf(a);return b>-1?(this._geometries.splice(b,1),this.collisionCoordinator.onGeometryDeleted(a),this.onGeometryRemovedObservable.notifyObservers(a),!0):!1},c.prototype.getGeometries=function(){return this._geometries},c.prototype.getMeshByID=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].id===a)return this.meshes[b];return null},c.prototype.getMeshesByID=function(a){return this.meshes.filter(function(b){return b.id===a})},c.prototype.getMeshByUniqueID=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].uniqueId===a)return this.meshes[b];return null},c.prototype.getLastMeshByID=function(a){for(var b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===a)return this.meshes[b];return null},c.prototype.getLastEntryByID=function(a){var b;for(b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===a)return this.meshes[b];for(b=this.cameras.length-1;b>=0;b--)if(this.cameras[b].id===a)return this.cameras[b];for(b=this.lights.length-1;b>=0;b--)if(this.lights[b].id===a)return this.lights[b];return null},c.prototype.getNodeByID=function(a){var b=this.getMeshByID(a);if(b)return b;var c=this.getLightByID(a);if(c)return c;var d=this.getCameraByID(a);if(d)return d;var e=this.getBoneByID(a);return e},c.prototype.getNodeByName=function(a){var b=this.getMeshByName(a);if(b)return b;var c=this.getLightByName(a);if(c)return c;var d=this.getCameraByName(a);if(d)return d;var e=this.getBoneByName(a);return e},c.prototype.getMeshByName=function(a){for(var b=0;b<this.meshes.length;b++)if(this.meshes[b].name===a)return this.meshes[b];return null},c.prototype.getSoundByName=function(b){var c;if(a.AudioEngine){for(c=0;c<this.mainSoundTrack.soundCollection.length;c++)if(this.mainSoundTrack.soundCollection[c].name===b)return this.mainSoundTrack.soundCollection[c];for(var d=0;d<this.soundTracks.length;d++)for(c=0;c<this.soundTracks[d].soundCollection.length;c++)if(this.soundTracks[d].soundCollection[c].name===b)return this.soundTracks[d].soundCollection[c]}return null},c.prototype.getLastSkeletonByID=function(a){for(var b=this.skeletons.length-1;b>=0;b--)if(this.skeletons[b].id===a)return this.skeletons[b];return null},c.prototype.getSkeletonById=function(a){for(var b=0;b<this.skeletons.length;b++)if(this.skeletons[b].id===a)return this.skeletons[b];return null},c.prototype.getSkeletonByName=function(a){for(var b=0;b<this.skeletons.length;b++)if(this.skeletons[b].name===a)return this.skeletons[b];return null},c.prototype.isActiveMesh=function(a){return-1!==this._activeMeshes.indexOf(a)},c.prototype._evaluateSubMesh=function(a,b){if(b.alwaysSelectAsActiveMesh||1===b.subMeshes.length||a.isInFrustum(this._frustumPlanes)){var c=a.getMaterial();b.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(a.getBoundingInfo().boundingBox),c&&(c.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(c)&&(this._processedMaterials.push(c),this._renderTargets.concatWithNoDuplicate(c.getRenderTargetTextures())),this._activeIndices+=a.indexCount,this._renderingManager.dispatch(a))}},c.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},c.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._boundingBoxRenderer.reset(),this._edgesRenderers.reset(),this._frustumPlanes?a.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=a.Frustum.GetPlanes(this._transformMatrix);var b,c;if(this._selectionOctree){var d=this._selectionOctree.select(this._frustumPlanes);b=d.data,c=d.length}else c=this.meshes.length,b=this.meshes;for(var e=0;c>e;e++){var f=b[e];if(!f.isBlocked&&(this._totalVertices+=f.getTotalVertices(),f.isReady()&&f.isEnabled())){f.computeWorldMatrix(),f.actionManager&&f.actionManager.hasSpecificTriggers([a.ActionManager.OnIntersectionEnterTrigger,a.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(f);var g=f.getLOD(this.activeCamera);g&&(f._preActivate(),(f.alwaysSelectAsActiveMesh||f.isVisible&&f.visibility>0&&0!==(f.layerMask&this.activeCamera.layerMask)&&f.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(f),this.activeCamera._activeMeshes.push(f),f._activate(this._renderId),this._activeMesh(g)))}}var h=a.Tools.Now;if(this.particlesEnabled){a.Tools.StartPerformanceCounter("Particles",this.particleSystems.length>0);for(var i=0;i<this.particleSystems.length;i++){var j=this.particleSystems[i];j.isStarted()&&(!j.emitter.position||j.emitter&&j.emitter.isEnabled())&&(this._activeParticleSystems.push(j),j.animate())}a.Tools.EndPerformanceCounter("Particles",this.particleSystems.length>0)}this._particlesDuration+=a.Tools.Now-h},c.prototype._activeMesh=function(a){if(a.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(a.skeleton)&&a.skeleton.prepare(),a.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(a)),(a.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(a.getBoundingInfo().boundingBox),a._edgesRenderer&&this._edgesRenderers.push(a._edgesRenderer),a&&a.subMeshes){var b,c;if(a._submeshesOctree&&a.useOctreeForRenderingSelection){var d=a._submeshesOctree.select(this._frustumPlanes);b=d.length,c=d.data}else c=a.subMeshes,b=c.length;for(var e=0;b>e;e++){var f=c[e];this._evaluateSubMesh(f,a)}}},c.prototype.updateTransformMatrix=function(a){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(a))},c.prototype._renderForCamera=function(b){var c=this._engine;if(this.activeCamera=b,!this.activeCamera)throw new Error("Active camera not set");a.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name),c.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);var d=a.Tools.Now;a.Tools.StartPerformanceCounter("Active meshes evaluation"),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=a.Tools.Now-d,a.Tools.EndPerformanceCounter("Active meshes evaluation");for(var e=0;e<this._softwareSkinnedMeshes.length;e++){var f=this._softwareSkinnedMeshes.data[e];f.applySkeleton(f.skeleton)}var g=a.Tools.Now;if(this.renderTargetsEnabled&&this._renderTargets.length>0){this._intermediateRendering=!0,a.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var h=0;h<this._renderTargets.length;h++){var i=this._renderTargets.data[h];if(i._shouldRender()){this._renderId++;var j=i.activeCamera&&i.activeCamera!==this.activeCamera;i.render(j,this.dumpNextRenderTargets)}}a.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._intermediateRendering=!1,this._renderId++,c.restoreDefaultFramebuffer()}this._renderTargetsDuration+=a.Tools.Now-g,this.postProcessManager._prepareFrame();var k,l,m=a.Tools.Now;if(this.layers.length){for(c.setDepthBuffer(!1),k=0;k<this.layers.length;k++)l=this.layers[k],l.isBackground&&l.render();c.setDepthBuffer(!0)}a.Tools.StartPerformanceCounter("Main render"),this._renderingManager.render(null,null,!0,!0),a.Tools.EndPerformanceCounter("Main render"),this._boundingBoxRenderer.render();for(var n=0;n<this._edgesRenderers.length;n++)this._edgesRenderers.data[n].render();if(this.lensFlaresEnabled){a.Tools.StartPerformanceCounter("Lens flares",this.lensFlareSystems.length>0);for(var o=0;o<this.lensFlareSystems.length;o++){var p=this.lensFlareSystems[o];0!==(b.layerMask&p.layerMask)&&p.render()}a.Tools.EndPerformanceCounter("Lens flares",this.lensFlareSystems.length>0)}if(this.layers.length){for(c.setDepthBuffer(!1),k=0;k<this.layers.length;k++)l=this.layers[k],l.isBackground||l.render();c.setDepthBuffer(!0)}this._renderDuration+=a.Tools.Now-m,this.postProcessManager._finalizeFrame(b.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera),a.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)},c.prototype._processSubCameras=function(b){if(b.cameraRigMode===a.Camera.RIG_MODE_NONE)return void this._renderForCamera(b);for(var c=0;c<b._rigCameras.length;c++)this._renderForCamera(b._rigCameras[c]);this.activeCamera=b,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},c.prototype._checkIntersections=function(){for(var b=0;b<this._meshesForIntersections.length;b++)for(var c=this._meshesForIntersections.data[b],d=0;d<c.actionManager.actions.length;d++){var e=c.actionManager.actions[d];if(e.trigger===a.ActionManager.OnIntersectionEnterTrigger||e.trigger===a.ActionManager.OnIntersectionExitTrigger){var f=e.getTriggerParameter(),g=f instanceof a.AbstractMesh?f:f.mesh,h=g.intersectsMesh(c,f.usePreciseIntersection),i=c._intersectionsInProgress.indexOf(g);h&&-1===i?e.trigger===a.ActionManager.OnIntersectionEnterTrigger?(e._executeCurrent(a.ActionEvent.CreateNew(c,null,g)),c._intersectionsInProgress.push(g)):e.trigger===a.ActionManager.OnIntersectionExitTrigger&&c._intersectionsInProgress.push(g):!h&&i>-1&&(e.trigger===a.ActionManager.OnIntersectionExitTrigger&&e._executeCurrent(a.ActionEvent.CreateNew(c,null,g)),c.actionManager.hasSpecificTrigger(a.ActionManager.OnIntersectionExitTrigger)&&e.trigger!==a.ActionManager.OnIntersectionExitTrigger||c._intersectionsInProgress.splice(i,1))}}},c.prototype.render=function(){var b=a.Tools.Now;this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this.getEngine().resetDrawCalls(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),a.Tools.StartPerformanceCounter("Scene rendering"),this.actionManager&&this.actionManager.processTrigger(a.ActionManager.OnEveryFrameTrigger,null),this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext();var d=Math.max(c.MinDeltaTime,Math.min(this._engine.getDeltaTime(),c.MaxDeltaTime));this._animationRatio=.06*d,this._animate(),this._physicsEngine&&(a.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._step(d/1e3),a.Tools.EndPerformanceCounter("Physics")),this.onBeforeRenderObservable.notifyObservers(this);var e=a.Tools.Now,f=this.getEngine(),g=this.activeCamera;if(this.renderTargetsEnabled){a.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(var h=0;h<this.customRenderTargets.length;h++){var i=this.customRenderTargets[h];if(i._shouldRender()){if(this._renderId++,this.activeCamera=i.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");f.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),i.render(g!==this.activeCamera,this.dumpNextRenderTargets)}}a.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}if(this.customRenderTargets.length>0&&f.restoreDefaultFramebuffer(),this._renderTargetsDuration+=a.Tools.Now-e,this.activeCamera=g,this.proceduralTexturesEnabled){a.Tools.StartPerformanceCounter("Procedural textures",this._proceduralTextures.length>0);for(var j=0;j<this._proceduralTextures.length;j++){var k=this._proceduralTextures[j];k._shouldRender()&&k.render()}a.Tools.EndPerformanceCounter("Procedural textures",this._proceduralTextures.length>0)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var l=0;l<this.lights.length;l++){var m=this.lights[l],n=m.getShadowGenerator();m.isEnabled()&&n&&-1!==n.getShadowMap().getScene().textures.indexOf(n.getShadowMap())&&this._renderTargets.push(n.getShadowMap())}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var o=this._renderId,p=0;p<this.activeCameras.length;p++)this._renderId=o,p>0&&this._engine.clear(0,!1,!0),this._processSubCameras(this.activeCameras[p]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections(),a.AudioEngine&&this._updateAudioParameters(),this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this);for(var q=0;q<this._toBeDisposed.length;q++)this._toBeDisposed.data[q].dispose(),this._toBeDisposed[q]=null;this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),a.Tools.EndPerformanceCounter("Scene rendering"),this._lastFrameDuration=a.Tools.Now-b},c.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var b,c=a.Engine.audioEngine;if(b=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera,b&&c.canUseWebAudio){c.audioContext.listener.setPosition(b.position.x,b.position.y,b.position.z);var d=a.Matrix.Invert(b.getViewMatrix()),e=a.Vector3.TransformNormal(new a.Vector3(0,0,-1),d);e.normalize(),c.audioContext.listener.setOrientation(e.x,e.y,e.z,0,1,0);var f;for(f=0;f<this.mainSoundTrack.soundCollection.length;f++){var g=this.mainSoundTrack.soundCollection[f];g.useCustomAttenuation&&g.updateDistanceFromListener()}for(f=0;f<this.soundTracks.length;f++)for(var h=0;h<this.soundTracks[f].soundCollection.length;h++)g=this.soundTracks[f].soundCollection[h],g.useCustomAttenuation&&g.updateDistanceFromListener()}}},Object.defineProperty(c.prototype,"audioEnabled",{get:function(){return this._audioEnabled},set:function(b){this._audioEnabled=b,
a.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),c.prototype._disableAudio=function(){var a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)this.mainSoundTrack.soundCollection[a].pause();for(a=0;a<this.soundTracks.length;a++)for(var b=0;b<this.soundTracks[a].soundCollection.length;b++)this.soundTracks[a].soundCollection[b].pause()},c.prototype._enableAudio=function(){var a;for(a=0;a<this.mainSoundTrack.soundCollection.length;a++)this.mainSoundTrack.soundCollection[a].isPaused&&this.mainSoundTrack.soundCollection[a].play();for(a=0;a<this.soundTracks.length;a++)for(var b=0;b<this.soundTracks[a].soundCollection.length;b++)this.soundTracks[a].soundCollection[b].isPaused&&this.soundTracks[a].soundCollection[b].play()},Object.defineProperty(c.prototype,"headphone",{get:function(){return this._headphone},set:function(b){this._headphone=b,a.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),c.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].switchPanningModelToHRTF()},c.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].switchPanningModelToEqualPower()},c.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new a.DepthRenderer(this),this._depthRenderer)},c.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},c.prototype.freezeMaterials=function(){for(var a=0;a<this.materials.length;a++)this.materials[a].freeze()},c.prototype.unfreezeMaterials=function(){for(var a=0;a<this.materials.length;a++)this.materials[a].unfreeze()},c.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this._depthRenderer&&this._depthRenderer.dispose(),this._debugLayer&&this._debugLayer.hide(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.detachControl(),a.AudioEngine&&this.disposeSounds();var b,c=this._engine.getRenderingCanvas();for(b=0;b<this.cameras.length;b++)this.cameras[b].detachControl(c);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),b=this._engine.scenes.indexOf(this),b>-1&&this._engine.scenes.splice(b,1),this._engine.wipeCaches()},c.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var a=0;a<this.soundTracks.length;a++)this.soundTracks[a].dispose()},c.prototype.getWorldExtends=function(){for(var b=new a.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new a.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),d=0;d<this.meshes.length;d++){var e=this.meshes[d];e.computeWorldMatrix(!0);var f=e.getBoundingInfo().boundingBox.minimumWorld,g=e.getBoundingInfo().boundingBox.maximumWorld;a.Tools.CheckExtends(f,b,c),a.Tools.CheckExtends(g,b,c)}return{min:b,max:c}},c.prototype.createOrUpdateSelectionOctree=function(b,c){void 0===b&&(b=64),void 0===c&&(c=2),this._selectionOctree||(this._selectionOctree=new a.Octree(a.Octree.CreationFuncForMeshes,b,c));var d=this.getWorldExtends();return this._selectionOctree.update(d.min,d.max,this.meshes),this._selectionOctree},c.prototype.createPickingRay=function(b,c,d,e,f){void 0===f&&(f=!1);var g=this._engine;if(!e){if(!this.activeCamera)throw new Error("Active camera not set");e=this.activeCamera}var h=e.viewport,i=h.toGlobal(g.getRenderWidth(),g.getRenderHeight());return b=b/this._engine.getHardwareScalingLevel()-i.x,c=c/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-i.y-i.height),a.Ray.CreateNew(b,c,i.width,i.height,d?d:a.Matrix.Identity(),f?a.Matrix.Identity():e.getViewMatrix(),e.getProjectionMatrix())},c.prototype.createPickingRayInCameraSpace=function(b,c,d){var e=this._engine;if(!d){if(!this.activeCamera)throw new Error("Active camera not set");d=this.activeCamera}var f=d.viewport,g=f.toGlobal(e.getRenderWidth(),e.getRenderHeight()),h=a.Matrix.Identity();return b=b/this._engine.getHardwareScalingLevel()-g.x,c=c/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-g.y-g.height),a.Ray.CreateNew(b,c,g.width,g.height,h,h,d.getProjectionMatrix())},c.prototype._internalPick=function(b,c,d){for(var e=null,f=0;f<this.meshes.length;f++){var g=this.meshes[f];if(c){if(!c(g))continue}else if(!g.isEnabled()||!g.isVisible||!g.isPickable)continue;var h=g.getWorldMatrix(),i=b(h),j=g.intersects(i,d);if(j&&j.hit&&(d||null==e||!(j.distance>=e.distance))&&(e=j,d))break}return e||new a.PickingInfo},c.prototype._internalPickSprites=function(b,c,d,e){var f=null;if(e=e||this.activeCamera,this.spriteManagers.length>0)for(var g=0;g<this.spriteManagers.length;g++){var h=this.spriteManagers[g];if(h.isPickable){var i=h.intersects(b,e,c,d);if(i&&i.hit&&(d||null==f||!(i.distance>=f.distance))&&(f=i,d))break}}return f||new a.PickingInfo},c.prototype.pick=function(a,b,c,d,e){var f=this;return this._internalPick(function(c){return f.createPickingRay(a,b,c,e)},c,d)},c.prototype.pickSprite=function(a,b,c,d,e){return this._internalPickSprites(this.createPickingRayInCameraSpace(a,b,e),c,d,e)},c.prototype.pickWithRay=function(b,c,d){var e=this;return this._internalPick(function(c){return e._pickWithRayInverseMatrix||(e._pickWithRayInverseMatrix=a.Matrix.Identity()),c.invertToRef(e._pickWithRayInverseMatrix),a.Ray.Transform(b,e._pickWithRayInverseMatrix)},c,d)},c.prototype.setPointerOverMesh=function(b){this._pointerOverMesh!==b&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(a.ActionManager.OnPointerOutTrigger,a.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=b,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(a.ActionManager.OnPointerOverTrigger,a.ActionEvent.CreateNew(this._pointerOverMesh)))},c.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},c.prototype.setPointerOverSprite=function(b){this._pointerOverSprite!==b&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(a.ActionManager.OnPointerOutTrigger,a.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=b,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(a.ActionManager.OnPointerOverTrigger,a.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},c.prototype.getPointerOverSprite=function(){return this._pointerOverSprite},c.prototype.getPhysicsEngine=function(){return this._physicsEngine},c.prototype.enablePhysics=function(b,c){if(this._physicsEngine)return!0;try{return this._physicsEngine=new a.PhysicsEngine(b,c),!0}catch(d){return a.Tools.Error(d.message),!1}},c.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},c.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},c.prototype.setGravity=function(b){a.Tools.Warn("Deprecated, please use 'scene.getPhysicsEngine().setGravity()'"),this._physicsEngine&&this._physicsEngine.setGravity(b)},c.prototype.createCompoundImpostor=function(b,c){a.Tools.Warn("Scene.createCompoundImpostor is deprecated. Please use PhysicsImpostor parent/child"),b.parts&&(c=b,b=b.parts);var d=b[0].mesh;d.physicsImpostor=new a.PhysicsImpostor(d,b[0].impostor,c,this);for(var e=1;e<b.length;e++){var f=b[e].mesh;f.parent!==d&&(f.position=f.position.subtract(d.position),f.parent=d),f.physicsImpostor=new a.PhysicsImpostor(f,b[e].impostor,c,this)}d.physicsImpostor.forceUpdate()},c.prototype.deleteCompoundImpostor=function(a){var b=a.parts[0].mesh;b.physicsImpostor.dispose(),b.physicsImpostor=null},c.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new a.HemisphericLight("default light",a.Vector3.Up(),this),!this.activeCamera){var b=new a.FreeCamera("default camera",a.Vector3.Zero(),this),c=this.getWorldExtends(),d=c.min.add(c.max.subtract(c.min).scale(.5));b.position=new a.Vector3(d.x,d.y,c.min.z-(c.max.z-c.min.z)),b.setTarget(d),this.activeCamera=b}},c.prototype._getByTags=function(b,c,d){if(void 0===c)return b;var e=[];d=d||function(a){};for(var f in b){var g=b[f];a.Tags.MatchesQuery(g,c)&&(e.push(g),d(g))}return e},c.prototype.getMeshesByTags=function(a,b){return this._getByTags(this.meshes,a,b)},c.prototype.getCamerasByTags=function(a,b){return this._getByTags(this.cameras,a,b)},c.prototype.getLightsByTags=function(a,b){return this._getByTags(this.lights,a,b)},c.prototype.getMaterialByTags=function(a,b){return this._getByTags(this.materials,a,b).concat(this._getByTags(this.multiMaterials,a,b))},c._FOGMODE_NONE=0,c._FOGMODE_EXP=1,c._FOGMODE_EXP2=2,c._FOGMODE_LINEAR=3,c.MinDeltaTime=1,c.MaxDeltaTime=1e3,c}();a.Scene=f}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f,g){b instanceof a.Mesh?this._engine=b.getScene().getEngine():this._engine=b,this._updatable=d,this._data=c,this._strideSize=e,f||this.create(),this._instanced=g}return b.prototype.createVertexBuffer=function(b,c,d,e){return new a.VertexBuffer(this._engine,this,b,this._updatable,!0,e?e:this._strideSize,this._instanced,c,d)},b.prototype.isUpdatable=function(){return this._updatable},b.prototype.getData=function(){return this._data},b.prototype.getBuffer=function(){return this._buffer},b.prototype.getStrideSize=function(){return this._strideSize},b.prototype.getIsInstanced=function(){return this._instanced},b.prototype.create=function(a){!a&&this._buffer||(a=a||this._data,this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a),this._data=a):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(a),this._data=a):this._buffer=this._engine.createVertexBuffer(a))},b.prototype.update=function(a){this.create(a)},b.prototype.updateDirectly=function(a,b,c){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a,b,c?c*this.getStrideSize():void 0),this._data=null)},b.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},b}();a.Buffer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(c,d,e,f,g,h,i,j,k){if(!h)switch(e){case b.PositionKind:h=3;break;case b.NormalKind:h=3;break;case b.UVKind:case b.UV2Kind:case b.UV3Kind:case b.UV4Kind:case b.UV5Kind:case b.UV6Kind:h=2;break;case b.ColorKind:h=4;break;case b.MatricesIndicesKind:case b.MatricesIndicesExtraKind:h=4;break;case b.MatricesWeightsKind:case b.MatricesWeightsExtraKind:h=4}d instanceof a.Buffer?(h||(h=d.getStrideSize()),this._buffer=d,this._ownsBuffer=!1):(this._buffer=new a.Buffer(c,d,f,h,g,i),this._ownsBuffer=!0),this._stride=h,this._offset=j?j:0,this._size=k?k:h,this._kind=e}return b.prototype.getKind=function(){return this._kind},b.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},b.prototype.getData=function(){return this._buffer.getData()},b.prototype.getBuffer=function(){return this._buffer.getBuffer()},b.prototype.getStrideSize=function(){return this._stride},b.prototype.getOffset=function(){return this._offset},b.prototype.getSize=function(){return this._size},b.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},b.prototype.create=function(a){return this._buffer.create(a)},b.prototype.update=function(a){return this._buffer.update(a)},b.prototype.updateDirectly=function(a,b){return this._buffer.updateDirectly(a,b)},b.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(b,"PositionKind",{get:function(){return b._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"NormalKind",{get:function(){return b._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UVKind",{get:function(){return b._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UV2Kind",{get:function(){return b._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UV3Kind",{get:function(){return b._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UV4Kind",{get:function(){return b._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UV5Kind",{get:function(){return b._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UV6Kind",{get:function(){return b._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ColorKind",{get:function(){return b._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MatricesIndicesKind",{get:function(){return b._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MatricesWeightsKind",{get:function(){return b._MatricesWeightsKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MatricesIndicesExtraKind",{get:function(){return b._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MatricesWeightsExtraKind",{get:function(){return b._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),b._PositionKind="position",b._NormalKind="normal",b._UVKind="uv",b._UV2Kind="uv2",b._UV3Kind="uv3",b._UV4Kind="uv4",b._UV5Kind="uv5",b._UV6Kind="uv6",b._ColorKind="color",b._MatricesIndicesKind="matricesIndices",b._MatricesWeightsKind="matricesWeights",b._MatricesIndicesExtraKind="matricesIndicesExtra",b._MatricesWeightsExtraKind="matricesWeightsExtra",b}();a.VertexBuffer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c){b.call(this,a,c.getScene()),c.instances.push(this),this._sourceMesh=c,this.position.copyFrom(c.position),this.rotation.copyFrom(c.rotation),this.scaling.copyFrom(c.scaling),c.rotationQuaternion&&(this.rotationQuaternion=c.rotationQuaternion.clone()),this.infiniteDistance=c.infiniteDistance,this.setPivotMatrix(c.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return __extends(c,b),Object.defineProperty(c.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),c.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(c.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),c.prototype.getVerticesData=function(a,b){return this._sourceMesh.getVerticesData(a,b)},c.prototype.isVerticesDataPresent=function(a){return this._sourceMesh.isVerticesDataPresent(a)},c.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(c.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),c.prototype.refreshBoundingInfo=function(){var b=this._sourceMesh.getBoundingInfo();this._boundingInfo=new a.BoundingInfo(b.minimum.clone(),b.maximum.clone()),this._updateBoundingInfo()},c.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},c.prototype._activate=function(a){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,a)},c.prototype.getLOD=function(a){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},c.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var a=0;a<this._sourceMesh.subMeshes.length;a++)this._sourceMesh.subMeshes[a].clone(this,this._sourceMesh)},c.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},c.prototype.clone=function(b,c,d){var e=this._sourceMesh.createInstance(b);if(a.Tools.DeepCopy(this,e,["name","subMeshes"],[]),this.refreshBoundingInfo(),c&&(e.parent=c),!d)for(var f=0;f<this.getScene().meshes.length;f++){var g=this.getScene().meshes[f];g.parent===this&&g.clone(g.name,e)}return e.computeWorldMatrix(!0),e},c.prototype.dispose=function(a){var c=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(c,1),b.prototype.dispose.call(this,a)},c}(a.AbstractMesh);a.InstancedMesh=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return a}();a._InstancesBatch=b;var c=function(c){function d(e,f,g,h,i,j){if(void 0===g&&(g=null),void 0===j&&(j=!0),c.call(this,e,f),this.onBeforeRenderObservable=new a.Observable,this.onAfterRenderObservable=new a.Observable,this.onBeforeDrawObservable=new a.Observable,this.delayLoadState=a.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._LODLevels=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new b,this._instancesBufferSize=2048,this._sideOrientation=d._DEFAULTSIDE,this._areNormalsFrozen=!1,h){h._geometry&&h._geometry.applyToMesh(this),a.Tools.DeepCopy(h,this,["name","material","skeleton","instances"],["_poseMatrix"]),this.setPivotMatrix(h.getPivotMatrix()),this.id=e+"."+h.id,this.material=h.material;var k;if(!i)for(k=0;k<f.meshes.length;k++){var l=f.meshes[k];l.parent===h&&l.clone(e+"."+l.name,this,i)}var m=this.getScene().getPhysicsEngine();if(j&&m){var n=m.getImpostorForPhysicsObject(h);n&&(this.physicsImpostor=n.clone(this))}for(k=0;k<f.particleSystems.length;k++){var o=f.particleSystems[k];o.emitter===h&&o.clone(o.name,this)}this.computeWorldMatrix(!0)}null!==g&&(this.parent=g)}return __extends(d,c),Object.defineProperty(d,"FRONTSIDE",{get:function(){return d._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"BACKSIDE",{get:function(){return d._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"DOUBLESIDE",{get:function(){return d._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"DEFAULTSIDE",{get:function(){return d._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(d,"NO_CAP",{get:function(){return d._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_START",{get:function(){return d._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_END",{get:function(){return d._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(d,"CAP_ALL",{get:function(){return d._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"onBeforeDraw",{set:function(a){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(a)},enumerable:!0,configurable:!0}),d.prototype.toString=function(b){var d=c.prototype.toString.call(this,b);if(d+=", n vertices: "+this.getTotalVertices(),d+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var e=0;e<this.animations.length;e++)d+=", animation[0]: "+this.animations[e].toString(b);return b&&(d+=", flat shading: "+(this._geometry?this.getVerticesData(a.VertexBuffer.PositionKind).length/3===this.getIndices().length?"YES":"NO":"UNKNOWN")),d},Object.defineProperty(d.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),d.prototype._sortLODLevels=function(){this._LODLevels.sort(function(a,b){return a.distance<b.distance?1:a.distance>b.distance?-1:0})},d.prototype.addLODLevel=function(b,c){if(c&&c._masterMesh)return a.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var d=new a.Internals.MeshLODLevel(b,c);return this._LODLevels.push(d),c&&(c._masterMesh=this),this._sortLODLevels(),this},d.prototype.getLODLevelAtDistance=function(a){for(var b=0;b<this._LODLevels.length;b++){var c=this._LODLevels[b];if(c.distance===a)return c.mesh}return null},d.prototype.removeLODLevel=function(a){for(var b=0;b<this._LODLevels.length;b++)this._LODLevels[b].mesh===a&&(this._LODLevels.splice(b,1),a&&(a._masterMesh=null));return this._sortLODLevels(),this},d.prototype.getLOD=function(a,b){if(!this._LODLevels||0===this._LODLevels.length)return this;var c=(b?b:this.getBoundingInfo().boundingSphere).centerWorld.subtract(a.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>c)return this.onLODLevelSelection&&this.onLODLevelSelection(c,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var d=0;d<this._LODLevels.length;d++){var e=this._LODLevels[d];if(e.distance<c)return e.mesh&&(e.mesh._preActivate(),e.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(c,this,e.mesh),e.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(c,this,this),this},Object.defineProperty(d.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),d.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},d.prototype.getVerticesData=function(a,b){return this._geometry?this._geometry.getVerticesData(a,b):null},d.prototype.getVertexBuffer=function(a){return this._geometry?this._geometry.getVertexBuffer(a):void 0},d.prototype.isVerticesDataPresent=function(a){return this._geometry?this._geometry.isVerticesDataPresent(a):this._delayInfo?-1!==this._delayInfo.indexOf(a):!1},d.prototype.getVerticesDataKinds=function(){if(!this._geometry){var a=[];if(this._delayInfo)for(var b in this._delayInfo)a.push(b);return a}return this._geometry.getVerticesDataKinds()},d.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},d.prototype.getIndices=function(a){return this._geometry?this._geometry.getIndices(a):[]},Object.defineProperty(d.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),d.prototype.isReady=function(){return this.delayLoadState===a.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isReady.call(this)},d.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(d.prototype,"sideOrientation",{get:function(){return this._sideOrientation},set:function(a){this._sideOrientation=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),d.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},d.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},Object.defineProperty(d.prototype,"overridenInstanceCount",{set:function(a){this._overridenInstanceCount=a},enumerable:!0,configurable:!0}),d.prototype._preActivate=function(){var a=this.getScene().getRenderId();this._preActivateId!==a&&(this._preActivateId=a,this._visibleInstances=null)},d.prototype._preActivateForIntermediateRendering=function(a){this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=a)},d.prototype._registerInstanceForRenderId=function(a,b){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=b,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[b]||(this._visibleInstances[b]=new Array),this._visibleInstances[b].push(a)},d.prototype.refreshBoundingInfo=function(){if(!this._boundingInfo.isLocked){var b=this.getVerticesData(a.VertexBuffer.PositionKind);if(b){var c=a.Tools.ExtractMinAndMax(b,0,this.getTotalVertices());this._boundingInfo=new a.BoundingInfo(c.minimum,c.maximum)}if(this.subMeshes)for(var d=0;d<this.subMeshes.length;d++)this.subMeshes[d].refreshBoundingInfo();this._updateBoundingInfo()}},d.prototype._createGlobalSubMesh=function(){var b=this.getTotalVertices();return b&&this.getIndices()?(this.releaseSubMeshes(),new a.SubMesh(0,0,b,0,this.getTotalIndices(),this)):null},d.prototype.subdivide=function(b){if(!(1>b)){for(var c=this.getTotalIndices(),d=c/b|0,e=0;d%3!==0;)d++;this.releaseSubMeshes();for(var f=0;b>f&&!(e>=c);f++)a.SubMesh.CreateFromIndices(0,e,Math.min(d,c-e),this),e+=d;this.synchronizeInstances()}},d.prototype.setVerticesData=function(b,c,d,e){if(this._geometry)this._geometry.setVerticesData(b,c,d,e);else{var f=new a.VertexData;f.set(c,b);var g=this.getScene();new a.Geometry(a.Geometry.RandomId(),g,f,d,this)}},d.prototype.setVerticesBuffer=function(b){if(!this._geometry){var c=this.getScene();new a.Geometry(a.Geometry.RandomId(),c).applyToMesh(this)}this._geometry.setVerticesBuffer(b)},d.prototype.updateVerticesData=function(a,b,c,d){this._geometry&&(d?(this.makeGeometryUnique(),this.updateVerticesData(a,b,c,!1)):this._geometry.updateVerticesData(a,b,c))},d.prototype.updateVerticesDataDirectly=function(b,c,d,e){a.Tools.Warn("Mesh.updateVerticesDataDirectly deprecated since 2.3."),this._geometry&&(e?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(b,c,d,!1)):this._geometry.updateVerticesDataDirectly(b,c,d))},d.prototype.updateMeshPositions=function(b,c){void 0===c&&(c=!0);var d=this.getVerticesData(a.VertexBuffer.PositionKind);if(b(d),this.updateVerticesData(a.VertexBuffer.PositionKind,d,!1,!1),c){var e=this.getIndices(),f=this.getVerticesData(a.VertexBuffer.NormalKind);a.VertexData.ComputeNormals(d,e,f),this.updateVerticesData(a.VertexBuffer.NormalKind,f,!1,!1)}},d.prototype.makeGeometryUnique=function(){if(this._geometry){var b=this._geometry.copy(a.Geometry.RandomId());b.applyToMesh(this)}},d.prototype.setIndices=function(b,c){if(this._geometry)this._geometry.setIndices(b,c);else{var d=new a.VertexData;d.indices=b;var e=this.getScene();new a.Geometry(a.Geometry.RandomId(),e,d,!1,this)}},d.prototype.toLeftHanded=function(){this._geometry&&this._geometry.toLeftHanded()},d.prototype._bind=function(b,c,d){var e,f=this.getScene().getEngine();if(this._unIndexed)e=null;else switch(d){case a.Material.PointFillMode:e=null;break;case a.Material.WireFrameFillMode:e=b.getLinesIndexBuffer(this.getIndices(),f);break;default:case a.Material.TriangleFillMode:e=this._unIndexed?null:this._geometry.getIndexBuffer()}f.bindBuffers(this._geometry.getVertexBuffers(),e,c)},d.prototype._draw=function(b,c,d){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeDrawObservable.notifyObservers(this);var e=this.getScene().getEngine();switch(c){case a.Material.PointFillMode:e.drawPointClouds(b.verticesStart,b.verticesCount,d);break;case a.Material.WireFrameFillMode:this._unIndexed?e.drawUnIndexed(!1,b.verticesStart,b.verticesCount,d):e.draw(!1,0,d>0?b.linesIndexCount/2:b.linesIndexCount,d);break;default:this._unIndexed?e.drawUnIndexed(!0,b.verticesStart,b.verticesCount,d):e.draw(!0,b.indexStart,b.indexCount,d)}}},d.prototype.registerBeforeRender=function(a){this.onBeforeRenderObservable.add(a)},d.prototype.unregisterBeforeRender=function(a){this.onBeforeRenderObservable.removeCallback(a)},d.prototype.registerAfterRender=function(a){this.onAfterRenderObservable.add(a)},d.prototype.unregisterAfterRender=function(a){this.onAfterRenderObservable.removeCallback(a)},d.prototype._getInstancesRenderList=function(a){var b=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[a]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[a]=null,this._visibleInstances){var c=b.getRenderId(),d=b._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[a]=this._visibleInstances[c];var e=this._renderId;if(!this._batchCache.visibleInstances[a]&&d&&(this._batchCache.visibleInstances[a]=this._visibleInstances[d],c=Math.max(d,c),e=Math.max(this._visibleInstances.selfDefaultRenderId,c)),this._batchCache.visibleInstances[a]&&this._batchCache.visibleInstances[a].length){if(this._renderIdForInstances[a]===c)return this._batchCache.mustReturn=!0,this._batchCache;c!==e&&(this._batchCache.renderSelf[a]=!1)}this._renderIdForInstances[a]=c}return this._batchCache},d.prototype._renderWithInstances=function(b,c,d,e,f){for(var g=d.visibleInstances[b._id],h=g.length+1,i=16*h*4,j=this._instancesBufferSize,k=this._instancesBuffer;this._instancesBufferSize<i;)this._instancesBufferSize*=2;this._instancesData&&j==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var l=0,m=0,n=this.getWorldMatrix();if(d.renderSelf[b._id]&&(n.copyToArray(this._instancesData,l),l+=16,m++),g)for(var o=0;o<g.length;o++){var p=g[o];p.getWorldMatrix().copyToArray(this._instancesData,l),l+=16,m++}k&&j==this._instancesBufferSize?k.updateDirectly(this._instancesData,0,m):(k&&k.dispose(),k=new a.Buffer(f,this._instancesData,!0,16,!1,!0),this._instancesBuffer=k,this.setVerticesBuffer(k.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(k.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(k.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(k.createVertexBuffer("world3",12,4))),f.bindBuffers(this.geometry.getVertexBuffers(),this.geometry.getIndexBuffer(),e),this._draw(b,c,m),f.unbindInstanceAttributes()},d.prototype._processRendering=function(a,b,c,d,e,f){var g=this.getScene(),h=g.getEngine();if(e)this._renderWithInstances(a,c,d,b,h);else if(d.renderSelf[a._id]&&(f&&f(!1,this.getWorldMatrix()),this._draw(a,c,this._overridenInstanceCount)),d.visibleInstances[a._id])for(var i=0;i<d.visibleInstances[a._id].length;i++){var j=d.visibleInstances[a._id][i],k=j.getWorldMatrix();f&&f(!0,k),this._draw(a,c)}},d.prototype.render=function(b,c){var d=this.getScene(),e=this._getInstancesRenderList(b._id);if(!e.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeRenderObservable.notifyObservers(this);var f=d.getEngine(),g=null!==f.getCaps().instancedArrays&&null!==e.visibleInstances[b._id]&&void 0!==e.visibleInstances[b._id],h=b.getMaterial();if(h&&h.isReady(this,g)){var i=f.getDepthWrite();this.renderOutline&&(f.setDepthWrite(!1),d.getOutlineRenderer().render(b,e),f.setDepthWrite(i)),h._preBind();var j=h.getEffect(),k=d.forcePointsCloud?a.Material.PointFillMode:d.forceWireframe?a.Material.WireFrameFillMode:h.fillMode;this._bind(b,j,k);var l=this.getWorldMatrix();if(h.bind(l,this),c&&f.setAlphaMode(h.alphaMode),this._processRendering(b,j,k,e,g,function(a,b){a&&h.bindOnlyWorldMatrix(b)}),h.unbind(),this.renderOutline&&i&&(f.setDepthWrite(!0),f.setColorWrite(!1),d.getOutlineRenderer().render(b,e),f.setColorWrite(!0)),this.renderOverlay){var m=f.getAlphaMode();f.setAlphaMode(a.Engine.ALPHA_COMBINE),d.getOutlineRenderer().render(b,e,!0),f.setAlphaMode(m)}this.onAfterRenderObservable.notifyObservers(this)}}},d.prototype.getEmittedParticleSystems=function(){for(var a=new Array,b=0;b<this.getScene().particleSystems.length;b++){var c=this.getScene().particleSystems[b];c.emitter===this&&a.push(c)}return a},d.prototype.getHierarchyEmittedParticleSystems=function(){var a=new Array,b=this.getDescendants();b.push(this);for(var c=0;c<this.getScene().particleSystems.length;c++){
var d=this.getScene().particleSystems[c];-1!==b.indexOf(d.emitter)&&a.push(d)}return a},d.prototype._checkDelayState=function(){var b=this,c=this,d=this.getScene();if(this._geometry)this._geometry.load(d);else if(c.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED){c.delayLoadState=a.Engine.DELAYLOADSTATE_LOADING,d._addPendingData(c);var e=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");a.Tools.LoadFile(this.delayLoadingFile,function(c){c instanceof ArrayBuffer?b._delayLoadingFunction(c,b):b._delayLoadingFunction(JSON.parse(c),b),b.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,d._removePendingData(b)},function(){},d.database,e)}},d.prototype.isInFrustum=function(b){return this.delayLoadState===a.Engine.DELAYLOADSTATE_LOADING?!1:c.prototype.isInFrustum.call(this,b)?(this._checkDelayState(),!0):!1},d.prototype.setMaterialByID=function(a){var b,c=this.getScene().materials;for(b=0;b<c.length;b++)if(c[b].id===a)return void(this.material=c[b]);var d=this.getScene().multiMaterials;for(b=0;b<d.length;b++)if(d[b].id===a)return void(this.material=d[b])},d.prototype.getAnimatables=function(){var a=[];return this.material&&a.push(this.material),this.skeleton&&a.push(this.skeleton),a},d.prototype.bakeTransformIntoVertices=function(b){if(this.isVerticesDataPresent(a.VertexBuffer.PositionKind)){var c=this.subMeshes.splice(0);this._resetPointsArrayCache();var d,e=this.getVerticesData(a.VertexBuffer.PositionKind),f=[];for(d=0;d<e.length;d+=3)a.Vector3.TransformCoordinates(a.Vector3.FromArray(e,d),b).toArray(f,d);if(this.setVerticesData(a.VertexBuffer.PositionKind,f,this.getVertexBuffer(a.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(a.VertexBuffer.NormalKind)){for(e=this.getVerticesData(a.VertexBuffer.NormalKind),f=[],d=0;d<e.length;d+=3)a.Vector3.TransformNormal(a.Vector3.FromArray(e,d),b).normalize().toArray(f,d);this.setVerticesData(a.VertexBuffer.NormalKind,f,this.getVertexBuffer(a.VertexBuffer.NormalKind).isUpdatable()),b.m[0]*b.m[5]*b.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=c}}},d.prototype.bakeCurrentTransformIntoVertices=function(){this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=a.Quaternion.Identity()),this._worldMatrix=a.Matrix.Identity()},d.prototype._resetPointsArrayCache=function(){this._positions=null},d.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var b=this.getVerticesData(a.VertexBuffer.PositionKind);if(!b)return!1;for(var c=0;c<b.length;c+=3)this._positions.push(a.Vector3.FromArray(b,c));return!0},d.prototype.clone=function(a,b,c,e){return void 0===e&&(e=!0),new d(a,this.getScene(),b,this,c,e)},d.prototype.dispose=function(a){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();c.prototype.dispose.call(this,a)},d.prototype.applyDisplacementMap=function(b,c,d,e){var f=this,g=this.getScene(),h=function(a){var b=document.createElement("canvas"),g=b.getContext("2d"),h=a.width,i=a.height;b.width=h,b.height=i,g.drawImage(a,0,0);var j=g.getImageData(0,0,h,i).data;f.applyDisplacementMapFromBuffer(j,h,i,c,d),e&&e(f)};a.Tools.LoadImage(b,h,function(){},g.database)},d.prototype.applyDisplacementMapFromBuffer=function(b,c,d,e,f){if(!this.isVerticesDataPresent(a.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(a.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(a.VertexBuffer.UVKind))return void a.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var g=this.getVerticesData(a.VertexBuffer.PositionKind),h=this.getVerticesData(a.VertexBuffer.NormalKind),i=this.getVerticesData(a.VertexBuffer.UVKind),j=a.Vector3.Zero(),k=a.Vector3.Zero(),l=a.Vector2.Zero(),m=0;m<g.length;m+=3){a.Vector3.FromArrayToRef(g,m,j),a.Vector3.FromArrayToRef(h,m,k),a.Vector2.FromArrayToRef(i,m/3*2,l);var n=Math.abs(l.x)*c%c|0,o=Math.abs(l.y)*d%d|0,p=4*(n+o*c),q=b[p]/255,r=b[p+1]/255,s=b[p+2]/255,t=.3*q+.59*r+.11*s;k.normalize(),k.scaleInPlace(e+(f-e)*t),j=j.add(k),j.toArray(g,m)}a.VertexData.ComputeNormals(g,this.getIndices(),h),this.updateVerticesData(a.VertexBuffer.PositionKind,g),this.updateVerticesData(a.VertexBuffer.NormalKind,h)},d.prototype.convertToFlatShadedMesh=function(){var b,c,d=this.getVerticesDataKinds(),e=[],f=[],g=[],h=!1;for(b=0;b<d.length;b++){c=d[b];var i=this.getVertexBuffer(c);c!==a.VertexBuffer.NormalKind?(e[c]=i,f[c]=e[c].getData(),g[c]=[]):(h=i.isUpdatable(),d.splice(b,1),b--)}var j,k=this.subMeshes.slice(0),l=this.getIndices(),m=this.getTotalIndices();for(j=0;m>j;j++){var n=l[j];for(b=0;b<d.length;b++){c=d[b];for(var o=e[c].getStrideSize(),p=0;o>p;p++)g[c].push(f[c][n*o+p])}}var q=[],r=g[a.VertexBuffer.PositionKind];for(j=0;m>j;j+=3){l[j]=j,l[j+1]=j+1,l[j+2]=j+2;for(var s=a.Vector3.FromArray(r,3*j),t=a.Vector3.FromArray(r,3*(j+1)),u=a.Vector3.FromArray(r,3*(j+2)),v=s.subtract(t),w=u.subtract(t),x=a.Vector3.Normalize(a.Vector3.Cross(v,w)),y=0;3>y;y++)q.push(x.x),q.push(x.y),q.push(x.z)}for(this.setIndices(l),this.setVerticesData(a.VertexBuffer.NormalKind,q,h),b=0;b<d.length;b++)c=d[b],this.setVerticesData(c,g[c],e[c].isUpdatable());this.releaseSubMeshes();for(var z=0;z<k.length;z++){var A=k[z];new a.SubMesh(A.materialIndex,A.indexStart,A.indexCount,A.indexStart,A.indexCount,this)}this.synchronizeInstances()},d.prototype.convertToUnIndexedMesh=function(){var b,c,d=this.getVerticesDataKinds(),e=[],f=[],g=[];for(b=0;b<d.length;b++){c=d[b];var h=this.getVertexBuffer(c);e[c]=h,f[c]=e[c].getData(),g[c]=[]}var i,j=this.subMeshes.slice(0),k=this.getIndices(),l=this.getTotalIndices();for(i=0;l>i;i++){var m=k[i];for(b=0;b<d.length;b++){c=d[b];for(var n=e[c].getStrideSize(),o=0;n>o;o++)g[c].push(f[c][m*n+o])}}for(i=0;l>i;i+=3)k[i]=i,k[i+1]=i+1,k[i+2]=i+2;for(this.setIndices(k),b=0;b<d.length;b++)c=d[b],this.setVerticesData(c,g[c],e[c].isUpdatable());this.releaseSubMeshes();for(var p=0;p<j.length;p++){var q=j[p];new a.SubMesh(q.materialIndex,q.indexStart,q.indexCount,q.indexStart,q.indexCount,this)}this._unIndexed=!0,this.synchronizeInstances()},d.prototype.flipFaces=function(b){void 0===b&&(b=!1);var c,d=a.VertexData.ExtractFromMesh(this);if(b&&this.isVerticesDataPresent(a.VertexBuffer.NormalKind))for(c=0;c<d.normals.length;c++)d.normals[c]*=-1;var e;for(c=0;c<d.indices.length;c+=3)e=d.indices[c+1],d.indices[c+1]=d.indices[c+2],d.indices[c+2]=e;d.applyToMesh(this)},d.prototype.createInstance=function(b){return new a.InstancedMesh(b,this)},d.prototype.synchronizeInstances=function(){for(var a=0;a<this.instances.length;a++){var b=this.instances[a];b._syncSubMeshes()}},d.prototype.simplify=function(b,c,d,e){void 0===c&&(c=!0),void 0===d&&(d=a.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:b,parallelProcessing:c,mesh:this,simplificationType:d,successCallback:e})},d.prototype.optimizeIndices=function(b){for(var c=this,d=this.getIndices(),e=this.getVerticesData(a.VertexBuffer.PositionKind),f=[],g=0;g<e.length;g+=3)f.push(a.Vector3.FromArray(e,g));var h=[];a.AsyncLoop.SyncAsyncForLoop(f.length,40,function(a){for(var b=f.length-1-a,c=f[b],d=0;b>d;++d){var e=f[d];if(c.equals(e)){h[b]=d;break}}},function(){for(var a=0;a<d.length;++a)d[a]=h[d[a]]||d[a];var e=c.subMeshes.slice(0);c.setIndices(d),c.subMeshes=e,b&&b(c)})},d.Parse=function(b,c,e){var f=new d(b.name,c);if(f.id=b.id,a.Tags.AddTagsTo(f,b.tags),f.position=a.Vector3.FromArray(b.position),b.rotationQuaternion?f.rotationQuaternion=a.Quaternion.FromArray(b.rotationQuaternion):b.rotation&&(f.rotation=a.Vector3.FromArray(b.rotation)),f.scaling=a.Vector3.FromArray(b.scaling),b.localMatrix?f.setPivotMatrix(a.Matrix.FromArray(b.localMatrix)):b.pivotMatrix&&f.setPivotMatrix(a.Matrix.FromArray(b.pivotMatrix)),f.setEnabled(b.isEnabled),f.isVisible=b.isVisible,f.infiniteDistance=b.infiniteDistance,f.showBoundingBox=b.showBoundingBox,f.showSubMeshesBoundingBox=b.showSubMeshesBoundingBox,void 0!==b.applyFog&&(f.applyFog=b.applyFog),void 0!==b.pickable&&(f.isPickable=b.pickable),void 0!==b.alphaIndex&&(f.alphaIndex=b.alphaIndex),f.receiveShadows=b.receiveShadows,f.billboardMode=b.billboardMode,void 0!==b.visibility&&(f.visibility=b.visibility),f.checkCollisions=b.checkCollisions,f._shouldGenerateFlatShading=b.useFlatShading,b.freezeWorldMatrix&&(f._waitingFreezeWorldMatrix=b.freezeWorldMatrix),b.parentId&&(f._waitingParentId=b.parentId),void 0!==b.actions&&(f._waitingActions=b.actions),f.hasVertexAlpha=b.hasVertexAlpha,b.delayLoadingFile?(f.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED,f.delayLoadingFile=e+b.delayLoadingFile,f._boundingInfo=new a.BoundingInfo(a.Vector3.FromArray(b.boundingBoxMinimum),a.Vector3.FromArray(b.boundingBoxMaximum)),b._binaryInfo&&(f._binaryInfo=b._binaryInfo),f._delayInfo=[],b.hasUVs&&f._delayInfo.push(a.VertexBuffer.UVKind),b.hasUVs2&&f._delayInfo.push(a.VertexBuffer.UV2Kind),b.hasUVs3&&f._delayInfo.push(a.VertexBuffer.UV3Kind),b.hasUVs4&&f._delayInfo.push(a.VertexBuffer.UV4Kind),b.hasUVs5&&f._delayInfo.push(a.VertexBuffer.UV5Kind),b.hasUVs6&&f._delayInfo.push(a.VertexBuffer.UV6Kind),b.hasColors&&f._delayInfo.push(a.VertexBuffer.ColorKind),b.hasMatricesIndices&&f._delayInfo.push(a.VertexBuffer.MatricesIndicesKind),b.hasMatricesWeights&&f._delayInfo.push(a.VertexBuffer.MatricesWeightsKind),f._delayLoadingFunction=a.Geometry.ImportGeometry,a.SceneLoader.ForceFullSceneLoadingForIncremental&&f._checkDelayState()):a.Geometry.ImportGeometry(b,f),b.materialId?f.setMaterialByID(b.materialId):f.material=null,b.skeletonId>-1&&(f.skeleton=c.getLastSkeletonByID(b.skeletonId),b.numBoneInfluencers&&(f.numBoneInfluencers=b.numBoneInfluencers)),b.animations){for(var g=0;g<b.animations.length;g++){var h=b.animations[g];f.animations.push(a.Animation.Parse(h))}a.Node.ParseAnimationRanges(f,b,c)}if(b.autoAnimate&&c.beginAnimation(f,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),b.layerMask&&!isNaN(b.layerMask)?f.layerMask=Math.abs(parseInt(b.layerMask)):f.layerMask=268435455,b.physicsImpostor&&(f.physicsImpostor=new a.PhysicsImpostor(f,b.physicsImpostor,{mass:b.physicsMass,friction:b.physicsFriction,restitution:b.physicsRestitution},c)),b.instances)for(var i=0;i<b.instances.length;i++){var j=b.instances[i],k=f.createInstance(j.name);if(a.Tags.AddTagsTo(k,j.tags),k.position=a.Vector3.FromArray(j.position),j.rotationQuaternion?k.rotationQuaternion=a.Quaternion.FromArray(j.rotationQuaternion):j.rotation&&(k.rotation=a.Vector3.FromArray(j.rotation)),k.scaling=a.Vector3.FromArray(j.scaling),k.checkCollisions=f.checkCollisions,b.animations){for(g=0;g<b.animations.length;g++)h=b.animations[g],k.animations.push(a.Animation.Parse(h));a.Node.ParseAnimationRanges(k,b,c)}}return f},d.CreateRibbon=function(b,c,d,e,f,g,h,i,j){return a.MeshBuilder.CreateRibbon(b,{pathArray:c,closeArray:d,closePath:e,offset:f,updatable:h,sideOrientation:i,instance:j},g)},d.CreateDisc=function(b,c,d,e,f,g){var h={radius:c,tessellation:d,sideOrientation:g,updatable:f};return a.MeshBuilder.CreateDisc(b,h,e)},d.CreateBox=function(b,c,d,e,f){var g={size:c,sideOrientation:f,updatable:e};return a.MeshBuilder.CreateBox(b,g,d)},d.CreateSphere=function(b,c,d,e,f,g){var h={segments:c,diameterX:d,diameterY:d,diameterZ:d,sideOrientation:g,updatable:f};return a.MeshBuilder.CreateSphere(b,h,e)},d.CreateCylinder=function(b,c,e,f,g,h,i,j,k){void 0!==i&&i instanceof a.Scene||(void 0!==i&&(k=j||d.DEFAULTSIDE,j=i),i=h,h=1);var l={height:c,diameterTop:e,diameterBottom:f,tessellation:g,subdivisions:h,sideOrientation:k,updatable:j};return a.MeshBuilder.CreateCylinder(b,l,i)},d.CreateTorus=function(b,c,d,e,f,g,h){var i={diameter:c,thickness:d,tessellation:e,sideOrientation:h,updatable:g};return a.MeshBuilder.CreateTorus(b,i,f)},d.CreateTorusKnot=function(b,c,d,e,f,g,h,i,j,k){var l={radius:c,tube:d,radialSegments:e,tubularSegments:f,p:g,q:h,sideOrientation:k,updatable:j};return a.MeshBuilder.CreateTorusKnot(b,l,i)},d.CreateLines=function(b,c,d,e,f){var g={points:c,updatable:e,instance:f};return a.MeshBuilder.CreateLines(b,g,d)},d.CreateDashedLines=function(b,c,d,e,f,g,h,i){var j={points:c,dashSize:d,gapSize:e,dashNb:f,updatable:h};return a.MeshBuilder.CreateDashedLines(b,j,g)},d.ExtrudeShape=function(b,c,e,f,g,h,i,j,k,l){var m={shape:c,path:e,scale:f,rotation:g,cap:0===h?0:h||d.NO_CAP,sideOrientation:k,instance:l,updatable:j};return a.MeshBuilder.ExtrudeShape(b,m,i)},d.ExtrudeShapeCustom=function(b,c,e,f,g,h,i,j,k,l,m,n){var o={shape:c,path:e,scaleFunction:f,rotationFunction:g,ribbonCloseArray:h,ribbonClosePath:i,cap:0===j?0:j||d.NO_CAP,sideOrientation:m,instance:n,updatable:l};return a.MeshBuilder.ExtrudeShapeCustom(b,o,k)},d.CreateLathe=function(b,c,d,e,f,g,h){var i={shape:c,radius:d,tessellation:e,sideOrientation:h,updatable:g};return a.MeshBuilder.CreateLathe(b,i,f)},d.CreatePlane=function(b,c,d,e,f){var g={size:c,width:c,height:c,sideOrientation:f,updatable:e};return a.MeshBuilder.CreatePlane(b,g,d)},d.CreateGround=function(b,c,d,e,f,g){var h={width:c,height:d,subdivisions:e,updatable:g};return a.MeshBuilder.CreateGround(b,h,f)},d.CreateTiledGround=function(b,c,d,e,f,g,h,i,j){var k={xmin:c,zmin:d,xmax:e,zmax:f,subdivisions:g,precision:h,updatable:j};return a.MeshBuilder.CreateTiledGround(b,k,i)},d.CreateGroundFromHeightMap=function(b,c,d,e,f,g,h,i,j,k){var l={width:d,height:e,subdivisions:f,minHeight:g,maxHeight:h,updatable:j,onReady:k};return a.MeshBuilder.CreateGroundFromHeightMap(b,c,l,i)},d.CreateTube=function(b,c,d,e,f,g,h,i,j,k){var l={path:c,radius:d,tessellation:e,radiusFunction:f,arc:1,cap:g,updatable:i,sideOrientation:j,instance:k};return a.MeshBuilder.CreateTube(b,l,h)},d.CreatePolyhedron=function(b,c,d){return a.MeshBuilder.CreatePolyhedron(b,c,d)},d.CreateIcoSphere=function(b,c,d){return a.MeshBuilder.CreateIcoSphere(b,c,d)},d.CreateDecal=function(b,c,d,e,f,g){var h={position:d,normal:e,size:f,angle:g};return a.MeshBuilder.CreateDecal(b,c,h)},d.prototype.setPositionsForCPUSkinning=function(){var b;return this._sourcePositions||(b=this.getVerticesData(a.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(b),this.getVertexBuffer(a.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(a.VertexBuffer.PositionKind,b,!0)),this._sourcePositions},d.prototype.setNormalsForCPUSkinning=function(){var b;return this._sourceNormals||(b=this.getVerticesData(a.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(b),this.getVertexBuffer(a.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(a.VertexBuffer.NormalKind,b,!0)),this._sourceNormals},d.prototype.applySkeleton=function(b){if(this.geometry&&this.geometry._softwareSkinningRenderId!=this.getScene().getRenderId()){if(this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(a.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(a.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsKind))return this;this._sourcePositions||this.setPositionsForCPUSkinning(),this._sourceNormals||this.setNormalsForCPUSkinning();var c=this.getVerticesData(a.VertexBuffer.PositionKind);c instanceof Float32Array||(c=new Float32Array(c));var d=this.getVerticesData(a.VertexBuffer.NormalKind);d instanceof Float32Array||(d=new Float32Array(d));for(var e,f=this.getVerticesData(a.VertexBuffer.MatricesIndicesKind),g=this.getVerticesData(a.VertexBuffer.MatricesWeightsKind),h=this.numBoneInfluencers>4,i=h?this.getVerticesData(a.VertexBuffer.MatricesIndicesExtraKind):null,j=h?this.getVerticesData(a.VertexBuffer.MatricesWeightsExtraKind):null,k=b.getTransformMatrices(this),l=a.Vector3.Zero(),m=new a.Matrix,n=new a.Matrix,o=0,p=0;p<c.length;p+=3,o+=4){var q;for(e=0;4>e&&(q=g[o+e],q>0);e++)a.Matrix.FromFloat32ArrayToRefScaled(k,16*f[o+e],q,n),m.addToSelf(n);if(h)for(e=0;4>e&&(q=j[o+e],q>0);e++)a.Matrix.FromFloat32ArrayToRefScaled(k,16*i[o+e],q,n),m.addToSelf(n);a.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[p],this._sourcePositions[p+1],this._sourcePositions[p+2],m,l),l.toArray(c,p),a.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[p],this._sourceNormals[p+1],this._sourceNormals[p+2],m,l),l.toArray(d,p),m.reset()}return this.updateVerticesData(a.VertexBuffer.PositionKind,c),this.updateVerticesData(a.VertexBuffer.NormalKind,d),this}},d.MinMax=function(a){var b=null,c=null;for(var d in a){var e=a[d],f=e.getBoundingInfo().boundingBox;b?(b.MinimizeInPlace(f.minimumWorld),c.MaximizeInPlace(f.maximumWorld)):(b=f.minimumWorld,c=f.maximumWorld)}return{min:b,max:c}},d.Center=function(b){var c=void 0!==b.min?b:d.MinMax(b);return a.Vector3.Center(c.min,c.max)},d.MergeMeshes=function(b,c,e,f){void 0===c&&(c=!0);var g;if(!e){var h=0;for(g=0;g<b.length;g++)if(b[g]&&(h+=b[g].getTotalVertices(),h>65536))return a.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var i,j,k;for(g=0;g<b.length;g++)b[g]&&(b[g].computeWorldMatrix(!0),j=a.VertexData.ExtractFromMesh(b[g],!0),j.transform(b[g].getWorldMatrix()),i?i.merge(j):(i=j,k=b[g]));if(f||(f=new d(k.name+"_merged",k.getScene())),i.applyToMesh(f),f.material=k.material,f.checkCollisions=k.checkCollisions,c)for(g=0;g<b.length;g++)b[g]&&b[g].dispose();return f},d._FRONTSIDE=0,d._BACKSIDE=1,d._DOUBLESIDE=2,d._DEFAULTSIDE=0,d._NO_CAP=0,d._CAP_START=1,d._CAP_END=2,d._CAP_ALL=3,d}(a.AbstractMesh);a.Mesh=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d,e,f,g,h){void 0===h&&(h=!0),this.materialIndex=a,this.verticesStart=b,this.verticesCount=c,this.indexStart=d,this.indexCount=e,this._renderId=0,this._mesh=f,this._renderingMesh=g||f,f.subMeshes.push(this),this._trianglePlanes=[],this._id=f.subMeshes.length-1,h&&(this.refreshBoundingInfo(),f.computeWorldMatrix(!0))}return Object.defineProperty(b.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),b.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},b.prototype.getMesh=function(){return this._mesh},b.prototype.getRenderingMesh=function(){return this._renderingMesh},b.prototype.getMaterial=function(){var b=this._renderingMesh.material;if(b&&b instanceof a.MultiMaterial){var c=b;return c.getSubMaterial(this.materialIndex)}return b?b:this._mesh.getScene().defaultMaterial},b.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,!this.IsGlobal){var b=this._renderingMesh.getVerticesData(a.VertexBuffer.PositionKind);if(!b)return void(this._boundingInfo=this._mesh._boundingInfo);var c,d=this._renderingMesh.getIndices();c=0===this.indexStart&&this.indexCount===d.length?{minimum:this._renderingMesh.getBoundingInfo().minimum.clone(),maximum:this._renderingMesh.getBoundingInfo().maximum.clone()}:a.Tools.ExtractMinAndMaxIndexed(b,d,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias),this._boundingInfo=new a.BoundingInfo(c.minimum,c.maximum)}},b.prototype._checkCollision=function(a){return this.getBoundingInfo()._checkCollision(a)},b.prototype.updateBoundingInfo=function(a){this.getBoundingInfo()||this.refreshBoundingInfo(),this.getBoundingInfo().update(a)},b.prototype.isInFrustum=function(a){return this.getBoundingInfo().isInFrustum(a)},b.prototype.render=function(a){this._renderingMesh.render(this,a)},b.prototype.getLinesIndexBuffer=function(a,b){if(!this._linesIndexBuffer){for(var c=[],d=this.indexStart;d<this.indexStart+this.indexCount;d+=3)c.push(a[d],a[d+1],a[d+1],a[d+2],a[d+2],a[d]);this._linesIndexBuffer=b.createIndexBuffer(c),this.linesIndexCount=c.length}return this._linesIndexBuffer},b.prototype.canIntersects=function(a){return a.intersectsBox(this.getBoundingInfo().boundingBox)},b.prototype.intersects=function(b,c,d,e){var f=null;if(this._mesh instanceof a.LinesMesh)for(var g=this._mesh,h=this.indexStart;h<this.indexStart+this.indexCount;h+=2){var i=c[d[h]],j=c[d[h+1]],k=b.intersectionSegment(i,j,g.intersectionThreshold);if(!(0>k)&&(e||!f||k<f.distance)&&(f=new a.IntersectionInfo(null,null,k),e))break}else for(var h=this.indexStart;h<this.indexStart+this.indexCount;h+=3){var i=c[d[h]],j=c[d[h+1]],l=c[d[h+2]],m=b.intersectsTriangle(i,j,l);if(m){if(m.distance<0)continue;if((e||!f||m.distance<f.distance)&&(f=m,f.faceId=h/3,e))break}}return f},b.prototype.clone=function(c,d){var e=new b(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,c,d,!1);return this.IsGlobal||(e._boundingInfo=new a.BoundingInfo(this.getBoundingInfo().minimum,this.getBoundingInfo().maximum)),e},b.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var a=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(a,1)},b.CreateFromIndices=function(a,c,d,e,f){var g=Number.MAX_VALUE,h=-Number.MAX_VALUE;f=f||e;for(var i=f.getIndices(),j=c;c+d>j;j++){var k=i[j];g>k&&(g=k),k>h&&(h=k)}return new b(a,g,h-g+1,c,d,e,f)},b}();a.SubMesh=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return b.CreateBox=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateBox(c);return f.applyToMesh(e,c.updatable),e},b.CreateSphere=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateSphere(c);return f.applyToMesh(e,c.updatable),e},b.CreateDisc=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateDisc(c);return f.applyToMesh(e,c.updatable),e},b.CreateIcoSphere=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateIcoSphere(c);return f.applyToMesh(e,c.updatable),e},b.CreateRibbon=function(b,c,d){var e=c.pathArray,f=c.closeArray,g=c.closePath,h=(c.offset,c.sideOrientation),i=c.instance,j=c.updatable;if(i){var k=function(b){for(var c=e[0].length,d=0,f=i.sideOrientation===a.Mesh.DOUBLESIDE?2:1,g=1;f>=g;g++)for(var h=0;h<e.length;h++){var j=e[h],k=j.length;c=k>c?c:k;for(var l=0;c>l;)b[d]=j[l].x,b[d+1]=j[l].y,b[d+2]=j[l].z,l++,d+=3;i._closePath&&(b[d]=j[0].x,b[d+1]=j[0].y,b[d+2]=j[0].z,d+=3)}},l=i.getVerticesData(a.VertexBuffer.PositionKind);if(k(l),i.updateVerticesData(a.VertexBuffer.PositionKind,l,!1,!1),!i.areNormalsFrozen){var m=i.getIndices(),n=i.getVerticesData(a.VertexBuffer.NormalKind);if(a.VertexData.ComputeNormals(l,m,n),i._closePath)for(var o=0,p=0,q=0;q<e.length;q++)o=3*i._idx[q],p=q+1<e.length?3*(i._idx[q+1]-1):n.length-3,n[o]=.5*(n[o]+n[p]),n[o+1]=.5*(n[o+1]+n[p+1]),n[o+2]=.5*(n[o+2]+n[p+2]),n[p]=n[o],n[p+1]=n[o+1],n[p+2]=n[o+2];i.updateVerticesData(a.VertexBuffer.NormalKind,n,!1,!1)}return i}var r=new a.Mesh(b,d);r.sideOrientation=h;var s=a.VertexData.CreateRibbon(c);return g&&(r._idx=s._idx),r._closePath=g,r._closeArray=f,s.applyToMesh(r,j),r},b.CreateCylinder=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateCylinder(c);return f.applyToMesh(e,c.updatable),e},b.CreateTorus=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateTorus(c);return f.applyToMesh(e,c.updatable),e},b.CreateTorusKnot=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateTorusKnot(c);return f.applyToMesh(e,c.updatable),e},b.CreateLineSystem=function(b,c,d){var e=c.instance,f=c.lines;if(e){var g=function(a){for(var b=0,c=0;c<f.length;c++)for(var d=f[c],e=0;e<d.length;e++)a[b]=d[e].x,a[b+1]=d[e].y,a[b+2]=d[e].z,b+=3};return e.updateMeshPositions(g,!1),e}var h=new a.LinesMesh(b,d),i=a.VertexData.CreateLineSystem(c);return i.applyToMesh(h,c.updatable),h},b.CreateLines=function(a,c,d){var e=b.CreateLineSystem(a,{lines:[c.points],updatable:c.updatable,instance:c.instance},d);return e},b.CreateDashedLines=function(b,c,d){var e=c.points,f=c.instance,g=c.gapSize,h=(c.dashNb,c.dashSize);if(f){var i=function(b){var c=a.Vector3.Zero(),d=b.length/6,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0;for(m=0;m<e.length-1;m++)e[m+1].subtractToRef(e[m],c),g+=c.length();for(i=g/d,j=f.dashSize*i/(f.dashSize+f.gapSize),m=0;m<e.length-1;m++)for(e[m+1].subtractToRef(e[m],c),h=Math.floor(c.length()/i),c.normalize(),n=0;h>n&&l<b.length;)k=i*n,b[l]=e[m].x+k*c.x,b[l+1]=e[m].y+k*c.y,b[l+2]=e[m].z+k*c.z,b[l+3]=e[m].x+(k+j)*c.x,b[l+4]=e[m].y+(k+j)*c.y,b[l+5]=e[m].z+(k+j)*c.z,l+=6,n++;for(;l<b.length;)b[l]=e[m].x,b[l+1]=e[m].y,b[l+2]=e[m].z,l+=3};return f.updateMeshPositions(i,!1),f}var j=new a.LinesMesh(b,d),k=a.VertexData.CreateDashedLines(c);return k.applyToMesh(j,c.updatable),j.dashSize=h,j.gapSize=g,j},b.ExtrudeShape=function(c,d,e){var f=d.path,g=d.shape,h=d.scale||1,i=d.rotation||0,j=0===d.cap?0:d.cap||a.Mesh.NO_CAP,k=d.updatable,l=0===d.sideOrientation?0:d.sideOrientation||a.Mesh.DEFAULTSIDE,m=d.instance;return b._ExtrudeShapeGeneric(c,g,f,h,i,null,null,!1,!1,j,!1,e,k,l,m)},b.ExtrudeShapeCustom=function(c,d,e){var f=d.path,g=d.shape,h=d.scaleFunction||function(){return 1},i=d.rotationFunction||function(){return 0},j=d.ribbonCloseArray||!1,k=d.ribbonClosePath||!1,l=0===d.cap?0:d.cap||a.Mesh.NO_CAP,m=d.updatable,n=0===d.sideOrientation?0:d.sideOrientation||a.Mesh.DEFAULTSIDE,o=d.instance;return b._ExtrudeShapeGeneric(c,g,f,null,null,h,i,j,k,l,!0,e,m,n,o)},b.CreateLathe=function(c,d,e){var f,g=d.arc<=0||d.arc>1?1:d.arc||1,h=void 0===d.closed?!0:d.closed,i=d.shape,j=d.radius||1,k=d.tessellation||64,l=d.updatable,m=0===d.sideOrientation?0:d.sideOrientation||a.Mesh.DEFAULTSIDE,n=d.cap||a.Mesh.NO_CAP,o=2*Math.PI,p=new Array,q=0,r=0,s=o/k*g,t=new Array;for(q=0;k>=q;q++){var t=[];for(n!=a.Mesh.CAP_START&&n!=a.Mesh.CAP_ALL||(t.push(new a.Vector3(0,i[0].y,0)),t.push(new a.Vector3(Math.cos(q*s)*i[0].x*j,i[0].y,Math.sin(q*s)*i[0].x*j))),r=0;r<i.length;r++)f=new a.Vector3(Math.cos(q*s)*i[r].x*j,i[r].y,Math.sin(q*s)*i[r].x*j),t.push(f);n!=a.Mesh.CAP_END&&n!=a.Mesh.CAP_ALL||(t.push(new a.Vector3(Math.cos(q*s)*i[i.length-1].x*j,i[i.length-1].y,Math.sin(q*s)*i[i.length-1].x*j)),t.push(new a.Vector3(0,i[i.length-1].y,0))),p.push(t)}var u=b.CreateRibbon(c,{pathArray:p,closeArray:h,sideOrientation:m,updatable:l},e);return u},b.CreatePlane=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreatePlane(c);if(f.applyToMesh(e,c.updatable),c.sourcePlane){e.translate(c.sourcePlane.normal,c.sourcePlane.d);var g=Math.acos(a.Vector3.Dot(c.sourcePlane.normal,a.Axis.Z)),h=a.Vector3.Cross(a.Axis.Z,c.sourcePlane.normal);e.rotate(h,g)}return e},b.CreateGround=function(b,c,d){var e=new a.GroundMesh(b,d);e._setReady(!1),e._subdivisions=c.subdivisions||1,e._width=c.width||1,e._height=c.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ;var f=a.VertexData.CreateGround(c);return f.applyToMesh(e,c.updatable),e._setReady(!0),e},b.CreateTiledGround=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreateTiledGround(c);return f.applyToMesh(e,c.updatable),e},b.CreateGroundFromHeightMap=function(b,c,d,e){var f=d.width||10,g=d.height||10,h=d.subdivisions||1,i=d.minHeight,j=d.maxHeight||10,k=d.updatable,l=d.onReady,m=new a.GroundMesh(b,e);m._subdivisions=h,m._width=f,m._height=g,m._maxX=m._width/2,m._maxZ=m._height/2,m._minX=-m._maxX,m._minZ=-m._maxZ,m._setReady(!1);var n=function(b){var c=document.createElement("canvas"),d=c.getContext("2d"),e=b.width,n=b.height;c.width=e,c.height=n,d.drawImage(b,0,0);var o=d.getImageData(0,0,e,n).data,p=a.VertexData.CreateGroundFromHeightMap({width:f,height:g,subdivisions:h,minHeight:i,maxHeight:j,buffer:o,bufferWidth:e,bufferHeight:n});p.applyToMesh(m,k),m._setReady(!0),l&&l(m)};return a.Tools.LoadImage(c,n,function(){},e.database),m},b.CreateTube=function(c,d,e){var f=d.path,g=d.radius||1,h=d.tessellation||64,i=d.radiusFunction,j=d.cap||a.Mesh.NO_CAP,k=d.updatable,l=d.sideOrientation||a.Mesh.DEFAULTSIDE,m=d.instance;d.arc=d.arc<=0||d.arc>1?1:d.arc||1;var n,o,p=function(b,c,d,e,f,g,h,i){for(var j,k,l,m,n=c.getTangents(),o=c.getNormals(),p=c.getDistances(),q=2*Math.PI,r=q/f*i,s=function(){return e},t=g||s,u=a.Tmp.Matrix[0],v=h===a.Mesh._NO_CAP||h===a.Mesh.CAP_END?0:2,w=0;w<b.length;w++){k=t(w,p[w]),j=Array(),l=o[w];for(var x=0;f>x;x++)a.Matrix.RotationAxisToRef(n[w],r*x,u),m=j[x]?j[x]:a.Vector3.Zero(),a.Vector3.TransformCoordinatesToRef(l,u,m),m.scaleInPlace(k).addInPlace(b[w]),j[x]=m;d[v]=j,v++}var y=function(a,c){for(var d=Array(),e=0;a>e;e++)d.push(b[c]);return d};switch(h){case a.Mesh.NO_CAP:break;case a.Mesh.CAP_START:d[0]=y(f,0),d[1]=d[2].slice(0);break;case a.Mesh.CAP_END:d[v]=d[v-1].slice(0),d[v+1]=y(f,b.length-1);break;case a.Mesh.CAP_ALL:d[0]=y(f,0),d[1]=d[2].slice(0),d[v]=d[v-1].slice(0),d[v+1]=y(f,b.length-1)}return d};if(m){var q=d.arc||m.arc;return n=m.path3D.update(f),o=p(f,n,m.pathArray,g,m.tessellation,i,m.cap,q),m=b.CreateRibbon(null,{pathArray:o,instance:m}),m.path3D=n,m.pathArray=o,m.arc=q,m}n=new a.Path3D(f);var r=new Array;j=0>j||j>3?0:j,o=p(f,n,r,g,h,i,j,d.arc);var s=b.CreateRibbon(c,{pathArray:o,closePath:!0,closeArray:!1,updatable:k,sideOrientation:l},e);return s.pathArray=o,s.path3D=n,s.tessellation=h,s.cap=j,s.arc=d.arc,s},b.CreatePolyhedron=function(b,c,d){var e=new a.Mesh(b,d),f=a.VertexData.CreatePolyhedron(c);return f.applyToMesh(e,c.updatable),e},b.CreateDecal=function(b,c,d){var e=c.getIndices(),f=c.getVerticesData(a.VertexBuffer.PositionKind),g=c.getVerticesData(a.VertexBuffer.NormalKind),h=d.position||a.Vector3.Zero(),i=d.normal||a.Vector3.Up(),j=d.size||new a.Vector3(1,1,1),k=d.angle||0;if(!i){var l=new a.Vector3(0,0,1),m=c.getScene().activeCamera,n=a.Vector3.TransformCoordinates(l,m.getWorldMatrix());i=m.globalPosition.subtract(n)}var o=-Math.atan2(i.z,i.x)-Math.PI/2,p=Math.sqrt(i.x*i.x+i.z*i.z),q=Math.atan2(i.y,p),r=a.Matrix.RotationYawPitchRoll(o,q,k).multiply(a.Matrix.Translation(h.x,h.y,h.z)),s=a.Matrix.Invert(r),t=c.getWorldMatrix(),u=t.multiply(s),v=new a.VertexData;v.indices=[],v.positions=[],v.normals=[],v.uvs=[];for(var w=0,x=function(b){var c=e[b],d=new a.PositionNormalVertex;return d.position=new a.Vector3(f[3*c],f[3*c+1],f[3*c+2]),d.position=a.Vector3.TransformCoordinates(d.position,u),d.normal=new a.Vector3(g[3*c],g[3*c+1],g[3*c+2]),d},y=function(b,c){if(0===b.length)return b;for(var d=.5*Math.abs(a.Vector3.Dot(j,c)),e=function(b,e){var f=a.Vector3.GetClipFactor(b.position,e.position,c,d);return new a.PositionNormalVertex(a.Vector3.Lerp(b.position,e.position,f),a.Vector3.Lerp(b.normal,e.normal,f))},f=new Array,g=0;g<b.length;g+=3){var h,i,k,l,m,n,o,p=0,q=a.Vector3.Dot(b[g].position,c)-d,r=a.Vector3.Dot(b[g+1].position,c)-d,s=a.Vector3.Dot(b[g+2].position,c)-d;switch(h=q>0,i=r>0,k=s>0,p=(h?1:0)+(i?1:0)+(k?1:0)){case 0:f.push(b[g]),f.push(b[g+1]),f.push(b[g+2]);break;case 1:if(h&&(l=b[g+1],m=b[g+2],n=e(b[g],l),o=e(b[g],m)),i){l=b[g],m=b[g+2],n=e(b[g+1],l),o=e(b[g+1],m),f.push(n),f.push(m.clone()),f.push(l.clone()),f.push(m.clone()),f.push(n.clone()),f.push(o);break}k&&(l=b[g],m=b[g+1],n=e(b[g+2],l),o=e(b[g+2],m)),f.push(l.clone()),f.push(m.clone()),f.push(n),f.push(o),f.push(n.clone()),f.push(m.clone());break;case 2:h||(l=b[g].clone(),m=e(l,b[g+1]),n=e(l,b[g+2]),f.push(l),f.push(m),f.push(n)),i||(l=b[g+1].clone(),m=e(l,b[g+2]),n=e(l,b[g]),f.push(l),f.push(m),f.push(n)),k||(l=b[g+2].clone(),m=e(l,b[g]),n=e(l,b[g+1]),f.push(l),f.push(m),f.push(n));break;case 3:}}return f},z=0;z<e.length;z+=3){var A=new Array;if(A.push(x(z)),A.push(x(z+1)),A.push(x(z+2)),A=y(A,new a.Vector3(1,0,0)),A=y(A,new a.Vector3(-1,0,0)),A=y(A,new a.Vector3(0,1,0)),A=y(A,new a.Vector3(0,-1,0)),A=y(A,new a.Vector3(0,0,1)),A=y(A,new a.Vector3(0,0,-1)),0!==A.length)for(var B=0;B<A.length;B++){var C=A[B];v.indices.push(w),C.position.toArray(v.positions,3*w),C.normal.toArray(v.normals,3*w),v.uvs.push(.5+C.position.x/j.x),v.uvs.push(.5+C.position.y/j.y),w++}}var D=new a.Mesh(b,c.getScene());return v.applyToMesh(D),D.position=h.clone(),D.rotation=new a.Vector3(q,o,k),
D},b._ExtrudeShapeGeneric=function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=function(b,c,d,e,f,g,h,i,j,k){for(var l=d.getTangents(),m=d.getNormals(),n=d.getBinormals(),o=d.getDistances(),p=0,q=function(){return f},r=function(){return g},s=k?i:r,t=k?h:q,u=j===a.Mesh.NO_CAP||j===a.Mesh.CAP_END?0:2,v=a.Tmp.Matrix[0],w=0;w<c.length;w++){for(var x=new Array,y=s(w,o[w]),z=t(w,o[w]),A=0;A<b.length;A++){a.Matrix.RotationAxisToRef(l[w],p,v);var B=l[w].scale(b[A].z).add(m[w].scale(b[A].x)).add(n[w].scale(b[A].y)),C=x[A]?x[A]:a.Vector3.Zero();a.Vector3.TransformCoordinatesToRef(B,v,C),C.scaleInPlace(z).addInPlace(c[w]),x[A]=C}e[u]=x,p+=y,u++}var D=function(b){var c,d=Array(),e=a.Vector3.Zero();for(c=0;c<b.length;c++)e.addInPlace(b[c]);for(e.scaleInPlace(1/b.length),c=0;c<b.length;c++)d.push(e);return d};switch(j){case a.Mesh.NO_CAP:break;case a.Mesh.CAP_START:e[0]=D(e[2]),e[1]=e[2].slice(0);break;case a.Mesh.CAP_END:e[u]=e[u-1],e[u+1]=D(e[u-1]);break;case a.Mesh.CAP_ALL:e[0]=D(e[2]),e[1]=e[2].slice(0),e[u]=e[u-1],e[u+1]=D(e[u-1])}return e};if(p)return q=p.path3D.update(d),r=s(c,d,p.path3D,p.pathArray,e,f,g,h,p.cap,l),p=a.Mesh.CreateRibbon(null,r,null,null,null,null,null,null,p);q=new a.Path3D(d);var t=new Array;k=0>k||k>3?0:k,r=s(c,d,q,t,e,f,g,h,k,l);var u=a.Mesh.CreateRibbon(b,r,i,j,0,m,n,o);return u.pathArray=r,u.path3D=q,u.cap=k,u},b}();a.MeshBuilder=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b){this.hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this.coordinatesMode=a.Texture.EXPLICIT_MODE,this.wrapU=a.Texture.WRAP_ADDRESSMODE,this.wrapV=a.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.isCube=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new a.Observable,this.delayLoadState=a.Engine.DELAYLOADSTATE_NONE,this._scene=b,this._scene.textures.push(this)}return b.prototype.toString=function(){return this.name},Object.defineProperty(b.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getTextureMatrix=function(){return null},b.prototype.getReflectionTextureMatrix=function(){return null},b.prototype.getInternalTexture=function(){return this._texture},b.prototype.isReady=function(){return this.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED?!0:this._texture?this._texture.isReady:!1},b.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},b.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},b.prototype.scale=function(a){},Object.defineProperty(b.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),b.prototype._removeFromCache=function(a,b){for(var c=this._scene.getEngine().getLoadedTexturesCache(),d=0;d<c.length;d++){var e=c[d];if(e.url===a&&e.noMipmap===b)return void c.splice(d,1)}},b.prototype._getFromCache=function(a,b,c){for(var d=this._scene.getEngine().getLoadedTexturesCache(),e=0;e<d.length;e++){var f=d[e];if(f.url===a&&f.noMipmap===b&&(!c||c===f.samplingMode))return f.references++,f}return null},b.prototype.delayLoad=function(){},b.prototype.clone=function(){return null},b.prototype.releaseInternalTexture=function(){this._texture&&(this._scene.getEngine().releaseInternalTexture(this._texture),delete this._texture)},b.prototype.dispose=function(){this.getScene().stopAnimation(this);var a=this._scene.textures.indexOf(this);a>=0&&this._scene.textures.splice(a,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},b.prototype.serialize=function(){if(!this.name)return null;var b=a.SerializationHelper.Serialize(this);return a.Animation.AppendSerializedAnimations(this,b),b},__decorate([a.serialize()],b.prototype,"name",void 0),__decorate([a.serialize()],b.prototype,"hasAlpha",void 0),__decorate([a.serialize()],b.prototype,"getAlphaFromRGB",void 0),__decorate([a.serialize()],b.prototype,"level",void 0),__decorate([a.serialize()],b.prototype,"coordinatesIndex",void 0),__decorate([a.serialize()],b.prototype,"coordinatesMode",void 0),__decorate([a.serialize()],b.prototype,"wrapU",void 0),__decorate([a.serialize()],b.prototype,"wrapV",void 0),__decorate([a.serialize()],b.prototype,"anisotropicFilteringLevel",void 0),__decorate([a.serialize()],b.prototype,"isCube",void 0),__decorate([a.serialize()],b.prototype,"isRenderTarget",void 0),b}();a.BaseTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(d,e,f,g,h,i,j,k,l){void 0===h&&(h=c.TRILINEAR_SAMPLINGMODE),void 0===i&&(i=null),void 0===j&&(j=null),void 0===k&&(k=null),void 0===l&&(l=!1),b.call(this,e),this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.name=d,this.url=d,this._noMipmap=f,this._invertY=g,this._samplingMode=h,this._buffer=k,this._deleteBuffer=l,d&&(this._texture=this._getFromCache(d,f,h),this._texture?a.Tools.SetImmediate(function(){i&&i()}):e.useDelayedTextureLoading?(this.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED,this._delayedOnLoad=i,this._delayedOnError=j):(this._texture=e.getEngine().createTexture(d,f,g,e,this._samplingMode,i,j,this._buffer),l&&delete this._buffer))}return __extends(c,b),Object.defineProperty(c.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),c.prototype.delayLoad=function(){this.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer),this._deleteBuffer&&delete this._buffer))},c.prototype.updateSamplingMode=function(a){this._texture&&(this._samplingMode=a,this.getScene().getEngine().updateTextureSamplingMode(a,this._texture))},c.prototype._prepareRowForTextureGeneration=function(b,c,d,e){b*=this.uScale,c*=this.vScale,b-=.5*this.uScale,c-=.5*this.vScale,d-=.5,a.Vector3.TransformCoordinatesFromFloatsToRef(b,c,d,this._rowGenerationMatrix,e),e.x+=.5*this.uScale+this.uOffset,e.y+=.5*this.vScale+this.vOffset,e.z+=.5},c.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=a.Matrix.Zero(),this._rowGenerationMatrix=new a.Matrix,this._t0=a.Vector3.Zero(),this._t1=a.Vector3.Zero(),this._t2=a.Vector3.Zero()),a.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},c.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=a.Matrix.Zero(),this._projectionModeMatrix=a.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case c.PLANAR_MODE:a.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case c.PROJECTION_MODE:a.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1,this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:a.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},c.prototype.clone=function(){var b=this;return a.SerializationHelper.Clone(function(){return new c(b._texture.url,b.getScene(),b._noMipmap,b._invertY,b._samplingMode)},this)},c.CreateFromBase64String=function(a,b,d,e,f,g,h,i){return void 0===g&&(g=c.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===i&&(i=null),new c("data:"+b,d,e,f,g,h,i,a)},c.Parse=function(b,d,e){if(b.isCube)return a.CubeTexture.Parse(b,d,e);if(!b.name&&!b.isRenderTarget)return null;var f=a.SerializationHelper.Parse(function(){if(b.mirrorPlane){var f=new a.MirrorTexture(b.name,b.renderTargetSize,d);return f._waitingRenderList=b.renderList,f.mirrorPlane=a.Plane.FromArray(b.mirrorPlane),f}if(b.isRenderTarget){var g=new a.RenderTargetTexture(b.name,b.renderTargetSize,d);return g._waitingRenderList=b.renderList,g}var h;return h=b.base64String?c.CreateFromBase64String(b.base64String,b.name,d):new c(e+b.name,d)},b,d);if(b.animations)for(var g=0;g<b.animations.length;g++){var h=b.animations[g];f.animations.push(a.Animation.Parse(h))}return f},c.NEAREST_SAMPLINGMODE=1,c.BILINEAR_SAMPLINGMODE=2,c.TRILINEAR_SAMPLINGMODE=3,c.EXPLICIT_MODE=0,c.SPHERICAL_MODE=1,c.PLANAR_MODE=2,c.CUBIC_MODE=3,c.PROJECTION_MODE=4,c.SKYBOX_MODE=5,c.INVCUBIC_MODE=6,c.EQUIRECTANGULAR_MODE=7,c.FIXED_EQUIRECTANGULAR_MODE=8,c.CLAMP_ADDRESSMODE=0,c.WRAP_ADDRESSMODE=1,c.MIRROR_ADDRESSMODE=2,__decorate([a.serialize()],c.prototype,"url",void 0),__decorate([a.serialize()],c.prototype,"uOffset",void 0),__decorate([a.serialize()],c.prototype,"vOffset",void 0),__decorate([a.serialize()],c.prototype,"uScale",void 0),__decorate([a.serialize()],c.prototype,"vScale",void 0),__decorate([a.serialize()],c.prototype,"uAng",void 0),__decorate([a.serialize()],c.prototype,"vAng",void 0),__decorate([a.serialize()],c.prototype,"wAng",void 0),c}(a.BaseTexture);a.Texture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g){if(b.call(this,d),this.coordinatesMode=a.Texture.CUBIC_MODE,this.name=c,this.url=c,this._noMipmap=f,this.hasAlpha=!1,c||g){if(this._texture=this._getFromCache(c,f),!g){e||(e=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),g=[];for(var h=0;h<e.length;h++)g.push(c+e[h]);this._extensions=e}this._files=g,this._texture||(d.useDelayedTextureLoading?this.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=d.getEngine().createCubeTexture(c,d,g,f)),this.isCube=!0,this._textureMatrix=a.Matrix.Identity()}}return __extends(c,b),c.CreateFromImages=function(a,b,d){return new c("",b,null,d,a)},c.prototype.delayLoad=function(){this.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},c.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},c.Parse=function(b,c,d){var e=a.SerializationHelper.Parse(function(){return new a.CubeTexture(d+b.name,c,b.extensions)},b,c);if(b.animations)for(var f=0;f<b.animations.length;f++){var g=b.animations[f];e.animations.push(a.Animation.Parse(g))}return e},c.prototype.clone=function(){var b=this;return a.SerializationHelper.Clone(function(){return new c(b.url,b.getScene(),b._extensions,b._noMipmap,b._files)},this)},c}(a.BaseTexture);a.CubeTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i,j){void 0===g&&(g=!0),void 0===h&&(h=a.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===i&&(i=!1),void 0===j&&(j=a.Texture.TRILINEAR_SAMPLINGMODE),b.call(this,null,e,!f),this.isCube=i,this.renderList=new Array,this.renderParticles=!0,this.renderSprites=!1,this.coordinatesMode=a.Texture.PROJECTION_MODE,this.onAfterUnbindObservable=new a.Observable,this.onBeforeRenderObservable=new a.Observable,this.onAfterRenderObservable=new a.Observable,this.onClearObservable=new a.Observable,this._currentRefreshId=-1,this._refreshRate=1,this.name=c,this.isRenderTarget=!0,this._size=d,this._generateMipMaps=f,this._doNotChangeAspectRatio=g,j===a.Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE),i?(this._texture=e.getEngine().createRenderTargetCubeTexture(d,{generateMipMaps:f,samplingMode:j}),this.coordinatesMode=a.Texture.INVCUBIC_MODE,this._textureMatrix=a.Matrix.Identity()):this._texture=e.getEngine().createRenderTargetTexture(d,{generateMipMaps:f,type:h,samplingMode:j}),this._renderingManager=new a.RenderingManager(e)}return __extends(c,b),Object.defineProperty(c,"REFRESHRATE_RENDER_ONCE",{get:function(){return c._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return c._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(c,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterUnbind",{set:function(a){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onClear",{set:function(a){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(a)},enumerable:!0,configurable:!0}),c.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),c.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},c.prototype.isReady=function(){return this.getScene().renderTargetsEnabled?b.prototype.isReady.call(this):!1},c.prototype.getRenderSize=function(){return this._size},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.scale=function(a){var b=this._size*a;this.resize(b,this._generateMipMaps)},c.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:b.prototype.getReflectionTextureMatrix.call(this)},c.prototype.resize=function(a,b){this.releaseInternalTexture(),this.isCube?this._texture=this.getScene().getEngine().createRenderTargetCubeTexture(a):this._texture=this.getScene().getEngine().createRenderTargetTexture(a,b)},c.prototype.render=function(a,b){var c=this.getScene();if(void 0!==this.useCameraPostProcesses&&(a=this.useCameraPostProcesses),this.activeCamera&&this.activeCamera!==c.activeCamera&&c.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0)),this._waitingRenderList){this.renderList=[];for(var d=0;d<this._waitingRenderList.length;d++){var e=this._waitingRenderList[d];this.renderList.push(c.getMeshByID(e))}delete this._waitingRenderList}if(this.renderListPredicate){this.renderList.splice(0);for(var f=this.getScene().meshes,d=0;d<f.length;d++){var g=f[d];this.renderListPredicate(g)&&this.renderList.push(g)}}if(!this.renderList||0!==this.renderList.length){this._renderingManager.reset();for(var h=this.renderList?this.renderList:c.getActiveMeshes().data,i=c.getRenderId(),j=0;j<h.length;j++){var g=h[j];if(g){if(!g.isReady()){this.resetRefreshCounter();continue}if(g._preActivateForIntermediateRendering(i),g.isEnabled()&&g.isVisible&&g.subMeshes&&0!==(g.layerMask&c.activeCamera.layerMask)){g._activate(i);for(var k=0;k<g.subMeshes.length;k++){var l=g.subMeshes[k];c._activeIndices+=l.indexCount,this._renderingManager.dispatch(l)}}}}if(this.isCube)for(var m=0;6>m;m++)this.renderToTarget(m,h,a,b),c.incrementRenderId(),c.resetCachedMaterial();else this.renderToTarget(0,h,a,b);this.onAfterUnbindObservable.notifyObservers(this),this.activeCamera&&this.activeCamera!==c.activeCamera&&c.setTransformMatrix(c.activeCamera.getViewMatrix(),c.activeCamera.getProjectionMatrix(!0)),c.resetCachedMaterial()}},c.prototype.renderToTarget=function(b,c,d,e){var f=this.getScene(),g=f.getEngine();d&&f.postProcessManager._prepareFrame(this._texture)||(this.isCube?g.bindFramebuffer(this._texture,b):g.bindFramebuffer(this._texture)),this.onBeforeRenderObservable.notifyObservers(b),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(g):g.clear(f.clearColor,!0,!0),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,c,this.renderParticles,this.renderSprites),d&&f.postProcessManager._finalizeFrame(!1,this._texture,b),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0),this.onAfterRenderObservable.notifyObservers(b),e&&a.Tools.DumpFramebuffer(this._size,this._size,g),this.isCube&&5!==b||(this.isCube&&5===b&&g.generateMipMapsForCubemap(this._texture),g.unBindFramebuffer(this._texture,this.isCube))},c.prototype.clone=function(){var a=this.getSize(),b=new c(this.name,a.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b.renderList=this.renderList.slice(0),b},c.prototype.serialize=function(){if(!this.name)return null;var a=b.prototype.serialize.call(this);a.renderTargetSize=this.getRenderSize(),a.renderList=[];for(var c=0;c<this.renderList.length;c++)a.renderList.push(this.renderList[c].id);return a},c._REFRESHRATE_RENDER_ONCE=0,c._REFRESHRATE_RENDER_ONEVERYFRAME=1,c._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,c}(a.Texture);a.RenderTargetTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i){void 0===h&&(h=!0),void 0===i&&(i=!1),b.call(this,null,f,!h),this.isCube=i,this.isEnabled=!0,this._currentRefreshId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._textures=new Array,this._floats=new Array,this._floatsArrays={},this._colors3=new Array,this._colors4=new Array,this._vectors2=new Array,this._vectors3=new Array,this._matrices=new Array,this._fallbackTextureUsed=!1,f._proceduralTextures.push(this),this.name=c,this.isRenderTarget=!0,this._size=d,this._generateMipMaps=h,this.setFragment(e),this._fallbackTexture=g;var j=f.getEngine();i?(this._texture=j.createRenderTargetCubeTexture(d,{generateMipMaps:h}),this.setFloat("face",0)):this._texture=j.createRenderTargetTexture(d,h);var k=[];k.push(1,1),k.push(-1,1),k.push(-1,-1),k.push(1,-1),this._vertexBuffers[a.VertexBuffer.PositionKind]=new a.VertexBuffer(j,k,a.VertexBuffer.PositionKind,!1,!1,2);var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=j.createIndexBuffer(l)}return __extends(c,b),c.prototype.reset=function(){if(void 0!==this._effect){var a=this.getScene().getEngine();a._releaseEffect(this._effect)}},c.prototype.isReady=function(){var b,c=this,d=this.getScene().getEngine();return this._fragment?this._fallbackTextureUsed?!0:(b=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=d.createEffect(b,[a.VertexBuffer.PositionKind],this._uniforms,this._samplers,"",null,null,function(){c.releaseInternalTexture(),c._fallbackTexture&&(c._texture=c._fallbackTexture._texture,c._texture.references++),c._fallbackTextureUsed=!0}),this._effect.isReady()):!1},c.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},c.prototype.setFragment=function(a){this._fragment=a},Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(a){this._refreshRate=a,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),c.prototype._shouldRender=function(){return this.isEnabled&&this.isReady()&&this._texture?this._fallbackTextureUsed?!1:-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1):!1},c.prototype.getRenderSize=function(){return this._size},c.prototype.resize=function(a,b){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(a,b))},c.prototype._checkUniform=function(a){-1===this._uniforms.indexOf(a)&&this._uniforms.push(a)},c.prototype.setTexture=function(a,b){return-1===this._samplers.indexOf(a)&&this._samplers.push(a),this._textures[a]=b,this},c.prototype.setFloat=function(a,b){return this._checkUniform(a),this._floats[a]=b,this},c.prototype.setFloats=function(a,b){return this._checkUniform(a),this._floatsArrays[a]=b,this},c.prototype.setColor3=function(a,b){return this._checkUniform(a),this._colors3[a]=b,this},c.prototype.setColor4=function(a,b){return this._checkUniform(a),this._colors4[a]=b,this},c.prototype.setVector2=function(a,b){return this._checkUniform(a),this._vectors2[a]=b,this},c.prototype.setVector3=function(a,b){return this._checkUniform(a),this._vectors3[a]=b,this},c.prototype.setMatrix=function(a,b){return this._checkUniform(a),this._matrices[a]=b,this},c.prototype.render=function(a){var b=this.getScene(),c=b.getEngine();c.enableEffect(this._effect),c.setState(!1);for(var d in this._textures)this._effect.setTexture(d,this._textures[d]);for(d in this._floats)this._effect.setFloat(d,this._floats[d]);for(d in this._floatsArrays)this._effect.setArray(d,this._floatsArrays[d]);for(d in this._colors3)this._effect.setColor3(d,this._colors3[d]);for(d in this._colors4){var e=this._colors4[d];this._effect.setFloat4(d,e.r,e.g,e.b,e.a)}for(d in this._vectors2)this._effect.setVector2(d,this._vectors2[d]);for(d in this._vectors3)this._effect.setVector3(d,this._vectors3[d]);for(d in this._matrices)this._effect.setMatrix(d,this._matrices[d]);if(c.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.isCube)for(var f=0;6>f;f++)c.bindFramebuffer(this._texture,f),this._effect.setFloat("face",f),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6),5===f&&c.generateMipMapsForCubemap(this._texture);else c.bindFramebuffer(this._texture),c.clear(b.clearColor,!0,!0),c.draw(!0,0,6);c.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated()},c.prototype.clone=function(){var a=this.getSize(),b=new c(this.name,a.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.coordinatesMode=this.coordinatesMode,b},c.prototype.dispose=function(){var c=this.getScene()._proceduralTextures.indexOf(this);c>=0&&this.getScene()._proceduralTextures.splice(c,1);var d=this._vertexBuffers[a.VertexBuffer.PositionKind];d&&(d.dispose(),this._vertexBuffers[a.VertexBuffer.PositionKind]=null),this._indexBuffer&&this.getScene().getEngine()._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),b.prototype.dispose.call(this)},c}(a.Texture);a.ProceduralTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){var g=this;b.call(this,c,d,e,f,!0),this.mirrorPlane=new a.Plane(0,1,0,1),this._transformMatrix=a.Matrix.Zero(),this._mirrorMatrix=a.Matrix.Zero(),this.onBeforeRenderObservable.add(function(){a.Matrix.ReflectionToRef(g.mirrorPlane,g._mirrorMatrix),g._savedViewMatrix=e.getViewMatrix(),g._mirrorMatrix.multiplyToRef(g._savedViewMatrix,g._transformMatrix),e.setTransformMatrix(g._transformMatrix,e.getProjectionMatrix()),e.clipPlane=g.mirrorPlane,e.getEngine().cullBackFaces=!1,e._mirroredCameraPosition=a.Vector3.TransformCoordinates(e.activeCamera.position,g._mirrorMatrix)}),this.onAfterRenderObservable.add(function(){e.setTransformMatrix(g._savedViewMatrix,e.getProjectionMatrix()),e.getEngine().cullBackFaces=!0,e._mirroredCameraPosition=null,delete e.clipPlane})}return __extends(c,b),c.prototype.clone=function(){var a=this.getSize(),b=new c(this.name,a.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.mirrorPlane=this.mirrorPlane.clone(),b.renderList=this.renderList.slice(0),b},c.prototype.serialize=function(){if(!this.name)return null;var a=b.prototype.serialize.call(this);return a.mirrorPlane=this.mirrorPlane.asArray(),a},c}(a.RenderTargetTexture);a.MirrorTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){var g=this;b.call(this,c,d,e,f,!0),this.refractionPlane=new a.Plane(0,1,0,1),this.depth=2,this.onBeforeRenderObservable.add(function(){e.clipPlane=g.refractionPlane}),this.onAfterRenderObservable.add(function(){delete e.clipPlane})}return __extends(c,b),c.prototype.clone=function(){var a=this.getSize(),b=new c(this.name,a.width,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.refractionPlane=this.refractionPlane.clone(),b.renderList=this.renderList.slice(0),b.depth=this.depth,b},c.prototype.serialize=function(){if(!this.name)return null;var a=b.prototype.serialize.call(this);return a.mirrorPlane=this.refractionPlane.asArray(),a.depth=this.depth,a},c}(a.RenderTargetTexture);a.RefractionTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g){void 0===g&&(g=a.Texture.TRILINEAR_SAMPLINGMODE),b.call(this,null,e,!f),this.name=c,this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=f,d.getContext?(this._canvas=d,this._texture=e.getEngine().createDynamicTexture(d.width,d.height,f,g)):(this._canvas=document.createElement("canvas"),d.width?this._texture=e.getEngine().createDynamicTexture(d.width,d.height,f,g):this._texture=e.getEngine().createDynamicTexture(d,d,f,g));var h=this.getSize();this._canvas.width=h.width,this._canvas.height=h.height,this._context=this._canvas.getContext("2d")}return __extends(c,b),Object.defineProperty(c.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),c.prototype.scale=function(a){var b=this.getSize();b.width*=a,b.height*=a,this._canvas.width=b.width,this._canvas.height=b.height,this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createDynamicTexture(b.width,b.height,this._generateMipMaps,this._samplingMode)},c.prototype.getContext=function(){return this._context},c.prototype.clear=function(){var a=this.getSize();this._context.fillRect(0,0,a.width,a.height)},c.prototype.update=function(a){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===a?!0:a)},c.prototype.drawText=function(a,b,c,d,e,f,g,h){void 0===h&&(h=!0);var i=this.getSize();if(f&&(this._context.fillStyle=f,this._context.fillRect(0,0,i.width,i.height)),this._context.font=d,null===b){var j=this._context.measureText(a);b=(i.width-j.width)/2}this._context.fillStyle=e,this._context.fillText(a,b,c),h&&this.update(g)},c.prototype.clone=function(){var a=this.getSize(),b=new c(this.name,a,this.getScene(),this._generateMipMaps);return b.hasAlpha=this.hasAlpha,b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b},c}(a.Texture);a.DynamicTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h){var i=this;void 0===f&&(f=!1),void 0===g&&(g=!1),void 0===h&&(h=a.Texture.TRILINEAR_SAMPLINGMODE),b.call(this,null,e,!f,g),this._autoLaunch=!0;var j;this.name=c,d instanceof HTMLVideoElement?this.video=d:(j=d,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0),this._generateMipMaps=f,this._samplingMode=h,a.Tools.IsExponentOfTwo(this.video.videoWidth)&&a.Tools.IsExponentOfTwo(this.video.videoHeight)?(this.wrapU=a.Texture.WRAP_ADDRESSMODE,this.wrapV=a.Texture.WRAP_ADDRESSMODE):(this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=!1),j?(this.video.addEventListener("canplaythrough",function(){i._createTexture()}),j.forEach(function(a){var b=document.createElement("source");b.src=a,i.video.appendChild(b)})):this._createTexture(),this._lastUpdate=a.Tools.Now}return __extends(c,b),c.prototype._createTexture=function(){this._texture=this.getScene().getEngine().createDynamicTexture(this.video.videoWidth,this.video.videoHeight,this._generateMipMaps,this._samplingMode),this._texture.isReady=!0},c.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var b=a.Tools.Now;return b-this._lastUpdate<15||this.video.readyState!==this.video.HAVE_ENOUGH_DATA?!1:(this._lastUpdate=b,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},c}(a.Texture);a.VideoTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d,e,f,g){b.call(this,a,d,null,e,f,g),this._animate=!0,this._time=0,this._texturePath=c,this.loadJson(c),this.refreshRate=1}return __extends(c,b),c.prototype.loadJson=function(b){function c(){a.Tools.Log("No config file found in "+b+" trying to use ShadersStore or DOM element");try{e.setFragment(e._texturePath)}catch(c){a.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}}var d=this,e=this,f=b+"/config.json",g=new XMLHttpRequest;g.open("GET",f,!0),g.addEventListener("load",function(){if(200===g.status||a.Tools.ValidateXHRData(g,1))try{d._config=JSON.parse(g.response),d.updateShaderUniforms(),d.updateTextures(),d.setFragment(d._texturePath+"/custom"),d._animate=d._config.animate,d.refreshRate=d._config.refreshrate}catch(b){c()}else c()},!1),g.addEventListener("error",function(){c()},!1);try{g.send()}catch(h){a.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},c.prototype.isReady=function(){if(!b.prototype.isReady.call(this))return!1;for(var a in this._textures){var c=this._textures[a];if(!c.isReady())return!1}return!0},c.prototype.render=function(a){this._animate&&(this._time+=.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms()),b.prototype.render.call(this,a)},c.prototype.updateTextures=function(){for(var b=0;b<this._config.sampler2Ds.length;b++)this.setTexture(this._config.sampler2Ds[b].sample2Dname,new a.Texture(this._texturePath+"/"+this._config.sampler2Ds[b].textureRelativeUrl,this.getScene()));
},c.prototype.updateShaderUniforms=function(){if(this._config)for(var b=0;b<this._config.uniforms.length;b++){var c=this._config.uniforms[b];switch(c.type){case"float":this.setFloat(c.name,c.value);break;case"color3":this.setColor3(c.name,new a.Color3(c.r,c.g,c.b));break;case"color4":this.setColor4(c.name,new a.Color4(c.r,c.g,c.b,c.a));break;case"vector2":this.setVector2(c.name,new a.Vector2(c.x,c.y));break;case"vector3":this.setVector3(c.name,new a.Vector3(c.x,c.y,c.z))}}this.setFloat("time",this._time)},Object.defineProperty(c.prototype,"animate",{get:function(){return this._animate},set:function(a){this._animate=a},enumerable:!0,configurable:!0}),c}(a.ProceduralTexture);a.CustomProceduralTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._defines={},this._currentRank=32,this._maxRank=-1}return b.prototype.addFallback=function(a,b){this._defines[a]||(a<this._currentRank&&(this._currentRank=a),a>this._maxRank&&(this._maxRank=a),this._defines[a]=new Array),this._defines[a].push(b)},b.prototype.addCPUSkinningFallback=function(a,b){this._meshRank=a,this._mesh=b,a>this._maxRank&&(this._maxRank=a)},Object.defineProperty(b.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),b.prototype.reduce=function(b){for(var c=this._defines[this._currentRank],d=0;d<c.length;d++)b=b.replace("#define "+c[d],"");return this._mesh&&this._currentRank===this._meshRank&&(this._mesh.computeBonesUsingShaders=!1,b=b.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),a.Tools.Log("Falling back to CPU skinning for "+this._mesh.name)),this._currentRank++,b},b}();a.EffectFallbacks=b;var c=function(){function b(a,b,c,d,e,f,g,h,i,j){var k=this;this._isReady=!1,this._compilationError="",this._valueCache=[],this._engine=e,this.name=a,this.defines=f,this._uniformsNames=c.concat(d),this._samplers=d,this._attributesNames=b,this.onError=i,this.onCompiled=h,this._indexParameters=j;var l,m;a.vertexElement?(l=document.getElementById(a.vertexElement),l||(l=a.vertexElement)):l=a.vertex||a,a.fragmentElement?(m=document.getElementById(a.fragmentElement),m||(m=a.fragmentElement)):m=a.fragment||a,this._loadVertexShader(l,function(a){k._processIncludes(a,function(a){k._loadFragmentShader(m,function(c){k._processIncludes(c,function(c){k._prepareEffect(a,c,b,f,g)})})})})}return b.prototype.isReady=function(){return this._isReady},b.prototype.getProgram=function(){return this._program},b.prototype.getAttributesNames=function(){return this._attributesNames},b.prototype.getAttributeLocation=function(a){return this._attributes[a]},b.prototype.getAttributeLocationByName=function(a){var b=this._attributesNames.indexOf(a);return this._attributes[b]},b.prototype.getAttributesCount=function(){return this._attributes.length},b.prototype.getUniformIndex=function(a){return this._uniformsNames.indexOf(a)},b.prototype.getUniform=function(a){return this._uniforms[this._uniformsNames.indexOf(a)]},b.prototype.getSamplers=function(){return this._samplers},b.prototype.getCompilationError=function(){return this._compilationError},b.prototype._loadVertexShader=function(c,d){if(c instanceof HTMLElement){var e=a.Tools.GetDOMTextContent(c);return void d(e)}if(b.ShadersStore[c+"VertexShader"])return void d(b.ShadersStore[c+"VertexShader"]);var f;f="."===c[0]||"/"===c[0]||c.indexOf("http")>-1?c:a.Engine.ShadersRepository+c,a.Tools.LoadFile(f+".vertex.fx",d)},b.prototype._loadFragmentShader=function(c,d){if(c instanceof HTMLElement){var e=a.Tools.GetDOMTextContent(c);return void d(e)}if(b.ShadersStore[c+"PixelShader"])return void d(b.ShadersStore[c+"PixelShader"]);if(b.ShadersStore[c+"FragmentShader"])return void d(b.ShadersStore[c+"FragmentShader"]);var f;f="."===c[0]||"/"===c[0]||c.indexOf("http")>-1?c:a.Engine.ShadersRepository+c,a.Tools.LoadFile(f+".fragment.fx",d)},b.prototype._dumpShadersName=function(){this.name.vertexElement?(a.Tools.Error("Vertex shader:"+this.name.vertexElement),a.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(a.Tools.Error("Vertex shader:"+this.name.vertex),a.Tools.Error("Fragment shader:"+this.name.fragment)):(a.Tools.Error("Vertex shader:"+this.name),a.Tools.Error("Fragment shader:"+this.name))},b.prototype._processIncludes=function(c,d){for(var e=this,f=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,g=f.exec(c),h=new String(c);null!=g;){var i=g[1];if(!b.IncludesShadersStore[i]){var j=a.Engine.ShadersRepository+"ShadersInclude/"+i+".fx";return void a.Tools.LoadFile(j,function(a){b.IncludesShadersStore[i]=a,e._processIncludes(h,d)})}var k=b.IncludesShadersStore[i];if(g[2])for(var l=g[3].split(","),m=0;m<l.length;m+=2){var n=new RegExp(l[m],"g"),o=l[m+1];k=k.replace(n,o)}if(g[4]){var p=g[5];if(-1!==p.indexOf("..")){var q=p.split(".."),r=parseInt(q[0]),s=parseInt(q[1]),t=k.slice(0);k="",isNaN(s)&&(s=this._indexParameters[q[1]]);for(var u=r;s>=u;u++)k+=t.replace(/\{X\}/g,u)+"\n"}else k=k.replace(/\{X\}/g,p)}h=h.replace(g[0],k),g=f.exec(c)}d(h)},b.prototype._processPrecision=function(a){return-1===a.indexOf("precision highp float")?a=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+a:"precision mediump float;\n"+a:this._engine.getCaps().highPrecisionShaderSupported||(a=a.replace("precision highp float","precision mediump float")),a},b.prototype._prepareEffect=function(b,c,d,e,f){try{var g=this._engine;b=this._processPrecision(b),c=this._processPrecision(c),this._program=g.createShaderProgram(b,c,e),this._uniforms=g.getUniforms(this._program,this._uniformsNames),this._attributes=g.getAttributes(this._program,d);for(var h=0;h<this._samplers.length;h++){var i=this.getUniform(this._samplers[h]);null==i&&(this._samplers.splice(h,1),h--)}g.bindSamplers(this),this._isReady=!0,this.onCompiled&&this.onCompiled(this)}catch(j){if(-1!==j.message.indexOf("highp"))return b=b.replace("precision highp float","precision mediump float"),c=c.replace("precision highp float","precision mediump float"),void this._prepareEffect(b,c,d,e,f);f&&f.isMoreFallbacks?(a.Tools.Error("Unable to compile effect with current defines. Trying next fallback."),this._dumpShadersName(),e=f.reduce(e),this._prepareEffect(b,c,d,e,f)):(a.Tools.Error("Unable to compile effect: "),this._dumpShadersName(),a.Tools.Error("Defines: "+e),a.Tools.Error("Error: "+j.message),this._compilationError=j.message,this.onError&&this.onError(this,this._compilationError))}},Object.defineProperty(b.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),b.prototype._bindTexture=function(a,b){this._engine._bindTexture(this._samplers.indexOf(a),b)},b.prototype.setTexture=function(a,b){this._engine.setTexture(this._samplers.indexOf(a),b)},b.prototype.setTextureFromPostProcess=function(a,b){this._engine.setTextureFromPostProcess(this._samplers.indexOf(a),b)},b.prototype._cacheMatrix=function(b,c){this._valueCache[b]||(this._valueCache[b]=new a.Matrix);for(var d=0;16>d;d++)this._valueCache[b].m[d]=c.m[d]},b.prototype._cacheFloat2=function(a,b,c){return this._valueCache[a]?(this._valueCache[a][0]=b,void(this._valueCache[a][1]=c)):void(this._valueCache[a]=[b,c])},b.prototype._cacheFloat3=function(a,b,c,d){return this._valueCache[a]?(this._valueCache[a][0]=b,this._valueCache[a][1]=c,void(this._valueCache[a][2]=d)):void(this._valueCache[a]=[b,c,d])},b.prototype._cacheFloat4=function(a,b,c,d,e){return this._valueCache[a]?(this._valueCache[a][0]=b,this._valueCache[a][1]=c,this._valueCache[a][2]=d,void(this._valueCache[a][3]=e)):void(this._valueCache[a]=[b,c,d,e])},b.prototype.setArray=function(a,b){return this._engine.setArray(this.getUniform(a),b),this},b.prototype.setArray2=function(a,b){return this._engine.setArray2(this.getUniform(a),b),this},b.prototype.setArray3=function(a,b){return this._engine.setArray3(this.getUniform(a),b),this},b.prototype.setArray4=function(a,b){return this._engine.setArray4(this.getUniform(a),b),this},b.prototype.setMatrices=function(a,b){return this._engine.setMatrices(this.getUniform(a),b),this},b.prototype.setMatrix=function(a,b){return this._engine.setMatrix(this.getUniform(a),b),this},b.prototype.setMatrix3x3=function(a,b){return this._engine.setMatrix3x3(this.getUniform(a),b),this},b.prototype.setMatrix2x2=function(a,b){return this._engine.setMatrix2x2(this.getUniform(a),b),this},b.prototype.setFloat=function(a,b){return this._valueCache[a]&&this._valueCache[a]===b?this:(this._valueCache[a]=b,this._engine.setFloat(this.getUniform(a),b),this)},b.prototype.setBool=function(a,b){return this._valueCache[a]&&this._valueCache[a]===b?this:(this._valueCache[a]=b,this._engine.setBool(this.getUniform(a),b?1:0),this)},b.prototype.setVector2=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y?this:(this._cacheFloat2(a,b.x,b.y),this._engine.setFloat2(this.getUniform(a),b.x,b.y),this)},b.prototype.setFloat2=function(a,b,c){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===c?this:(this._cacheFloat2(a,b,c),this._engine.setFloat2(this.getUniform(a),b,c),this)},b.prototype.setVector3=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y&&this._valueCache[a][2]===b.z?this:(this._cacheFloat3(a,b.x,b.y,b.z),this._engine.setFloat3(this.getUniform(a),b.x,b.y,b.z),this)},b.prototype.setFloat3=function(a,b,c,d){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===c&&this._valueCache[a][2]===d?this:(this._cacheFloat3(a,b,c,d),this._engine.setFloat3(this.getUniform(a),b,c,d),this)},b.prototype.setVector4=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.x&&this._valueCache[a][1]===b.y&&this._valueCache[a][2]===b.z&&this._valueCache[a][3]===b.w?this:(this._cacheFloat4(a,b.x,b.y,b.z,b.w),this._engine.setFloat4(this.getUniform(a),b.x,b.y,b.z,b.w),this)},b.prototype.setFloat4=function(a,b,c,d,e){return this._valueCache[a]&&this._valueCache[a][0]===b&&this._valueCache[a][1]===c&&this._valueCache[a][2]===d&&this._valueCache[a][3]===e?this:(this._cacheFloat4(a,b,c,d,e),this._engine.setFloat4(this.getUniform(a),b,c,d,e),this)},b.prototype.setColor3=function(a,b){return this._valueCache[a]&&this._valueCache[a][0]===b.r&&this._valueCache[a][1]===b.g&&this._valueCache[a][2]===b.b?this:(this._cacheFloat3(a,b.r,b.g,b.b),this._engine.setColor3(this.getUniform(a),b),this)},b.prototype.setColor4=function(a,b,c){return this._valueCache[a]&&this._valueCache[a][0]===b.r&&this._valueCache[a][1]===b.g&&this._valueCache[a][2]===b.b&&this._valueCache[a][3]===c?this:(this._cacheFloat4(a,b.r,b.g,b.b,c),this._engine.setColor4(this.getUniform(a),b,c),this)},b.ShadersStore={},b.IncludesShadersStore={},b}();a.Effect=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return b.PrepareDefinesForLights=function(b,c,d,e){void 0===e&&(e=4);for(var f=0,g=!1,h=!1,i=0;i<b.lights.length;i++){var j=b.lights[i];if(j.isEnabled()){if(j._excludedMeshesIds.length>0){for(var k=0;k<j._excludedMeshesIds.length;k++){var l=b.getMeshByID(j._excludedMeshesIds[k]);l&&j.excludedMeshes.push(l)}j._excludedMeshesIds=[]}if(j._includedOnlyMeshesIds.length>0){for(var m=0;m<j._includedOnlyMeshesIds.length;m++){var n=b.getMeshByID(j._includedOnlyMeshesIds[m]);n&&j.includedOnlyMeshes.push(n)}j._includedOnlyMeshesIds=[]}if(j.canAffectMesh(c)){g=!0,void 0===d["LIGHT"+f]&&(h=!0),d["LIGHT"+f]=!0;var o;if(o=j instanceof a.SpotLight?"SPOTLIGHT"+f:j instanceof a.HemisphericLight?"HEMILIGHT"+f:j instanceof a.PointLight?"POINTLIGHT"+f:"DIRLIGHT"+f,void 0===d[o]&&(h=!0),d[o]=!0,j.specular.equalsFloats(0,0,0)||void 0===d.SPECULARTERM||(d.SPECULARTERM=!0),b.shadowsEnabled){var p=j.getShadowGenerator();c&&c.receiveShadows&&p&&(void 0===d["SHADOW"+f]&&(h=!0),d["SHADOW"+f]=!0,d.SHADOWS=!0,(p.useVarianceShadowMap||p.useBlurVarianceShadowMap)&&(void 0===d["SHADOWVSM"+f]&&(h=!0),d["SHADOWVSM"+f]=!0),p.usePoissonSampling&&(void 0===d["SHADOWPCF"+f]&&(h=!0),d["SHADOWPCF"+f]=!0))}if(f++,f===e)break}}}return h&&d.rebuild(),g},b.PrepareUniformsAndSamplersList=function(a,b,c,d){void 0===d&&(d=4);for(var e=0;d>e&&c["LIGHT"+e];e++)a.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e),b.push("shadowSampler"+e)},b.HandleFallbacksForShadows=function(a,b,c){void 0===c&&(c=4);for(var d=0;c>d&&a["LIGHT"+d];d++)d>0&&b.addFallback(d,"LIGHT"+d),a["SHADOW"+d]&&b.addFallback(0,"SHADOW"+d),a["SHADOWPCF"+d]&&b.addFallback(0,"SHADOWPCF"+d),a["SHADOWVSM"+d]&&b.addFallback(0,"SHADOWVSM"+d)},b.PrepareAttributesForBones=function(b,c,d,e){d.NUM_BONE_INFLUENCERS>0&&(e.addCPUSkinningFallback(0,c),b.push(a.VertexBuffer.MatricesIndicesKind),b.push(a.VertexBuffer.MatricesWeightsKind),d.NUM_BONE_INFLUENCERS>4&&(b.push(a.VertexBuffer.MatricesIndicesExtraKind),b.push(a.VertexBuffer.MatricesWeightsExtraKind)))},b.PrepareAttributesForInstances=function(a,b){b.INSTANCES&&(a.push("world0"),a.push("world1"),a.push("world2"),a.push("world3"))},b.BindLightShadow=function(a,b,c,d,e,f){var g=a.getShadowGenerator();return c.receiveShadows&&g&&(a.needCube()?f||(f=!0,e.setFloat2("depthValues",b.activeCamera.minZ,b.activeCamera.maxZ)):e.setMatrix("lightMatrix"+d,g.getTransformMatrix()),e.setTexture("shadowSampler"+d,g.getShadowMapForRendering()),e.setFloat3("shadowsInfo"+d,g.getDarkness(),g.blurScale/g.getShadowMap().getSize().width,g.bias)),f},b.BindLightProperties=function(b,c,d){b instanceof a.PointLight?b.transferToEffect(c,"vLightData"+d):b instanceof a.DirectionalLight?b.transferToEffect(c,"vLightData"+d):b instanceof a.SpotLight?b.transferToEffect(c,"vLightData"+d,"vLightDirection"+d):b instanceof a.HemisphericLight&&b.transferToEffect(c,"vLightData"+d,"vLightGround"+d)},b.BindLights=function(c,d,e,f,g){void 0===g&&(g=4);for(var h=0,i=!1,j=0;j<c.lights.length;j++){var k=c.lights[j];if(k.isEnabled()&&k.canAffectMesh(d)&&(b.BindLightProperties(k,e,h),k.diffuse.scaleToRef(k.intensity,a.Tmp.Color3[0]),e.setColor4("vLightDiffuse"+h,a.Tmp.Color3[0],k.range),f.SPECULARTERM&&(k.specular.scaleToRef(k.intensity,a.Tmp.Color3[1]),e.setColor3("vLightSpecular"+h,a.Tmp.Color3[1])),c.shadowsEnabled&&(i=this.BindLightShadow(k,c,d,h,e,i)),h++,h===g))break}},b.BindFogParameters=function(b,c,d){b.fogEnabled&&c.applyFog&&b.fogMode!==a.Scene.FOGMODE_NONE&&(d.setFloat4("vFogInfos",b.fogMode,b.fogStart,b.fogEnd,b.fogDensity),d.setColor3("vFogColor",b.fogColor))},b.BindBonesParameters=function(a,b){a&&a.useBones&&a.computeBonesUsingShaders&&b.setMatrices("mBones",a.skeleton.getTransformMatrices(a))},b.BindLogDepth=function(a,b,c){a.LOGARITHMICDEPTH&&b.setFloat("logarithmicDepthConstant",2/(Math.log(c.activeCamera.maxZ+1)/Math.LN2))},b.BindClipPlane=function(a,b){if(b.clipPlane){var c=b.clipPlane;a.setFloat4("vClipPlane",c.normal.x,c.normal.y,c.normal.z,c.d)}},b}();a.MaterialHelper=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.isEnabled=!0,this.leftColor=a.Color3.White(),this.rightColor=a.Color3.Black(),this.bias=0,this.power=1}return b.prototype.clone=function(){var c=new b;return a.Tools.DeepCopy(this,c),new b},b.prototype.serialize=function(){var a={};return a.isEnabled=this.isEnabled,a.leftColor=this.leftColor,a.rightColor=this.rightColor,a.bias=this.bias,a.power=this.power,a},b.Parse=function(c){var d=new b;return d.isEnabled=c.isEnabled,d.leftColor=a.Color3.FromArray(c.leftColor),d.rightColor=a.Color3.FromArray(c.rightColor),d.bias=c.bias,d.power=c.power||1,d},b}();a.FresnelParameters=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return a.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=Object.keys(this)},a.prototype.isEqual=function(a){if(this._keys.length!==a._keys.length)return!1;for(var b=0;b<this._keys.length;b++){var c=this._keys[b];if(this[c]!==a[c])return!1}return!0},a.prototype.cloneTo=function(a){this._keys.length!==a._keys.length&&(a._keys=this._keys.slice(0));for(var b=0;b<this._keys.length;b++){var c=this._keys[b];a[c]=this[c]}},a.prototype.reset=function(){for(var a=0;a<this._keys.length;a++){var b=this._keys[a];"number"==typeof this[b]?this[b]=0:this[b]=!1}},a.prototype.toString=function(){for(var a="",b=0;b<this._keys.length;b++){var c=this._keys[b];"number"==typeof this[c]?a+="#define "+c+" "+this[c]+"\n":this[c]&&(a+="#define "+c+"\n")}return a},a}();a.MaterialDefines=b;var c=function(){function b(c,d,e){this.name=c,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this.backFaceCulling=!0,this.sideOrientation=b.CounterClockWiseSideOrientation,this.onDisposeObservable=new a.Observable,this.onBindObservable=new a.Observable,this.alphaMode=a.Engine.ALPHA_COMBINE,this.disableDepthWrite=!1,this.fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=b.TriangleFillMode,this.id=c,this._scene=d,e||d.materials.push(this)}return Object.defineProperty(b,"TriangleFillMode",{get:function(){return b._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(b,"WireFrameFillMode",{get:function(){return b._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointFillMode",{get:function(){return b._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ClockWiseSideOrientation",{get:function(){return b._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(b,"CounterClockWiseSideOrientation",{get:function(){return b._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBind",{set:function(a){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"wireframe",{get:function(){return this._fillMode===b.WireFrameFillMode},set:function(a){this._fillMode=a?b.WireFrameFillMode:b.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"pointsCloud",{get:function(){return this._fillMode===b.PointFillMode},set:function(a){this._fillMode=a?b.PointFillMode:b.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fillMode",{get:function(){return this._fillMode},set:function(a){this._fillMode=a},enumerable:!0,configurable:!0}),b.prototype.toString=function(a){var b="Name: "+this.name;return b},Object.defineProperty(b.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),b.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},b.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},b.prototype.isReady=function(a,b){return!0},b.prototype.getEffect=function(){return this._effect},b.prototype.getScene=function(){return this._scene},b.prototype.needAlphaBlending=function(){return this.alpha<1},b.prototype.needAlphaTesting=function(){return!1},b.prototype.getAlphaTestTexture=function(){return null},b.prototype.markDirty=function(){this._wasPreviouslyReady=!1},b.prototype._preBind=function(){var a=this._scene.getEngine();a.enableEffect(this._effect),a.setState(this.backFaceCulling,this.zOffset,!1,this.sideOrientation===b.ClockWiseSideOrientation)},b.prototype.bind=function(a,b){if(this._scene._cachedMaterial=this,this.onBindObservable.notifyObservers(b),this.disableDepthWrite){var c=this._scene.getEngine();this._cachedDepthWriteState=c.getDepthWrite(),c.setDepthWrite(!1)}},b.prototype.bindOnlyWorldMatrix=function(a){},b.prototype.unbind=function(){if(this.disableDepthWrite){var a=this._scene.getEngine();a.setDepthWrite(this._cachedDepthWriteState)}},b.prototype.clone=function(a){return null},b.prototype.getBindedMeshes=function(){for(var a=new Array,b=0;b<this._scene.meshes.length;b++){var c=this._scene.meshes[b];c.material===this&&a.push(c)}return a},b.prototype.dispose=function(a,b){this.getScene().stopAnimation(this);var c=this._scene.materials.indexOf(this);for(c>=0&&this._scene.materials.splice(c,1),a&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),c=0;c<this._scene.meshes.length;c++){var d=this._scene.meshes[c];d.material===this&&(d.material=null)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBindObservable.clear()},b.prototype.serialize=function(){return a.SerializationHelper.Serialize(this)},b.ParseMultiMaterial=function(b,c){var d=new a.MultiMaterial(b.name,c);d.id=b.id,a.Tags.AddTagsTo(d,b.tags);for(var e=0;e<b.materials.length;e++){var f=b.materials[e];f?d.subMaterials.push(c.getMaterialByID(f)):d.subMaterials.push(null)}return d},b.Parse=function(b,c,d){if(!b.customType)return a.StandardMaterial.Parse(b,c,d);var e=a.Tools.Instantiate(b.customType);return e.Parse(b,c,d)},b._TriangleFillMode=0,b._WireFrameFillMode=1,b._PointFillMode=2,b._ClockWiseSideOrientation=0,b._CounterClockWiseSideOrientation=1,__decorate([a.serialize()],b.prototype,"id",void 0),__decorate([a.serialize()],b.prototype,"checkReadyOnEveryCall",void 0),__decorate([a.serialize()],b.prototype,"checkReadyOnlyOnce",void 0),__decorate([a.serialize()],b.prototype,"state",void 0),__decorate([a.serialize()],b.prototype,"alpha",void 0),__decorate([a.serialize()],b.prototype,"backFaceCulling",void 0),__decorate([a.serialize()],b.prototype,"sideOrientation",void 0),__decorate([a.serialize()],b.prototype,"alphaMode",void 0),__decorate([a.serialize()],b.prototype,"disableDepthWrite",void 0),__decorate([a.serialize()],b.prototype,"fogEnabled",void 0),__decorate([a.serialize()],b.prototype,"pointSize",void 0),__decorate([a.serialize()],b.prototype,"zOffset",void 0),__decorate([a.serialize()],b.prototype,"wireframe",null),__decorate([a.serialize()],b.prototype,"pointsCloud",null),__decorate([a.serialize()],b.prototype,"fillMode",null),b}();a.Material=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(){a.call(this),this.DIFFUSE=!1,this.AMBIENT=!1,this.OPACITY=!1,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.SPECULAR=!1,this.BUMP=!1,this.PARALLAX=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.INVERTNORMALMAPX=!1,this.INVERTNORMALMAPY=!1,this.rebuild()}return __extends(b,a),b}(a.MaterialDefines),c=function(c){function d(d,e){var f=this;c.call(this,d,e),this.ambientColor=new a.Color3(0,0,0),this.diffuseColor=new a.Color3(1,1,1),this.specularColor=new a.Color3(1,1,1),this.emissiveColor=new a.Color3(0,0,0),this.specularPower=64,this.useAlphaFromDiffuseTexture=!1,this.useEmissiveAsIllumination=!1,this.linkEmissiveWithDiffuse=!1,this.useReflectionFresnelFromSpecular=!1,this.useSpecularOverAlpha=!1,this.useReflectionOverAlpha=!1,this.disableLighting=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.useLightmapAsShadowmap=!1,this.useGlossinessFromSpecularMapAlpha=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this._renderTargets=new a.SmartArray(16),this._worldViewProjectionMatrix=a.Matrix.Zero(),this._globalAmbientColor=new a.Color3(0,0,0),this._defines=new b,this._cachedDefines=new b,this._cachedDefines.BonesPerMesh=-1,this.getRenderTargetTextures=function(){return f._renderTargets.reset(),f.reflectionTexture&&f.reflectionTexture.isRenderTarget&&f._renderTargets.push(f.reflectionTexture),f.refractionTexture&&f.refractionTexture.isRenderTarget&&f._renderTargets.push(f.refractionTexture),f._renderTargets}}return __extends(d,c),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},d.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},d.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},d.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},d.prototype._checkCache=function(a,b,c){return b?this._defines.INSTANCES!==c?!1:!(!b._materialDefines||!b._materialDefines.isEqual(this._defines)):!0},d.prototype.isReady=function(c,e){if(this.isFrozen&&this._wasPreviouslyReady)return!0;var f=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===f.getRenderId()&&this._checkCache(f,c,e))return!0;var g=f.getEngine(),h=!1,i=!1;if(this._defines.reset(),f.texturesEnabled){if(this.diffuseTexture&&d.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;i=!0,this._defines.DIFFUSE=!0}if(this.ambientTexture&&d.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;i=!0,this._defines.AMBIENT=!0}if(this.opacityTexture&&d.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;i=!0,this._defines.OPACITY=!0,this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0)}if(this.reflectionTexture&&d.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(h=!0,this._defines.REFLECTION=!0,this.roughness>0&&(this._defines.ROUGHNESS=!0),this.useReflectionOverAlpha&&(this._defines.REFLECTIONOVERALPHA=!0),this.reflectionTexture.coordinatesMode===a.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case a.Texture.CUBIC_MODE:case a.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case a.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case a.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case a.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case a.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case a.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case a.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case a.Texture.FIXED_EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0}}if(this.emissiveTexture&&d.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;i=!0,this._defines.EMISSIVE=!0}if(this.lightmapTexture&&d.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;i=!0,this._defines.LIGHTMAP=!0,this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.specularTexture&&d.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;i=!0,this._defines.SPECULAR=!0,this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha}if(f.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&d.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;i=!0,this._defines.BUMP=!0,this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0)),this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0),this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&d.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;i=!0,this._defines.REFRACTION=!0,this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube}}if(f.clipPlane&&(this._defines.CLIPPLANE=!0),g.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithDiffuse&&(this._defines.LINKEMISSIVEWITHDIFFUSE=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),(this.pointsCloud||f.forcePointsCloud)&&(this._defines.POINTSIZE=!0),f.fogEnabled&&c&&c.applyFog&&f.fogMode!==a.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),f.lightsEnabled&&!this.disableLighting&&(h=a.MaterialHelper.PrepareDefinesForLights(f,c,this._defines,this.maxSimultaneousLights)),d.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled||this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0,this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._defines.REFRACTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),h=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),c&&(h&&c.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),i&&(c.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),c.useVertexColors&&c.isVerticesDataPresent(a.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,this._defines.BonesPerMesh=c.skeleton.bones.length+1),e&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),f.resetCachedMaterial();var j=new a.EffectFallbacks;this._defines.REFLECTION&&j.addFallback(0,"REFLECTION"),this._defines.SPECULAR&&j.addFallback(0,"SPECULAR"),this._defines.BUMP&&j.addFallback(0,"BUMP"),this._defines.PARALLAX&&j.addFallback(1,"PARALLAX"),this._defines.PARALLAXOCCLUSION&&j.addFallback(0,"PARALLAXOCCLUSION"),this._defines.SPECULAROVERALPHA&&j.addFallback(0,"SPECULAROVERALPHA"),this._defines.FOG&&j.addFallback(1,"FOG"),this._defines.POINTSIZE&&j.addFallback(0,"POINTSIZE"),this._defines.LOGARITHMICDEPTH&&j.addFallback(0,"LOGARITHMICDEPTH"),a.MaterialHelper.HandleFallbacksForShadows(this._defines,j,this.maxSimultaneousLights),this._defines.SPECULARTERM&&j.addFallback(0,"SPECULARTERM"),this._defines.DIFFUSEFRESNEL&&j.addFallback(1,"DIFFUSEFRESNEL"),this._defines.OPACITYFRESNEL&&j.addFallback(2,"OPACITYFRESNEL"),this._defines.REFLECTIONFRESNEL&&j.addFallback(3,"REFLECTIONFRESNEL"),
this._defines.EMISSIVEFRESNEL&&j.addFallback(4,"EMISSIVEFRESNEL"),this._defines.FRESNEL&&j.addFallback(4,"FRESNEL");var k=[a.VertexBuffer.PositionKind];this._defines.NORMAL&&k.push(a.VertexBuffer.NormalKind),this._defines.UV1&&k.push(a.VertexBuffer.UVKind),this._defines.UV2&&k.push(a.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&k.push(a.VertexBuffer.ColorKind),a.MaterialHelper.PrepareAttributesForBones(k,c,this._defines,j),a.MaterialHelper.PrepareAttributesForInstances(k,this._defines);var l="default";f.getEngine().getCaps().standardDerivatives||(l="legacydefault");var m=this._defines.toString(),n=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","depthValues","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","logarithmicDepthConstant"],o=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"];a.MaterialHelper.PrepareUniformsAndSamplersList(n,o,this._defines,this.maxSimultaneousLights),this._effect=f.getEngine().createEffect(l,k,n,o,m,j,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights-1})}return this._effect.isReady()?(this._renderId=f.getRenderId(),this._wasPreviouslyReady=!0,c&&(c._materialDefines||(c._materialDefines=new b),this._defines.cloneTo(c._materialDefines)),!0):!1},d.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null),this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null),c.prototype.unbind.call(this)},d.prototype.bindOnlyWorldMatrix=function(a){this._effect.setMatrix("world",a)},d.prototype.bind=function(b,e){var f=this.getScene();if(this.bindOnlyWorldMatrix(b),a.MaterialHelper.BindBonesParameters(e,this._effect),f.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",f.getTransformMatrix()),d.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new a.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._effect.setColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._effect.setColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),f.texturesEnabled&&(this.diffuseTexture&&d.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.ambientTexture&&d.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&d.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&d.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,this.roughness)),this.emissiveTexture&&d.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&d.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.specularTexture&&d.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&f.getEngine().getCaps().standardDerivatives&&d.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&d.RefractionTextureEnabled)){var g=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(g=this.refractionTexture.depth)),this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,g,this.invertRefractionY?-1:1)}a.MaterialHelper.BindClipPlane(this._effect,f),this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),f.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._effect.setVector3("vEyePosition",f._mirroredCameraPosition?f._mirroredCameraPosition:f.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor)}f.getCachedMaterial()===this&&this.isFrozen||(this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*e.visibility),f.lightsEnabled&&!this.disableLighting&&a.MaterialHelper.BindLights(f,e,this._effect,this._defines,this.maxSimultaneousLights),(f.fogEnabled&&e.applyFog&&f.fogMode!==a.Scene.FOGMODE_NONE||this.reflectionTexture||this.refractionTexture)&&this._effect.setMatrix("view",f.getViewMatrix()),a.MaterialHelper.BindFogParameters(f,e,this._effect),a.MaterialHelper.BindLogDepth(this._defines,this._effect,f)),c.prototype.bind.call(this,b,e)},d.prototype.getAnimatables=function(){var a=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&a.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&a.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&a.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&a.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&a.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&this.specularTexture.animations.length>0&&a.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&a.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&this.lightmapTexture.animations.length>0&&a.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&this.refractionTexture.animations.length>0&&a.push(this.refractionTexture),a},d.prototype.dispose=function(a,b){b&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose()),c.prototype.dispose.call(this,a,b)},d.prototype.clone=function(b){var c=this;return a.SerializationHelper.Clone(function(){return new d(b,c.getScene())},this)},d.prototype.serialize=function(){return a.SerializationHelper.Serialize(this)},d.Parse=function(b,c,e){return a.SerializationHelper.Parse(function(){return new d(b.name,c)},b,c,e)},d.DiffuseTextureEnabled=!0,d.AmbientTextureEnabled=!0,d.OpacityTextureEnabled=!0,d.ReflectionTextureEnabled=!0,d.EmissiveTextureEnabled=!0,d.SpecularTextureEnabled=!0,d.BumpTextureEnabled=!0,d.FresnelEnabled=!0,d.LightmapTextureEnabled=!0,d.RefractionTextureEnabled=!0,__decorate([a.serializeAsTexture()],d.prototype,"diffuseTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"ambientTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"opacityTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"reflectionTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"emissiveTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"specularTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"bumpTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"lightmapTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"refractionTexture",void 0),__decorate([a.serializeAsColor3("ambient")],d.prototype,"ambientColor",void 0),__decorate([a.serializeAsColor3("diffuse")],d.prototype,"diffuseColor",void 0),__decorate([a.serializeAsColor3("specular")],d.prototype,"specularColor",void 0),__decorate([a.serializeAsColor3("emissive")],d.prototype,"emissiveColor",void 0),__decorate([a.serialize()],d.prototype,"specularPower",void 0),__decorate([a.serialize()],d.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([a.serialize()],d.prototype,"useEmissiveAsIllumination",void 0),__decorate([a.serialize()],d.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([a.serialize()],d.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([a.serialize()],d.prototype,"useSpecularOverAlpha",void 0),__decorate([a.serialize()],d.prototype,"useReflectionOverAlpha",void 0),__decorate([a.serialize()],d.prototype,"disableLighting",void 0),__decorate([a.serialize()],d.prototype,"useParallax",void 0),__decorate([a.serialize()],d.prototype,"useParallaxOcclusion",void 0),__decorate([a.serialize()],d.prototype,"parallaxScaleBias",void 0),__decorate([a.serialize()],d.prototype,"roughness",void 0),__decorate([a.serialize()],d.prototype,"indexOfRefraction",void 0),__decorate([a.serialize()],d.prototype,"invertRefractionY",void 0),__decorate([a.serialize()],d.prototype,"useLightmapAsShadowmap",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"diffuseFresnelParameters",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"opacityFresnelParameters",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"reflectionFresnelParameters",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"refractionFresnelParameters",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"emissiveFresnelParameters",void 0),__decorate([a.serialize()],d.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([a.serialize()],d.prototype,"maxSimultaneousLights",void 0),__decorate([a.serialize()],d.prototype,"invertNormalMapX",void 0),__decorate([a.serialize()],d.prototype,"invertNormalMapY",void 0),__decorate([a.serialize()],d.prototype,"useLogarithmicDepth",null),d}(a.Material);a.StandardMaterial=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c){b.call(this,a,c,!0),this.subMaterials=new Array,c.multiMaterials.push(this)}return __extends(c,b),c.prototype.getSubMaterial=function(a){return 0>a||a>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[a]},c.prototype.isReady=function(a){for(var b=0;b<this.subMaterials.length;b++){var c=this.subMaterials[b];if(c&&!this.subMaterials[b].isReady(a))return!1}return!0},c.prototype.clone=function(a,b){for(var d=new c(a,this.getScene()),e=0;e<this.subMaterials.length;e++){var f=null;f=b?this.subMaterials[e].clone(a+"-"+this.subMaterials[e].name):this.subMaterials[e],d.subMaterials.push(f)}return d},c.prototype.serialize=function(){var b={};b.name=this.name,b.id=this.id,b.tags=a.Tags.GetTags(this),b.materials=[];for(var c=0;c<this.subMaterials.length;c++){var d=this.subMaterials[c];d?b.materials.push(d.id):b.materials.push(null)}return b},c}(a.Material);a.MultiMaterial=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return Object.defineProperty(b,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(b,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ForceFullSceneLoadingForIncremental",{get:function(){return b._ForceFullSceneLoadingForIncremental},set:function(a){b._ForceFullSceneLoadingForIncremental=a},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ShowLoadingScreen",{get:function(){return b._ShowLoadingScreen},set:function(a){b._ShowLoadingScreen=a},enumerable:!0,configurable:!0}),Object.defineProperty(b,"loggingLevel",{get:function(){return b._loggingLevel},set:function(a){b._loggingLevel=a},enumerable:!0,configurable:!0}),b._getPluginForFilename=function(a){var b=a.lastIndexOf("."),c=a.indexOf("?");-1===c&&(c=a.length);for(var d=a.substring(b,c).toLowerCase(),e=0;e<this._registeredPlugins.length;e++){var f=this._registeredPlugins[e];if(-1!==f.extensions.indexOf(d))return f}return this._registeredPlugins[0]},b.GetPluginForExtension=function(a){for(var b=0;b<this._registeredPlugins.length;b++){var c=this._registeredPlugins[b];if(-1!==c.extensions.indexOf(a))return c}return null},b.RegisterPlugin=function(a){a.extensions=a.extensions.toLowerCase(),b._registeredPlugins.push(a)},b.ImportMesh=function(c,d,e,f,g,h,i){if(e.substr&&"/"===e.substr(0,1))return void a.Tools.Error("Wrong sceneFilename parameter");if(e.substr&&"/"===e.substr(0,1))return void a.Tools.Error("Wrong sceneFilename parameter");var j={};f._addPendingData(j);var k=function(k){f.database=l;var m=b._getPluginForFilename(e),n=function(a){var b=[],h=[],k=[];try{if(m.importMesh){var l=m;if(!l.importMesh(c,f,a,d,b,h,k))return i&&i(f,"Unable to import meshes from "+d+e),void f._removePendingData(j);g&&(f.importedMeshesFiles.push(d+e),g(b,h,k),f._removePendingData(j))}else{var n=m;n.importMeshAsync(c,f,a,d,function(a,b,c){g&&(f.importedMeshesFiles.push(d+e),g(a,b,c),f._removePendingData(j))},function(){i&&i(f,"Unable to import meshes from "+d+e),f._removePendingData(j)})}}catch(o){i&&i(f,"Unable to import meshes from "+d+e,o),f._removePendingData(j)}};return e.substr&&"data:"===e.substr(0,5)?void n(e.substr(5)):void a.Tools.LoadFile(d+e,function(a){n(a)},h,l)};if(!f.getEngine().enableOfflineSupport||e.substr&&"data:"===e.substr(0,5))k(!0);else var l=new a.Database(d+e,k)},b.Load=function(c,d,e,f,g,h){b.Append(c,d,new a.Scene(e),f,g,h)},b.Append=function(c,d,e,f,g,h){if(d.substr&&"/"===d.substr(0,1))return void a.Tools.Error("Wrong sceneFilename parameter");var i,j=this._getPluginForFilename(d.name||d),k={};e._addPendingData(k),b.ShowLoadingScreen&&e.getEngine().displayLoadingUI();var l=function(a){if(e.database=i,j.load){var d=j;if(!d.load(e,a,c))return h&&h(e),e._removePendingData(k),void e.getEngine().hideLoadingUI();f&&f(e),e._removePendingData(k)}else{var g=j;g.loadAsync(e,a,c,function(){f&&f(e)},function(){h&&h(e),e._removePendingData(k),e.getEngine().hideLoadingUI()})}b.ShowLoadingScreen&&e.executeWhenReady(function(){e.getEngine().hideLoadingUI()})},m=function(b){a.Tools.LoadFile(c+d,l,g,i)};return d.substr&&"data:"===d.substr(0,5)?void l(d.substr(5)):void(-1===c.indexOf("file:")?e.getEngine().enableOfflineSupport?i=new a.Database(c+d,m):m(!0):a.Tools.ReadFile(d,l,g))},b._ForceFullSceneLoadingForIncremental=!1,b._ShowLoadingScreen=!0,b._loggingLevel=b.NO_LOGGING,b._registeredPlugins=new Array,b}();a.SceneLoader=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(b,c,d,e){for(var f=0,g=c.materials.length;g>f;f++){var h=c.materials[f];if(h.id===b)return a.Material.Parse(h,d,e)}return null},d=function(a,b,c){b=b instanceof Array?b:[b];for(var d in b)if(a.name===b[d])return c.push(a.id),!0;return a.parentId&&-1!==c.indexOf(a.parentId)?(c.push(a.id),!0):!1},e=function(a,b){return a+" of "+(b?b.file+" from "+b.name+" version: "+b.version+", exporter version: "+b.exporter_version:"unknown")};a.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(b,f,g,h,i,j,k){var l="importMesh has failed JSON parse";try{var m=JSON.parse(g);l="";var n,o,p=a.SceneLoader.loggingLevel===a.SceneLoader.DETAILED_LOGGING,q=[],r=[],s=[];for(n=0,o=m.meshes.length;o>n;n++){var t=m.meshes[n];if(!b||d(t,b,s)){if(b instanceof Array&&delete b[b.indexOf(t.name)],t.geometryId&&m.geometries){var u=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(b){!u&&m.geometries[b]&&m.geometries[b]instanceof Array&&m.geometries[b].forEach(function(c){if(c.id===t.geometryId){switch(b){case"boxes":a.Geometry.Primitives.Box.Parse(c,f);break;case"spheres":a.Geometry.Primitives.Sphere.Parse(c,f);break;case"cylinders":a.Geometry.Primitives.Cylinder.Parse(c,f);break;case"toruses":a.Geometry.Primitives.Torus.Parse(c,f);break;case"grounds":a.Geometry.Primitives.Ground.Parse(c,f);break;case"planes":a.Geometry.Primitives.Plane.Parse(c,f);break;case"torusKnots":a.Geometry.Primitives.TorusKnot.Parse(c,f);break;case"vertexData":a.Geometry.Parse(c,f,h)}u=!0}})}),u||a.Tools.Warn("Geometry not found for mesh "+t.id)}if(t.materialId){var v=-1!==r.indexOf(t.materialId);if(!v&&m.multiMaterials)for(var w=0,x=m.multiMaterials.length;x>w;w++){var y=m.multiMaterials[w];if(y.id===t.materialId){for(var z=0,A=y.materials.length;A>z;z++){var B=y.materials[z];r.push(B);var C=c(B,m,f,h);l+="\n	Material "+C.toString(p)}r.push(y.id);var D=a.Material.ParseMultiMaterial(y,f);v=!0,l+="\n	Multi-Material "+D.toString(p);break}}if(!v){r.push(t.materialId);var C=c(t.materialId,m,f,h);C?l+="\n	Material "+C.toString(p):a.Tools.Warn("Material not found for mesh "+t.id)}}if(t.skeletonId>-1&&f.skeletons){var E=q.indexOf(t.skeletonId)>-1;if(!E)for(var F=0,G=m.skeletons.length;G>F;F++){var H=m.skeletons[F];if(H.id===t.skeletonId){var I=a.Skeleton.Parse(H,f);k.push(I),q.push(H.id),l+="\n	Skeleton "+I.toString(p)}}}var J=a.Mesh.Parse(t,f,h);i.push(J),l+="\n	Mesh "+J.toString(p)}}var K;for(n=0,o=f.meshes.length;o>n;n++)K=f.meshes[n],K._waitingParentId&&(K.parent=f.getLastEntryByID(K._waitingParentId),K._waitingParentId=void 0);for(n=0,o=f.meshes.length;o>n;n++)K=f.meshes[n],K._waitingFreezeWorldMatrix?(K.freezeWorldMatrix(),K._waitingFreezeWorldMatrix=void 0):K.computeWorldMatrix(!0);if(m.particleSystems)for(n=0,o=m.particleSystems.length;o>n;n++){var L=m.particleSystems[n];-1!==s.indexOf(L.emitterId)&&j.push(a.ParticleSystem.Parse(L,f,h))}return!0}catch(M){throw a.Tools.Log(e("importMesh",m.producer)+l),l=null,M}finally{null!==l&&a.SceneLoader.loggingLevel!==a.SceneLoader.NO_LOGGING&&a.Tools.Log(e("importMesh",m.producer)+(a.SceneLoader.loggingLevel!==a.SceneLoader.MINIMAL_LOGGING?l:""))}},load:function(b,c,d){var f="importScene has failed JSON parse";try{var g=JSON.parse(c);f="";var h=a.SceneLoader.loggingLevel===a.SceneLoader.DETAILED_LOGGING;if(b.useDelayedTextureLoading=g.useDelayedTextureLoading&&!a.SceneLoader.ForceFullSceneLoadingForIncremental,b.autoClear=g.autoClear,b.clearColor=a.Color4.FromArray(g.clearColor),b.ambientColor=a.Color3.FromArray(g.ambientColor),g.gravity&&(b.gravity=a.Vector3.FromArray(g.gravity)),g.fogMode&&0!==g.fogMode)switch(b.fogMode=g.fogMode,b.fogColor=a.Color3.FromArray(g.fogColor),b.fogStart=g.fogStart,b.fogEnd=g.fogEnd,b.fogDensity=g.fogDensity,f+="	Fog mode for scene:  ",b.fogMode){case 1:f+="exp\n";break;case 2:f+="exp2\n";break;case 3:f+="linear\n"}if(g.physicsEnabled){var i;"cannon"===g.physicsEngine?i=new a.CannonJSPlugin:"oimo"===g.physicsEngine&&(i=new a.OimoJSPlugin),f="	Physics engine "+(g.physicsEngine?g.physicsEngine:"oimo")+" enabled\n";var j=g.physicsGravity?a.Vector3.FromArray(g.physicsGravity):null;b.enablePhysics(j,i)}void 0!=g.collisionsEnabled&&(b.collisionsEnabled=g.collisionsEnabled),b.workerCollisions=!!g.workerCollisions;var k,l;for(k=0,l=g.lights.length;l>k;k++){var m=g.lights[k],n=a.Light.Parse(m,b);f+=0===k?"\n	Lights:":"",f+="\n		"+n.toString(h)}if(g.animations)for(k=0,l=g.animations.length;l>k;k++){var o=g.animations[k],p=a.Animation.Parse(o);b.animations.push(p),f+=0===k?"\n	Animations:":"",f+="\n		"+p.toString(h)}if(g.autoAnimate&&b.beginAnimation(b,g.autoAnimateFrom,g.autoAnimateTo,g.autoAnimateLoop,g.autoAnimateSpeed||1),g.materials)for(k=0,l=g.materials.length;l>k;k++){var q=g.materials[k],r=a.Material.Parse(q,b,d);f+=0===k?"\n	Materials:":"",f+="\n		"+r.toString(h)}if(g.multiMaterials)for(k=0,l=g.multiMaterials.length;l>k;k++){var s=g.multiMaterials[k],t=a.Material.ParseMultiMaterial(s,b);f+=0===k?"\n	MultiMaterials:":"",f+="\n		"+t.toString(h)}if(g.skeletons)for(k=0,l=g.skeletons.length;l>k;k++){var u=g.skeletons[k],v=a.Skeleton.Parse(u,b);f+=0===k?"\n	Skeletons:":"",f+="\n		"+v.toString(h)}var w=g.geometries;if(w){var x=w.boxes;if(x)for(k=0,l=x.length;l>k;k++){var y=x[k];a.Geometry.Primitives.Box.Parse(y,b)}var z=w.spheres;if(z)for(k=0,l=z.length;l>k;k++){var A=z[k];a.Geometry.Primitives.Sphere.Parse(A,b)}var B=w.cylinders;if(B)for(k=0,l=B.length;l>k;k++){var C=B[k];a.Geometry.Primitives.Cylinder.Parse(C,b)}var D=w.toruses;if(D)for(k=0,l=D.length;l>k;k++){var E=D[k];a.Geometry.Primitives.Torus.Parse(E,b)}var F=w.grounds;if(F)for(k=0,l=F.length;l>k;k++){var G=F[k];a.Geometry.Primitives.Ground.Parse(G,b)}var H=w.planes;if(H)for(k=0,l=H.length;l>k;k++){var I=H[k];a.Geometry.Primitives.Plane.Parse(I,b)}var J=w.torusKnots;if(J)for(k=0,l=J.length;l>k;k++){var K=J[k];a.Geometry.Primitives.TorusKnot.Parse(K,b)}var L=w.vertexData;if(L)for(k=0,l=L.length;l>k;k++){var M=L[k];a.Geometry.Parse(M,b,d)}}for(k=0,l=g.meshes.length;l>k;k++){var N=g.meshes[k],O=a.Mesh.Parse(N,b,d);f+=0===k?"\n	Meshes:":"",f+="\n		"+O.toString(h)}for(k=0,l=g.cameras.length;l>k;k++){var P=g.cameras[k],Q=a.Camera.Parse(P,b);f+=0===k?"\n	Cameras:":"",f+="\n		"+Q.toString(h)}for(g.activeCameraID&&b.setActiveCameraByID(g.activeCameraID),k=0,l=b.cameras.length;l>k;k++){var Q=b.cameras[k];Q._waitingParentId&&(Q.parent=b.getLastEntryByID(Q._waitingParentId),Q._waitingParentId=void 0)}for(k=0,l=b.lights.length;l>k;k++){var n=b.lights[k];n._waitingParentId&&(n.parent=b.getLastEntryByID(n._waitingParentId),n._waitingParentId=void 0)}var R,S=[];if(a.AudioEngine&&g.sounds)for(k=0,l=g.sounds.length;l>k;k++){var T=g.sounds[k];a.Engine.audioEngine.canUseWebAudio?(T.url||(T.url=T.name),S[T.url]?a.Sound.Parse(T,b,d,S[T.url]):(R=a.Sound.Parse(T,b,d),S[T.url]=R)):new a.Sound(T.name,null,b)}for(S=[],k=0,l=b.meshes.length;l>k;k++){var O=b.meshes[k];O._waitingParentId&&(O.parent=b.getLastEntryByID(O._waitingParentId),O._waitingParentId=void 0),O._waitingActions&&(a.ActionManager.Parse(O._waitingActions,O,b),O._waitingActions=void 0)}for(k=0,l=b.meshes.length;l>k;k++){var U=b.meshes[k];U._waitingFreezeWorldMatrix?(U.freezeWorldMatrix(),U._waitingFreezeWorldMatrix=void 0):U.computeWorldMatrix(!0)}if(g.particleSystems)for(k=0,l=g.particleSystems.length;l>k;k++){var V=g.particleSystems[k];a.ParticleSystem.Parse(V,b,d)}if(g.lensFlareSystems)for(k=0,l=g.lensFlareSystems.length;l>k;k++){var W=g.lensFlareSystems[k];a.LensFlareSystem.Parse(W,b,d)}if(g.shadowGenerators)for(k=0,l=g.shadowGenerators.length;l>k;k++){var X=g.shadowGenerators[k];a.ShadowGenerator.Parse(X,b)}return g.actions&&a.ActionManager.Parse(g.actions,null,b),!0}catch(Y){throw a.Tools.Log(e("importScene",g.producer)+f),f=null,Y}finally{null!==f&&a.SceneLoader.loggingLevel!==a.SceneLoader.NO_LOGGING&&a.Tools.Log(e("importScene",g.producer)+(a.SceneLoader.loggingLevel!==a.SceneLoader.MINIMAL_LOGGING?f:""))}}})}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f,g,h){void 0===h&&(h=a.Texture.TRILINEAR_SAMPLINGMODE),this.name=b,this.cellSize=e,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new a.Observable,this._vertexBuffers={},this._capacity=d,this._spriteTexture=new a.Texture(c,f,!0,!1,h),this._spriteTexture.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._epsilon=void 0===g?.01:g,this._scene=f,this._scene.spriteManagers.push(this);for(var i=[],j=0,k=0;d>k;k++)i.push(j),i.push(j+1),i.push(j+2),i.push(j),i.push(j+2),i.push(j+3),j+=4;this._indexBuffer=f.getEngine().createIndexBuffer(i),this._vertexData=new Float32Array(16*d*4),this._buffer=new a.Buffer(f.getEngine(),this._vertexData,!0,16);var l=this._buffer.createVertexBuffer(a.VertexBuffer.PositionKind,0,4),m=this._buffer.createVertexBuffer("options",4,4),n=this._buffer.createVertexBuffer("cellInfo",8,4),o=this._buffer.createVertexBuffer(a.VertexBuffer.ColorKind,12,4);this._vertexBuffers[a.VertexBuffer.PositionKind]=l,this._vertexBuffers.options=m,this._vertexBuffers.cellInfo=n,this._vertexBuffers[a.VertexBuffer.ColorKind]=o,this._effectBase=this._scene.getEngine().createEffect("sprites",[a.VertexBuffer.PositionKind,"options","cellInfo",a.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[a.VertexBuffer.PositionKind,"options","cellInfo",a.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(b.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"texture",{get:function(){return this._spriteTexture},set:function(a){this._spriteTexture=a},enumerable:!0,configurable:!0}),b.prototype._appendSpriteVertex=function(a,b,c,d,e){var f=16*a;0===c?c=this._epsilon:1===c&&(c=1-this._epsilon),0===d?d=this._epsilon:1===d&&(d=1-this._epsilon),this._vertexData[f]=b.position.x,this._vertexData[f+1]=b.position.y,this._vertexData[f+2]=b.position.z,this._vertexData[f+3]=b.angle,this._vertexData[f+4]=b.width,this._vertexData[f+5]=b.height,this._vertexData[f+6]=c,this._vertexData[f+7]=d,this._vertexData[f+8]=b.invertU?1:0,this._vertexData[f+9]=b.invertV?1:0;var g=b.cellIndex/e>>0;this._vertexData[f+10]=b.cellIndex-g*e,this._vertexData[f+11]=g,this._vertexData[f+12]=b.color.r,this._vertexData[f+13]=b.color.g,this._vertexData[f+14]=b.color.b,this._vertexData[f+15]=b.color.a},b.prototype.intersects=function(b,c,d,e){for(var f,g=Math.min(this._capacity,this.sprites.length),h=a.Vector3.Zero(),i=a.Vector3.Zero(),j=Number.MAX_VALUE,k=a.Vector3.Zero(),l=c.getViewMatrix(),m=0;g>m;m++){var n=this.sprites[m];if(n){if(d){if(!d(n))continue}else if(!n.isPickable)continue;if(a.Vector3.TransformCoordinatesToRef(n.position,l,k),h.copyFromFloats(k.x-n.width/2,k.y-n.height/2,k.z),i.copyFromFloats(k.x+n.width/2,k.y+n.height/2,k.z),b.intersectsBoxMinMax(h,i)){var o=a.Vector3.Distance(k,b.origin);if(j>o&&(j=o,f=n,e))break}}}if(f){var p=new a.PickingInfo;return p.hit=!0,p.pickedSprite=f,p.distance=j,p}return null},b.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var b=this._scene.getEngine(),c=this._spriteTexture.getBaseSize(),d=b.getDeltaTime(),e=Math.min(this._capacity,this.sprites.length),f=c.width/this.cellSize,g=0,h=0;e>h;h++){var i=this.sprites[h];i&&(i._animate(d),this._appendSpriteVertex(g++,i,0,0,f),this._appendSpriteVertex(g++,i,1,0,f),this._appendSpriteVertex(g++,i,1,1,f),this._appendSpriteVertex(g++,i,0,1,f))}this._buffer.update(this._vertexData);var j=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==a.Scene.FOGMODE_NONE&&this.fogEnabled&&(j=this._effectFog),b.enableEffect(j);var k=this._scene.getViewMatrix();j.setTexture("diffuseSampler",this._spriteTexture),j.setMatrix("view",k),j.setMatrix("projection",this._scene.getProjectionMatrix()),j.setFloat2("textureInfos",this.cellSize/c.width,this.cellSize/c.height),this._scene.fogEnabled&&this._scene.fogMode!==a.Scene.FOGMODE_NONE&&this.fogEnabled&&(j.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),j.setColor3("vFogColor",this._scene.fogColor)),b.bindBuffers(this._vertexBuffers,this._indexBuffer,j),b.setDepthFunctionToLessOrEqual(),j.setBool("alphaTest",!0),b.setColorWrite(!1),b.draw(!0,0,6*e),b.setColorWrite(!0),j.setBool("alphaTest",!1),b.setAlphaMode(a.Engine.ALPHA_COMBINE),b.draw(!0,0,6*e),b.setAlphaMode(a.Engine.ALPHA_DISABLE)}},b.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var a=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(a,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},b}();a.SpriteManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){this.name=b,this.color=new a.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,
this._direction=1,this._frameCount=0,this._time=0,this._manager=c,this._manager.sprites.push(this),this.position=a.Vector3.Zero()}return Object.defineProperty(b.prototype,"size",{get:function(){return this.width},set:function(a){this.width=a,this.height=a},enumerable:!0,configurable:!0}),b.prototype.playAnimation=function(a,b,c,d){this._fromIndex=a,this._toIndex=b,this._loopAnimation=c,this._delay=d,this._animationStarted=!0,this._direction=b>a?1:-1,this.cellIndex=a,this._time=0},b.prototype.stopAnimation=function(){this._animationStarted=!1},b.prototype._animate=function(a){this._animationStarted&&(this._time+=a,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},b.prototype.dispose=function(){for(var a=0;a<this._manager.sprites.length;a++)this._manager.sprites[a]==this&&this._manager.sprites.splice(a,1)},b}();a.Sprite=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f){this.name=b,this.scale=new a.Vector2(1,1),this.offset=new a.Vector2(0,0),this.alphaBlendingMode=a.Engine.ALPHA_COMBINE,this._vertexBuffers={},this.onDisposeObservable=new a.Observable,this.onBeforeRenderObservable=new a.Observable,this.onAfterRenderObservable=new a.Observable,this.texture=c?new a.Texture(c,d,!0):null,this.isBackground=void 0===e?!0:e,this.color=void 0===f?new a.Color4(1,1,1,1):f,this._scene=d,this._scene.layers.push(this);var g=d.getEngine(),h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1);var i=new a.VertexBuffer(g,h,a.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[a.VertexBuffer.PositionKind]=i;var j=[];j.push(0),j.push(1),j.push(2),j.push(0),j.push(2),j.push(3),this._indexBuffer=g.createIndexBuffer(j),this._effect=g.createEffect("layer",[a.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=g.createEffect("layer",[a.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(b.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),b.prototype.render=function(){var b=this.alphaTest?this._alphaTestEffect:this._effect;if(b.isReady()&&this.texture&&this.texture.isReady()){var c=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),c.enableEffect(b),c.setState(!1),b.setTexture("textureSampler",this.texture),b.setMatrix("textureMatrix",this.texture.getTextureMatrix()),b.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),b.setVector2("offset",this.offset),b.setVector2("scale",this.scale),c.bindBuffers(this._vertexBuffers,this._indexBuffer,b),this._alphaTestEffect?c.draw(!0,0,6):(c.setAlphaMode(this.alphaBlendingMode),c.draw(!0,0,6),c.setAlphaMode(a.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},b.prototype.dispose=function(){var b=this._vertexBuffers[a.VertexBuffer.PositionKind];b&&(b.dispose(),this._vertexBuffers[a.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var c=this._scene.layers.indexOf(this);this._scene.layers.splice(c,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},b}();a.Layer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.position=a.Vector3.Zero(),this.direction=a.Vector3.Zero(),this.color=new a.Color4(0,0,0,0),this.colorStep=new a.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.angle=0,this.angularSpeed=0}return b.prototype.copyTo=function(a){a.position.copyFrom(this.position),a.direction.copyFrom(this.direction),a.color.copyFrom(this.color),a.colorStep.copyFrom(this.colorStep),a.lifeTime=this.lifeTime,a.age=this.age,a.size=this.size,a.angle=this.angle,a.angularSpeed=this.angularSpeed},b}();a.Particle=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a,b){if(a===b)return a;var c=Math.random();return c*(b-a)+a},c=function(){function c(d,e,f,g){var h=this;this.name=d,this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.onDisposeObservable=new a.Observable,this.blendMode=c.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=a.Vector3.Zero(),this.direction1=new a.Vector3(0,1,0),this.direction2=new a.Vector3(0,1,0),this.minEmitBox=new a.Vector3(-.5,-.5,-.5),this.maxEmitBox=new a.Vector3(.5,.5,.5),this.color1=new a.Color4(1,1,1,1),this.color2=new a.Color4(1,1,1,1),this.colorDead=new a.Color4(0,0,0,1),this.textureMask=new a.Color4(1,1,1,1),this.particles=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new a.Color4(0,0,0,0),this._colorDiff=new a.Color4(0,0,0,0),this._scaledDirection=a.Vector3.Zero(),this._scaledGravity=a.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.id=d,this._capacity=e,this._scene=f,this._customEffect=g,f.particleSystems.push(this);for(var i=[],j=0,k=0;e>k;k++)i.push(j),i.push(j+1),i.push(j+2),i.push(j),i.push(j+2),i.push(j+3),j+=4;this._indexBuffer=f.getEngine().createIndexBuffer(i),this._vertexData=new Float32Array(11*e*4),this._vertexBuffer=new a.Buffer(f.getEngine(),this._vertexData,!0,11);var l=this._vertexBuffer.createVertexBuffer(a.VertexBuffer.PositionKind,0,3),m=this._vertexBuffer.createVertexBuffer(a.VertexBuffer.ColorKind,3,4),n=this._vertexBuffer.createVertexBuffer("options",7,4);this._vertexBuffers[a.VertexBuffer.PositionKind]=l,this._vertexBuffers[a.VertexBuffer.ColorKind]=m,this._vertexBuffers.options=n,this.startDirectionFunction=function(c,d,e,f){var g=b(h.direction1.x,h.direction2.x),i=b(h.direction1.y,h.direction2.y),j=b(h.direction1.z,h.direction2.z);a.Vector3.TransformNormalFromFloatsToRef(g*c,i*c,j*c,d,e)},this.startPositionFunction=function(c,d,e){var f=b(h.minEmitBox.x,h.maxEmitBox.x),g=b(h.minEmitBox.y,h.maxEmitBox.y),i=b(h.minEmitBox.z,h.maxEmitBox.z);a.Vector3.TransformCoordinatesFromFloatsToRef(f,g,i,c,d)},this.updateFunction=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.age+=h._scaledUpdateSpeed,c.age>=c.lifeTime?(h.recycleParticle(c),b--):(c.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),c.color.addInPlace(h._scaledColorStep),c.color.a<0&&(c.color.a=0),c.angle+=c.angularSpeed*h._scaledUpdateSpeed,c.direction.scaleToRef(h._scaledUpdateSpeed,h._scaledDirection),c.position.addInPlace(h._scaledDirection),h.gravity.scaleToRef(h._scaledUpdateSpeed,h._scaledGravity),c.direction.addInPlace(h._scaledGravity))}}}return Object.defineProperty(c.prototype,"onDispose",{set:function(a){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(a)},enumerable:!0,configurable:!0}),c.prototype.recycleParticle=function(a){var b=this.particles.pop();b!==a&&(b.copyTo(a),this._stockParticles.push(b))},c.prototype.getCapacity=function(){return this._capacity},c.prototype.isAlive=function(){return this._alive},c.prototype.isStarted=function(){return this._started},c.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},c.prototype.stop=function(){this._stopped=!0},c.prototype._appendParticleVertex=function(a,b,c,d){var e=11*a;this._vertexData[e]=b.position.x,this._vertexData[e+1]=b.position.y,this._vertexData[e+2]=b.position.z,this._vertexData[e+3]=b.color.r,this._vertexData[e+4]=b.color.g,this._vertexData[e+5]=b.color.b,this._vertexData[e+6]=b.color.a,this._vertexData[e+7]=b.angle,this._vertexData[e+8]=b.size,this._vertexData[e+9]=c,this._vertexData[e+10]=d},c.prototype._update=function(c){this._alive=this.particles.length>0,this.updateFunction(this.particles);var d;d=this.emitter.position?this.emitter.getWorldMatrix():a.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z);for(var e,f=0;c>f&&this.particles.length!==this._capacity;f++){0!==this._stockParticles.length?(e=this._stockParticles.pop(),e.age=0):e=new a.Particle,this.particles.push(e);var g=b(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(g,d,e.direction,e),e.lifeTime=b(this.minLifeTime,this.maxLifeTime),e.size=b(this.minSize,this.maxSize),e.angularSpeed=b(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(d,e.position,e);var h=b(0,1);a.Color4.LerpToRef(this.color1,this.color2,h,e.color),this.colorDead.subtractToRef(e.color,this._colorDiff),this._colorDiff.scaleToRef(1/e.lifeTime,e.colorStep)}},c.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var b=[];this._scene.clipPlane&&b.push("#define CLIPPLANE");var c=b.join("\n");return this._cachedDefines!==c&&(this._cachedDefines=c,this._effect=this._scene.getEngine().createEffect("particles",[a.VertexBuffer.PositionKind,a.VertexBuffer.ColorKind,"options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],c)),this._effect},c.prototype.animate=function(){if(this._started){var a=this._getEffect();if(this.emitter&&a.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var b;this.manualEmitCount>-1?(b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(b=this.emitRate*this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-b),this._newPartsExcess>1&&(b+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(var c=0,d=0;d<this.particles.length;d++){var e=this.particles[d];this._appendParticleVertex(c++,e,0,0),this._appendParticleVertex(c++,e,1,0),this._appendParticleVertex(c++,e,1,1),this._appendParticleVertex(c++,e,0,1)}this._vertexBuffer.update(this._vertexData)}}},c.prototype.render=function(){var b=this._getEffect();if(!(this.emitter&&b.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var d=this._scene.getEngine();d.enableEffect(b),d.setState(!1);var e=this._scene.getViewMatrix();if(b.setTexture("diffuseSampler",this.particleTexture),b.setMatrix("view",e),b.setMatrix("projection",this._scene.getProjectionMatrix()),b.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var f=this._scene.clipPlane,g=e.clone();g.invert(),b.setMatrix("invView",g),b.setFloat4("vClipPlane",f.normal.x,f.normal.y,f.normal.z,f.d)}return d.bindBuffers(this._vertexBuffers,this._indexBuffer,b),this.blendMode===c.BLENDMODE_ONEONE?d.setAlphaMode(a.Engine.ALPHA_ONEONE):d.setAlphaMode(a.Engine.ALPHA_COMBINE),this.forceDepthWrite&&d.setDepthWrite(!0),d.draw(!0,0,6*this.particles.length),d.setAlphaMode(a.Engine.ALPHA_DISABLE),this.particles.length},c.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var a=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(a,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},c.prototype.clone=function(b,d){var e=new c(b,this._capacity,this._scene);return a.Tools.DeepCopy(this,e,["particles"]),void 0===d&&(d=this.emitter),e.emitter=d,this.particleTexture&&(e.particleTexture=new a.Texture(this.particleTexture.url,this._scene)),e.start(),e},c.prototype.serialize=function(){var b={};return b.name=this.name,b.id=this.id,this.emitter.position?b.emitterId=this.emitter.id:b.emitter=this.emitter.asArray(),b.capacity=this.getCapacity(),this.particleTexture&&(b.textureName=this.particleTexture.name),a.Animation.AppendSerializedAnimations(this,b),b.minAngularSpeed=this.minAngularSpeed,b.maxAngularSpeed=this.maxAngularSpeed,b.minSize=this.minSize,b.maxSize=this.maxSize,b.minEmitPower=this.minEmitPower,b.maxEmitPower=this.maxEmitPower,b.minLifeTime=this.minLifeTime,b.maxLifeTime=this.maxLifeTime,b.emitRate=this.emitRate,b.minEmitBox=this.minEmitBox.asArray(),b.maxEmitBox=this.maxEmitBox.asArray(),b.gravity=this.gravity.asArray(),b.direction1=this.direction1.asArray(),b.direction2=this.direction2.asArray(),b.color1=this.color1.asArray(),b.color2=this.color2.asArray(),b.colorDead=this.colorDead.asArray(),b.updateSpeed=this.updateSpeed,b.targetStopDuration=this.targetStopDuration,b.textureMask=this.textureMask.asArray(),b.blendMode=this.blendMode,b},c.Parse=function(b,d,e){var f=b.name,g=new c(f,b.capacity,d);if(b.id&&(g.id=b.id),b.textureName&&(g.particleTexture=new a.Texture(e+b.textureName,d),g.particleTexture.name=b.textureName),b.emitterId?g.emitter=d.getLastMeshByID(b.emitterId):g.emitter=a.Vector3.FromArray(b.emitter),b.animations)for(var h=0;h<b.animations.length;h++){var i=b.animations[h];g.animations.push(a.Animation.Parse(i))}return b.autoAnimate&&d.beginAnimation(g,b.autoAnimateFrom,b.autoAnimateTo,b.autoAnimateLoop,b.autoAnimateSpeed||1),g.minAngularSpeed=b.minAngularSpeed,g.maxAngularSpeed=b.maxAngularSpeed,g.minSize=b.minSize,g.maxSize=b.maxSize,g.minLifeTime=b.minLifeTime,g.maxLifeTime=b.maxLifeTime,g.minEmitPower=b.minEmitPower,g.maxEmitPower=b.maxEmitPower,g.emitRate=b.emitRate,g.minEmitBox=a.Vector3.FromArray(b.minEmitBox),g.maxEmitBox=a.Vector3.FromArray(b.maxEmitBox),g.gravity=a.Vector3.FromArray(b.gravity),g.direction1=a.Vector3.FromArray(b.direction1),g.direction2=a.Vector3.FromArray(b.direction2),g.color1=a.Color4.FromArray(b.color1),g.color2=a.Color4.FromArray(b.color2),g.colorDead=a.Color4.FromArray(b.colorDead),g.updateSpeed=b.updateSpeed,g.targetStopDuration=b.targetStopDuration,g.textureMask=a.Color4.FromArray(b.textureMask),g.blendMode=b.blendMode,b.preventAutoStart||g.start(),g},c.BLENDMODE_ONEONE=0,c.BLENDMODE_STANDARD=1,c}();a.ParticleSystem=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c){this.name=a,this.from=b,this.to=c}return a.prototype.clone=function(){return new a(this.name,this.from,this.to)},a}();a.AnimationRange=b;var c=function(){function a(a,b,c){this.frame=a,this.action=b,this.onlyOnce=c,this.isDone=!1}return a}();a.AnimationEvent=c;var d=function(){function b(a){this.path=a,this._onchange=new Array,this.value=0,this.animations=new Array}return b.prototype.getPoint=function(){var b=this.path.getPointAtLengthPosition(this.value);return new a.Vector3(b.x,0,b.y)},b.prototype.moveAhead=function(a){return void 0===a&&(a=.002),this.move(a),this},b.prototype.moveBack=function(a){return void 0===a&&(a=.002),this.move(-a),this},b.prototype.move=function(a){if(Math.abs(a)>1)throw"step size should be less than 1.";return this.value+=a,this.ensureLimits(),this.raiseOnChange(),this},b.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},b.prototype.markAsDirty=function(a){return this.ensureLimits(),this.raiseOnChange(),this},b.prototype.raiseOnChange=function(){var a=this;return this._onchange.forEach(function(b){return b(a)}),this},b.prototype.onchange=function(a){return this._onchange.push(a),this},b}();a.PathCursor=d;var e=function(){function c(a,b,d,e,f,g){this.name=a,this.targetProperty=b,this.framePerSecond=d,this.dataType=e,this.loopMode=f,this.enableBlending=g,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._events=new Array,this.allowMatricesInterpolation=!1,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=b.split("."),this.dataType=e,this.loopMode=void 0===f?c.ANIMATIONLOOPMODE_CYCLE:f}return c._PrepareAnimation=function(b,d,e,f,g,h,i,j){var k=void 0;if(!isNaN(parseFloat(g))&&isFinite(g)?k=c.ANIMATIONTYPE_FLOAT:g instanceof a.Quaternion?k=c.ANIMATIONTYPE_QUATERNION:g instanceof a.Vector3?k=c.ANIMATIONTYPE_VECTOR3:g instanceof a.Vector2?k=c.ANIMATIONTYPE_VECTOR2:g instanceof a.Color3?k=c.ANIMATIONTYPE_COLOR3:g instanceof a.Size&&(k=c.ANIMATIONTYPE_SIZE),void 0==k)return null;var l=new c(b,d,e,k,i),m=[];return m.push({frame:0,value:g}),m.push({frame:f,value:h}),l.setKeys(m),void 0!==j&&l.setEasingFunction(j),l},c.CreateAndStartAnimation=function(a,b,d,e,f,g,h,i,j,k){var l=c._PrepareAnimation(a,d,e,f,g,h,i,j);return b.getScene().beginDirectAnimation(b,[l],0,f,1===l.loopMode,1,k)},c.CreateMergeAndStartAnimation=function(a,b,d,e,f,g,h,i,j,k){var l=c._PrepareAnimation(a,d,e,f,g,h,i,j);return b.animations.push(l),b.getScene().beginAnimation(b,0,f,1===l.loopMode,1,k)},c.prototype.toString=function(a){var b="Name: "+this.name+", property: "+this.targetProperty;if(b+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(b+=", ",c=!1),b+=d;b+="}"}return b},c.prototype.addEvent=function(a){this._events.push(a)},c.prototype.removeEvents=function(a){for(var b=0;b<this._events.length;b++)this._events[b].frame===a&&(this._events.splice(b,1),b--)},c.prototype.createRange=function(a,c,d){this._ranges[a]||(this._ranges[a]=new b(a,c,d))},c.prototype.deleteRange=function(a,b){if(void 0===b&&(b=!0),this._ranges[a]){if(b)for(var c=this._ranges[a].from,d=this._ranges[a].to,e=this._keys.length-1;e>=0;e--)this._keys[e].frame>=c&&this._keys[e].frame<=d&&this._keys.splice(e,1);this._ranges[a]=void 0}},c.prototype.getRange=function(a){return this._ranges[a]},c.prototype.reset=function(){this._offsetsCache={},this._highLimitsCache={},this.currentFrame=0,this._blendingFactor=0,this._originalBlendValue=null},c.prototype.isStopped=function(){return this._stopped},c.prototype.getKeys=function(){return this._keys},c.prototype.getHighestFrame=function(){for(var a=0,b=0,c=this._keys.length;c>b;b++)a<this._keys[b].frame&&(a=this._keys[b].frame);return a},c.prototype.getEasingFunction=function(){return this._easingFunction},c.prototype.setEasingFunction=function(a){this._easingFunction=a},c.prototype.floatInterpolateFunction=function(a,b,c){return a+(b-a)*c},c.prototype.quaternionInterpolateFunction=function(b,c,d){return a.Quaternion.Slerp(b,c,d)},c.prototype.vector3InterpolateFunction=function(b,c,d){return a.Vector3.Lerp(b,c,d)},c.prototype.vector2InterpolateFunction=function(b,c,d){return a.Vector2.Lerp(b,c,d)},c.prototype.sizeInterpolateFunction=function(b,c,d){return a.Size.Lerp(b,c,d)},c.prototype.color3InterpolateFunction=function(b,c,d){return a.Color3.Lerp(b,c,d)},c.prototype.matrixInterpolateFunction=function(b,c,d){return a.Matrix.Lerp(b,c,d)},c.prototype.clone=function(){var a=new c(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(this._keys&&a.setKeys(this._keys),this._ranges){a._ranges={};for(var b in this._ranges)a._ranges[b]=this._ranges[b].clone()}return a},c.prototype.setKeys=function(a){this._keys=a.slice(0),this._offsetsCache={},this._highLimitsCache={}},c.prototype._getKeyValue=function(a){return"function"==typeof a?a():a},c.prototype._interpolate=function(a,b,d,e,f){if(d===c.ANIMATIONLOOPMODE_CONSTANT&&b>0)return f.clone?f.clone():f;this.currentFrame=a;var g=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(a-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[g].frame>=a)for(;g-1>=0&&this._keys[g].frame>=a;)g--;for(var h=g;h<this._keys.length;h++)if(this._keys[h+1].frame>=a){var i=this._getKeyValue(this._keys[h].value),j=this._getKeyValue(this._keys[h+1].value),k=(a-this._keys[h].frame)/(this._keys[h+1].frame-this._keys[h].frame);switch(null!=this._easingFunction&&(k=this._easingFunction.ease(k)),this.dataType){case c.ANIMATIONTYPE_FLOAT:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return e*b+this.floatInterpolateFunction(i,j,k)}break;case c.ANIMATIONTYPE_QUATERNION:var l=null;switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:l=this.quaternionInterpolateFunction(i,j,k);break;case c.ANIMATIONLOOPMODE_RELATIVE:l=this.quaternionInterpolateFunction(i,j,k).add(e.scale(b))}return l;case c.ANIMATIONTYPE_VECTOR3:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(i,j,k).add(e.scale(b))}case c.ANIMATIONTYPE_VECTOR2:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(i,j,k).add(e.scale(b))}case c.ANIMATIONTYPE_SIZE:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(i,j,k).add(e.scale(b))}case c.ANIMATIONTYPE_COLOR3:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(i,j,k).add(e.scale(b))}case c.ANIMATIONTYPE_MATRIX:switch(d){case c.ANIMATIONLOOPMODE_CYCLE:case c.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(i,j,k);case c.ANIMATIONLOOPMODE_RELATIVE:return i}}break}return this._getKeyValue(this._keys[this._keys.length-1].value)},c.prototype.setValue=function(b,c){void 0===c&&(c=!1);var d,e;if(this.targetPropertyPath.length>1){for(var f=this._target[this.targetPropertyPath[0]],g=1;g<this.targetPropertyPath.length-1;g++)f=f[this.targetPropertyPath[g]];d=this.targetPropertyPath[this.targetPropertyPath.length-1],e=f}else d=this.targetPropertyPath[0],e=this._target;this.enableBlending&&this._blendingFactor<=1?(this._originalBlendValue||(e[d].clone?this._originalBlendValue=e[d].clone():this._originalBlendValue=e[d]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?e[d]=this._originalBlendValue.construtor.prototype.Lerp(b,this._originalBlendValue,this._blendingFactor):e[d]=b:this._originalBlendValue.m?e[d]=a.Matrix.Lerp(this._originalBlendValue,b,this._blendingFactor):e[d]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*b,this._blendingFactor+=this.blendingSpeed):e[d]=b,this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty)},c.prototype.goToFrame=function(a){a<this._keys[0].frame?a=this._keys[0].frame:a>this._keys[this._keys.length-1].frame&&(a=this._keys[this._keys.length-1].frame);var b=this._interpolate(a,0,this.loopMode);this.setValue(b)},c.prototype.animate=function(b,d,e,f,g,h){if(void 0===h&&(h=!1),!this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1;var i=!0;if(0!==this._keys[0].frame){var j={frame:0,value:this._keys[0].value};this._keys.splice(0,0,j)}(d<this._keys[0].frame||d>this._keys[this._keys.length-1].frame)&&(d=this._keys[0].frame),(e<this._keys[0].frame||e>this._keys[this._keys.length-1].frame)&&(e=this._keys[this._keys.length-1].frame);var k,l=e-d,m=b*(this.framePerSecond*g)/1e3,n=0;if(m>l&&!f)i=!1,n=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==c.ANIMATIONLOOPMODE_CYCLE){var o=e.toString()+d.toString();if(!this._offsetsCache[o]){var p=this._interpolate(d,0,c.ANIMATIONLOOPMODE_CYCLE),q=this._interpolate(e,0,c.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case c.ANIMATIONTYPE_FLOAT:this._offsetsCache[o]=q-p;break;case c.ANIMATIONTYPE_QUATERNION:this._offsetsCache[o]=q.subtract(p);break;case c.ANIMATIONTYPE_VECTOR3:this._offsetsCache[o]=q.subtract(p);case c.ANIMATIONTYPE_VECTOR2:this._offsetsCache[o]=q.subtract(p);case c.ANIMATIONTYPE_SIZE:this._offsetsCache[o]=q.subtract(p);case c.ANIMATIONTYPE_COLOR3:this._offsetsCache[o]=q.subtract(p)}this._highLimitsCache[o]=q}n=this._highLimitsCache[o],k=this._offsetsCache[o]}if(void 0===k)switch(this.dataType){case c.ANIMATIONTYPE_FLOAT:k=0;break;case c.ANIMATIONTYPE_QUATERNION:k=new a.Quaternion(0,0,0,0);break;case c.ANIMATIONTYPE_VECTOR3:k=a.Vector3.Zero();break;case c.ANIMATIONTYPE_VECTOR2:k=a.Vector2.Zero();break;case c.ANIMATIONTYPE_SIZE:k=a.Size.Zero();break;case c.ANIMATIONTYPE_COLOR3:k=a.Color3.Black()}var r=m/l>>0,s=i?d+m%l:e,t=this._interpolate(s,r,this.loopMode,k,n);this.setValue(t);for(var u=0;u<this._events.length;u++)if(s>=this._events[u].frame){var v=this._events[u];v.isDone||(v.onlyOnce&&(this._events.splice(u,1),u--),v.isDone=!0,v.action())}else this._events[u].isDone&&!this._events[u].onlyOnce&&(this._events[u].isDone=!1);return i||(this._stopped=!0),i},c.prototype.serialize=function(){var a={};a.name=this.name,a.property=this.targetProperty,a.framePerSecond=this.framePerSecond,a.dataType=this.dataType,a.loopBehavior=this.loopMode;var b=this.dataType;a.keys=[];for(var d=this.getKeys(),e=0;e<d.length;e++){var f=d[e],g={};switch(g.frame=f.frame,b){case c.ANIMATIONTYPE_FLOAT:g.values=[f.value];break;case c.ANIMATIONTYPE_QUATERNION:case c.ANIMATIONTYPE_MATRIX:case c.ANIMATIONTYPE_VECTOR3:case c.ANIMATIONTYPE_COLOR3:g.values=f.value.asArray()}a.keys.push(g)}a.ranges=[];for(var h in this._ranges){var i={};i.name=h,i.from=this._ranges[h].from,i.to=this._ranges[h].to,a.ranges.push(i)}return a},Object.defineProperty(c,"ANIMATIONTYPE_FLOAT",{get:function(){return c._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_VECTOR3",{get:function(){return c._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_VECTOR2",{get:function(){return c._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_SIZE",{get:function(){return c._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_QUATERNION",{get:function(){return c._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_MATRIX",{get:function(){return c._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONTYPE_COLOR3",{get:function(){return c._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return c._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return c._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return c._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),c.Parse=function(b){var d,e,f=new c(b.name,b.property,b.framePerSecond,b.dataType,b.loopBehavior),g=b.dataType,h=[];for(e=0;e<b.keys.length;e++){var i=b.keys[e];switch(g){case c.ANIMATIONTYPE_FLOAT:d=i.values[0];break;case c.ANIMATIONTYPE_QUATERNION:d=a.Quaternion.FromArray(i.values);break;case c.ANIMATIONTYPE_MATRIX:d=a.Matrix.FromArray(i.values);break;case c.ANIMATIONTYPE_COLOR3:d=a.Color3.FromArray(i.values);break;case c.ANIMATIONTYPE_VECTOR3:default:d=a.Vector3.FromArray(i.values)}h.push({frame:i.frame,value:d})}if(f.setKeys(h),b.ranges)for(e=0;e<b.ranges.length;e++)d=b.ranges[e],f.createRange(d.name,d.from,d.to);return f},c.AppendSerializedAnimations=function(a,b){if(a.animations){b.animations=[];for(var c=0;c<a.animations.length;c++){var d=a.animations[c];b.animations.push(d.serialize())}}},c._ANIMATIONTYPE_FLOAT=0,c._ANIMATIONTYPE_VECTOR3=1,c._ANIMATIONTYPE_QUATERNION=2,c._ANIMATIONTYPE_MATRIX=3,c._ANIMATIONTYPE_COLOR3=4,c._ANIMATIONTYPE_VECTOR2=5,c._ANIMATIONTYPE_SIZE=6,c._ANIMATIONLOOPMODE_RELATIVE=0,c._ANIMATIONLOOPMODE_CYCLE=1,c._ANIMATIONLOOPMODE_CONSTANT=2,c}();a.Animation=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c,d,e,f,g,h){void 0===c&&(c=0),void 0===d&&(d=100),void 0===e&&(e=!1),void 0===f&&(f=1),this.target=b,this.fromFrame=c,this.toFrame=d,this.loopAnimation=e,this.speedRatio=f,this.onAnimationEnd=g,this._animations=new Array,this._paused=!1,this.animationStarted=!1,h&&this.appendAnimations(b,h),this._scene=a,a._activeAnimatables.push(this)}return a.prototype.getAnimations=function(){return this._animations},a.prototype.appendAnimations=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d._target=a,this._animations.push(d)}},a.prototype.getAnimationByTargetProperty=function(a){for(var b=this._animations,c=0;c<b.length;c++)if(b[c].targetProperty===a)return b[c];return null},a.prototype.reset=function(){for(var a=this._animations,b=0;b<a.length;b++)a[b].reset();this._localDelayOffset=null,this._pausedDelay=null},a.prototype.enableBlending=function(a){for(var b=this._animations,c=0;c<b.length;c++)b[c].enableBlending=!0,b[c].blendingSpeed=a},a.prototype.disableBlending=function(){for(var a=this._animations,b=0;b<a.length;b++)a[b].enableBlending=!1},a.prototype.goToFrame=function(a){for(var b=this._animations,c=0;c<b.length;c++)b[c].goToFrame(a)},a.prototype.pause=function(){this._paused||(this._paused=!0)},a.prototype.restart=function(){this._paused=!1},a.prototype.stop=function(){var a=this._scene._activeAnimatables.indexOf(this);if(a>-1){this._scene._activeAnimatables.splice(a,1);for(var b=this._animations,a=0;a<b.length;a++)b[a].reset();this.onAnimationEnd&&this.onAnimationEnd()}},a.prototype._animate=function(a){if(this._paused)return this.animationStarted=!1,this._pausedDelay||(this._pausedDelay=a),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=a-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=a;var b,c=!1,d=this._animations;for(b=0;b<d.length;b++){var e=d[b],f=e.animate(a-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio);c=c||f}return this.animationStarted=c,c||(b=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(b,1)),!c&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),c},a}();a.Animatable=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this._easingMode=a.EASINGMODE_EASEIN}return Object.defineProperty(a,"EASINGMODE_EASEIN",{get:function(){return a._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EASINGMODE_EASEOUT",{get:function(){return a._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(a,"EASINGMODE_EASEINOUT",{get:function(){return a._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),a.prototype.setEasingMode=function(a){
var b=Math.min(Math.max(a,0),2);this._easingMode=b},a.prototype.getEasingMode=function(){return this._easingMode},a.prototype.easeInCore=function(a){throw new Error("You must implement this method")},a.prototype.ease=function(b){switch(this._easingMode){case a.EASINGMODE_EASEIN:return this.easeInCore(b);case a.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-b)}return b>=.5?.5*(1-this.easeInCore(2*(1-b)))+.5:.5*this.easeInCore(2*b)},a._EASINGMODE_EASEIN=0,a._EASINGMODE_EASEOUT=1,a._EASINGMODE_EASEINOUT=2,a}();a.EasingFunction=b;var c=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return a=Math.max(0,Math.min(1,a)),1-Math.sqrt(1-a*a)},b}(b);a.CircleEase=c;var d=function(a){function b(b){void 0===b&&(b=1),a.call(this),this.amplitude=b}return __extends(b,a),b.prototype.easeInCore=function(a){var b=Math.max(0,this.amplitude);return Math.pow(a,3)-a*b*Math.sin(3.141592653589793*a)},b}(b);a.BackEase=d;var e=function(a){function b(b,c){void 0===b&&(b=3),void 0===c&&(c=2),a.call(this),this.bounces=b,this.bounciness=c}return __extends(b,a),b.prototype.easeInCore=function(a){var b=Math.max(0,this.bounces),c=this.bounciness;1>=c&&(c=1.001);var d=Math.pow(c,b),e=1-c,f=(1-d)/e+.5*d,g=a*f,h=Math.log(-g*(1-c)+1)/Math.log(c),i=Math.floor(h),j=i+1,k=(1-Math.pow(c,i))/(e*f),l=(1-Math.pow(c,j))/(e*f),m=.5*(k+l),n=a-m,o=m-k;return-Math.pow(1/c,b-i)/(o*o)*(n-o)*(n+o)},b}(b);a.BounceEase=e;var f=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return a*a*a},b}(b);a.CubicEase=f;var g=function(a){function b(b,c){void 0===b&&(b=3),void 0===c&&(c=3),a.call(this),this.oscillations=b,this.springiness=c}return __extends(b,a),b.prototype.easeInCore=function(a){var b,c=Math.max(0,this.oscillations),d=Math.max(0,this.springiness);return b=0==d?a:(Math.exp(d*a)-1)/(Math.exp(d)-1),b*Math.sin((6.283185307179586*c+1.5707963267948966)*a)},b}(b);a.ElasticEase=g;var h=function(a){function b(b){void 0===b&&(b=2),a.call(this),this.exponent=b}return __extends(b,a),b.prototype.easeInCore=function(a){return this.exponent<=0?a:(Math.exp(this.exponent*a)-1)/(Math.exp(this.exponent)-1)},b}(b);a.ExponentialEase=h;var i=function(a){function b(b){void 0===b&&(b=2),a.call(this),this.power=b}return __extends(b,a),b.prototype.easeInCore=function(a){var b=Math.max(0,this.power);return Math.pow(a,b)},b}(b);a.PowerEase=i;var j=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return a*a},b}(b);a.QuadraticEase=j;var k=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return a*a*a*a},b}(b);a.QuarticEase=k;var l=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return a*a*a*a*a},b}(b);a.QuinticEase=l;var m=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.easeInCore=function(a){return 1-Math.sin(1.5707963267948966*(1-a))},b}(b);a.SineEase=m;var n=function(b){function c(a,c,d,e){void 0===a&&(a=0),void 0===c&&(c=0),void 0===d&&(d=1),void 0===e&&(e=1),b.call(this),this.x1=a,this.y1=c,this.x2=d,this.y2=e}return __extends(c,b),c.prototype.easeInCore=function(b){return a.BezierCurve.interpolate(b,this.x1,this.y1,this.x2,this.y2)},c}(b);a.BezierCurveEase=n}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g){b.call(this,c,d.getScene()),this.name=c,this.children=new Array,this.animations=new Array,this._worldTransform=new a.Matrix,this._absoluteTransform=new a.Matrix,this._invertedAbsoluteTransform=new a.Matrix,this._skeleton=d,this._matrix=f,this._baseMatrix=f,this._restPose=g?g:f.clone(),d.bones.push(this),e?(this._parent=e,e.children.push(this)):this._parent=null,this._updateDifferenceMatrix()}return __extends(c,b),c.prototype.getParent=function(){return this._parent},c.prototype.getLocalMatrix=function(){return this._matrix},c.prototype.getBaseMatrix=function(){return this._baseMatrix},c.prototype.getRestPose=function(){return this._restPose},c.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},c.prototype.getWorldMatrix=function(){return this._worldTransform},c.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},c.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},c.prototype.updateMatrix=function(a){this._baseMatrix=a.clone(),this._matrix=a.clone(),this._skeleton._markAsDirty(),this._updateDifferenceMatrix()},c.prototype._updateDifferenceMatrix=function(a){a||(a=this._baseMatrix),this._parent?a.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(a),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var b=0;b<this.children.length;b++)this.children[b]._updateDifferenceMatrix()},c.prototype.markAsDirty=function(){this._currentRenderId++,this._skeleton._markAsDirty()},c.prototype.copyAnimationRange=function(b,c,d,e,f){void 0===e&&(e=!1),void 0===f&&(f=null),0===this.animations.length&&(this.animations.push(new a.Animation(this.name,"_matrix",b.animations[0].framePerSecond,a.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var g=b.animations[0].getRange(c);if(!g)return!1;for(var h,i,j,k=g.from,l=g.to,m=b.animations[0].getKeys(),n=b.length,o=b.getParent(),p=this.getParent(),q=e&&o&&n&&this.length&&n!==this.length,r=q?p.length/o.length:null,s=e&&!p&&f&&(1!==f.x||1!==f.y||1!==f.z),t=this.animations[0].getKeys(),u=0,v=m.length;v>u;u++)h=m[u],h.frame>=k&&h.frame<=l&&(e?(j=h.value.clone(),q?(i=j.getTranslation(),j.setTranslation(i.scaleInPlace(r))):s?(i=j.getTranslation(),j.setTranslation(i.multiplyInPlace(f))):j=h.value):j=h.value,t.push({frame:h.frame+d,value:j}));return this.animations[0].createRange(c,k+d,l+d),!0},c}(a.Node);a.Bone=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d){this.name=b,this.id=c,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=a.Matrix.Identity(),this._ranges={},this.bones=[],this._scene=d,d.skeletons.push(this),this._isDirty=!0}return b.prototype.getTransformMatrices=function(a){return this.needInitialSkinMatrix&&a._bonesTransformMatrices?a._bonesTransformMatrices:this._transformMatrices},b.prototype.getScene=function(){return this._scene},b.prototype.toString=function(a){var b="Name: "+this.name+", nBones: "+this.bones.length;if(b+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),a){b+=", Ranges: {";var c=!0;for(var d in this._ranges)c&&(b+=", ",c=!1),b+=d;b+="}"}return b},b.prototype.getBoneIndexByName=function(a){for(var b=0,c=this.bones.length;c>b;b++)if(this.bones[b].name===a)return b;return-1},b.prototype.createAnimationRange=function(b,c,d){if(!this._ranges[b]){this._ranges[b]=new a.AnimationRange(b,c,d);for(var e=0,f=this.bones.length;f>e;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(b,c,d)}},b.prototype.deleteAnimationRange=function(a,b){void 0===b&&(b=!0);for(var c=0,d=this.bones.length;d>c;c++)this.bones[c].animations[0]&&this.bones[c].animations[0].deleteRange(a,b);this._ranges[a]=void 0},b.prototype.getAnimationRange=function(a){return this._ranges[a]},b.prototype.getAnimationRanges=function(){var a,b=[],c=0;for(a in this._ranges)b[c]=this._ranges[a],c++;return b},b.prototype.copyAnimationRange=function(b,c,d){if(void 0===d&&(d=!1),this._ranges[c]||!b.getAnimationRange(c))return!1;var e,f,g=!0,h=this._getHighestAnimationFrame()+1,i={},j=b.bones;for(f=0,e=j.length;e>f;f++)i[j[f].name]=j[f];this.bones.length!==j.length&&(a.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+j.length),g=!1);var k=d&&this.dimensionsAtRest&&b.dimensionsAtRest?this.dimensionsAtRest.divide(b.dimensionsAtRest):null;for(f=0,e=this.bones.length;e>f;f++){var l=this.bones[f].name,m=i[l];m?g=g&&this.bones[f].copyAnimationRange(m,c,h,d,k):(a.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+l),g=!1)}var n=b.getAnimationRange(c);return this._ranges[c]=new a.AnimationRange(c,n.from+h,n.to+h),g},b.prototype.returnToRest=function(){for(var a=0;a<this.bones.length;a++)this.bones[a].returnToRest()},b.prototype._getHighestAnimationFrame=function(){for(var a=0,b=0,c=this.bones.length;c>b;b++)if(this.bones[b].animations[0]){var d=this.bones[b].animations[0].getHighestFrame();d>a&&(a=d)}return a},b.prototype.beginAnimation=function(a,b,c,d){var e=this.getAnimationRange(a);return e?this._scene.beginAnimation(this,e.from,e.to,b,c,d):null},b.prototype._markAsDirty=function(){this._isDirty=!0},b.prototype._registerMeshWithPoseMatrix=function(a){this._meshesWithPoseMatrix.push(a)},b.prototype._unregisterMeshWithPoseMatrix=function(a){var b=this._meshesWithPoseMatrix.indexOf(a);b>-1&&this._meshesWithPoseMatrix.splice(b,1)},b.prototype._computeTransformMatrices=function(a,b){for(var c=0;c<this.bones.length;c++){var d=this.bones[c],e=d.getParent();e?d.getLocalMatrix().multiplyToRef(e.getWorldMatrix(),d.getWorldMatrix()):b?d.getLocalMatrix().multiplyToRef(b,d.getWorldMatrix()):d.getWorldMatrix().copyFrom(d.getLocalMatrix()),d.getInvertedAbsoluteTransform().multiplyToArray(d.getWorldMatrix(),a,16*c)}this._identity.copyToArray(a,16*this.bones.length)},b.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var b=0;b<this._meshesWithPoseMatrix.length;b++){var c=this._meshesWithPoseMatrix[b];c._bonesTransformMatrices&&c._bonesTransformMatrices.length===16*(this.bones.length+1)||(c._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)));for(var d=c.getPoseMatrix(),e=0;e<this.bones.length;e++){var f=this.bones[e];if(!f.getParent()){var g=f.getBaseMatrix();g.multiplyToRef(d,a.Tmp.Matrix[0]),f._updateDifferenceMatrix(a.Tmp.Matrix[0])}}this._computeTransformMatrices(c._bonesTransformMatrices,d)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones+=this.bones.length}},b.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var a=0;a<this.bones.length;a++)this._animatables.push(this.bones[a])}return this._animatables},b.prototype.clone=function(c,d){var e=new b(c,d||c,this._scene);e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var f=0;f<this.bones.length;f++){var g=this.bones[f],h=null;if(g.getParent()){var i=this.bones.indexOf(g.getParent());h=e.bones[i]}var j=new a.Bone(g.name,e,h,g.getBaseMatrix().clone(),g.getRestPose().clone());a.Tools.DeepCopy(g.animations,j.animations)}if(this._ranges){e._ranges={};for(var k in this._ranges)e._ranges[k]=this._ranges[k].clone()}return this._isDirty=!0,e},b.prototype.enableBlending=function(a){void 0===a&&(a=.01),this.bones.forEach(function(b){b.animations.forEach(function(b){b.enableBlending=!0,b.blendingSpeed=a})})},b.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},b.prototype.serialize=function(){var a={};a.name=this.name,a.id=this.id,a.dimensionsAtRest=this.dimensionsAtRest,a.bones=[],a.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var b=0;b<this.bones.length;b++){var c=this.bones[b],d={parentBoneIndex:c.getParent()?this.bones.indexOf(c.getParent()):-1,name:c.name,matrix:c.getLocalMatrix().toArray(),rest:c.getRestPose().toArray()};a.bones.push(d),c.length&&(d.length=c.length),c.animations&&c.animations.length>0&&(d.animation=c.animations[0].serialize()),a.ranges=[];for(var e in this._ranges){var f={};f.name=e,f.from=this._ranges[e].from,f.to=this._ranges[e].to,a.ranges.push(f)}}return a},b.Parse=function(c,d){var e=new b(c.name,c.id,d);c.dimensionsAtRest&&(e.dimensionsAtRest=a.Vector3.FromArray(c.dimensionsAtRest)),e.needInitialSkinMatrix=c.needInitialSkinMatrix;var f;for(f=0;f<c.bones.length;f++){var g=c.bones[f],h=null;g.parentBoneIndex>-1&&(h=e.bones[g.parentBoneIndex]);var i=g.rest?a.Matrix.FromArray(g.rest):null,j=new a.Bone(g.name,e,h,a.Matrix.FromArray(g.matrix),i);g.length&&(j.length=g.length),g.animation&&j.animations.push(a.Animation.Parse(g.animation))}if(c.ranges)for(f=0;f<c.ranges.length;f++){var k=c.ranges[f];e.createAnimationRange(k.name,k.from,k.to)}return e},b}();a.Skeleton=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f,g,h,i,j,k,l){void 0===h&&(h=a.Texture.NEAREST_SAMPLINGMODE),void 0===l&&(l=a.Engine.TEXTURETYPE_UNSIGNED_INT),this.name=b,this.width=-1,this.height=-1,this.enablePixelPerfectMode=!1,this._reusable=!1,this._textures=new a.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new a.Vector2(1,1),this.onActivateObservable=new a.Observable,this.onSizeChangedObservable=new a.Observable,this.onApplyObservable=new a.Observable,this.onBeforeRenderObservable=new a.Observable,this.onAfterRenderObservable=new a.Observable,null!=g?(this._camera=g,this._scene=g.getScene(),g.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=i,this._options=f,this.renderTargetSamplingMode=h?h:a.Texture.NEAREST_SAMPLINGMODE,this._reusable=j||!1,this._textureType=l,this._samplers=e||[],this._samplers.push("textureSampler"),this._fragmentUrl=c,this._parameters=d||[],this._parameters.push("scale"),this.updateEffect(k)}return Object.defineProperty(b.prototype,"onActivate",{set:function(a){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),this._onActivateObserver=this.onActivateObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onSizeChanged",{set:function(a){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onApply",{set:function(a){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeRender",{set:function(a){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRender",{set:function(a){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(a)},enumerable:!0,configurable:!0}),b.prototype.updateEffect=function(a){this._effect=this._engine.createEffect({vertex:"postprocess",fragment:this._fragmentUrl},["position"],this._parameters,this._samplers,void 0!==a?a:"")},b.prototype.isReusable=function(){return this._reusable},b.prototype.markTextureDirty=function(){this.width=-1},b.prototype.activate=function(b,c){b=b||this._camera;var d=b.getScene(),e=b.getEngine().getCaps().maxTextureSize,f=(c?c._width:this._engine.getRenderingCanvas().width)*this._options|0,g=(c?c._height:this._engine.getRenderingCanvas().height)*this._options|0,h=this._options.width||f,i=this._options.height||g;if(this.renderTargetSamplingMode!==a.Texture.NEAREST_SAMPLINGMODE&&(this._options.width||(h=a.Tools.GetExponentOfTwo(h,e)),this._options.height||(i=a.Tools.GetExponentOfTwo(i,e))),this.width!==h||this.height!==i){if(this._textures.length>0){for(var j=0;j<this._textures.length;j++)this._engine._releaseTexture(this._textures.data[j]);this._textures.reset()}this.width=h,this.height=i,this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===b._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType})),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===b._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType})),this.onSizeChangedObservable.notifyObservers(this)}this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(f/h,g/i),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd],0,f,g)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd])),this.onActivateObservable.notifyObservers(b),this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(d.clearColor,d.autoClear||d.forceWireframe,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(b.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),b.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(a.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null},b.prototype.dispose=function(a){if(a=a||this._camera,this._textures.length>0){for(var b=0;b<this._textures.length;b++)this._engine._releaseTexture(this._textures.data[b]);this._textures.reset()}if(a){a.detachPostProcess(this);var c=a._postProcesses.indexOf(this);0===c&&a._postProcesses.length>0&&this._camera._postProcesses[0].markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},b}();a.PostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a){this._vertexBuffers={},this._scene=a}return b.prototype._prepareBuffers=function(){if(!this._vertexBuffers[a.VertexBuffer.PositionKind]){var b=[];b.push(1,1),b.push(-1,1),b.push(-1,-1),b.push(1,-1),this._vertexBuffers[a.VertexBuffer.PositionKind]=new a.VertexBuffer(this._scene.getEngine(),b,a.VertexBuffer.PositionKind,!1,!1,2);var c=[];c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(c)}},b.prototype._prepareFrame=function(a){var b=this._scene.activeCamera._postProcesses;return 0!==b.length&&this._scene.postProcessesEnabled?(b[0].activate(this._scene.activeCamera,a),!0):!1},b.prototype.directRender=function(a,b){for(var c=this._scene.getEngine(),d=0;d<a.length;d++){d<a.length-1?a[d+1].activate(this._scene.activeCamera,b):b?c.bindFramebuffer(b):c.restoreDefaultFramebuffer();var e=a[d],f=e.apply();f&&(e.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),c.bindBuffers(this._vertexBuffers,this._indexBuffer,f),c.draw(!0,0,6),e.onAfterRenderObservable.notifyObservers(f))}c.setDepthBuffer(!0),c.setDepthWrite(!0)},b.prototype._finalizeFrame=function(a,b,c,d){if(d=d||this._scene.activeCamera._postProcesses,0!==d.length&&this._scene.postProcessesEnabled){for(var e=this._scene.getEngine(),f=0,g=d.length;g>f&&(g-1>f?d[f+1].activate(this._scene.activeCamera,b):b?e.bindFramebuffer(b,c):e.restoreDefaultFramebuffer(),!a);f++){var h=d[f],i=h.apply();i&&(h.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),e.bindBuffers(this._vertexBuffers,this._indexBuffer,i),e.draw(!0,0,6),h.onAfterRenderObservable.notifyObservers(i))}e.setDepthBuffer(!0),e.setDepthWrite(!0)}},b.prototype.dispose=function(){var b=this._vertexBuffers[a.VertexBuffer.PositionKind];b&&(b.dispose(),this._vertexBuffers[a.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},b}();a.PostProcessManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this,b,"pass",null,null,c,d,e,f,g)}return __extends(b,a),b}(a.PostProcess);a.PassPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b){this.type=a,this.jointData=b,b.nativeParams=b.nativeParams||{}}return Object.defineProperty(a.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(a){this._physicsJoint,this._physicsJoint=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"physicsPlugin",{set:function(a){this._physicsPlugin=a},enumerable:!0,configurable:!0}),a.prototype.executeNativeFunction=function(a){a(this._physicsPlugin.world,this._physicsJoint)},a.DistanceJoint=0,a.HingeJoint=1,a.BallAndSocketJoint=2,a.WheelJoint=3,a.SliderJoint=4,a.PrismaticJoint=5,a.UniversalJoint=6,a.Hinge2Joint=a.WheelJoint,a.PointToPointJoint=8,a.SpringJoint=9,a.LockJoint=10,a}();a.PhysicsJoint=b;var c=function(a){function c(c){a.call(this,b.DistanceJoint,c)}return __extends(c,a),c.prototype.updateDistance=function(a,b){this._physicsPlugin.updateDistanceJoint(this,a,b)},c}(b);a.DistanceJoint=c;var d=function(a){function b(b,c){a.call(this,b,c)}return __extends(b,a),b.prototype.setMotor=function(a,b){this._physicsPlugin.setMotor(this,a,b)},b.prototype.setLimit=function(a,b){this._physicsPlugin.setLimit(this,a,b)},b}(b);a.MotorEnabledJoint=d;var e=function(a){function c(c){a.call(this,b.HingeJoint,c)}return __extends(c,a),c.prototype.setMotor=function(a,b){this._physicsPlugin.setMotor(this,a,b)},c.prototype.setLimit=function(a,b){this._physicsPlugin.setLimit(this,a,b)},c}(d);a.HingeJoint=e;var f=function(a){function c(c){a.call(this,b.Hinge2Joint,c)}return __extends(c,a),c.prototype.setMotor=function(a,b,c){void 0===c&&(c=0),this._physicsPlugin.setMotor(this,a,b,c)},c.prototype.setLimit=function(a,b,c){void 0===c&&(c=0),this._physicsPlugin.setLimit(this,a,b,c)},c}(d);a.Hinge2Joint=f}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e){var f=this;return void 0===d&&(d={mass:0}),this.object=b,this.type=c,this._options=d,this._scene=e,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=a.Vector3.Zero(),this._tmpPositionWithDelta=a.Vector3.Zero(),this._tmpRotationWithDelta=new a.Quaternion,this.beforeStep=function(){f.object.position.subtractToRef(f._deltaPosition,f._tmpPositionWithDelta),f._deltaRotationConjugated?f.object.rotationQuaternion.multiplyToRef(f._deltaRotationConjugated,f._tmpRotationWithDelta):f._tmpRotationWithDelta.copyFrom(f.object.rotationQuaternion),f._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(f,f._tmpPositionWithDelta,f._tmpRotationWithDelta),f._onBeforePhysicsStepCallbacks.forEach(function(a){a(f)})},this.afterStep=function(){f._onAfterPhysicsStepCallbacks.forEach(function(a){a(f)}),f._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(f),f.object.position.addInPlace(f._deltaPosition),f._deltaRotation&&f.object.rotationQuaternion.multiplyInPlace(f._deltaRotation)},this.onCollide=function(a){if(f._onPhysicsCollideCallbacks.length){var b=f._physicsEngine.getImpostorWithPhysicsBody(a.body);b&&f._onPhysicsCollideCallbacks.filter(function(a){return-1!==a.otherImpostors.indexOf(b)}).forEach(function(a){a.callback(f,b)})}},this.object?(!this._scene&&b.getScene&&(this._scene=b.getScene()),this._physicsEngine=this._scene.getPhysicsEngine(),void(this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=a.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new a.Quaternion),this._options.mass=void 0===d.mass?0:d.mass,this._options.friction=void 0===d.friction?.2:d.friction,this._options.restitution=void 0===d.restitution?.2:d.restitution,this._joints=[],this.object.parent||this._init()):a.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):void a.Tools.Error("No object was provided. A physics object is obligatory")}return b.prototype._init=function(){this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this.parent||this._physicsEngine.addImpostor(this)},b.prototype._getPhysicsParent=function(){if(this.object.parent instanceof a.AbstractMesh){var b=this.object.parent;return b.physicsImpostor}},b.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},b.prototype.setScalingUpdated=function(a){this.forceUpdate()},b.prototype.forceUpdate=function(){this._init(),this.parent&&this.parent.forceUpdate()},Object.defineProperty(b.prototype,"physicsBody",{get:function(){return this._parent?this._parent.physicsBody:this._physicsBody},set:function(a){this._physicsBody&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=a,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),b.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},b.prototype.getObjectExtendSize=function(){return this.object.getBoundingInfo?(this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiply(this.object.scaling)):b.DEFAULT_OBJECT_SIZE},b.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.center:this.object.position},b.prototype.getParam=function(a){return this._options[a]},b.prototype.setParam=function(a,b){this._options[a]=b,this._bodyUpdateRequired=!0},b.prototype.setMass=function(a){this.getParam("mass")!==a&&this.setParam("mass",a),this._physicsEngine.getPhysicsPlugin().setBodyMass(this,a)},b.prototype.getLinearVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this)},b.prototype.setLinearVelocity=function(a){this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,a)},b.prototype.getAngularVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this)},b.prototype.setAngularVelocity=function(a){this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,a)},b.prototype.executeNativeFunction=function(a){a(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},b.prototype.registerBeforePhysicsStep=function(a){this._onBeforePhysicsStepCallbacks.push(a)},b.prototype.unregisterBeforePhysicsStep=function(b){var c=this._onBeforePhysicsStepCallbacks.indexOf(b);c>-1?this._onBeforePhysicsStepCallbacks.splice(c,1):a.Tools.Warn("Function to remove was not found")},b.prototype.registerAfterPhysicsStep=function(a){this._onAfterPhysicsStepCallbacks.push(a)},b.prototype.unregisterAfterPhysicsStep=function(b){var c=this._onAfterPhysicsStepCallbacks.indexOf(b);c>-1?this._onAfterPhysicsStepCallbacks.splice(c,1):a.Tools.Warn("Function to remove was not found")},b.prototype.registerOnPhysicsCollide=function(a,b){var c=a instanceof Array?a:[a];this._onPhysicsCollideCallbacks.push({callback:b,otherImpostors:c})},b.prototype.unregisterOnPhysicsCollide=function(b,c){var d=b instanceof Array?b:[b],e=this._onPhysicsCollideCallbacks.indexOf({callback:c,otherImpostors:d});e>-1?this._onPhysicsCollideCallbacks.splice(e,1):a.Tools.Warn("Function to remove was not found")},b.prototype.applyForce=function(a,b){this._physicsEngine.getPhysicsPlugin().applyForce(this,a,b)},b.prototype.applyImpulse=function(a,b){this._physicsEngine.getPhysicsPlugin().applyImpulse(this,a,b)},b.prototype.createJoint=function(b,c,d){var e=new a.PhysicsJoint(c,d);this.addJoint(b,e)},b.prototype.addJoint=function(a,b){this._joints.push({otherImpostor:a,joint:b}),this._physicsEngine.addJoint(this,a,b)},b.prototype.sleep=function(){this._physicsEngine.getPhysicsPlugin().sleepBody(this)},b.prototype.wakeUp=function(){this._physicsEngine.getPhysicsPlugin().wakeUpBody(this)},b.prototype.clone=function(a){return a?new b(a,this.type,this._options,this._scene):null},b.prototype.dispose=function(){var a=this;this._physicsEngine&&(this._joints.forEach(function(b){a._physicsEngine.removeJoint(a,b.otherImpostor,b.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate())},b.prototype.setDeltaPosition=function(a){this._deltaPosition.copyFrom(a)},b.prototype.setDeltaRotation=function(b){this._deltaRotation||(this._deltaRotation=new a.Quaternion),this._deltaRotation.copyFrom(b),this._deltaRotationConjugated=this._deltaRotation.conjugate()},b.DEFAULT_OBJECT_SIZE=new a.Vector3(1,1,1),b.NoImpostor=0,b.SphereImpostor=1,b.BoxImpostor=2,b.PlaneImpostor=3,b.MeshImpostor=4,b.CylinderImpostor=7,b.ParticleImpostor=8,b.HeightmapImpostor=9,b}();a.PhysicsImpostor=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){if(void 0===c&&(c=new a.CannonJSPlugin),this._physicsPlugin=c,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");b=b||new a.Vector3(0,-9.807,0),this.setGravity(b),this.setTimeStep()}return b.prototype.setGravity=function(a){this.gravity=a,this._physicsPlugin.setGravity(this.gravity)},b.prototype.setTimeStep=function(a){void 0===a&&(a=1/60),this._physicsPlugin.setTimeStep(a)},b.prototype.dispose=function(){this._impostors.forEach(function(a){a.dispose()}),this._physicsPlugin.dispose()},b.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},b.prototype.addImpostor=function(a){a.uniqueId=this._impostors.push(a),a.parent||this._physicsPlugin.generatePhysicsBody(a)},b.prototype.removeImpostor=function(a){var b=this._impostors.indexOf(a);if(b>-1){var c=this._impostors.splice(b,1);c.length&&(c[0].physicsBody=null)}},b.prototype.addJoint=function(a,b,c){var d={mainImpostor:a,connectedImpostor:b,joint:c};c.physicsPlugin=this._physicsPlugin,this._joints.push(d),this._physicsPlugin.generateJoint(d)},b.prototype.removeJoint=function(a,b,c){var d=this._joints.filter(function(d){return d.connectedImpostor===b&&d.joint===c&&d.mainImpostor===a});d.length&&this._physicsPlugin.removeJoint(d[0])},b.prototype._step=function(a){var b=this;this._impostors.forEach(function(a){a.isBodyInitRequired()&&b._physicsPlugin.generatePhysicsBody(a)}),a>.1?a=.1:0>=a&&(a=1/60),this._physicsPlugin.executeStep(a,this._impostors)},b.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},b.prototype.getImpostorForPhysicsObject=function(a){for(var b=0;b<this._impostors.length;++b)if(this._impostors[b].object===a)return this._impostors[b]},b.prototype.getImpostorWithPhysicsBody=function(a){for(var b=0;b<this._impostors.length;++b)if(this._impostors[b].physicsBody===a)return this._impostors[b]},b.NoImpostor=a.PhysicsImpostor.NoImpostor,b.SphereImpostor=a.PhysicsImpostor.SphereImpostor,b.BoxImpostor=a.PhysicsImpostor.BoxImpostor,b.PlaneImpostor=a.PhysicsImpostor.PlaneImpostor,b.MeshImpostor=a.PhysicsImpostor.MeshImpostor,b.CylinderImpostor=a.PhysicsImpostor.CylinderImpostor,b.HeightmapImpostor=a.PhysicsImpostor.HeightmapImpostor,b.CapsuleImpostor=-1,b.ConeImpostor=-1,b.ConvexHullImpostor=-1,b.Epsilon=.001,b}();a.PhysicsEngine=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return b.prototype.set=function(b,c){switch(c){case a.VertexBuffer.PositionKind:this.positions=b;break;case a.VertexBuffer.NormalKind:this.normals=b;break;case a.VertexBuffer.UVKind:this.uvs=b;break;case a.VertexBuffer.UV2Kind:this.uvs2=b;break;case a.VertexBuffer.UV3Kind:this.uvs3=b;break;case a.VertexBuffer.UV4Kind:this.uvs4=b;break;case a.VertexBuffer.UV5Kind:this.uvs5=b;break;case a.VertexBuffer.UV6Kind:this.uvs6=b;break;case a.VertexBuffer.ColorKind:
this.colors=b;break;case a.VertexBuffer.MatricesIndicesKind:this.matricesIndices=b;break;case a.VertexBuffer.MatricesWeightsKind:this.matricesWeights=b;break;case a.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=b;break;case a.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=b}},b.prototype.applyToMesh=function(a,b){this._applyTo(a,b)},b.prototype.applyToGeometry=function(a,b){this._applyTo(a,b)},b.prototype.updateMesh=function(a,b,c){this._update(a)},b.prototype.updateGeometry=function(a,b,c){this._update(a)},b.prototype._applyTo=function(b,c){this.positions&&b.setVerticesData(a.VertexBuffer.PositionKind,this.positions,c),this.normals&&b.setVerticesData(a.VertexBuffer.NormalKind,this.normals,c),this.uvs&&b.setVerticesData(a.VertexBuffer.UVKind,this.uvs,c),this.uvs2&&b.setVerticesData(a.VertexBuffer.UV2Kind,this.uvs2,c),this.uvs3&&b.setVerticesData(a.VertexBuffer.UV3Kind,this.uvs3,c),this.uvs4&&b.setVerticesData(a.VertexBuffer.UV4Kind,this.uvs4,c),this.uvs5&&b.setVerticesData(a.VertexBuffer.UV5Kind,this.uvs5,c),this.uvs6&&b.setVerticesData(a.VertexBuffer.UV6Kind,this.uvs6,c),this.colors&&b.setVerticesData(a.VertexBuffer.ColorKind,this.colors,c),this.matricesIndices&&b.setVerticesData(a.VertexBuffer.MatricesIndicesKind,this.matricesIndices,c),this.matricesWeights&&b.setVerticesData(a.VertexBuffer.MatricesWeightsKind,this.matricesWeights,c),this.matricesIndicesExtra&&b.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,c),this.matricesWeightsExtra&&b.setVerticesData(a.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,c),this.indices&&b.setIndices(this.indices)},b.prototype._update=function(b,c,d){this.positions&&b.updateVerticesData(a.VertexBuffer.PositionKind,this.positions,c,d),this.normals&&b.updateVerticesData(a.VertexBuffer.NormalKind,this.normals,c,d),this.uvs&&b.updateVerticesData(a.VertexBuffer.UVKind,this.uvs,c,d),this.uvs2&&b.updateVerticesData(a.VertexBuffer.UV2Kind,this.uvs2,c,d),this.uvs3&&b.updateVerticesData(a.VertexBuffer.UV3Kind,this.uvs3,c,d),this.uvs4&&b.updateVerticesData(a.VertexBuffer.UV4Kind,this.uvs4,c,d),this.uvs5&&b.updateVerticesData(a.VertexBuffer.UV5Kind,this.uvs5,c,d),this.uvs6&&b.updateVerticesData(a.VertexBuffer.UV6Kind,this.uvs6,c,d),this.colors&&b.updateVerticesData(a.VertexBuffer.ColorKind,this.colors,c,d),this.matricesIndices&&b.updateVerticesData(a.VertexBuffer.MatricesIndicesKind,this.matricesIndices,c,d),this.matricesWeights&&b.updateVerticesData(a.VertexBuffer.MatricesWeightsKind,this.matricesWeights,c,d),this.matricesIndicesExtra&&b.updateVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,c,d),this.matricesWeightsExtra&&b.updateVerticesData(a.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,c,d),this.indices&&b.setIndices(this.indices)},b.prototype.transform=function(b){var c,d=a.Vector3.Zero();if(this.positions){var e=a.Vector3.Zero();for(c=0;c<this.positions.length;c+=3)a.Vector3.FromArrayToRef(this.positions,c,e),a.Vector3.TransformCoordinatesToRef(e,b,d),this.positions[c]=d.x,this.positions[c+1]=d.y,this.positions[c+2]=d.z}if(this.normals){var f=a.Vector3.Zero();for(c=0;c<this.normals.length;c+=3)a.Vector3.FromArrayToRef(this.normals,c,f),a.Vector3.TransformNormalToRef(f,b,d),this.normals[c]=d.x,this.normals[c+1]=d.y,this.normals[c+2]=d.z}},b.prototype.merge=function(a){if(a.indices){this.indices||(this.indices=[]);for(var b=this.positions?this.positions.length/3:0,c=0;c<a.indices.length;c++)this.indices.push(a.indices[c]+b)}this.positions=this._mergeElement(this.positions,a.positions),this.normals=this._mergeElement(this.normals,a.normals),this.uvs=this._mergeElement(this.uvs,a.uvs),this.uvs2=this._mergeElement(this.uvs2,a.uvs2),this.uvs3=this._mergeElement(this.uvs3,a.uvs3),this.uvs4=this._mergeElement(this.uvs4,a.uvs4),this.uvs5=this._mergeElement(this.uvs5,a.uvs5),this.uvs6=this._mergeElement(this.uvs6,a.uvs6),this.colors=this._mergeElement(this.colors,a.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,a.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,a.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,a.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,a.matricesWeightsExtra)},b.prototype._mergeElement=function(a,b){if(!b)return a;if(!a)return b;var c=b.length+a.length,d=a instanceof Float32Array,e=b instanceof Float32Array;if(d){var f=new Float32Array(c);return f.set(a),f.set(b,a.length),f}if(e){for(var g=a.slice(0),h=0,c=b.length;c>h;h++)g.push(b[h]);return g}return a.concat(b)},b.prototype.serialize=function(){var a=this.serialize();return this.positions&&(a.positions=this.positions),this.normals&&(a.normals=this.normals),this.uvs&&(a.uvs=this.uvs),this.uvs2&&(a.uvs2=this.uvs2),this.uvs3&&(a.uvs3=this.uvs3),this.uvs4&&(a.uvs4=this.uvs4),this.uvs5&&(a.uvs5=this.uvs5),this.uvs6&&(a.uvs6=this.uvs6),this.colors&&(a.colors=this.colors),this.matricesIndices&&(a.matricesIndices=this.matricesIndices,a.matricesIndices._isExpanded=!0),this.matricesWeights&&(a.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(a.matricesIndicesExtra=this.matricesIndicesExtra,a.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(a.matricesWeightsExtra=this.matricesWeightsExtra),a.indices=this.indices,a},b.ExtractFromMesh=function(a,c){return b._ExtractFrom(a,c)},b.ExtractFromGeometry=function(a,c){return b._ExtractFrom(a,c)},b._ExtractFrom=function(c,d){var e=new b;return c.isVerticesDataPresent(a.VertexBuffer.PositionKind)&&(e.positions=c.getVerticesData(a.VertexBuffer.PositionKind,d)),c.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(e.normals=c.getVerticesData(a.VertexBuffer.NormalKind,d)),c.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(e.uvs=c.getVerticesData(a.VertexBuffer.UVKind,d)),c.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(e.uvs2=c.getVerticesData(a.VertexBuffer.UV2Kind,d)),c.isVerticesDataPresent(a.VertexBuffer.UV3Kind)&&(e.uvs3=c.getVerticesData(a.VertexBuffer.UV3Kind,d)),c.isVerticesDataPresent(a.VertexBuffer.UV4Kind)&&(e.uvs4=c.getVerticesData(a.VertexBuffer.UV4Kind,d)),c.isVerticesDataPresent(a.VertexBuffer.UV5Kind)&&(e.uvs5=c.getVerticesData(a.VertexBuffer.UV5Kind,d)),c.isVerticesDataPresent(a.VertexBuffer.UV6Kind)&&(e.uvs6=c.getVerticesData(a.VertexBuffer.UV6Kind,d)),c.isVerticesDataPresent(a.VertexBuffer.ColorKind)&&(e.colors=c.getVerticesData(a.VertexBuffer.ColorKind,d)),c.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesKind)&&(e.matricesIndices=c.getVerticesData(a.VertexBuffer.MatricesIndicesKind,d)),c.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsKind)&&(e.matricesWeights=c.getVerticesData(a.VertexBuffer.MatricesWeightsKind,d)),c.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesExtraKind)&&(e.matricesIndicesExtra=c.getVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,d)),c.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsExtraKind)&&(e.matricesWeightsExtra=c.getVerticesData(a.VertexBuffer.MatricesWeightsExtraKind,d)),e.indices=c.getIndices(d),e},b.CreateRibbon=function(c){var d=c.pathArray,e=c.closeArray||!1,f=c.closePath||!1,g=Math.floor(d[0].length/2),h=c.offset||g;h=h>g?g:Math.floor(h);var i,j,k,l,m=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,n=[],o=[],p=[],q=[],r=[],s=[],t=[],u=[],v=[],w=[];if(d.length<2){var x=[],y=[];for(k=0;k<d[0].length-h;k++)x.push(d[0][k]),y.push(d[0][k+h]);d=[x,y]}var z,A,B=0,C=f?1:0;i=d[0].length;var D,E;for(j=0;j<d.length;j++){for(t[j]=0,r[j]=[0],z=d[j],A=z.length,i=A>i?i:A,l=0;A>l;)n.push(z[l].x,z[l].y,z[l].z),l>0&&(D=z[l].subtract(z[l-1]).length(),E=D+t[j],r[j].push(E),t[j]=E),l++;f&&(l--,n.push(z[0].x,z[0].y,z[0].z),D=z[l].subtract(z[0]).length(),E=D+t[j],r[j].push(E),t[j]=E),v[j]=A+C,w[j]=B,B+=A+C}var F,G,H,I;for(k=0;i+C>k;k++){for(u[k]=0,s[k]=[0],j=0;j<d.length-1;j++)F=d[j],G=d[j+1],k===i?(H=F[0],I=G[0]):(H=F[k],I=G[k]),D=I.subtract(H).length(),E=D+u[k],s[k].push(E),u[k]=E;e&&(F=d[j],G=d[0],k===i&&(I=G[0]),D=I.subtract(H).length(),E=D+u[k],u[k]=E)}var J,K;for(j=0;j<d.length;j++)for(k=0;i+C>k;k++)J=r[j][k]/t[j],K=s[k][j]/u[k],q.push(J,K);j=0;for(var L=0,M=v[j]-1,N=v[j+1]-1,O=N>M?M:N,P=w[1]-w[0],Q=e?v.length:v.length-1;O>=L&&Q>j;)o.push(L,L+P,L+1),o.push(L+P+1,L+1,L+P),L+=1,L===O&&(j++,j===v.length-1?(P=w[0]-w[j],M=v[j]-1,N=v[0]-1):(P=w[j+1]-w[j],M=v[j]-1,N=v[j+1]-1),L=w[j],O=N>M?M+L:N+L);if(b.ComputeNormals(n,o,p),f){var R=0,S=0;for(j=0;j<d.length;j++)R=3*w[j],S=j+1<d.length?3*(w[j+1]-1):p.length-3,p[R]=.5*(p[R]+p[S]),p[R+1]=.5*(p[R+1]+p[S+1]),p[R+2]=.5*(p[R+2]+p[S+2]),p[S]=p[R],p[S+1]=p[R+1],p[S+2]=p[R+2]}b._ComputeSides(m,n,o,p,q);var T=new b;return T.indices=o,T.positions=n,T.normals=p,T.uvs=q,f&&(T._idx=w),T},b.CreateBox=function(c){for(var d=[new a.Vector3(0,0,1),new a.Vector3(0,0,-1),new a.Vector3(1,0,0),new a.Vector3(-1,0,0),new a.Vector3(0,1,0),new a.Vector3(0,-1,0)],e=[],f=[],g=[],h=[],i=c.width||c.size||1,j=c.height||c.size||1,k=c.depth||c.size||1,l=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,m=c.faceUV||new Array(6),n=c.faceColors,o=[],p=0;6>p;p++)void 0===m[p]&&(m[p]=new a.Vector4(0,0,1,1)),n&&void 0===n[p]&&(n[p]=new a.Color4(1,1,1,1));for(var q=new a.Vector3(i/2,j/2,k/2),r=0;r<d.length;r++){var s=d[r],t=new a.Vector3(s.y,s.z,s.x),u=a.Vector3.Cross(s,t),v=f.length/3;e.push(v),e.push(v+1),e.push(v+2),e.push(v),e.push(v+2),e.push(v+3);var w=s.subtract(t).subtract(u).multiply(q);f.push(w.x,w.y,w.z),g.push(s.x,s.y,s.z),h.push(m[r].z,m[r].w),n&&o.push(n[r].r,n[r].g,n[r].b,n[r].a),w=s.subtract(t).add(u).multiply(q),f.push(w.x,w.y,w.z),g.push(s.x,s.y,s.z),h.push(m[r].x,m[r].w),n&&o.push(n[r].r,n[r].g,n[r].b,n[r].a),w=s.add(t).add(u).multiply(q),f.push(w.x,w.y,w.z),g.push(s.x,s.y,s.z),h.push(m[r].x,m[r].y),n&&o.push(n[r].r,n[r].g,n[r].b,n[r].a),w=s.add(t).subtract(u).multiply(q),f.push(w.x,w.y,w.z),g.push(s.x,s.y,s.z),h.push(m[r].z,m[r].y),n&&o.push(n[r].r,n[r].g,n[r].b,n[r].a)}b._ComputeSides(l,f,e,g,h);var x=new b;if(x.indices=e,x.positions=f,x.normals=g,x.uvs=h,n){var y=l===a.Mesh.DOUBLESIDE?o.concat(o):o;x.colors=y}return x},b.CreateSphere=function(c){for(var d=c.segments||32,e=c.diameterX||c.diameter||1,f=c.diameterY||c.diameter||1,g=c.diameterZ||c.diameter||1,h=c.arc<=0||c.arc>1?1:c.arc||1,i=c.slice<=0?1:c.slice||1,j=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,k=new a.Vector3(e/2,f/2,g/2),l=2+d,m=2*l,n=[],o=[],p=[],q=[],r=0;l>=r;r++){for(var s=r/l,t=s*Math.PI*i,u=0;m>=u;u++){var v=u/m,w=v*Math.PI*2*h,x=a.Matrix.RotationZ(-t),y=a.Matrix.RotationY(w),z=a.Vector3.TransformCoordinates(a.Vector3.Up(),x),A=a.Vector3.TransformCoordinates(z,y),B=A.multiply(k),C=A.divide(k).normalize();o.push(B.x,B.y,B.z),p.push(C.x,C.y,C.z),q.push(v,s)}if(r>0)for(var D=o.length/3,E=D-2*(m+1);D>E+m+2;E++)n.push(E),n.push(E+1),n.push(E+m+1),n.push(E+m+1),n.push(E+1),n.push(E+m+2)}b._ComputeSides(j,o,n,p,q);var F=new b;return F.indices=n,F.positions=o,F.normals=p,F.uvs=q,F},b.CreateCylinder=function(c){var d,e=c.height||2,f=0===c.diameterTop?0:c.diameterTop||c.diameter||1,g=c.diameterBottom||c.diameter||1,h=c.tessellation||24,i=c.subdivisions||1,j=c.hasRings,k=c.enclose,l=c.arc<=0||c.arc>1?1:c.arc||1,m=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,n=c.faceUV||new Array(3),o=c.faceColors,p=1!==l&&k?2:0,q=j?i:1,r=2+(1+p)*q;for(d=0;r>d;d++)o&&void 0===o[d]&&(o[d]=new a.Color4(1,1,1,1));for(d=0;r>d;d++)n&&void 0===n[d]&&(n[d]=new a.Vector4(0,0,1,1));var s,t,u,v,w,x,y=[],z=[],A=[],B=[],C=[],D=2*Math.PI*l/h,E=(g-f)/2/e,F=a.Vector3.Zero(),G=a.Vector3.Zero(),H=a.Vector3.Zero(),I=a.Vector3.Zero(),J=a.Vector3.Zero(),K=a.Axis.Y,L=1,M=1,N=0,O=0;for(v=0;i>=v;v++)for(t=v/i,u=(t*(f-g)+g)/2,L=j&&0!==v&&v!==i?2:1,x=0;L>x;x++){for(j&&(M+=x),k&&(M+=2*x),w=0;h>=w;w++)s=w*D,F.x=Math.cos(-s)*u,F.y=-e/2+t*e,F.z=Math.sin(-s)*u,0===f&&v===i?(G.x=A[A.length-3*(h+1)],G.y=A[A.length-3*(h+1)+1],G.z=A[A.length-3*(h+1)+2]):(G.x=F.x,G.z=F.z,G.y=Math.sqrt(G.x*G.x+G.z*G.z)*E,G.normalize()),0===w&&(H.copyFrom(F),I.copyFrom(G)),z.push(F.x,F.y,F.z),A.push(G.x,G.y,G.z),O=j?N!==M?n[M].y:n[M].w:n[M].y+(n[M].w-n[M].y)*t,B.push(n[M].x+(n[M].z-n[M].x)*w/h,O),o&&C.push(o[M].r,o[M].g,o[M].b,o[M].a);1!==l&&k&&(z.push(F.x,F.y,F.z),z.push(0,F.y,0),z.push(0,F.y,0),z.push(H.x,H.y,H.z),a.Vector3.CrossToRef(K,G,J),J.normalize(),A.push(J.x,J.y,J.z,J.x,J.y,J.z),a.Vector3.CrossToRef(I,K,J),J.normalize(),A.push(J.x,J.y,J.z,J.x,J.y,J.z),O=j?N!==M?n[M+1].y:n[M+1].w:n[M+1].y+(n[M+1].w-n[M+1].y)*t,B.push(n[M+1].x,O),B.push(n[M+1].z,O),O=j?N!==M?n[M+2].y:n[M+2].w:n[M+2].y+(n[M+2].w-n[M+2].y)*t,B.push(n[M+2].x,O),B.push(n[M+2].z,O),o&&(C.push(o[M+1].r,o[M+1].g,o[M+1].b,o[M+1].a),C.push(o[M+1].r,o[M+1].g,o[M+1].b,o[M+1].a),C.push(o[M+2].r,o[M+2].g,o[M+2].b,o[M+2].a),C.push(o[M+2].r,o[M+2].g,o[M+2].b,o[M+2].a))),N!==M&&(N=M)}var M,P=1!==l&&k?h+4:h;for(v=0,M=0;i>M;M++){for(w=0;h>w;w++){var Q=v*(P+1)+w,R=(v+1)*(P+1)+w,S=v*(P+1)+(w+1),T=(v+1)*(P+1)+(w+1);y.push(Q,R,S),y.push(T,S,R)}1!==l&&k&&(y.push(Q+2,R+2,S+2),y.push(T+2,S+2,R+2),y.push(Q+4,R+4,S+4),y.push(T+4,S+4,R+4)),v=j?v+2:v+1}var U=function(b){var c=b?f/2:g/2;if(0!==c){var d,i,j,k,m=b?n[r-1]:n[0];o&&(k=b?o[r-1]:o[0]);var p=z.length/3,q=b?e/2:-e/2,s=new a.Vector3(0,q,0);z.push(s.x,s.y,s.z),A.push(0,b?1:-1,0),B.push(m.x+.5*(m.z-m.x),m.y+.5*(m.w-m.y)),o&&C.push(k.r,k.g,k.b,k.a);var t=new a.Vector2(.5,.5);for(j=0;h>=j;j++){d=2*Math.PI*j*l/h;var u=Math.cos(-d),v=Math.sin(-d);i=new a.Vector3(u*c,q,v*c);var w=new a.Vector2(u*t.x+.5,v*t.y+.5);z.push(i.x,i.y,i.z),A.push(0,b?1:-1,0),B.push(m.x+(m.z-m.x)*w.x,m.y+(m.w-m.y)*w.y),o&&C.push(k.r,k.g,k.b,k.a)}for(j=0;h>j;j++)b?(y.push(p),y.push(p+(j+2)),y.push(p+(j+1))):(y.push(p),y.push(p+(j+1)),y.push(p+(j+2)))}};U(!1),U(!0),b._ComputeSides(m,z,y,A,B);var V=new b;return V.indices=y,V.positions=z,V.normals=A,V.uvs=B,o&&(V.colors=C),V},b.CreateTorus=function(c){for(var d=[],e=[],f=[],g=[],h=c.diameter||1,i=c.thickness||.5,j=c.tessellation||16,k=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,l=j+1,m=0;j>=m;m++)for(var n=m/j,o=m*Math.PI*2/j-Math.PI/2,p=a.Matrix.Translation(h/2,0,0).multiply(a.Matrix.RotationY(o)),q=0;j>=q;q++){var r=1-q/j,s=q*Math.PI*2/j+Math.PI,t=Math.cos(s),u=Math.sin(s),v=new a.Vector3(t,u,0),w=v.scale(i/2),x=new a.Vector2(n,r);w=a.Vector3.TransformCoordinates(w,p),v=a.Vector3.TransformNormal(v,p),e.push(w.x,w.y,w.z),f.push(v.x,v.y,v.z),g.push(x.x,x.y);var y=(m+1)%l,z=(q+1)%l;d.push(m*l+q),d.push(m*l+z),d.push(y*l+q),d.push(m*l+z),d.push(y*l+z),d.push(y*l+q)}b._ComputeSides(k,e,d,f,g);var A=new b;return A.indices=d,A.positions=e,A.normals=f,A.uvs=g,A},b.CreateLineSystem=function(a){for(var c=[],d=[],e=a.lines,f=0,g=0;g<e.length;g++)for(var h=e[g],i=0;i<h.length;i++)d.push(h[i].x,h[i].y,h[i].z),i>0&&(c.push(f-1),c.push(f)),f++;var j=new b;return j.indices=c,j.positions=d,j},b.CreateDashedLines=function(c){var d=c.dashSize||3,e=c.gapSize||1,f=c.dashNb||200,g=c.points,h=new Array,i=new Array,j=a.Vector3.Zero(),k=0,l=0,m=0,n=0,o=0,p=0,q=0;for(q=0;q<g.length-1;q++)g[q+1].subtractToRef(g[q],j),k+=j.length();for(m=k/f,n=d*m/(d+e),q=0;q<g.length-1;q++){g[q+1].subtractToRef(g[q],j),l=Math.floor(j.length()/m),j.normalize();for(var r=0;l>r;r++)o=m*r,h.push(g[q].x+o*j.x,g[q].y+o*j.y,g[q].z+o*j.z),h.push(g[q].x+(o+n)*j.x,g[q].y+(o+n)*j.y,g[q].z+(o+n)*j.z),i.push(p,p+1),p+=2}var s=new b;return s.positions=h,s.indices=i,s},b.CreateGround=function(c){var d,e,f=[],g=[],h=[],i=[],j=c.width||1,k=c.height||1,l=c.subdivisions||1;for(d=0;l>=d;d++)for(e=0;l>=e;e++){var m=new a.Vector3(e*j/l-j/2,0,(l-d)*k/l-k/2),n=new a.Vector3(0,1,0);g.push(m.x,m.y,m.z),h.push(n.x,n.y,n.z),i.push(e/l,1-d/l)}for(d=0;l>d;d++)for(e=0;l>e;e++)f.push(e+1+(d+1)*(l+1)),f.push(e+1+d*(l+1)),f.push(e+d*(l+1)),f.push(e+(d+1)*(l+1)),f.push(e+1+(d+1)*(l+1)),f.push(e+d*(l+1));var o=new b;return o.indices=f,o.positions=g,o.normals=h,o.uvs=i,o},b.CreateTiledGround=function(c){function d(b,c,d,g){var h=p.length/3,i=n.w+1;for(e=0;e<n.h;e++)for(f=0;f<n.w;f++){var j=[h+f+e*i,h+(f+1)+e*i,h+(f+1)+(e+1)*i,h+f+(e+1)*i];o.push(j[1]),o.push(j[2]),o.push(j[3]),o.push(j[0]),o.push(j[1]),o.push(j[3])}var k=a.Vector3.Zero(),l=new a.Vector3(0,1,0);for(e=0;e<=n.h;e++)for(k.z=e*(g-c)/n.h+c,f=0;f<=n.w;f++)k.x=f*(d-b)/n.w+b,k.y=0,p.push(k.x,k.y,k.z),q.push(l.x,l.y,l.z),r.push(f/n.w,e/n.h)}var e,f,g,h,i=c.xmin,j=c.zmin,k=c.xmax,l=c.zmax,m=c.subdivisions||{w:1,h:1},n=c.precision||{w:1,h:1},o=[],p=[],q=[],r=[];m.h=m.w<1?1:m.h,m.w=m.w<1?1:m.w,n.w=n.w<1?1:n.w,n.h=n.h<1?1:n.h;var s={w:(k-i)/m.w,h:(l-j)/m.h};for(g=0;g<m.h;g++)for(h=0;h<m.w;h++)d(i+h*s.w,j+g*s.h,i+(h+1)*s.w,j+(g+1)*s.h);var t=new b;return t.indices=o,t.positions=p,t.normals=q,t.uvs=r,t},b.CreateGroundFromHeightMap=function(c){var d,e,f=[],g=[],h=[],i=[];for(d=0;d<=c.subdivisions;d++)for(e=0;e<=c.subdivisions;e++){var j=new a.Vector3(e*c.width/c.subdivisions-c.width/2,0,(c.subdivisions-d)*c.height/c.subdivisions-c.height/2),k=(j.x+c.width/2)/c.width*(c.bufferWidth-1)|0,l=(1-(j.z+c.height/2)/c.height)*(c.bufferHeight-1)|0,m=4*(k+l*c.bufferWidth),n=c.buffer[m]/255,o=c.buffer[m+1]/255,p=c.buffer[m+2]/255,q=.3*n+.59*o+.11*p;j.y=c.minHeight+(c.maxHeight-c.minHeight)*q,g.push(j.x,j.y,j.z),h.push(0,0,0),i.push(e/c.subdivisions,1-d/c.subdivisions)}for(d=0;d<c.subdivisions;d++)for(e=0;e<c.subdivisions;e++)f.push(e+1+(d+1)*(c.subdivisions+1)),f.push(e+1+d*(c.subdivisions+1)),f.push(e+d*(c.subdivisions+1)),f.push(e+(d+1)*(c.subdivisions+1)),f.push(e+1+(d+1)*(c.subdivisions+1)),f.push(e+d*(c.subdivisions+1));b.ComputeNormals(g,f,h);var r=new b;return r.indices=f,r.positions=g,r.normals=h,r.uvs=i,r},b.CreatePlane=function(c){var d=[],e=[],f=[],g=[],h=c.width||c.size||1,i=c.height||c.size||1,j=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,k=h/2,l=i/2;e.push(-k,-l,0),f.push(0,0,-1),g.push(0,0),e.push(k,-l,0),f.push(0,0,-1),g.push(1,0),e.push(k,l,0),f.push(0,0,-1),g.push(1,1),e.push(-k,l,0),f.push(0,0,-1),g.push(0,1),d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),b._ComputeSides(j,e,d,f,g);var m=new b;return m.indices=d,m.positions=e,m.normals=f,m.uvs=g,m},b.CreateDisc=function(c){var d=[],e=[],f=[],g=[],h=c.radius||.5,i=c.tessellation||64,j=c.arc<=0||c.arc>1?1:c.arc||1,k=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE;d.push(0,0,0),g.push(.5,.5);for(var l=2*Math.PI*j,m=l/i,n=0;l>n;n+=m){var o=Math.cos(n),p=Math.sin(n),q=(o+1)/2,r=(1-p)/2;d.push(h*o,h*p,0),g.push(q,r)}1===j&&(d.push(d[3],d[4],d[5]),g.push(g[2],g[3]));for(var s=d.length/3,t=1;s-1>t;t++)e.push(t+1,0,t);b.ComputeNormals(d,e,f),b._ComputeSides(k,d,e,f,g);var u=new b;return u.indices=e,u.positions=d,u.normals=f,u.uvs=g,u},b.CreateIcoSphere=function(c){var d,e=c.sideOrientation||a.Mesh.DEFAULTSIDE,f=c.radius||1,g=void 0===c.flat?!0:c.flat,h=c.subdivisions||4,i=c.radiusX||f,j=c.radiusY||f,k=c.radiusZ||f,l=(1+Math.sqrt(5))/2,m=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],n=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],o=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],p=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],q=138/1024,r=239/1024,s=60/1024,t=26/1024,u=-40/1024,v=20/1024,w=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],x=[],y=[],z=[],A=[],B=0,C=new Array(3),D=new Array(3);for(d=0;3>d;d++)C[d]=a.Vector3.Zero(),D[d]=a.Vector2.Zero();for(var E=0;20>E;E++){for(d=0;3>d;d++){var F=n[3*E+d];C[d].copyFromFloats(m[3*o[F]],m[3*o[F]+1],m[3*o[F]+2]),C[d].normalize().scaleInPlace(f),D[d].copyFromFloats(p[2*F]*q+s+w[E]*u,p[2*F+1]*r+t+w[E]*v)}for(var G=function(b,c,d,e){var f=a.Vector3.Lerp(C[0],C[2],c/h),l=a.Vector3.Lerp(C[1],C[2],c/h),m=h===c?C[2]:a.Vector3.Lerp(f,l,b/(h-c));m.normalize();var n;if(g){var o=a.Vector3.Lerp(C[0],C[2],e/h),p=a.Vector3.Lerp(C[1],C[2],e/h);n=a.Vector3.Lerp(o,p,d/(h-e))}else n=new a.Vector3(m.x,m.y,m.z);n.x/=i,n.y/=j,n.z/=k,n.normalize();var q=a.Vector2.Lerp(D[0],D[2],c/h),r=a.Vector2.Lerp(D[1],D[2],c/h),s=h===c?D[2]:a.Vector2.Lerp(q,r,b/(h-c));y.push(m.x*i,m.y*j,m.z*k),z.push(n.x,n.y,n.z),A.push(s.x,s.y),x.push(B),B++},H=0;h>H;H++)for(var I=0;h>I+H;I++)G(I,H,I+1/3,H+1/3),G(I+1,H,I+1/3,H+1/3),G(I,H+1,I+1/3,H+1/3),h>I+H+1&&(G(I+1,H,I+2/3,H+2/3),G(I+1,H+1,I+2/3,H+2/3),G(I,H+1,I+2/3,H+2/3))}b._ComputeSides(e,y,x,z,A);var J=new b;return J.indices=x,J.positions=y,J.normals=z,J.uvs=A,J},b.CreatePolyhedron=function(c){var d=[];d[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},d[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},d[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},d[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},d[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},d[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},d[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},d[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},d[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},d[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},d[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},d[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},d[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},d[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},d[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var e,f,g,h,i,j,k=c.type<0||c.type>=d.length?0:c.type||0,l=c.size,m=c.sizeX||l||1,n=c.sizeY||l||1,o=c.sizeZ||l||1,p=c.custom||d[k],q=p.face.length,r=c.faceUV||new Array(q),s=c.faceColors,t=void 0===c.flat?!0:c.flat,u=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,v=[],w=[],x=[],y=[],z=[],A=0,B=0,C=[],D=0,E=0;if(t)for(E=0;q>E;E++)s&&void 0===s[E]&&(s[E]=new a.Color4(1,1,1,1)),r&&void 0===r[E]&&(r[E]=new a.Vector4(0,0,1,1));if(t)for(E=0;q>E;E++){var F=p.face[E].length;for(g=2*Math.PI/F,h=.5*Math.tan(g/2),i=.5,D=0;F>D;D++)v.push(p.vertex[p.face[E][D]][0]*m,p.vertex[p.face[E][D]][1]*n,p.vertex[p.face[E][D]][2]*o),C.push(A),A++,e=r[E].x+(r[E].z-r[E].x)*(.5+h),f=r[E].y+(r[E].w-r[E].y)*(i-.5),y.push(e,f),j=h*Math.cos(g)-i*Math.sin(g),i=h*Math.sin(g)+i*Math.cos(g),h=j,s&&z.push(s[E].r,s[E].g,s[E].b,s[E].a);for(D=0;F-2>D;D++)w.push(C[0+B],C[D+2+B],C[D+1+B]);B+=F}else{for(D=0;D<p.vertex.length;D++)v.push(p.vertex[D][0]*m,p.vertex[D][1]*n,p.vertex[D][2]*o),y.push(0,0);for(E=0;q>E;E++)for(D=0;D<p.face[E].length-2;D++)w.push(p.face[E][0],p.face[E][D+2],p.face[E][D+1])}b.ComputeNormals(v,w,x),b._ComputeSides(u,v,w,x,y);var G=new b;return G.positions=v,G.indices=w,G.normals=x,G.uvs=y,s&&t&&(G.colors=z),G},b.CreateTorusKnot=function(c){var d,e,f=[],g=[],h=[],i=[],j=c.radius||2,k=c.tube||.5,l=c.radialSegments||32,m=c.tubularSegments||32,n=c.p||2,o=c.q||3,p=0===c.sideOrientation?0:c.sideOrientation||a.Mesh.DEFAULTSIDE,q=function(b){var c=Math.cos(b),d=Math.sin(b),e=o/n*b,f=Math.cos(e),g=j*(2+f)*.5*c,h=j*(2+f)*d*.5,i=j*Math.sin(e)*.5;return new a.Vector3(g,h,i)};for(d=0;l>=d;d++){var r=d%l,s=r/l*2*n*Math.PI,t=q(s),u=q(s+.01),v=u.subtract(t),w=u.add(t),x=a.Vector3.Cross(v,w);for(w=a.Vector3.Cross(x,v),x.normalize(),w.normalize(),e=0;m>e;e++){var y=e%m,z=y/m*2*Math.PI,A=-k*Math.cos(z),B=k*Math.sin(z);g.push(t.x+A*w.x+B*x.x),g.push(t.y+A*w.y+B*x.y),g.push(t.z+A*w.z+B*x.z),i.push(d/l),i.push(e/m)}}for(d=0;l>d;d++)for(e=0;m>e;e++){var C=(e+1)%m,D=d*m+e,E=(d+1)*m+e,F=(d+1)*m+C,G=d*m+C;f.push(G),f.push(E),f.push(D),f.push(G),f.push(F),f.push(E)}b.ComputeNormals(g,f,h),b._ComputeSides(p,g,f,h,i);var H=new b;return H.indices=f,H.positions=g,H.normals=h,H.uvs=i,H},b.ComputeNormals=function(a,b,c){var d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;for(d=0;d<a.length;d++)c[d]=0;var r=b.length/3;for(d=0;r>d;d++)o=b[3*d],p=b[3*d+1],q=b[3*d+2],e=a[3*o]-a[3*p],f=a[3*o+1]-a[3*p+1],g=a[3*o+2]-a[3*p+2],h=a[3*q]-a[3*p],i=a[3*q+1]-a[3*p+1],j=a[3*q+2]-a[3*p+2],k=f*j-g*i,l=g*h-e*j,m=e*i-f*h,n=Math.sqrt(k*k+l*l+m*m),n=0===n?1:n,k/=n,l/=n,m/=n,c[3*o]+=k,c[3*o+1]+=l,c[3*o+2]+=m,c[3*p]+=k,c[3*p+1]+=l,c[3*p+2]+=m,c[3*q]+=k,c[3*q+1]+=l,c[3*q+2]+=m;for(d=0;d<c.length/3;d++)k=c[3*d],l=c[3*d+1],m=c[3*d+2],n=Math.sqrt(k*k+l*l+m*m),n=0===n?1:n,k/=n,l/=n,m/=n,c[3*d]=k,c[3*d+1]=l,c[3*d+2]=m},b._ComputeSides=function(b,c,d,e,f){var g,h,i=d.length,j=e.length;switch(b=b||a.Mesh.DEFAULTSIDE){case a.Mesh.FRONTSIDE:break;case a.Mesh.BACKSIDE:var k;for(g=0;i>g;g+=3)k=d[g],d[g]=d[g+2],d[g+2]=k;for(h=0;j>h;h++)e[h]=-e[h];break;case a.Mesh.DOUBLESIDE:for(var l=c.length,m=l/3,n=0;l>n;n++)c[l+n]=c[n];for(g=0;i>g;g+=3)d[g+i]=d[g+2]+m,d[g+1+i]=d[g+1]+m,d[g+2+i]=d[g]+m;for(h=0;j>h;h++)e[j+h]=-e[h];for(var o=f.length,p=0;o>p;p++)f[p+o]=f[p]}},b.ImportVertexData=function(c,d){var e=new b,f=c.positions;f&&e.set(f,a.VertexBuffer.PositionKind);var g=c.normals;g&&e.set(g,a.VertexBuffer.NormalKind);var h=c.uvs;h&&e.set(h,a.VertexBuffer.UVKind);var i=c.uv2s;i&&e.set(i,a.VertexBuffer.UV2Kind);var j=c.uv3s;j&&e.set(j,a.VertexBuffer.UV3Kind);var k=c.uv4s;k&&e.set(k,a.VertexBuffer.UV4Kind);var l=c.uv5s;l&&e.set(l,a.VertexBuffer.UV5Kind);var m=c.uv6s;m&&e.set(m,a.VertexBuffer.UV6Kind);var n=c.colors;n&&e.set(a.Color4.CheckColors4(n,f.length/3),a.VertexBuffer.ColorKind);var o=c.matricesIndices;o&&e.set(o,a.VertexBuffer.MatricesIndicesKind);var p=c.matricesWeights;p&&e.set(p,a.VertexBuffer.MatricesWeightsKind);var q=c.indices;q&&(e.indices=q),d.setAllVerticesData(e,c.updatable)},b}();a.VertexData=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return b.EnableFor=function(a){a._tags=a._tags||{},a.hasTags=function(){return b.HasTags(a)},a.addTags=function(c){return b.AddTagsTo(a,c)},a.removeTags=function(c){return b.RemoveTagsFrom(a,c)},a.matchesTagsQuery=function(c){return b.MatchesQuery(a,c)}},b.DisableFor=function(a){delete a._tags,delete a.hasTags,delete a.addTags,delete a.removeTags,delete a.matchesTagsQuery},b.HasTags=function(b){return b._tags?!a.Tools.IsEmpty(b._tags):!1},b.GetTags=function(a,b){if(void 0===b&&(b=!0),!a._tags)return null;if(b){var c=[];for(var d in a._tags)a._tags.hasOwnProperty(d)&&a._tags[d]===!0&&c.push(d);return c.join(" ")}return a._tags},b.AddTagsTo=function(a,c){if(c&&"string"==typeof c){var d=c.split(" ");for(var e in d)b._AddTagTo(a,d[e])}},b._AddTagTo=function(a,c){c=c.trim(),""!==c&&"true"!==c&&"false"!==c&&(c.match(/[\s]/)||c.match(/^([!]|([|]|[&]){2})/)||(b.EnableFor(a),a._tags[c]=!0))},b.RemoveTagsFrom=function(a,c){if(b.HasTags(a)){var d=c.split(" ");for(var e in d)b._RemoveTagFrom(a,d[e])}},b._RemoveTagFrom=function(a,b){delete a._tags[b]},b.MatchesQuery=function(c,d){return void 0===d?!0:""===d?b.HasTags(c):a.Internals.AndOrNotEvaluator.Eval(d,function(a){
return b.HasTags(c)&&c._tags[a]})},b}();a.Tags=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(a){var b=function(){function a(){}return a.Eval=function(b,c){return b=b.match(/\([^\(\)]*\)/g)?b.replace(/\([^\(\)]*\)/g,function(b){return b=b.slice(1,b.length-1),a._HandleParenthesisContent(b,c)}):a._HandleParenthesisContent(b,c),"true"===b?!0:"false"===b?!1:a.Eval(b,c)},a._HandleParenthesisContent=function(b,c){c=c||function(a){return"true"===a};var d,e=b.split("||");for(var f in e){var g=a._SimplifyNegation(e[f].trim()),h=g.split("&&");if(h.length>1)for(var i=0;i<h.length;++i){var j=a._SimplifyNegation(h[i].trim());if(d="true"!==j&&"false"!==j?"!"===j[0]?!c(j.substring(1)):c(j):"true"===j,!d){g="false";break}}if(d||"true"===g){d=!0;break}d="true"!==g&&"false"!==g?"!"===g[0]?!c(g.substring(1)):c(g):"true"===g}return d?"true":"false"},a._SimplifyNegation=function(a){return a=a.replace(/^[\s!]+/,function(a){return a=a.replace(/[\s]/g,function(){return""}),a.length%2?"!":""}),a=a.trim(),"!true"===a?a="false":"!false"===a&&(a="true"),a},a}();a.AndOrNotEvaluator=b}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f,g){this._enabled=!0,this._refCount=0,this._name=c,this._renderTexture=new a.RenderTargetTexture(c,d,b),this.setRenderList(e),this._renderTexture.onBeforeRenderObservable.add(f),this._renderTexture.onAfterRenderObservable.add(g),this._scene=b,this._renderList=e}return b.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},b.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},b.prototype._update=function(){this.setRenderList(this._renderList)},b.prototype.setRenderList=function(a){this._renderTexture.renderList=a},b.prototype.getRenderTexture=function(){return this._renderTexture},b}();a.PostProcessRenderPass=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d){this._engine=a,this._name=b,this._singleInstance=d||!0,this._getPostProcess=c,this._cameras=[],this._indicesForCamera=[],this._postProcesses={},this._renderPasses={},this._renderEffectAsPasses={}}return Object.defineProperty(b.prototype,"isSupported",{get:function(){for(var a in this._postProcesses)if(!this._postProcesses[a].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),b.prototype._update=function(){for(var a in this._renderPasses)this._renderPasses[a]._update()},b.prototype.addPass=function(a){this._renderPasses[a._name]=a,this._linkParameters()},b.prototype.removePass=function(a){delete this._renderPasses[a._name],this._linkParameters()},b.prototype.addRenderEffectAsPass=function(a){this._renderEffectAsPasses[a._name]=a,this._linkParameters()},b.prototype.getPass=function(a){for(var b in this._renderPasses)if(b===a)return this._renderPasses[a]},b.prototype.emptyPasses=function(){this._renderPasses={},this._linkParameters()},b.prototype._attachCameras=function(b){for(var c,d=a.Tools.MakeArray(b||this._cameras),e=0;e<d.length;e++){var f=d[e],g=f.name;c=this._singleInstance?0:g,this._postProcesses[c]=this._postProcesses[c]||this._getPostProcess();var h=f.attachPostProcess(this._postProcesses[c]);this._indicesForCamera[g]||(this._indicesForCamera[g]=[]),this._indicesForCamera[g].push(h),-1===this._cameras.indexOf(f)&&(this._cameras[g]=f);for(var i in this._renderPasses)this._renderPasses[i]._incRefCount()}this._linkParameters()},b.prototype._detachCameras=function(b){for(var c=a.Tools.MakeArray(b||this._cameras),d=0;d<c.length;d++){var e=c[d],f=e.name;e.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);var g=this._cameras.indexOf(f);this._indicesForCamera.splice(g,1),this._cameras.splice(g,1);for(var h in this._renderPasses)this._renderPasses[h]._decRefCount()}},b.prototype._enable=function(b){for(var c=a.Tools.MakeArray(b||this._cameras),d=0;d<c.length;d++){for(var e=c[d],f=e.name,g=0;g<this._indicesForCamera[f].length;g++)void 0===e._postProcesses[this._indicesForCamera[f][g]]&&b[d].attachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f][g]);for(var h in this._renderPasses)this._renderPasses[h]._incRefCount()}},b.prototype._disable=function(b){for(var c=a.Tools.MakeArray(b||this._cameras),d=0;d<c.length;d++){var e=c[d],f=e.Name;e.detachPostProcess(this._postProcesses[this._singleInstance?0:f],this._indicesForCamera[f]);for(var g in this._renderPasses)this._renderPasses[g]._decRefCount()}},b.prototype.getPostProcess=function(a){return this._singleInstance?this._postProcesses[0]:this._postProcesses[a.name]},b.prototype._linkParameters=function(){var a=this;for(var b in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[b]),this._postProcesses[b].onBeforeRenderObservable.add(function(b){a._linkTextures(b)})},b.prototype._linkTextures=function(a){for(var b in this._renderPasses)a.setTexture(b,this._renderPasses[b].getRenderTexture());for(var c in this._renderEffectAsPasses)a.setTextureFromPostProcess(c+"Sampler",this._renderEffectAsPasses[c].getPostProcess())},b}();a.PostProcessRenderEffect=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b){this._engine=a,this._name=b,this._renderEffects={},this._renderEffectsForIsolatedPass={},this._cameras=[]}return Object.defineProperty(b.prototype,"isSupported",{get:function(){for(var a in this._renderEffects)if(!this._renderEffects[a].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),b.prototype.addEffect=function(a){this._renderEffects[a._name]=a},b.prototype._enableEffect=function(b,c){var d=this._renderEffects[b];d&&d._enable(a.Tools.MakeArray(c||this._cameras))},b.prototype._disableEffect=function(b,c){var d=this._renderEffects[b];d&&d._disable(a.Tools.MakeArray(c||this._cameras))},b.prototype._attachCameras=function(b,c){var d,e=a.Tools.MakeArray(b||this._cameras),f=[];for(d=0;d<e.length;d++){var g=e[d],h=g.name;-1===this._cameras.indexOf(g)?this._cameras[h]=g:c&&f.push(d)}for(d=0;d<f.length;d++)b.splice(f[d],1);for(var i in this._renderEffects)this._renderEffects[i]._attachCameras(e)},b.prototype._detachCameras=function(b){var c=a.Tools.MakeArray(b||this._cameras);for(var d in this._renderEffects)this._renderEffects[d]._detachCameras(c);for(var e=0;e<c.length;e++)this._cameras.splice(this._cameras.indexOf(c[e]),1)},b.prototype._enableDisplayOnlyPass=function(c,d){var e,f=this,g=a.Tools.MakeArray(d||this._cameras),h=null;for(e in this._renderEffects)if(h=this._renderEffects[e].getPass(c),null!=h)break;if(null!==h){for(e in this._renderEffects)this._renderEffects[e]._disable(g);h._name=b.PASS_SAMPLER_NAME;for(var i=0;i<g.length;i++){var j=g[i],k=j.name;this._renderEffectsForIsolatedPass[k]=this._renderEffectsForIsolatedPass[k]||new a.PostProcessRenderEffect(this._engine,b.PASS_EFFECT_NAME,function(){return new a.DisplayPassPostProcess(b.PASS_EFFECT_NAME,1,null,null,f._engine,!0)}),this._renderEffectsForIsolatedPass[k].emptyPasses(),this._renderEffectsForIsolatedPass[k].addPass(h),this._renderEffectsForIsolatedPass[k]._attachCameras(j)}}},b.prototype._disableDisplayOnlyPass=function(c){for(var d=this,e=a.Tools.MakeArray(c||this._cameras),f=0;f<e.length;f++){var g=e[f],h=g.name;this._renderEffectsForIsolatedPass[h]=this._renderEffectsForIsolatedPass[h]||new a.PostProcessRenderEffect(this._engine,b.PASS_EFFECT_NAME,function(){return new a.DisplayPassPostProcess(b.PASS_EFFECT_NAME,1,null,null,d._engine,!0)}),this._renderEffectsForIsolatedPass[h]._disable(g)}for(var i in this._renderEffects)this._renderEffects[i]._enable(e)},b.prototype._update=function(){for(var a in this._renderEffects)this._renderEffects[a]._update();for(var b=0;b<this._cameras.length;b++){var c=this._cameras[b].name;this._renderEffectsForIsolatedPass[c]&&this._renderEffectsForIsolatedPass[c]._update()}},b.prototype.dispose=function(){},b.PASS_EFFECT_NAME="passEffect",b.PASS_SAMPLER_NAME="passSampler",b}();a.PostProcessRenderPipeline=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this._renderPipelines={}}return a.prototype.addPipeline=function(a){this._renderPipelines[a._name]=a},a.prototype.attachCamerasToRenderPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._attachCameras(b,c)},a.prototype.detachCamerasFromRenderPipeline=function(a,b){var c=this._renderPipelines[a];c&&c._detachCameras(b)},a.prototype.enableEffectInPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._enableEffect(b,c)},a.prototype.disableEffectInPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._disableEffect(b,c)},a.prototype.enableDisplayOnlyPassInPipeline=function(a,b,c){var d=this._renderPipelines[a];d&&d._enableDisplayOnlyPass(b,c)},a.prototype.disableDisplayOnlyPassInPipeline=function(a,b){var c=this._renderPipelines[a];c&&c._disableDisplayOnlyPass(b)},a.prototype.update=function(){for(var a in this._renderPipelines){var b=this._renderPipelines[a];b.isSupported?b._update():(b.dispose(),delete this._renderPipelines[a])}},a}();a.PostProcessRenderPipelineManager=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b){this.frontColor=new a.Color3(1,1,1),this.backColor=new a.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new a.SmartArray(32),this._vertexBuffers={},this._scene=b}return b.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new a.ShaderMaterial("colorShader",this._scene,"color",{attributes:[a.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"]});var b=this._scene.getEngine(),c=a.VertexData.CreateBox(1);this._vertexBuffers[a.VertexBuffer.PositionKind]=new a.VertexBuffer(b,c.positions,a.VertexBuffer.PositionKind,!1),this._indexBuffer=b.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},b.prototype.reset=function(){this.renderList.reset()},b.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var b=this._scene.getEngine();b.setDepthWrite(!1),this._colorShader._preBind();for(var c=0;c<this.renderList.length;c++){var d=this.renderList.data[c],e=d.minimum,f=d.maximum,g=f.subtract(e),h=e.add(g.scale(.5)),i=a.Matrix.Scaling(g.x,g.y,g.z).multiply(a.Matrix.Translation(h.x,h.y,h.z)).multiply(d.getWorldMatrix());b.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(b.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(i),b.draw(!1,0,24)),b.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(i),b.draw(!1,0,24)}this._colorShader.unbind(),b.setDepthFunctionToLessOrEqual(),b.setDepthWrite(!0)}},b.prototype.dispose=function(){if(this._colorShader){this._colorShader.dispose();var b=this._vertexBuffers[a.VertexBuffer.PositionKind];b&&(b.dispose(),this._vertexBuffers[a.VertexBuffer.PositionKind]=null),this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},b}();a.BoundingBoxRenderer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a){this._actionManager=a}return a.prototype.isValid=function(){return!0},a.prototype._getProperty=function(a){return this._actionManager._getProperty(a)},a.prototype._getEffectiveTarget=function(a,b){return this._actionManager._getEffectiveTarget(a,b)},a.prototype.serialize=function(){},a.prototype._serialize=function(a){return{type:2,children:[],name:a.name,properties:a.properties}},a}();a.Condition=b;var c=function(b){function c(a,d,e,f,g){void 0===g&&(g=c.IsEqual),b.call(this,a),this.propertyPath=e,this.value=f,this.operator=g,this._target=d,this._effectiveTarget=this._getEffectiveTarget(d,this.propertyPath),this._property=this._getProperty(this.propertyPath)}return __extends(c,b),Object.defineProperty(c,"IsEqual",{get:function(){return c._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsDifferent",{get:function(){return c._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsGreater",{get:function(){return c._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(c,"IsLesser",{get:function(){return c._IsLesser},enumerable:!0,configurable:!0}),c.prototype.isValid=function(){switch(this.operator){case c.IsGreater:return this._effectiveTarget[this._property]>this.value;case c.IsLesser:return this._effectiveTarget[this._property]<this.value;case c.IsEqual:case c.IsDifferent:var a;return a=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===c.IsEqual?a:!a}return!1},c.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[a.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:a.Action._SerializeValueAsString(this.value)},{name:"operator",value:c.GetOperatorName(this.operator)}]})},c.GetOperatorName=function(a){switch(a){case c._IsEqual:return"IsEqual";case c._IsDifferent:return"IsDifferent";case c._IsGreater:return"IsGreater";case c._IsLesser:return"IsLesser";default:return""}},c._IsEqual=0,c._IsDifferent=1,c._IsGreater=2,c._IsLesser=3,c}(b);a.ValueCondition=c;var d=function(a){function b(b,c){a.call(this,b),this.predicate=c}return __extends(b,a),b.prototype.isValid=function(){return this.predicate()},b}(b);a.PredicateCondition=d;var e=function(b){function c(a,c,d){b.call(this,a),this.value=d,this._target=c}return __extends(c,b),c.prototype.isValid=function(){return this._target.state===this.value},c.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[a.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},c}(b);a.StateCondition=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b){this.triggerOptions=a,a.parameter?(this.trigger=a.trigger,this._triggerParameter=a.parameter):this.trigger=a,this._nextActiveAction=this,this._condition=b}return b.prototype._prepare=function(){},b.prototype.getTriggerParameter=function(){return this._triggerParameter},b.prototype._executeCurrent=function(a){if(this._nextActiveAction._condition){var b=this._nextActiveAction._condition,c=this._actionManager.getScene().getRenderId();if(b._evaluationId===c){if(!b._currentResult)return}else{if(b._evaluationId=c,!b.isValid())return void(b._currentResult=!1);b._currentResult=!0}}this._nextActiveAction.execute(a),this.skipToNextActiveAction()},b.prototype.execute=function(a){},b.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},b.prototype.then=function(a){return this._child=a,a._actionManager=this._actionManager,a._prepare(),a},b.prototype._getProperty=function(a){return this._actionManager._getProperty(a)},b.prototype._getEffectiveTarget=function(a,b){return this._actionManager._getEffectiveTarget(a,b)},b.prototype.serialize=function(a){},b.prototype._serialize=function(a,b){var c={type:1,children:[],name:a.name,properties:a.properties||[]};if(this._child&&this._child.serialize(c),this._condition){var d=this._condition.serialize();return d.children.push(c),b&&b.children.push(d),d}return b&&b.children.push(c),c},b._SerializeValueAsString=function(b){return"number"==typeof b?b.toString():"boolean"==typeof b?b?"true":"false":b instanceof a.Vector2?b.x+", "+b.y:b instanceof a.Vector3?b.x+", "+b.y+", "+b.z:b instanceof a.Color3?b.r+", "+b.g+", "+b.b:b instanceof a.Color4?b.r+", "+b.g+", "+b.b+", "+b.a:b},b._GetTargetProperty=function(b){return{name:"target",targetType:b instanceof a.Mesh?"MeshProperties":b instanceof a.Light?"LightProperties":b instanceof a.Camera?"CameraProperties":"SceneProperties",value:b instanceof a.Scene?"Scene":b.name}},b}();a.Action=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c,d,e,f){this.source=a,this.pointerX=b,this.pointerY=c,this.meshUnderPointer=d,this.sourceEvent=e,this.additionalData=f}return a.CreateNew=function(b,c,d){var e=b.getScene();return new a(b,e.pointerX,e.pointerY,e.meshUnderPointer,c,d)},a.CreateNewFromSprite=function(b,c,d,e){return new a(b,c.pointerX,c.pointerY,c.meshUnderPointer,d,e)},a.CreateNewFromScene=function(b,c){return new a(null,b.pointerX,b.pointerY,b.meshUnderPointer,c)},a.CreateNewFromPrimitive=function(b,c,d,e){return new a(b,c.x,c.y,null,d,e)},a}();a.ActionEvent=b;var c=function(){function b(a){this.actions=new Array,this._scene=a,a._actionManagers.push(this)}return Object.defineProperty(b,"NothingTrigger",{get:function(){return b._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPickTrigger",{get:function(){return b._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnLeftPickTrigger",{get:function(){return b._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnRightPickTrigger",{get:function(){return b._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnCenterPickTrigger",{get:function(){return b._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPickDownTrigger",{get:function(){return b._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPickUpTrigger",{get:function(){return b._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPickOutTrigger",{get:function(){return b._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnLongPressTrigger",{get:function(){return b._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPointerOverTrigger",{get:function(){return b._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnPointerOutTrigger",{get:function(){return b._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnEveryFrameTrigger",{get:function(){return b._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnIntersectionEnterTrigger",{get:function(){return b._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnIntersectionExitTrigger",{get:function(){return b._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnKeyDownTrigger",{get:function(){return b._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OnKeyUpTrigger",{get:function(){return b._OnKeyUpTrigger},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){var a=this._scene._actionManagers.indexOf(this);a>-1&&this._scene._actionManagers.splice(a,1)},b.prototype.getScene=function(){return this._scene},b.prototype.hasSpecificTriggers=function(a){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(a.indexOf(c.trigger)>-1)return!0}return!1},b.prototype.hasSpecificTrigger=function(a){for(var b=0;b<this.actions.length;b++){var c=this.actions[b];if(c.trigger===a)return!0}return!1},Object.defineProperty(b.prototype,"hasPointerTriggers",{get:function(){for(var a=0;a<this.actions.length;a++){var c=this.actions[a];if(c.trigger>=b._OnPickTrigger&&c.trigger<=b._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasPickTriggers",{get:function(){for(var a=0;a<this.actions.length;a++){var c=this.actions[a];if(c.trigger>=b._OnPickTrigger&&c.trigger<=b._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),b.prototype.registerAction=function(c){return c.trigger===b.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(a.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(c),c._actionManager=this,c._prepare(),c)},b.prototype.processTrigger=function(a,c){for(var d=0;d<this.actions.length;d++){var e=this.actions[d];if(e.trigger===a){if(a===b.OnKeyUpTrigger||a===b.OnKeyDownTrigger){var f=e.getTriggerParameter();if(f){var g=c.sourceEvent.charCode?c.sourceEvent.charCode:c.sourceEvent.keyCode,h=String.fromCharCode(g).toLowerCase();if(h!==f.toLowerCase())continue}}e._executeCurrent(c)}}},b.prototype._getEffectiveTarget=function(a,b){for(var c=b.split("."),d=0;d<c.length-1;d++)a=a[c[d]];return a},b.prototype._getProperty=function(a){var b=a.split(".");return b[b.length-1]},b.prototype.serialize=function(c){for(var d={children:[],name:c,type:3,properties:[]},e=0;e<this.actions.length;e++){var f={type:0,children:[],name:b.GetTriggerName(this.actions[e].trigger),properties:[]},g=this.actions[e].triggerOptions;g&&"number"!=typeof g&&(g.parameter instanceof a.Node?f.properties.push(a.Action._GetTargetProperty(g.parameter)):f.properties.push({name:"parameter",targetType:null,value:g.parameter})),this.actions[e].serialize(f),d.children.push(f)}return d},b.Parse=function(c,d,e){var f=new a.ActionManager(e);null===d?e.actionManager=f:d.actionManager=f;for(var g=function(b,c){var d=Object.create(a[b].prototype);return d.constructor.apply(d,c),d},h=function(b,c,d,e){if(null===e){var f=parseFloat(c);return"true"===c||"false"===c?"true"===c:isNaN(f)?c:f}for(var g=e.split("."),h=c.split(","),i=0;i<g.length;i++)d=d[g[i]];if("boolean"==typeof d)return"true"===h[0];if("string"==typeof d)return h[0];for(var j=new Array,i=0;i<h.length;i++)j.push(parseFloat(h[i]));return d instanceof a.Vector3?a.Vector3.FromArray(j):d instanceof a.Vector4?a.Vector4.FromArray(j):d instanceof a.Color3?a.Color3.FromArray(j):d instanceof a.Color4?a.Color4.FromArray(j):parseFloat(h[0])},i=function(c,d,j,k,l){if(void 0===l&&(l=null),!c.detached){var m=new Array,n=null,o=null,p=c.combine&&c.combine.length>0;if(2===c.type?m.push(f):m.push(d),p){for(var q=new Array,r=0;r<c.combine.length;r++)i(c.combine[r],b.NothingTrigger,j,k,q);m.push(q)}else for(var s=0;s<c.properties.length;s++){var t=c.properties[s].value,u=c.properties[s].name,v=c.properties[s].targetType;"target"===u?t=n=null!==v&&"SceneProperties"===v?e:e.getNodeByName(t):"parent"===u?t=e.getNodeByName(t):"sound"===u?t=e.getSoundByName(t):"propertyPath"!==u?t=2===c.type&&"operator"===u?a.ValueCondition[t]:h(u,t,n,"value"===u?o:null):o=t,m.push(t)}if(null===l?m.push(j):m.push(null),"InterpolateValueAction"===c.name){var w=m[m.length-2];m[m.length-1]=w,m[m.length-2]=j}var x=g(c.name,m);if(x instanceof a.Condition&&null!==j){var y=new a.DoNothingAction(d,j);k?k.then(y):f.registerAction(y),k=y}null===l?x instanceof a.Condition?(j=x,x=k):(j=null,k?k.then(x):f.registerAction(x)):l.push(x);for(var s=0;s<c.children.length;s++)i(c.children[s],d,j,x,null)}},j=0;j<c.children.length;j++){var k,l=c.children[j];if(l.properties.length>0){var m=l.properties[0].value,n=null===l.properties[0].targetType?m:e.getMeshByName(m);k={trigger:a.ActionManager[l.name],parameter:n}}else k=a.ActionManager[l.name];for(var o=0;o<l.children.length;o++)l.detached||i(l.children[o],k,null,null)}},b.GetTriggerName=function(a){switch(a){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},b._NothingTrigger=0,b._OnPickTrigger=1,b._OnLeftPickTrigger=2,b._OnRightPickTrigger=3,b._OnCenterPickTrigger=4,b._OnPickDownTrigger=5,b._OnPickUpTrigger=6,b._OnLongPressTrigger=7,b._OnPointerOverTrigger=8,b._OnPointerOutTrigger=9,b._OnEveryFrameTrigger=10,b._OnIntersectionEnterTrigger=11,b._OnIntersectionExitTrigger=12,b._OnKeyDownTrigger=13,b._OnKeyUpTrigger=14,b._OnPickOutTrigger=15,b.DragMovementThreshold=10,b.LongPressDelay=500,b}();a.ActionManager=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d,e,f,g,h,i){void 0===f&&(f=1e3),b.call(this,a,g),this.propertyPath=d,this.value=e,this.duration=f,this.stopOtherAnimations=h,this.onInterpolationDone=i,this._target=this._effectiveTarget=c}return __extends(c,b),c.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},c.prototype.execute=function(){var b,c=this._actionManager.getScene(),d=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)b=a.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof a.Color3)b=a.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof a.Vector3)b=a.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof a.Matrix)b=a.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof a.Quaternion))return void a.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");b=a.Animation.ANIMATIONTYPE_QUATERNION}var e=new a.Animation("InterpolateValueAction",this._property,100*(1e3/this.duration),b,a.Animation.ANIMATIONLOOPMODE_CONSTANT);e.setKeys(d),this.stopOtherAnimations&&c.stopAnimation(this._effectiveTarget),c.beginDirectAnimation(this._effectiveTarget,[e],0,100,!1,1,this.onInterpolationDone)},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[a.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:a.Action._SerializeValueAsString(this.value)},{name:"duration",value:a.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:a.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},c)},c}(a.Action);a.InterpolateValueAction=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c,d,e){b.call(this,a,e),this.propertyPath=d,this._target=this._effectiveTarget=c}return __extends(c,b),c.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},c.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[a.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},c)},c}(a.Action);a.SwitchBooleanAction=b;var c=function(b){function c(a,c,d,e){b.call(this,a,e),this.value=d,this._target=c}return __extends(c,b),c.prototype.execute=function(){this._target.state=this.value},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"SetStateAction",properties:[a.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},c)},c}(a.Action);a.SetStateAction=c;var d=function(b){function c(a,c,d,e,f){b.call(this,a,f),this.propertyPath=d,this.value=e,this._target=this._effectiveTarget=c}return __extends(c,b),c.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},c.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"SetValueAction",properties:[a.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:a.Action._SerializeValueAsString(this.value)}]},c)},c}(a.Action);a.SetValueAction=d;var e=function(b){function c(a,c,d,e,f){b.call(this,a,f),this.propertyPath=d,this.value=e,this._target=this._effectiveTarget=c}return __extends(c,b),c.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&a.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},c.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[a.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:a.Action._SerializeValueAsString(this.value)}]},c)},c}(a.Action);a.IncrementValueAction=e;var f=function(b){function c(a,c,d,e,f,g){b.call(this,a,g),this.from=d,this.to=e,this.loop=f,this._target=c}return __extends(c,b),c.prototype._prepare=function(){},c.prototype.execute=function(){var a=this._actionManager.getScene();a.beginAnimation(this._target,this.from,this.to,this.loop)},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[a.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:a.Action._SerializeValueAsString(this.loop)||!1}]},c)},c}(a.Action);a.PlayAnimationAction=f;var g=function(b){function c(a,c,d){b.call(this,a,d),this._target=c}return __extends(c,b),c.prototype._prepare=function(){},c.prototype.execute=function(){var a=this._actionManager.getScene();a.stopAnimation(this._target)},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[a.Action._GetTargetProperty(this._target)]},c)},c}(a.Action);a.StopAnimationAction=g;var h=function(b){function c(c,d){void 0===c&&(c=a.ActionManager.NothingTrigger),b.call(this,c,d)}return __extends(c,b),c.prototype.execute=function(){},c.prototype.serialize=function(a){return b.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},a)},c}(a.Action);a.DoNothingAction=h;var i=function(a){function b(b,c,d){a.call(this,b,d),this.children=c}return __extends(b,a),b.prototype._prepare=function(){for(var a=0;a<this.children.length;a++)this.children[a]._actionManager=this._actionManager,this.children[a]._prepare()},b.prototype.execute=function(a){for(var b=0;b<this.children.length;b++)this.children[b].execute(a)},b.prototype.serialize=function(b){for(var c=a.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},b),d=0;d<this.children.length;d++)c.combine.push(this.children[d].serialize(null));return c},b}(a.Action);a.CombineAction=i;var j=function(a){function b(b,c,d){a.call(this,b,d),this.func=c}return __extends(b,a),b.prototype.execute=function(a){this.func(a)},b}(a.Action);a.ExecuteCodeAction=j;var k=function(b){function c(a,c,d,e){b.call(this,a,e),this._target=c,this._parent=d}return __extends(c,b),c.prototype._prepare=function(){},c.prototype.execute=function(){if(this._target.parent!==this._parent){var b=this._parent.getWorldMatrix().clone();b.invert(),this._target.position=a.Vector3.TransformCoordinates(this._target.position,b),this._target.parent=this._parent}},c.prototype.serialize=function(c){return b.prototype._serialize.call(this,{name:"SetParentAction",properties:[a.Action._GetTargetProperty(this._target),a.Action._GetTargetProperty(this._parent)]},c)},c}(a.Action);a.SetParentAction=k;var l=function(a){function b(b,c,d){a.call(this,b,d),this._sound=c}return __extends(b,a),b.prototype._prepare=function(){},b.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},b.prototype.serialize=function(b){return a.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{
name:"sound",value:this._sound.name}]},b)},b}(a.Action);a.PlaySoundAction=l;var m=function(a){function b(b,c,d){a.call(this,b,d),this._sound=c}return __extends(b,a),b.prototype._prepare=function(){},b.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},b.prototype.serialize=function(b){return a.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},b)},b}(a.Action);a.StopSoundAction=m}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f){this.delayLoadState=a.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this.id=b,this._engine=c.getEngine(),this._meshes=[],this._scene=c,this._vertexBuffers={},this._indices=[],d?this.setAllVerticesData(d,e):(this._totalVertices=0,this._indices=[]),f&&(f instanceof a.LinesMesh&&(this.boundingBias=new a.Vector2(0,f.intersectionThreshold),this.updateExtend()),this.applyToMesh(f),f.computeWorldMatrix(!0))}return Object.defineProperty(b.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(a){this._boundingBias&&this._boundingBias.equals(a)||(this._boundingBias=a.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getEngine=function(){return this._engine},b.prototype.isReady=function(){return this.delayLoadState===a.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===a.Engine.DELAYLOADSTATE_NONE},b.prototype.setAllVerticesData=function(a,b){a.applyToGeometry(this,b),this.notifyUpdate()},b.prototype.setVerticesData=function(b,c,d,e){var f=new a.VertexBuffer(this._engine,c,b,d,0===this._meshes.length,e);this.setVerticesBuffer(f)},b.prototype.setVerticesBuffer=function(b){var c=b.getKind();if(this._vertexBuffers[c]&&this._vertexBuffers[c].dispose(),this._vertexBuffers[c]=b,c===a.VertexBuffer.PositionKind){var d=b.getData(),e=b.getStrideSize();this._totalVertices=d.length/e,this.updateExtend(d,e);for(var f=this._meshes,g=f.length,h=0;g>h;h++){var i=f[h];i._resetPointsArrayCache(),i._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),i._createGlobalSubMesh(),i.computeWorldMatrix(!0)}}this.notifyUpdate(c)},b.prototype.updateVerticesDataDirectly=function(a,b,c){var d=this.getVertexBuffer(a);d&&(d.updateDirectly(b,c),this.notifyUpdate(a))},b.prototype.updateVerticesData=function(b,c,d){var e=this.getVertexBuffer(b);if(e){if(e.update(c),b===a.VertexBuffer.PositionKind){var f=e.getStrideSize();this._totalVertices=c.length/f,this.updateBoundingInfo(d,c)}this.notifyUpdate(b)}},b.prototype.updateBoundingInfo=function(b,c){b&&this.updateExtend(c);for(var d=this._meshes,e=d.length,f=0;e>f;f++){var g=d[f];if(g._resetPointsArrayCache(),b){g._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var h=0;h<g.subMeshes.length;h++){var i=g.subMeshes[h];i.refreshBoundingInfo()}}}},b.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},b.prototype.getVerticesData=function(a,b){var c=this.getVertexBuffer(a);if(!c)return null;var d=c.getData();if(b&&1!==this._meshes.length){for(var e=d.length,f=[],g=0;e>g;g++)f.push(d[g]);return f}return d},b.prototype.getVertexBuffer=function(a){return this.isReady()?this._vertexBuffers[a]:null},b.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},b.prototype.isVerticesDataPresent=function(a){return this._vertexBuffers?void 0!==this._vertexBuffers[a]:this._delayInfo?-1!==this._delayInfo.indexOf(a):!1},b.prototype.getVerticesDataKinds=function(){var a,b=[];if(!this._vertexBuffers&&this._delayInfo)for(a in this._delayInfo)b.push(a);else for(a in this._vertexBuffers)b.push(a);return b},b.prototype.setIndices=function(a,b){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=a,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==b&&(this._totalVertices=b);for(var c=this._meshes,d=c.length,e=0;d>e;e++)c[e]._createGlobalSubMesh();this.notifyUpdate()},b.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},b.prototype.getIndices=function(a){if(!this.isReady())return null;var b=this._indices;if(a&&1!==this._meshes.length){for(var c=b.length,d=[],e=0;c>e;e++)d.push(b[e]);return d}return b},b.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},b.prototype.releaseForMesh=function(a,b){var c=this._meshes,d=c.indexOf(a);if(-1!==d){for(var e in this._vertexBuffers)this._vertexBuffers[e].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),c.splice(d,1),a._geometry=null,0===c.length&&b&&this.dispose()}},b.prototype.applyToMesh=function(a){if(a._geometry!==this){var b=a._geometry;b&&b.releaseForMesh(a);var c=this._meshes;a._geometry=this,this._scene.pushGeometry(this),c.push(a),this.isReady()?this._applyToMesh(a):a._boundingInfo=this._boundingInfo}},b.prototype.updateExtend=function(b,c){void 0===b&&(b=null),b||(b=this._vertexBuffers[a.VertexBuffer.PositionKind].getData()),this._extend=a.Tools.ExtractMinAndMax(b,0,this._totalVertices,this.boundingBias,c)},b.prototype._applyToMesh=function(b){var c=this._meshes.length;for(var d in this._vertexBuffers)1===c&&this._vertexBuffers[d].create(),this._vertexBuffers[d].getBuffer().references=c,d===a.VertexBuffer.PositionKind&&(b._resetPointsArrayCache(),this._extend||this.updateExtend(this._vertexBuffers[d].getData()),b._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),b._createGlobalSubMesh(),b._updateBoundingInfo());1===c&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=c)},b.prototype.notifyUpdate=function(a){this.onGeometryUpdated&&this.onGeometryUpdated(this,a)},b.prototype.load=function(b,c){var d=this;if(this.delayLoadState!==a.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(c&&c());this.delayLoadState=a.Engine.DELAYLOADSTATE_LOADING,b._addPendingData(this),a.Tools.LoadFile(this.delayLoadingFile,function(e){d._delayLoadingFunction(JSON.parse(e),d),d.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,d._delayInfo=[],b._removePendingData(d);for(var f=d._meshes,g=f.length,h=0;g>h;h++)d._applyToMesh(f[h]);c&&c()},function(){},b.database)}},b.prototype.toLeftHanded=function(){var b=this.getIndices(!1);if(null!=b&&b.length>0){for(var c=0;c<b.length;c+=3){var d=b[c+0];b[c+0]=b[c+2],b[c+2]=d}this.setIndices(b)}var e=this.getVerticesData(a.VertexBuffer.PositionKind,!1);if(null!=e&&e.length>0){for(var c=0;c<e.length;c+=3)e[c+2]=-e[c+2];this.setVerticesData(a.VertexBuffer.PositionKind,e,!1)}var f=this.getVerticesData(a.VertexBuffer.NormalKind,!1);if(null!=f&&f.length>0){for(var c=0;c<f.length;c+=3)f[c+2]=-f[c+2];this.setVerticesData(a.VertexBuffer.NormalKind,f,!1)}},b.prototype.isDisposed=function(){return this._isDisposed},b.prototype.dispose=function(){var b,c=this._meshes,d=c.length;for(b=0;d>b;b++)this.releaseForMesh(c[b]);this._meshes=[];for(var e in this._vertexBuffers)this._vertexBuffers[e].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=a.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},b.prototype.copy=function(c){var d=new a.VertexData;d.indices=[];for(var e=this.getIndices(),f=0;f<e.length;f++)d.indices.push(e[f]);var g,h=!1,i=!1;for(g in this._vertexBuffers){var j=this.getVerticesData(g);j instanceof Float32Array?d.set(new Float32Array(j),g):d.set(j.slice(0),g),i||(h=this.getVertexBuffer(g).isUpdatable(),i=!h)}var k=new b(c,this._scene,d,h,null);k.delayLoadState=this.delayLoadState,k.delayLoadingFile=this.delayLoadingFile,k._delayLoadingFunction=this._delayLoadingFunction;for(g in this._delayInfo)k._delayInfo=k._delayInfo||[],k._delayInfo.push(g);return k._boundingInfo=new a.BoundingInfo(this._extend.minimum,this._extend.maximum),k},b.prototype.serialize=function(){var b={};return b.id=this.id,a.Tags.HasTags(this)&&(b.tags=a.Tags.GetTags(this)),b},b.prototype.serializeVerticeData=function(){var b=this.serialize();return this.isVerticesDataPresent(a.VertexBuffer.PositionKind)&&(b.positions=this.getVerticesData(a.VertexBuffer.PositionKind)),this.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(b.normals=this.getVerticesData(a.VertexBuffer.NormalKind)),this.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(b.uvs=this.getVerticesData(a.VertexBuffer.UVKind)),this.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(b.uvs2=this.getVerticesData(a.VertexBuffer.UV2Kind)),this.isVerticesDataPresent(a.VertexBuffer.UV3Kind)&&(b.uvs3=this.getVerticesData(a.VertexBuffer.UV3Kind)),this.isVerticesDataPresent(a.VertexBuffer.UV4Kind)&&(b.uvs4=this.getVerticesData(a.VertexBuffer.UV4Kind)),this.isVerticesDataPresent(a.VertexBuffer.UV5Kind)&&(b.uvs5=this.getVerticesData(a.VertexBuffer.UV5Kind)),this.isVerticesDataPresent(a.VertexBuffer.UV6Kind)&&(b.uvs6=this.getVerticesData(a.VertexBuffer.UV6Kind)),this.isVerticesDataPresent(a.VertexBuffer.ColorKind)&&(b.colors=this.getVerticesData(a.VertexBuffer.ColorKind)),this.isVerticesDataPresent(a.VertexBuffer.MatricesIndicesKind)&&(b.matricesIndices=this.getVerticesData(a.VertexBuffer.MatricesIndicesKind),b.matricesIndices._isExpanded=!0),this.isVerticesDataPresent(a.VertexBuffer.MatricesWeightsKind)&&(b.matricesWeights=this.getVerticesData(a.VertexBuffer.MatricesWeightsKind)),b.indices=this.getIndices(),b},b.ExtractFromMesh=function(a,b){var c=a._geometry;return c?c.copy(b):null},b.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},b.ImportGeometry=function(b,c){var d=c.getScene(),e=b.geometryId;if(e){var f=d.getGeometryByID(e);f&&f.applyToMesh(c)}else if(b instanceof ArrayBuffer){var g=c._binaryInfo;if(g.positionsAttrDesc&&g.positionsAttrDesc.count>0){var h=new Float32Array(b,g.positionsAttrDesc.offset,g.positionsAttrDesc.count);c.setVerticesData(a.VertexBuffer.PositionKind,h,!1)}if(g.normalsAttrDesc&&g.normalsAttrDesc.count>0){var i=new Float32Array(b,g.normalsAttrDesc.offset,g.normalsAttrDesc.count);c.setVerticesData(a.VertexBuffer.NormalKind,i,!1)}if(g.uvsAttrDesc&&g.uvsAttrDesc.count>0){var j=new Float32Array(b,g.uvsAttrDesc.offset,g.uvsAttrDesc.count);c.setVerticesData(a.VertexBuffer.UVKind,j,!1)}if(g.uvs2AttrDesc&&g.uvs2AttrDesc.count>0){var k=new Float32Array(b,g.uvs2AttrDesc.offset,g.uvs2AttrDesc.count);c.setVerticesData(a.VertexBuffer.UV2Kind,k,!1)}if(g.uvs3AttrDesc&&g.uvs3AttrDesc.count>0){var l=new Float32Array(b,g.uvs3AttrDesc.offset,g.uvs3AttrDesc.count);c.setVerticesData(a.VertexBuffer.UV3Kind,l,!1)}if(g.uvs4AttrDesc&&g.uvs4AttrDesc.count>0){var m=new Float32Array(b,g.uvs4AttrDesc.offset,g.uvs4AttrDesc.count);c.setVerticesData(a.VertexBuffer.UV4Kind,m,!1)}if(g.uvs5AttrDesc&&g.uvs5AttrDesc.count>0){var n=new Float32Array(b,g.uvs5AttrDesc.offset,g.uvs5AttrDesc.count);c.setVerticesData(a.VertexBuffer.UV5Kind,n,!1)}if(g.uvs6AttrDesc&&g.uvs6AttrDesc.count>0){var o=new Float32Array(b,g.uvs6AttrDesc.offset,g.uvs6AttrDesc.count);c.setVerticesData(a.VertexBuffer.UV6Kind,o,!1)}if(g.colorsAttrDesc&&g.colorsAttrDesc.count>0){var p=new Float32Array(b,g.colorsAttrDesc.offset,g.colorsAttrDesc.count);c.setVerticesData(a.VertexBuffer.ColorKind,p,!1,g.colorsAttrDesc.stride)}if(g.matricesIndicesAttrDesc&&g.matricesIndicesAttrDesc.count>0){var q=new Int32Array(b,g.matricesIndicesAttrDesc.offset,g.matricesIndicesAttrDesc.count);c.setVerticesData(a.VertexBuffer.MatricesIndicesKind,q,!1)}if(g.matricesWeightsAttrDesc&&g.matricesWeightsAttrDesc.count>0){var r=new Float32Array(b,g.matricesWeightsAttrDesc.offset,g.matricesWeightsAttrDesc.count);c.setVerticesData(a.VertexBuffer.MatricesWeightsKind,r,!1)}if(g.indicesAttrDesc&&g.indicesAttrDesc.count>0){var s=new Int32Array(b,g.indicesAttrDesc.offset,g.indicesAttrDesc.count);c.setIndices(s)}if(g.subMeshesAttrDesc&&g.subMeshesAttrDesc.count>0){var t=new Int32Array(b,g.subMeshesAttrDesc.offset,5*g.subMeshesAttrDesc.count);c.subMeshes=[];for(var u=0;u<g.subMeshesAttrDesc.count;u++){var v=t[5*u+0],w=t[5*u+1],x=t[5*u+2],y=t[5*u+3],z=t[5*u+4];new a.SubMesh(v,w,x,y,z,c)}}}else if(b.positions&&b.normals&&b.indices){if(c.setVerticesData(a.VertexBuffer.PositionKind,b.positions,!1),c.setVerticesData(a.VertexBuffer.NormalKind,b.normals,!1),b.uvs&&c.setVerticesData(a.VertexBuffer.UVKind,b.uvs,!1),b.uvs2&&c.setVerticesData(a.VertexBuffer.UV2Kind,b.uvs2,!1),b.uvs3&&c.setVerticesData(a.VertexBuffer.UV3Kind,b.uvs3,!1),b.uvs4&&c.setVerticesData(a.VertexBuffer.UV4Kind,b.uvs4,!1),b.uvs5&&c.setVerticesData(a.VertexBuffer.UV5Kind,b.uvs5,!1),b.uvs6&&c.setVerticesData(a.VertexBuffer.UV6Kind,b.uvs6,!1),b.colors&&c.setVerticesData(a.VertexBuffer.ColorKind,a.Color4.CheckColors4(b.colors,b.positions.length/3),!1),b.matricesIndices)if(b.matricesIndices._isExpanded)delete b.matricesIndices._isExpanded,c.setVerticesData(a.VertexBuffer.MatricesIndicesKind,b.matricesIndices,!1);else{for(var A=[],u=0;u<b.matricesIndices.length;u++){var B=b.matricesIndices[u];A.push(255&B),A.push((65280&B)>>8),A.push((16711680&B)>>16),A.push(B>>24)}c.setVerticesData(a.VertexBuffer.MatricesIndicesKind,A,!1)}if(b.matricesIndicesExtra)if(b.matricesIndicesExtra._isExpanded)delete b.matricesIndices._isExpanded,c.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,b.matricesIndicesExtra,!1);else{for(var A=[],u=0;u<b.matricesIndicesExtra.length;u++){var B=b.matricesIndicesExtra[u];A.push(255&B),A.push((65280&B)>>8),A.push((16711680&B)>>16),A.push(B>>24)}c.setVerticesData(a.VertexBuffer.MatricesIndicesExtraKind,A,!1)}b.matricesWeights&&c.setVerticesData(a.VertexBuffer.MatricesWeightsKind,b.matricesWeights,!1),b.matricesWeightsExtra&&c.setVerticesData(a.VertexBuffer.MatricesWeightsExtraKind,b.matricesWeightsExtra,!1),c.setIndices(b.indices)}if(b.subMeshes){c.subMeshes=[];for(var C=0;C<b.subMeshes.length;C++){var D=b.subMeshes[C];new a.SubMesh(D.materialIndex,D.verticesStart,D.verticesCount,D.indexStart,D.indexCount,c)}}c._shouldGenerateFlatShading&&(c.convertToFlatShadedMesh(),delete c._shouldGenerateFlatShading),c.computeWorldMatrix(!0),d._selectionOctree&&d._selectionOctree.addMesh(c)},b.Parse=function(c,d,e){if(d.getGeometryByID(c.id))return null;var f=new b(c.id,d);return a.Tags.AddTagsTo(f,c.tags),c.delayLoadingFile?(f.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED,f.delayLoadingFile=e+c.delayLoadingFile,f._boundingInfo=new a.BoundingInfo(a.Vector3.FromArray(c.boundingBoxMinimum),a.Vector3.FromArray(c.boundingBoxMaximum)),f._delayInfo=[],c.hasUVs&&f._delayInfo.push(a.VertexBuffer.UVKind),c.hasUVs2&&f._delayInfo.push(a.VertexBuffer.UV2Kind),c.hasUVs3&&f._delayInfo.push(a.VertexBuffer.UV3Kind),c.hasUVs4&&f._delayInfo.push(a.VertexBuffer.UV4Kind),c.hasUVs5&&f._delayInfo.push(a.VertexBuffer.UV5Kind),c.hasUVs6&&f._delayInfo.push(a.VertexBuffer.UV6Kind),c.hasColors&&f._delayInfo.push(a.VertexBuffer.ColorKind),c.hasMatricesIndices&&f._delayInfo.push(a.VertexBuffer.MatricesIndicesKind),c.hasMatricesWeights&&f._delayInfo.push(a.VertexBuffer.MatricesWeightsKind),f._delayLoadingFunction=a.VertexData.ImportVertexData):a.VertexData.ImportVertexData(c,f),d.pushGeometry(f,!0),f},b}();a.Geometry=b;var b;!function(b){var c;!function(c){var d=function(a){function b(b,c,d,e){a.call(this,b,c,null,!1,e),this._canBeRegenerated=d,this._beingRegenerated=!0,this.regenerate(),this._beingRegenerated=!1}return __extends(b,a),b.prototype.canBeRegenerated=function(){return this._canBeRegenerated},b.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},b.prototype.asNewGeometry=function(b){return a.prototype.copy.call(this,b)},b.prototype.setAllVerticesData=function(b,c){this._beingRegenerated&&a.prototype.setAllVerticesData.call(this,b,!1)},b.prototype.setVerticesData=function(b,c,d){this._beingRegenerated&&a.prototype.setVerticesData.call(this,b,c,!1)},b.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},b.prototype.copy=function(a){throw new Error("Must be overriden in sub-classes.")},b.prototype.serialize=function(){var b=a.prototype.serialize.call(this);return b.canBeRegenerated=this.canBeRegenerated(),b},b}(b);c._Primitive=d;var e=function(b){function c(c,d,e,f,g,h,i,j,k){void 0===k&&(k=a.Mesh.DEFAULTSIDE),b.call(this,c,d,i,j),this.pathArray=e,this.closeArray=f,this.closePath=g,this.offset=h,this.side=k}return __extends(c,b),c.prototype._regenerateVertexData=function(){return a.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},c.prototype.copy=function(a){return new c(a,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},c}(d);c.Ribbon=e;var f=function(c){function d(b,d,e,f,g,h){void 0===h&&(h=a.Mesh.DEFAULTSIDE),c.call(this,b,d,f,g),this.size=e,this.side=h}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.size=this.size,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Box(c.id,d,c.size,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Box=f;var g=function(c){function d(b,d,e,f,g,h,i){void 0===i&&(i=a.Mesh.DEFAULTSIDE),c.call(this,b,d,g,h),this.segments=e,this.diameter=f,this.side=i}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.segments=this.segments,a.diameter=this.diameter,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Sphere(c.id,d,c.segments,c.diameter,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Sphere=g;var h=function(b){function c(c,d,e,f,g,h,i){void 0===i&&(i=a.Mesh.DEFAULTSIDE),b.call(this,c,d,g,h),this.radius=e,this.tessellation=f,this.side=i}return __extends(c,b),c.prototype._regenerateVertexData=function(){return a.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},c.prototype.copy=function(a){return new c(a,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},c}(d);c.Disc=h;var i=function(c){function d(b,d,e,f,g,h,i,j,k,l){void 0===i&&(i=1),void 0===l&&(l=a.Mesh.DEFAULTSIDE),c.call(this,b,d,j,k),this.height=e,this.diameterTop=f,this.diameterBottom=g,this.tessellation=h,this.subdivisions=i,this.side=l}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.height=this.height,a.diameterTop=this.diameterTop,a.diameterBottom=this.diameterBottom,a.tessellation=this.tessellation,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Cylinder(c.id,d,c.height,c.diameterTop,c.diameterBottom,c.tessellation,c.subdivisions,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Cylinder=i;var j=function(c){function d(b,d,e,f,g,h,i,j){void 0===j&&(j=a.Mesh.DEFAULTSIDE),c.call(this,b,d,h,i),this.diameter=e,this.thickness=f,this.tessellation=g,this.side=j}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.diameter=this.diameter,a.thickness=this.thickness,a.tessellation=this.tessellation,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Torus(c.id,d,c.diameter,c.thickness,c.tessellation,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Torus=j;var k=function(c){function d(a,b,d,e,f,g,h){c.call(this,a,b,g,h),this.width=d,this.height=e,this.subdivisions=f}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.width=this.width,a.height=this.height,a.subdivisions=this.subdivisions,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Ground(c.id,d,c.width,c.height,c.subdivisions,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Ground=k;var l=function(b){function c(a,c,d,e,f,g,h,i,j,k){b.call(this,a,c,j,k),this.xmin=d,this.zmin=e,this.xmax=f,this.zmax=g,this.subdivisions=h,this.precision=i}return __extends(c,b),c.prototype._regenerateVertexData=function(){return a.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},c.prototype.copy=function(a){return new c(a,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},c}(d);c.TiledGround=l;var m=function(c){function d(b,d,e,f,g,h){void 0===h&&(h=a.Mesh.DEFAULTSIDE),c.call(this,b,d,f,g),this.size=e,this.side=h}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.size=this.size,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.Plane(c.id,d,c.size,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.Plane=m;var n=function(c){function d(b,d,e,f,g,h,i,j,k,l,m){void 0===m&&(m=a.Mesh.DEFAULTSIDE),c.call(this,b,d,k,l),this.radius=e,this.tube=f,this.radialSegments=g,this.tubularSegments=h,this.p=i,this.q=j,this.side=m}return __extends(d,c),d.prototype._regenerateVertexData=function(){return a.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},d.prototype.copy=function(a){return new d(a,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},d.prototype.serialize=function(){var a=c.prototype.serialize.call(this);return a.radius=this.radius,a.tube=this.tube,a.radialSegments=this.radialSegments,a.tubularSegments=this.tubularSegments,a.p=this.p,a.q=this.q,a},d.Parse=function(c,d){if(d.getGeometryByID(c.id))return null;var e=new b.Primitives.TorusKnot(c.id,d,c.radius,c.tube,c.radialSegments,c.tubularSegments,c.p,c.q,c.canBeRegenerated,null);return a.Tags.AddTagsTo(e,c.tags),d.pushGeometry(e,!0),e},d}(d);c.TorusKnot=n}(c=b.Primitives||(b.Primitives={}))}(b=a.Geometry||(a.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d){b.call(this,c,d),this.generateOctree=!1,this._worldInverse=new a.Matrix}return __extends(c,b),Object.defineProperty(c.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),c.prototype.optimize=function(a,b){void 0===b&&(b=32),this._subdivisions=a,this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(b)},c.prototype.getHeightAtCoordinates=function(a,b){if(a-=this.position.x,b-=this.position.z,a/=this.scaling.x,b/=this.scaling.z,a<this._minX||a>this._maxX||b<this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var c=this._getFacetAt(a,b),d=-(c.x*a+c.z*b+c.w)/c.y;return d*this.scaling.y+this.position.y},c.prototype.getNormalAtCoordinates=function(b,c){var d=new a.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(b,c,d),d},c.prototype.getNormalAtCoordinatesToRef=function(a,b,c){if(a-=this.position.x,b-=this.position.z,a/=this.scaling.x,b/=this.scaling.z,!(a<this._minX||a>this._maxX||b<this._minZ||b>this._maxZ)){this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var d=this._getFacetAt(a,b);c.x=d.x,c.y=d.y,c.z=d.z}},c.prototype.updateCoordinateHeights=function(){this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads()},c.prototype._getFacetAt=function(a,b){var c,d=Math.floor((a+this._maxX)*this._subdivisions/this._width),e=Math.floor(-(b+this._maxZ)*this._subdivisions/this._height+this._subdivisions),f=this._heightQuads[e*this._subdivisions+d];return c=b<f.slope.x*a+f.slope.y?f.facet1:f.facet2},c.prototype._initHeightQuads=function(){this._heightQuads=new Array;for(var b=0;b<this._subdivisions;b++)for(var c=0;c<this._subdivisions;c++){var d={slope:a.Vector2.Zero(),facet1:new a.Vector4(0,0,0,0),facet2:new a.Vector4(0,0,0,0)};this._heightQuads[b*this._subdivisions+c]=d}},c.prototype._computeHeightQuads=function(){for(var b=this.getVerticesData(a.VertexBuffer.PositionKind),c=a.Tmp.Vector3[0],d=a.Tmp.Vector3[1],e=a.Tmp.Vector3[2],f=a.Tmp.Vector3[3],g=a.Tmp.Vector3[4],h=a.Tmp.Vector3[5],i=a.Tmp.Vector3[6],j=a.Tmp.Vector3[7],k=a.Tmp.Vector3[8],l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;s<this._subdivisions;s++)for(var t=0;t<this._subdivisions;t++){l=3*t,m=s*(this._subdivisions+1)*3,n=(s+1)*(this._subdivisions+1)*3,c.x=b[m+l],c.y=b[m+l+1],c.z=b[m+l+2],d.x=b[m+l+3],d.y=b[m+l+4],d.z=b[m+l+5],e.x=b[n+l],e.y=b[n+l+1],e.z=b[n+l+2],f.x=b[n+l+3],f.y=b[n+l+4],f.z=b[n+l+5],o=(f.z-c.z)/(f.x-c.x),p=c.z-o*c.x,d.subtractToRef(c,g),e.subtractToRef(c,h),f.subtractToRef(c,i),a.Vector3.CrossToRef(i,h,j),a.Vector3.CrossToRef(g,i,k),j.normalize(),k.normalize(),q=-(j.x*c.x+j.y*c.y+j.z*c.z),r=-(k.x*d.x+k.y*d.y+k.z*d.z);var u=this._heightQuads[s*this._subdivisions+t];u.slope.copyFromFloats(o,p),u.facet1.copyFromFloats(j.x,j.y,j.z,q),u.facet2.copyFromFloats(k.x,k.y,k.z,r)}},c}(a.Mesh);a.GroundMesh=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g){void 0===e&&(e=null),b.call(this,c,d,e,f,g),this.color=new a.Color3(1,1,1),this.alpha=1,this._positionBuffer={},f&&(this.color=f.color.clone(),this.alpha=f.alpha),this._intersectionThreshold=.1,this._colorShader=new a.ShaderMaterial("colorShader",d,"color",{attributes:[a.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"],needAlphaBlending:!0}),this._positionBuffer[a.VertexBuffer.PositionKind]=null}return __extends(c,b),Object.defineProperty(c.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(b){this._intersectionThreshold!==b&&(this._intersectionThreshold=b,this.geometry&&(this.geometry.boundingBias=new a.Vector2(0,b)))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype.createInstance=function(b){return a.Tools.Log("LinesMeshes do not support createInstance."),null},c.prototype._bind=function(b,c,d){var e=this.getScene().getEngine();this._positionBuffer[a.VertexBuffer.PositionKind]=this._geometry.getVertexBuffer(a.VertexBuffer.PositionKind),e.bindBuffers(this._positionBuffer,this._geometry.getIndexBuffer(),this._colorShader.getEffect()),this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},c.prototype._draw=function(a,b,c){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var d=this.getScene().getEngine();d.draw(!1,a.indexStart,a.indexCount)}},c.prototype.dispose=function(a){this._colorShader.dispose(),b.prototype.dispose.call(this,a)},c.prototype.clone=function(a,b,d){return new c(a,this.getScene(),b,this,d)},c}(a.Mesh);a.LinesMesh=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c){var d=this;void 0===b&&(b=""),void 0===c&&(c="black"),this._renderingCanvas=a,this._loadingText=b,this._loadingDivBackgroundColor=c,this._resizeLoadingUI=function(){var a=d._renderingCanvas.getBoundingClientRect();d._loadingDiv.style.position="absolute",d._loadingDiv.style.left=a.left+"px",d._loadingDiv.style.top=a.top+"px",d._loadingDiv.style.width=a.width+"px",d._loadingDiv.style.height=a.height+"px"}}return a.prototype.displayLoadingUI=function(){var a=this;if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var b=new Image;b.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==",
b.style.position="absolute",b.style.left="50%",b.style.top="50%",b.style.marginLeft="-50px",b.style.marginTop="-50px",b.style.transition="transform 1.0s ease",b.style.webkitTransition="-webkit-transform 1.0s ease";var c=360,d=function(){c+=360,b.style.transform="rotateZ("+c+"deg)",b.style.webkitTransform="rotateZ("+c+"deg)"};b.addEventListener("transitionend",d),b.addEventListener("webkitTransitionEnd",d),this._loadingDiv.appendChild(b);var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.marginLeft="-50px",e.style.marginTop="-50px",this._loadingDiv.appendChild(e),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){a._loadingDiv.style.opacity="1",b.style.transform="rotateZ(360deg)",b.style.webkitTransform="rotateZ(360deg)"},0)}},a.prototype.hideLoadingUI=function(){var a=this;if(this._loadingDiv){var b=function(){a._loadingDiv&&(document.body.removeChild(a._loadingDiv),window.removeEventListener("resize",a._resizeLoadingUI),a._loadingDiv=null)};this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",b)}},Object.defineProperty(a.prototype,"loadingUIText",{set:function(a){this._loadingText=a,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(a){this._loadingDivBackgroundColor=a,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),a}();a.DefaultLoadingScreen=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.unlocked=!1,"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0),/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0}return Object.defineProperty(b.prototype,"audioContext",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),b.prototype._unlockiOSaudio=function(){var a=this,b=function(){var c=a.audioContext.createBuffer(1,1,22050),d=a.audioContext.createBufferSource();d.buffer=c,d.connect(a.audioContext.destination),d.start(0),setTimeout(function(){d.playbackState!==d.PLAYING_STATE&&d.playbackState!==d.FINISHED_STATE||(a.unlocked=!0,window.removeEventListener("touchend",b,!1),a.onAudioUnlocked&&a.onAudioUnlocked())},0)};window.addEventListener("touchend",b,!1)},b.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(b){this.canUseWebAudio=!1,a.Tools.Error("Web Audio: "+b.message)}},b.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},b.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},b.prototype.setGlobalVolume=function(a){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=a)},b.prototype.connectToAnalyser=function(a){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=a,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},b}();a.AudioEngine=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f){var g=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=a.Vector3.Zero(),this._localDirection=new a.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this.name=b,this._scene=d,this._readyToPlayCallback=e,this._customAttenuationFunction=function(a,b,c,d,e){return c>b?a*(1-b/c):0},f&&(this.autoplay=f.autoplay||!1,this.loop=f.loop||!1,void 0!==f.volume&&(this._volume=f.volume),this.spatialSound=f.spatialSound||!1,this.maxDistance=f.maxDistance||100,this.useCustomAttenuation=f.useCustomAttenuation||!1,this.rolloffFactor=f.rolloffFactor||1,this.refDistance=f.refDistance||1,this.distanceModel=f.distanceModel||"linear",this._playbackRate=f.playbackRate||1,this._streaming=f.streaming||!1),a.Engine.audioEngine.canUseWebAudio?(this._soundGain=a.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),c&&("string"==typeof c?this._streaming?(this._htmlAudioElement=new Audio(c),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,this._htmlAudioElement.crossOrigin="anonymous",this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){g._isReadyToPlay=!0,g.autoplay&&g.play(),g._readyToPlayCallback&&g._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):a.Tools.LoadFile(c,function(a){g._soundLoaded(a)},null,this._scene.database,!0):c instanceof ArrayBuffer?c.byteLength>0&&this._soundLoaded(c):a.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):(this._scene.mainSoundTrack.AddSound(this),a.Engine.audioEngine.WarnedWebAudioUnsupported||(a.Tools.Error("Web Audio is not supported by your browser."),a.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){g._readyToPlayCallback()},1e3))}return b.prototype.dispose=function(){a.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},b.prototype._soundLoaded=function(b){var c=this;this._isLoaded=!0,a.Engine.audioEngine.audioContext.decodeAudioData(b,function(a){c._audioBuffer=a,c._isReadyToPlay=!0,c.autoplay&&c.play(),c._readyToPlayCallback&&c._readyToPlayCallback()},function(){a.Tools.Error("Error while decoding audio data for: "+c.name)})},b.prototype.setAudioBuffer=function(b){a.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=b,this._isReadyToPlay=!0)},b.prototype.updateOptions=function(a){a&&(this.loop=a.loop||this.loop,this.maxDistance=a.maxDistance||this.maxDistance,this.useCustomAttenuation=a.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=a.rolloffFactor||this.rolloffFactor,this.refDistance=a.refDistance||this.refDistance,this.distanceModel=a.distanceModel||this.distanceModel,this._playbackRate=a.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate))},b.prototype._createSpatialParameters=function(){a.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=a.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},b.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},b.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},b.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},b.prototype._switchPanningModel=function(){a.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},b.prototype.connectToSoundTrackAudioNode=function(b){a.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(b),this._isOutputConnected=!0)},b.prototype.setDirectionalCone=function(b,c,d){return b>c?void a.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=b,this._coneOuterAngle=c,this._coneOuterGain=d,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},b.prototype.setPosition=function(b){this._position=b,a.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},b.prototype.setLocalDirectionToMesh=function(b){this._localDirection=b,a.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},b.prototype._updateDirection=function(){var b=this._connectedMesh.getWorldMatrix(),c=a.Vector3.TransformNormal(this._localDirection,b);c.normalize(),this._soundPanner.setOrientation(c.x,c.y,c.z)},b.prototype.updateDistanceFromListener=function(){if(a.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var b=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,b,this.maxDistance,this.refDistance,this.rolloffFactor)}},b.prototype.setAttenuationFunction=function(a){this._customAttenuationFunction=a},b.prototype.play=function(b){var c=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{this._startOffset<0&&(b=-this._startOffset,this._startOffset=0);var d=b?a.Engine.audioEngine.audioContext.currentTime+b:a.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming?(this._streamingSource||(this._streamingSource=a.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){c._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=a.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){c._onended()},this._soundSource.start(d,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0)),this._startTime=d,this.isPlaying=!0,this.isPaused=!1}catch(e){a.Tools.Error("Error while trying to play audio: "+this.name+", "+e.message)}},b.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},b.prototype.stop=function(b){if(this.isPlaying){if(this._streaming)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else{var c=b?a.Engine.audioEngine.audioContext.currentTime+b:a.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(c),this._soundSource.onended=null,this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},b.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():(this.stop(0),this._startOffset+=a.Engine.audioEngine.audioContext.currentTime-this._startTime))},b.prototype.setVolume=function(b,c){a.Engine.audioEngine.canUseWebAudio&&(c?(this._soundGain.gain.cancelScheduledValues(a.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,a.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(b,a.Engine.audioEngine.audioContext.currentTime+c)):this._soundGain.gain.value=b),this._volume=b},b.prototype.setPlaybackRate=function(a){this._playbackRate=a,this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate)},b.prototype.getVolume=function(){return this._volume},b.prototype.attachToMesh=function(a){var b=this;this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=a,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(a){return b._onRegisterAfterWorldMatrixUpdate(a)},a.registerAfterWorldMatrixUpdate(this._registerFunc)},b.prototype.detachFromMesh=function(){this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},b.prototype._onRegisterAfterWorldMatrixUpdate=function(b){this.setPosition(b.getBoundingInfo().boundingSphere.centerWorld),a.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},b.prototype.clone=function(){var a=this;if(this._streaming)return null;var c=function(){a._isReadyToPlay?(e._audioBuffer=a.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play()):window.setTimeout(c,300)},d={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},e=new b(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,d);return this.useCustomAttenuation&&e.setAttenuationFunction(this._customAttenuationFunction),e.setPosition(this._position),e.setPlaybackRate(this._playbackRate),c(),e},b.prototype.getAudioBuffer=function(){return this._audioBuffer},b.Parse=function(c,d,e,f){var g,h=c.name;g=c.url?e+c.url:e+h;var i,j={autoplay:c.autoplay,loop:c.loop,volume:c.volume,spatialSound:c.spatialSound,maxDistance:c.maxDistance,rolloffFactor:c.rolloffFactor,refDistance:c.refDistance,distanceModel:c.distanceModel,playbackRate:c.playbackRate};if(f){var k=function(){f._isReadyToPlay?(i._audioBuffer=f.getAudioBuffer(),i._isReadyToPlay=!0,i.autoplay&&i.play()):window.setTimeout(k,300)};i=new b(h,new ArrayBuffer(0),d,null,j),k()}else i=new b(h,g,d,function(){d._removePendingData(i)},j),d._addPendingData(i);if(c.position){var l=a.Vector3.FromArray(c.position);i.setPosition(l)}if(c.isDirectional&&(i.setDirectionalCone(c.coneInnerAngle||360,c.coneOuterAngle||360,c.coneOuterGain||0),c.localDirectionToMesh)){var m=a.Vector3.FromArray(c.localDirectionToMesh);i.setLocalDirectionToMesh(m)}if(c.connectedMeshId){var n=d.getMeshByID(c.connectedMeshId);n&&i.attachToMesh(n)}return i},b}();a.Sound=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b){this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=a,this.soundCollection=new Array,this._options=b,this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return b.prototype._initializeSoundTrackAudioGraph=function(){a.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode=a.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(a.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},b.prototype.dispose=function(){if(a.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},b.prototype.AddSound=function(b){this._isInitialized||this._initializeSoundTrackAudioGraph(),a.Engine.audioEngine.canUseWebAudio&&b.connectToSoundTrackAudioNode(this._outputAudioNode),b.soundTrackId&&(-1===b.soundTrackId?this._scene.mainSoundTrack.RemoveSound(b):this._scene.soundTracks[b.soundTrackId].RemoveSound(b)),this.soundCollection.push(b),b.soundTrackId=this.id},b.prototype.RemoveSound=function(a){var b=this.soundCollection.indexOf(a);-1!==b&&this.soundCollection.splice(b,1)},b.prototype.setVolume=function(b){a.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=b)},b.prototype.switchPanningModelToHRTF=function(){if(a.Engine.audioEngine.canUseWebAudio)for(var b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()},b.prototype.switchPanningModelToEqualPower=function(){if(a.Engine.audioEngine.canUseWebAudio)for(var b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()},b.prototype.connectToAnalyser=function(b){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=b,a.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,a.Engine.audioEngine.masterGain))},b}();a.SoundTrack=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return a.TransformCoordinatesToRefSIMD=function(a,b,c){var d=SIMD.float32x4.loadXYZ(a._data,0),e=SIMD.float32x4.load(b.m,0),f=SIMD.float32x4.load(b.m,4),g=SIMD.float32x4.load(b.m,8),h=SIMD.float32x4.load(b.m,12),i=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),e),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),f)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),g),h));i=SIMD.float32x4.div(i,SIMD.float32x4.swizzle(i,3,3,3,3)),SIMD.float32x4.storeXYZ(c._data,0,i)},a.TransformCoordinatesFromFloatsToRefSIMD=function(a,b,c,d,e){var f=SIMD.float32x4.splat(a),g=SIMD.float32x4.splat(b),h=SIMD.float32x4.splat(c),i=SIMD.float32x4.load(d.m,0),j=SIMD.float32x4.load(d.m,4),k=SIMD.float32x4.load(d.m,8),l=SIMD.float32x4.load(d.m,12),m=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(f,i),SIMD.float32x4.mul(g,j)),SIMD.float32x4.add(SIMD.float32x4.mul(h,k),l));m=SIMD.float32x4.div(m,SIMD.float32x4.swizzle(m,3,3,3,3)),SIMD.float32x4.storeXYZ(e._data,0,m)},a}();a.SIMDVector3=b;var c=function(){function a(){}return a.prototype.multiplyToArraySIMD=function(a,b,c){void 0===c&&(c=0);var d=this.m,e=a.m,f=SIMD.float32x4.load(e,0),g=SIMD.float32x4.load(e,4),h=SIMD.float32x4.load(e,8),i=SIMD.float32x4.load(e,12),j=SIMD.float32x4.load(d,0);SIMD.float32x4.store(b,c+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,0,0,0,0),f),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(j,3,3,3,3),i)))));var k=SIMD.float32x4.load(d,4);SIMD.float32x4.store(b,c+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,0,0,0,0),f),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,3,3,3,3),i)))));var l=SIMD.float32x4.load(d,8);SIMD.float32x4.store(b,c+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),f),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),i)))));var m=SIMD.float32x4.load(d,12);SIMD.float32x4.store(b,c+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,0,0,0,0),f),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,1,1,1,1),g),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,2,2,2,2),h),SIMD.float32x4.mul(SIMD.float32x4.swizzle(m,3,3,3,3),i)))))},a.prototype.invertToRefSIMD=function(a){var b,c,d,e,f,g,h,i,j,k,l=this.m,m=a.m,n=SIMD.float32x4.load(l,0),o=SIMD.float32x4.load(l,4),p=SIMD.float32x4.load(l,8),q=SIMD.float32x4.load(l,12);return f=SIMD.float32x4.shuffle(n,o,0,1,4,5),c=SIMD.float32x4.shuffle(p,q,0,1,4,5),b=SIMD.float32x4.shuffle(f,c,0,2,4,6),c=SIMD.float32x4.shuffle(c,f,1,3,5,7),f=SIMD.float32x4.shuffle(n,o,2,3,6,7),e=SIMD.float32x4.shuffle(p,q,2,3,6,7),d=SIMD.float32x4.shuffle(f,e,0,2,4,6),e=SIMD.float32x4.shuffle(e,f,1,3,5,7),f=SIMD.float32x4.mul(d,e),f=SIMD.float32x4.swizzle(f,1,0,3,2),g=SIMD.float32x4.mul(c,f),h=SIMD.float32x4.mul(b,f),f=SIMD.float32x4.swizzle(f,2,3,0,1),g=SIMD.float32x4.sub(SIMD.float32x4.mul(c,f),g),h=SIMD.float32x4.sub(SIMD.float32x4.mul(b,f),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),f=SIMD.float32x4.mul(c,d),f=SIMD.float32x4.swizzle(f,1,0,3,2),g=SIMD.float32x4.add(SIMD.float32x4.mul(e,f),g),j=SIMD.float32x4.mul(b,f),f=SIMD.float32x4.swizzle(f,2,3,0,1),g=SIMD.float32x4.sub(g,SIMD.float32x4.mul(e,f)),j=SIMD.float32x4.sub(SIMD.float32x4.mul(b,f),j),j=SIMD.float32x4.swizzle(j,2,3,0,1),f=SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,2,3,0,1),e),f=SIMD.float32x4.swizzle(f,1,0,3,2),d=SIMD.float32x4.swizzle(d,2,3,0,1),g=SIMD.float32x4.add(SIMD.float32x4.mul(d,f),g),i=SIMD.float32x4.mul(b,f),f=SIMD.float32x4.swizzle(f,2,3,0,1),g=SIMD.float32x4.sub(g,SIMD.float32x4.mul(d,f)),i=SIMD.float32x4.sub(SIMD.float32x4.mul(b,f),i),i=SIMD.float32x4.swizzle(i,2,3,0,1),f=SIMD.float32x4.mul(b,c),f=SIMD.float32x4.swizzle(f,1,0,3,2),i=SIMD.float32x4.add(SIMD.float32x4.mul(e,f),i),j=SIMD.float32x4.sub(SIMD.float32x4.mul(d,f),j),f=SIMD.float32x4.swizzle(f,2,3,0,1),i=SIMD.float32x4.sub(SIMD.float32x4.mul(e,f),i),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(d,f)),f=SIMD.float32x4.mul(b,e),f=SIMD.float32x4.swizzle(f,1,0,3,2),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(d,f)),i=SIMD.float32x4.add(SIMD.float32x4.mul(c,f),i),f=SIMD.float32x4.swizzle(f,2,3,0,1),h=SIMD.float32x4.add(SIMD.float32x4.mul(d,f),h),i=SIMD.float32x4.sub(i,SIMD.float32x4.mul(c,f)),f=SIMD.float32x4.mul(b,d),f=SIMD.float32x4.swizzle(f,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(e,f),h),j=SIMD.float32x4.sub(j,SIMD.float32x4.mul(c,f)),f=SIMD.float32x4.swizzle(f,2,3,0,1),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(e,f)),j=SIMD.float32x4.add(SIMD.float32x4.mul(c,f),j),k=SIMD.float32x4.mul(b,g),k=SIMD.float32x4.add(SIMD.float32x4.swizzle(k,2,3,0,1),k),k=SIMD.float32x4.add(SIMD.float32x4.swizzle(k,1,0,3,2),k),f=SIMD.float32x4.reciprocalApproximation(k),k=SIMD.float32x4.sub(SIMD.float32x4.add(f,f),SIMD.float32x4.mul(k,SIMD.float32x4.mul(f,f))),k=SIMD.float32x4.swizzle(k,0,0,0,0),g=SIMD.float32x4.mul(k,g),h=SIMD.float32x4.mul(k,h),i=SIMD.float32x4.mul(k,i),j=SIMD.float32x4.mul(k,j),SIMD.float32x4.store(m,0,g),SIMD.float32x4.store(m,4,h),SIMD.float32x4.store(m,8,i),SIMD.float32x4.store(m,12,j),this},a.LookAtLHToRefSIMD=function(a,b,c,d){var e=d.m,f=SIMD.float32x4(b.x,b.y,b.z,0),g=SIMD.float32x4(a.x,a.y,a.z,0),h=SIMD.float32x4(c.x,c.y,c.z,0),i=SIMD.float32x4.sub(f,g),j=SIMD.float32x4.mul(i,i);j=SIMD.float32x4.add(j,SIMD.float32x4.add(SIMD.float32x4.swizzle(j,1,2,0,3),SIMD.float32x4.swizzle(j,2,0,1,3))),i=SIMD.float32x4.mul(i,SIMD.float32x4.reciprocalSqrtApproximation(j)),j=SIMD.float32x4.mul(h,h),j=SIMD.float32x4.add(j,SIMD.float32x4.add(SIMD.float32x4.swizzle(j,1,2,0,3),SIMD.float32x4.swizzle(j,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(j));var k=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(i,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(i,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));j=SIMD.float32x4.mul(k,k),j=SIMD.float32x4.add(j,SIMD.float32x4.add(SIMD.float32x4.swizzle(j,1,2,0,3),SIMD.float32x4.swizzle(j,2,0,1,3))),k=SIMD.float32x4.mul(k,SIMD.float32x4.reciprocalSqrtApproximation(j));var l=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,1,2,0,3),SIMD.float32x4.swizzle(i,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(k,2,0,1,3),SIMD.float32x4.swizzle(i,1,2,0,3)));j=SIMD.float32x4.mul(k,k),j=SIMD.float32x4.add(j,SIMD.float32x4.add(SIMD.float32x4.swizzle(j,1,2,0,3),SIMD.float32x4.swizzle(j,2,0,1,3))),k=SIMD.float32x4.mul(k,SIMD.float32x4.reciprocalSqrtApproximation(j));var m=SIMD.float32x4.splat(0);k=SIMD.float32x4.neg(k);var n=SIMD.float32x4.shuffle(k,l,0,1,4,5),o=SIMD.float32x4.shuffle(i,m,0,1,4,5),p=SIMD.float32x4.shuffle(n,o,0,2,4,6),q=SIMD.float32x4.shuffle(n,o,1,3,5,7);n=SIMD.float32x4.shuffle(k,l,2,3,6,7),o=SIMD.float32x4.shuffle(i,m,2,3,6,7);var r=SIMD.float32x4.shuffle(n,o,0,2,4,6),s=SIMD.float32x4(0,0,0,1),t=SIMD.float32x4(1,0,0,0),u=SIMD.float32x4(0,1,0,0),v=SIMD.float32x4(0,0,1,0),w=SIMD.float32x4.neg(g);w=SIMD.float32x4.withW(w,1),SIMD.float32x4.store(e,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(t,0,0,0,0),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(t,1,1,1,1),q),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(t,2,2,2,2),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(t,3,3,3,3),s))))),SIMD.float32x4.store(e,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),q),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),s))))),SIMD.float32x4.store(e,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(v,0,0,0,0),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(v,1,1,1,1),q),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(v,2,2,2,2),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(v,3,3,3,3),s))))),SIMD.float32x4.store(e,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,0,0,0,0),p),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,1,1,1,1),q),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,2,2,2,2),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(w,3,3,3,3),s)))))},a}();a.SIMDMatrix=c;var d=a.Matrix.prototype.multiplyToArray,e=a.Matrix.prototype.invertToRef,f=a.Matrix.LookAtLHToRef,g=a.Vector3.TransformCoordinatesToRef,h=a.Vector3.TransformCoordinatesFromFloatsToRef,i=function(){function i(){}return Object.defineProperty(i,"IsEnabled",{get:function(){return i._isEnabled},enumerable:!0,configurable:!0}),i.DisableSIMD=function(){a.Matrix.prototype.multiplyToArray=d,a.Matrix.prototype.invertToRef=e,a.Matrix.LookAtLHToRef=f,a.Vector3.TransformCoordinatesToRef=g,a.Vector3.TransformCoordinatesFromFloatsToRef=h,i._isEnabled=!1},i.EnableSIMD=function(){void 0!==window.SIMD&&(a.Matrix.prototype.multiplyToArray=c.prototype.multiplyToArraySIMD,a.Matrix.prototype.invertToRef=c.prototype.invertToRefSIMD,a.Matrix.LookAtLHToRef=c.LookAtLHToRefSIMD,a.Vector3.TransformCoordinatesToRef=b.TransformCoordinatesToRefSIMD,a.Vector3.TransformCoordinatesFromFloatsToRef=b.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(a.Vector3.prototype,"x",{get:function(){return this._data[0]},set:function(a){this._data||(this._data=new Float32Array(3)),this._data[0]=a}}),Object.defineProperty(a.Vector3.prototype,"y",{get:function(){return this._data[1]},set:function(a){this._data[1]=a}}),Object.defineProperty(a.Vector3.prototype,"z",{get:function(){return this._data[2]},set:function(a){this._data[2]=a}}),i._isEnabled=!0)},i._isEnabled=!1,i}();a.SIMDHelper=i}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d){this._pos=c,this._size=d,this._root=a,this._parent=b}return Object.defineProperty(b.prototype,"pos",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"contentSize",{get:function(){return this._contentSize},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"UVs",{get:function(){
var b=this._root._size.width,c=this._root._size.height,d=new a.Vector2(this._pos.x/b,this._pos.y/c),e=new a.Vector2((this._pos.x+this._contentSize.width-1)/b,(this._pos.y+this._contentSize.height-1)/c),f=new Array;return f.push(d),f.push(new a.Vector2(e.x,d.y)),f.push(e),f.push(new a.Vector2(d.x,e.y)),f},enumerable:!0,configurable:!0}),b.prototype.freeContent=function(){this.contentSize&&(this._contentSize=null,this.attemptDefrag())},Object.defineProperty(b.prototype,"isUsed",{get:function(){return null!=this._contentSize||null!=this._leftNode},enumerable:!0,configurable:!0}),b.prototype.findAndSplitNode=function(a){var b=this.findNode(a);return b?(b.splitNode(a),b):null},b.prototype.findNode=function(a){var b=null;return this.isUsed?(this._leftNode&&(b=this._leftNode.findNode(a)),!b&&this._rightNode&&(b=this._rightNode.findNode(a)),!b&&this._bottomNode&&(b=this._bottomNode.findNode(a))):this._initialSize&&a.width<=this._initialSize.width&&a.height<=this._initialSize.height?b=this:a.width<=this._size.width&&a.height<=this._size.height&&(b=this),b},b.prototype.splitNode=function(c){return!this._contentSize&&this._initialSize?(this._leftNode=new b(this._root,this,new a.Vector2(this._pos.x,this._pos.y),new a.Size(this._initialSize.width,this._initialSize.height)),this._leftNode.splitNode(c)):(this._contentSize=c.clone(),this._initialSize=c.clone(),c.width!==this._size.width&&(this._rightNode=new b(this._root,this,new a.Vector2(this._pos.x+c.width,this._pos.y),new a.Size(this._size.width-c.width,c.height))),c.height!==this._size.height&&(this._bottomNode=new b(this._root,this,new a.Vector2(this._pos.x,this._pos.y+c.height),new a.Size(this._size.width,this._size.height-c.height))),this)},b.prototype.attemptDefrag=function(){!this.isUsed&&this.isRecursiveFree&&(this.clearNode(),this._parent&&this._parent.attemptDefrag())},b.prototype.clearNode=function(){this._initialSize=null,this._rightNode=null,this._bottomNode=null},Object.defineProperty(b.prototype,"isRecursiveFree",{get:function(){return!this.contentSize&&(!this._leftNode||this._leftNode.isRecursiveFree)&&(!this._rightNode||this._rightNode.isRecursiveFree)&&(!this._bottomNode||this._bottomNode.isRecursiveFree)},enumerable:!0,configurable:!0}),b.prototype.evalFreeSize=function(a){var b=0;return this.isUsed||(b=this._initialSize?this._initialSize.surface:this._size.surface),this._rightNode&&(b+=this._rightNode.evalFreeSize(0)),this._bottomNode&&(b+=this._bottomNode.evalFreeSize(0)),b+a},b}();a.PackedRect=b;var c=function(b){function c(c){b.call(this,null,null,a.Vector2.Zero(),c),this._root=this}return __extends(c,b),c.prototype.addRect=function(a){var b=this.findAndSplitNode(a);return b},Object.defineProperty(c.prototype,"freeSpace",{get:function(){var a=0;return a=this.evalFreeSize(a),a/(this._size.width*this._size.height)},enumerable:!0,configurable:!0}),c}(b);a.RectPackingMap=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return a}();a.DynamicFloatArrayElementInfo=b;var c=function(){function a(a,c){this.compareValueOffset=null,this.sortingAscending=!0,this._stride=a,this.buffer=new Float32Array(a*c),this._lastUsed=0,this._firstFree=0,this._allEntries=new Array(c),this._freeEntries=new Array(c);for(var d=0;c>d;d++){var e=new b;e.offset=d*a,this._allEntries[d]=e,this._freeEntries[c-d-1]=e}}return a.prototype.allocElement=function(){0===this._freeEntries.length&&this._growBuffer();var a=this._freeEntries.pop();return this._lastUsed=Math.max(a.offset,this._lastUsed),a.offset===this._firstFree&&(this._freeEntries.length>0?this._firstFree=this._freeEntries[this._freeEntries.length-1].offset:this._firstFree+=this._stride),a},a.prototype.freeElement=function(a){this._firstFree=Math.min(a.offset,this._firstFree),this._freeEntries.push(a)},a.prototype.pack=function(){if(0===this._freeEntries.length)return this.buffer;if(this._lastUsed<this._firstFree){var a=this.buffer.subarray(0,this._lastUsed+this._stride);return a}var c=this._stride,d=new b;d.offset=this.totalElementCount*c,this._freeEntries.push(d);for(var e=this._freeEntries.sort(function(a,b){return a.offset-b.offset}),f=this._allEntries.sort(function(a,b){return a.offset-b.offset}),g=e[0].offset,h=1,i=(this.usedElementCount+1)*c,j=e[0].offset,k=1;k<e.length&&!(g>=i);k++){var l=e[k],m=l.offset,n=m-j;if(n!==c){for(var o=n/c-1,p=m-c,q=Math.min(h,o),r=0;q>r;r++){var s=g/c,t=p/c,u=f[t];this._moveElement(u,g);var v=f[s];v.offset=p,f[s]=u,f[t]=v,p-=c,g+=c}o>=h?(g=p+c,h=1+q):h=(m-g)/c+1,j=m}else++h,j=m}var w=this.buffer.subarray(0,g);return this._lastUsed=g-c,this._firstFree=g,e.pop(),this._freeEntries=e.sort(function(a,b){return b.offset-a.offset}),this._allEntries=f,w},a.prototype._moveElement=function(a,b){for(var c=0;c<this._stride;c++)this.buffer[b+c]=this.buffer[a.offset+c];a.offset=b},a.prototype._growBuffer=function(){var a=Math.floor(1.5*this.totalElementCount),c=new Float32Array(a*this._stride);c.set(this.buffer);for(var d=this.totalElementCount,e=a-this.totalElementCount,f=0;e>f;f++){var g=new b;g.offset=(d+f)*this.stride,this._allEntries.push(g),this._freeEntries[e-f-1]=g}this._firstFree=d*this.stride,this.buffer=c},Object.defineProperty(a.prototype,"totalElementCount",{get:function(){return this._allEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"freeElementCount",{get:function(){return this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"usedElementCount",{get:function(){return this._allEntries.length-this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"stride",{get:function(){return this._stride},enumerable:!0,configurable:!0}),a.prototype.sort=function(){var a=this;if(!this.compareValueOffset)throw new Error("The DynamicFloatArray.sort() method needs a valid 'compareValueOffset' property");var b=this.usedElementCount;if(!this._sortTable||this._sortTable.length<b){var c=Math.min(this.totalElementCount,2*b);this._sortTable=new Array(c),this._sortedTable=new Array(c)}this.pack();for(var e=0,f=this.stride,g=0;b>g;g++,e+=f){var h=this._sortTable[g];h||(h=new d,this._sortTable[g]=h),h.compareData=this.buffer[e+this.compareValueOffset],h.offset=e,h.swapedOffset=null,this._sortedTable[g]=h}this.sortingAscending?this._sortedTable.sort(function(a,b){return a.compareData-b.compareData}):this._sortedTable.sort(function(a,b){return b.compareData-a.compareData});for(var i=function(b,c){for(var d=0;f>d;d++){var e=a.buffer[c+d];a.buffer[c+d]=a.buffer[b+d],a.buffer[b+d]=e}},g=0;b>g;g++){var j=this._sortedTable[g],k=this._sortTable[g],l=j.offset;if(j.swapedOffset){for(var m=j;m.swapedOffset;)m=this._sortTable[m.swapedOffset/f];l=m.offset}k.swapedOffset=l,l!==k.offset&&i(l,k.offset),this._allEntries[j.offset/f].offset=k.offset}return this._allEntries.sort(function(a,b){return a.offset-b.offset}),!0},a}();a.DynamicFloatArray=c;var d=function(){function a(){this.compareData=this.offset=this.swapedOffset=null}return a}()}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return a}();a.CharInfo=b;var c=function(c){function d(b,d,e,f,g){void 0===f&&(f=200),void 0===g&&(g=a.Texture.TRILINEAR_SAMPLINGMODE),c.call(this,null,e,!0,!1,g),this._charInfos={},this._curCharCount=0,this._lastUpdateCharCount=-1,this._usedCounter=1,this.name=b,this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._context.font=d,this._context.fillStyle="white";var h=this.getFontHeight(d);this._lineHeight=h.height,this._offset=h.offset-1;var i=this._context.measureText("W").width;this._spaceWidth=this._context.measureText(" ").width;var j=this._lineHeight*i*f,k=Math.sqrt(j),l=Math.pow(2,Math.ceil(Math.log(k)/Math.log(2)));this._texture=e.getEngine().createDynamicTexture(l,l,!1,g);var m=this.getSize();this._canvas=document.createElement("canvas"),this._canvas.width=m.width,this._canvas.height=m.height,this._context=this._canvas.getContext("2d"),this._context.textBaseline="top",this._context.font=d,this._context.fillStyle="white",this._context.imageSmoothingEnabled=!1,this._currentFreePosition=a.Vector2.Zero();for(var n=32;127>n;n++){var o=String.fromCharCode(n);this.getChar(o)}this.update()}return __extends(d,c),Object.defineProperty(d.prototype,"spaceWidth",{get:function(){return this._spaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"lineHeight",{get:function(){return this._lineHeight},enumerable:!0,configurable:!0}),d.GetCachedFontTexture=function(b,c){var e=b;e.__fontTextureCache__||(e.__fontTextureCache__=new a.StringDictionary);var f=e.__fontTextureCache__,g=c.toLocaleLowerCase(),h=f.get(g);return h?(++h._usedCounter,h):(h=new d(null,g,b,200,a.Texture.NEAREST_SAMPLINGMODE),f.add(g,h),h)},d.ReleaseCachedFontTexture=function(a,b){var c=a,d=c.__fontTextureCache__;if(d){var e=b.toLocaleLowerCase(),f=d.get(e);0===--f._usedCounter&&(d.remove(e),f.dispose())}},d.prototype.getChar=function(c){if(1!==c.length)return null;var d=this._charInfos[c];if(d)return d;d=new b;var e=this._context.measureText(c),f=this.getSize(),g=2,h=2,i=e.width;return this._currentFreePosition.x+i+g>f.width&&(this._currentFreePosition.x=0,this._currentFreePosition.y+=this._lineHeight+h,this._currentFreePosition.y>f.height)?this.getChar("!"):(this._context.fillText(c,this._currentFreePosition.x-.5,this._currentFreePosition.y-this._offset-.5),d.topLeftUV=new a.Vector2(this._currentFreePosition.x/f.width,this._currentFreePosition.y/f.height),d.bottomRightUV=new a.Vector2(d.topLeftUV.x+i/f.width,d.topLeftUV.y+(this._lineHeight+2)/f.height),d.charWidth=i,this._charInfos[c]=d,this._curCharCount++,this._currentFreePosition.x+=i+g,d)},d.prototype.measureText=function(b,c){void 0===c&&(c=4);for(var d=0,e=0,f=1,g=0,h=0;h<b.length;h++){var i=b[h];if("\n"!==i)if("	"!==i)" ">i||(e+=this.getChar(i).charWidth,++g);else{var j=g+c;j-=j%c,e+=(j-g)*this.spaceWidth,g=j}else d=Math.max(d,e),g=0,e=0,++f}return d=Math.max(d,e),new a.Size(d,f*this._lineHeight)},d.prototype.getFontHeight=function(a){var b=document.createElement("canvas"),c=b.getContext("2d");c.fillRect(0,0,b.width,b.height),c.textBaseline="top",c.fillStyle="white",c.font=a,c.fillText("jH|",0,0);for(var d=c.getImageData(0,0,b.width,b.height).data,e=-1,f=-1,g=0;g<b.height;g++)for(var h=0;h<b.width;h++){var i=4*(g*b.width+h);if(0!==d[i]){-1===e&&(e=g);break}if(h===b.width-1&&-1!==e){f=g,g=b.height;break}}return{height:f-e,offset:e-1}},Object.defineProperty(d.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),d.prototype.getContext=function(){return this._context},d.prototype.update=function(){this._lastUpdateCharCount<this._curCharCount&&(this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,!1,!0),this._lastUpdateCharCount=this._curCharCount)},d.prototype.clone=function(){return null},d}(a.Texture);a.FontTexture=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){void 0===f&&(f=a.Texture.TRILINEAR_SAMPLINGMODE),b.call(this,null,d,!0,!1,f),this.name=c,this._size=e,this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._rectPackingMap=new a.RectPackingMap(new a.Size(e.width,e.height)),this._texture=d.getEngine().createRenderTargetTexture(e,{generateMipMaps:!this.noMipmap,type:a.Engine.TEXTURETYPE_UNSIGNED_INT})}return __extends(c,b),c.prototype.allocateRect=function(a){return this._rectPackingMap.addRect(a)},c.prototype.freeRect=function(a){a&&a.freeContent()},Object.defineProperty(c.prototype,"freeSpace",{get:function(){return this._rectPackingMap.freeSpace},enumerable:!0,configurable:!0}),c.prototype.bindTextureForRect=function(a,b){return this.bindTextureForPosSize(a.pos,a.contentSize,b)},c.prototype.bindTextureForPosSize=function(b,c,d){var e=this.getScene().getEngine();e.bindFramebuffer(this._texture),this._replacedViewport=e.setDirectViewport(b.x,b.y,c.width,c.height),d&&e.scissorClear(b.x,b.y,c.width,c.height,new a.Color4(0,0,0,0))},c.prototype.unbindTexture=function(b){b&&a.Tools.DumpFramebuffer(this._size.width,this._size.height,this.getScene().getEngine());var c=this.getScene().getEngine();this._replacedViewport&&(c.setViewport(this._replacedViewport),this._replacedViewport=null),c.unBindFramebuffer(this._texture)},Object.defineProperty(c.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),c.prototype.clone=function(){return null},c}(a.Texture);a.MapTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.radius=0,this.center=a.Vector2.Zero(),this.extent=a.Vector2.Zero()}return b.CreateFromSize=function(a){var c=new b;return b.CreateFromSizeToRef(a,c),c},b.CreateFromRadius=function(a){var c=new b;return b.CreateFromRadiusToRef(a,c),c},b.CreateFromPoints=function(a){var c=new b;return b.CreateFromPointsToRef(a,c),c},b.CreateFromSizeToRef=function(b,c){b||(b=a.Size.Zero()),c.center.x=+b.width/2,c.center.y=+b.height/2,c.extent.x=c.center.x,c.extent.y=c.center.y,c.radius=c.extent.length()},b.CreateFromRadiusToRef=function(a,b){b.center.x=b.center.y=0;var c=+a;b.extent.x=c,b.extent.y=c,b.radius=c},b.CreateFromPointsToRef=function(a,c){for(var d=Number.MAX_VALUE,e=Number.MAX_VALUE,f=Number.MIN_VALUE,g=Number.MIN_VALUE,h=0;h<a.length;h++){var i=a[h];d=Math.min(i.x,d),f=Math.max(i.x,f),e=Math.min(i.y,e),g=Math.max(i.y,g)}b.CreateFromMinMaxToRef(d,f,e,g,c)},b.CreateFromMinMaxToRef=function(b,c,d,e,f){var g=c-b,h=e-d;f.center=new a.Vector2(b+g/2,d+h/2),f.extent=new a.Vector2(c-f.center.x,e-f.center.y),f.radius=f.extent.length()},b.prototype.clone=function(){var a=new b;return a.center=this.center.clone(),a.radius=this.radius,a.extent=this.extent.clone(),a},b.prototype.max=function(){var b=a.Vector2.Zero();return this.maxToRef(b),b},b.prototype.maxToRef=function(a){a.x=this.center.x+this.extent.x,a.y=this.center.y+this.extent.y},b.prototype.transform=function(a){var c=new b;return this.transformToRef(a,c),c},b.prototype.union=function(a){var c=new b;return this.unionToRef(a,c),c},b.prototype.transformToRef=function(c,d){var e=b._transform;e[0].x=this.center.x+this.extent.x,e[0].y=this.center.y+this.extent.y,e[1].x=this.center.x+this.extent.x,e[1].y=this.center.y-this.extent.y,e[2].x=this.center.x-this.extent.x,e[2].y=this.center.y-this.extent.y,e[3].x=this.center.x-this.extent.x,e[3].y=this.center.y+this.extent.y;for(var f=0;4>f;f++)a.Vector2.TransformToRef(e[f],c,e[f]);b.CreateFromPointsToRef(e,d)},b.prototype.unionToRef=function(a,c){var d=Math.max(this.center.x+this.extent.x,a.center.x+a.extent.x),e=Math.max(this.center.y+this.extent.y,a.center.y+a.extent.y),f=Math.min(this.center.x-this.extent.x,a.center.x-a.extent.x),g=Math.min(this.center.y-this.extent.y,a.center.y-a.extent.y);b.CreateFromMinMaxToRef(f,d,g,e,c)},b.prototype.doesIntersect=function(a){var b=a.subtract(this.center);return b.lengthSquared()<=this.radius*this.radius?Math.abs(b.x)<=this.extent.x&&Math.abs(b.y)<=this.extent.y:!1},b._transform=new Array(a.Vector2.Zero(),a.Vector2.Zero(),a.Vector2.Zero(),a.Vector2.Zero()),b}();a.BoundingInfo2D=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){}return a.prototype.isLocked=function(){return this._isLocked},a.prototype.lock=function(){return this._isLocked?!0:(this.onLock(),this._isLocked=!0,!1)},a.prototype.onLock=function(){},a}();a.LockableBase=b;var c=function(b){function c(a,c){void 0===c&&(c=!1),b.call(this),this._color=a,c&&this.lock()}return __extends(c,b),c.prototype.isTransparent=function(){return this._color&&this._color.a<1},Object.defineProperty(c.prototype,"color",{get:function(){return this._color},set:function(a){this.isLocked()||(this._color=a)},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return this._color.toHexString()},c=__decorate([a.className("SolidColorBrush2D")],c)}(b);a.SolidColorBrush2D=c;var d=function(b){function c(c,d,e,f,g,h){void 0===e&&(e=a.Vector2.Zero()),void 0===f&&(f=0),void 0===g&&(g=1),void 0===h&&(h=!1),b.call(this),this._color1=c,this._color2=d,this._translation=e,this._rotation=f,this._scale=g,h&&this.lock()}return __extends(c,b),c.prototype.isTransparent=function(){return this._color1&&this._color1.a<1||this._color2&&this._color2.a<1},Object.defineProperty(c.prototype,"color1",{get:function(){return this._color1},set:function(a){this.isLocked()||(this._color1=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color2",{get:function(){return this._color2},set:function(a){this.isLocked()||(this._color2=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"translation",{get:function(){return this._translation},set:function(a){this.isLocked()||(this._translation=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this.isLocked()||(this._rotation=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return this._scale},set:function(a){this.isLocked()||(this._scale=a)},enumerable:!0,configurable:!0}),c.prototype.toString=function(){return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+";"},c.BuildKey=function(a,b,c,d,e){return"C1:"+a+";C2:"+b+";T:"+c.toString()+";R:"+d+";S:"+e+";"},c=__decorate([a.className("GradientColorBrush2D")],c)}(b);a.GradientColorBrush2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){function b(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),i._hookProperty(a,b,c,d,f.PROPKIND_MODEL)}function c(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),i._hookProperty(a,b,c,d,f.PROPKIND_INSTANCE)}function d(a,b,c,d){return void 0===c&&(c=!1),void 0===d&&(d=!1),i._hookProperty(a,b,c,d,f.PROPKIND_DYNAMIC)}var e=function(){function a(){}return a}();a.Prim2DClassInfo=e;var f=function(){function a(){}return a.PROPKIND_MODEL=1,a.PROPKIND_INSTANCE=2,a.PROPKIND_DYNAMIC=3,a}();a.Prim2DPropInfo=f;var g=function(){function a(){}return a}();a.PropertyChangedInfo=g;var h=function(){function b(b,c,d){this._baseClass=b,this._type=c,this._subClasses=new Array,this._levelContent=new a.StringDictionary,this._classContentFactory=d}return Object.defineProperty(b.prototype,"classContent",{get:function(){return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?this._baseClass.classContent:null)),this._classContent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"levelContent",{get:function(){return this._levelContent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var b=new a.StringDictionary,c=this;c;)c.levelContent.forEach(function(a,c){return b.add(a,c)}),c=c._baseClass;this._fullContent=b}return this._fullContent},enumerable:!0,configurable:!0}),b.prototype.getLevelOf=function(a){if(a===this._type)return this;var b=Object.getPrototypeOf(a),c=this.getOrAddType(Object.getPrototypeOf(b),b);return c||this.getLevelOf(b),this.getOrAddType(b,a)},b.prototype.getOrAddType=function(a,c){if(a===this._type){for(var d=0,e=this._subClasses;d<e.length;d++){var f=e[d];if(f.type===c)return f.node}var g=new b(this,c,this._classContentFactory),h={type:c,node:g};return this._subClasses.push(h),h.node}for(var i=0,j=this._subClasses;i<j.length;i++){var f=j[i],h=f.node.getOrAddType(a,c);if(h)return h}return null},b.get=function(a){var b=a.__classTreeInfo;return b?b.getLevelOf(a):null},b.getOrRegister=function(a,c){var d=a.__classTreeInfo;return d||(d=new b(null,a,c),a.__classTreeInfo=d),d},b}();a.ClassTreeInfo=h;var i=function(){function b(){this._flags=0,this._modelKey=null,this._instanceDirtyFlags=0,this._levelBoundingInfo=new a.BoundingInfo2D,this.animations=new Array}return Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this._isFlagSet(b.flagIsDisposed)},enumerable:!0,configurable:!0}),b.prototype.dispose=function(){return this.isDisposed?!1:(this.animations.splice(0),this._setFlags(b.flagIsDisposed),!0)},b.prototype.getAnimatables=function(){return new Array},Object.defineProperty(b.prototype,"modelKey",{get:function(){var c=this;if(!this._isFlagSet(b.flagModelDirty)&&this._modelKey)return this._modelKey;var d="Class:"+a.Tools.getClassName(this)+";",e=this.propDic;return e.forEach(function(b,e){if(e.kind===f.PROPKIND_MODEL){var g=c[e.name];if(g&&g.constructor===Array){var h=g[0];g=h?a.Tools.hashCodeFromStream(a.Tools.arrayOrStringFeeder(g)):0}d+=e.name+":"+(null!=g?e.typeLevelCompare?a.Tools.getClassName(g):g.toString():"[null]")+";"}}),this._clearFlags(b.flagModelDirty),this._modelKey=d,d},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(b.flagModelDirty|b.flagPositioningDirty|b.flagLayoutDirty)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"propDic",{get:function(){if(!this._propInfo){var a=h.get(Object.getPrototypeOf(this));if(!a)throw new Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=a.fullContent}return this._propInfo},enumerable:!0,configurable:!0}),b._createPropInfo=function(a,b,c,d,g,i){var j=h.getOrRegister(a,function(){return new e}),k=j.getLevelOf(a),l=k.levelContent.get(c.toString());if(l)throw new Error("The ID "+c+" is already taken by another property declaration named: "+l.name);return l=new f,l.id=c,l.flagId=Math.pow(2,c),l.kind=i,l.name=b,l.dirtyBoundingInfo=d,l.typeLevelCompare=g,k.levelContent.add(b,l),l},b._checkUnchanged=function(a,b){if(null===a&&null===b||void 0===a&&void 0===b)return!0;if(null!=a&&null!=b)if("function"==typeof a.equals){if(a.equals(b))return!0}else if(a===b)return!0;return!1},b.prototype.markAsDirty=function(a){if(!this.isDisposed){var b=a.indexOf(".");-1!==b&&(a=a.substr(0,b));var c=this.propDic.get(a);if(c){var d=this[a];this._handlePropChanged(void 0,d,a,c,c.typeLevelCompare)}}},b.prototype._boundingBoxDirty=function(){if(this._setFlags(b.flagLevelBoundingInfoDirty),this instanceof a.Prim2DBase)for(var c=this;c&&(c._boundingSize=null,c._setFlags(b.flagBoundingInfoDirty),c.isSizeAuto&&c.onPrimitivePropertyDirty(a.Prim2DBase.sizeProperty.flagId),!(c instanceof a.Group2D&&c.isRenderableGroup));)c=c.parent},b.prototype._handlePropChanged=function(c,d,e,g,h){g.dirtyBoundingInfo&&this._boundingBoxDirty();var i=b.propChangedInfo;i.oldValue=c,i.newValue=d,i.propertyName=e;var j=g.flagId;if(this.propertyChanged.notifyObservers(i,j),this instanceof a.Group2D&&this.handleGroupChanged(g),this instanceof a.Prim2DBase){var k=this._parent;null!=k&&k.layoutEngine&&0!==(k.layoutEngine.layoutDirtyOnPropertyChangedMask&g.flagId)&&k._setLayoutDirty()}var l=!1;if(h&&null!=c&&null!=d){var m=c.__proto__,n=d.__proto__;l=m===n}l||g.kind!==f.PROPKIND_MODEL?(l||g.kind===f.PROPKIND_INSTANCE||g.kind===f.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(j):this.onPrimitivePropertyDirty(b.flagModelDirty)},b.prototype.onPrimitivePropertyDirty=function(a){this.isDirty||this.onPrimBecomesDirty(),this._instanceDirtyFlags|=a},b.prototype.handleGroupChanged=function(a){},b.prototype.checkPropertiesDirty=function(a){return 0!==(this._instanceDirtyFlags&a)},b.prototype.clearPropertiesDirty=function(a){return this._instanceDirtyFlags&=~a,this._instanceDirtyFlags},b.prototype._resetPropertiesDirty=function(){this._instanceDirtyFlags=0},Object.defineProperty(b.prototype,"levelBoundingInfo",{get:function(){return this._isFlagSet(b.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(b.flagLevelBoundingInfoDirty)),this._levelBoundingInfo},enumerable:!0,configurable:!0}),b.prototype.updateLevelBoundingInfo=function(){},b.prototype.onPrimBecomesDirty=function(){},b._hookProperty=function(a,c,d,e,f){return function(g,h,i){var j=b._createPropInfo(g,h,a,e,d,f);c&&c(j);var k=i.get,l=i.set;i.set=function(a){if(!this.isDisposed){var c=k.call(this);if(!b._checkUnchanged(c,a)){var e=this;l.call(this,a),e._handlePropChanged(c,a,h,j,d)}}}}},b.prototype.addExternalData=function(b,c){return this._externalData||(this._externalData=new a.StringDictionary),this._externalData.add(b,c)},b.prototype.getExternalData=function(a){return this._externalData?this._externalData.get(a):null},b.prototype.getOrAddExternalDataWithFactory=function(b,c){return this._externalData||(this._externalData=new a.StringDictionary),this._externalData.getOrAddWithFactory(b,c)},b.prototype.removeExternalData=function(a){return this._externalData?this._externalData.remove(a):!1},b.prototype._isFlagSet=function(a){return 0!==(this._flags&a)},b.prototype._areAllFlagsSet=function(a){return(this._flags&a)===a},b.prototype._areSomeFlagsSet=function(a){return 0!==(this._flags&a)},b.prototype._clearFlags=function(a){this._flags&=~a},b.prototype._setFlags=function(a){var b=this._flags;return this._flags|=a,b},b.prototype._changeFlags=function(a,b){b?this._flags|=a:this._flags&=~a},b.propChangedInfo=new g,b.flagIsDisposed=1,b.flagLevelBoundingInfoDirty=2,b.flagModelDirty=4,b.flagLayoutDirty=8,b.flagLevelVisible=16,b.flagBoundingInfoDirty=32,b.flagIsPickable=64,b.flagIsVisible=128,b.flagVisibilityChanged=256,b.flagPositioningDirty=512,b.flagTrackedGroup=1024,b=__decorate([a.className("SmartPropertyPrim")],b)}();a.SmartPropertyPrim=i,a.modelLevelProperty=b,a.instanceLevelProperty=c,a.dynamicLevelProperty=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this.forceRefreshPrimitive=!1}return a}();a.PrepareRender2DContext=b;var c=function(){function a(a){this._renderMode=a,this.useInstancing=!1,this.groupInfoPartData=null,this.partDataStartIndex=this.partDataEndIndex=null}return Object.defineProperty(a.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RenderModeOpaque",{get:function(){return a._renderModeOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RenderModeAlphaTest",{get:function(){return a._renderModeAlphaTest},enumerable:!0,configurable:!0}),Object.defineProperty(a,"RenderModeTransparent",{get:function(){return a._renderModeTransparent},enumerable:!0,configurable:!0}),a._renderModeOpaque=1,a._renderModeAlphaTest=2,a._renderModeTransparent=3,a}();a.Render2DContext=c;var d=function(){function b(){this.primitivePointerPos=a.Vector2.Zero(),this.tilt=a.Vector2.Zero(),this.cancelBubble=!1}return Object.defineProperty(b,"PointerOver",{get:function(){return b._pointerOver},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerEnter",{get:function(){return b._pointerEnter},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerDown",{get:function(){return b._pointerDown},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerMouseWheel",{get:function(){return b._pointerMouseWheel},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerMove",{get:function(){return b._pointerMove},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerUp",{get:function(){return b._pointerUp},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerOut",{get:function(){return b._pointerOut},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerLeave",{get:function(){return b._pointerLeave},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerGotCapture",{get:function(){return b._pointerGotCapture},enumerable:!0,configurable:!0}),Object.defineProperty(b,"PointerLostCapture",{get:function(){return b._pointerLostCapture},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MouseWheelPrecision",{get:function(){return b._mouseWheelPrecision},enumerable:!0,configurable:!0}),b.prototype.updateRelatedTarget=function(a,b){this.relatedTarget=a,this.relatedTargetPointerPos=b},b.getEventTypeName=function(a){switch(a){case b.PointerOver:return"PointerOver";case b.PointerEnter:return"PointerEnter";case b.PointerDown:return"PointerDown";case b.PointerMouseWheel:return"PointerMouseWheel";case b.PointerMove:return"PointerMove";case b.PointerUp:return"PointerUp";case b.PointerOut:return"PointerOut";case b.PointerLeave:return"PointerLeave";case b.PointerGotCapture:return"PointerGotCapture";case b.PointerLostCapture:return"PointerLostCapture"}},b._pointerOver=1,b._pointerEnter=2,b._pointerDown=4,b._pointerMouseWheel=8,b._pointerMove=16,b._pointerUp=32,b._pointerOut=64,b._pointerLeave=128,b._pointerGotCapture=256,b._pointerLostCapture=512,b._mouseWheelPrecision=3,b}();a.PrimitivePointerInfo=d;var e=function(){function a(b){this._changedCallback=b,this._horizontal=a.AlignLeft,this._vertical=a.AlignBottom}return Object.defineProperty(a,"AlignLeft",{get:function(){return a._AlignLeft},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AlignTop",{get:function(){return a._AlignTop},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AlignRight",{get:function(){return a._AlignRight},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AlignBottom",{get:function(){return a._AlignBottom},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AlignCenter",{get:function(){return a._AlignCenter},enumerable:!0,configurable:!0}),Object.defineProperty(a,"AlignStretch",{get:function(){return a._AlignStretch},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"horizontal",{get:function(){return this._horizontal},set:function(a){this._horizontal!==a&&(this._horizontal=a,this._changedCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"vertical",{get:function(){return this._vertical},set:function(a){this._vertical!==a&&(this._vertical=a,this._changedCallback())},enumerable:!0,configurable:!0}),a.prototype.setHorizontal=function(b){var c=b.trim().toLocaleLowerCase();switch(c){case"left":return void(this.horizontal=a.AlignLeft);case"right":return void(this.horizontal=a.AlignRight);case"center":return void(this.horizontal=a.AlignCenter);case"stretch":return void(this.horizontal=a.AlignStretch)}},a.prototype.setVertical=function(b){var c=b.trim().toLocaleLowerCase();switch(c){case"top":return void(this.vertical=a.AlignTop);case"bottom":return void(this.vertical=a.AlignBottom);case"center":return void(this.vertical=a.AlignCenter);case"stretch":return void(this.vertical=a.AlignStretch)}},a.prototype.fromString=function(a){for(var b=a.trim().split(","),c=0;c<b.length;c++){var d=b[c];d=d.toLocaleLowerCase().trim();var e=d.indexOf("h:");-1===e&&(e=d.indexOf("horizontal:")),-1===e?(e=d.indexOf("v:"),-1===e&&(e=d.indexOf("vertical:")),-1===e||(d=d.substr(d.indexOf(":")+1),this.setVertical(d))):(d=d.substr(d.indexOf(":")+1),this.setHorizontal(d))}},a._AlignLeft=1,a._AlignTop=1,a._AlignRight=2,a._AlignBottom=2,a._AlignCenter=3,a._AlignStretch=4,a}();a.PrimitiveAlignment=e;var f=function(){function a(a,b){this.prim=a,this.intersectionLocation=b}return a}();a.PrimitiveIntersectedInfo=f;var g=function(){function a(b,c){this._parentAccess=b,this._changedCallback=c,this._pixels=new Array(4),this._percentages=new Array(4),this._setType(0,a.Auto),this._setType(1,a.Auto),this._setType(2,a.Auto),this._setType(3,a.Auto),this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0}return a.prototype.fromString=function(b){this._clear();for(var c=b.trim().split(","),d=!1,e=0;e<c.length;e++){var f=c[e];d=this._extractString(f,!1)||d}if(!d)throw new Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=a.Pixel<<0),0===(240&this._flags)&&(this._flags|=a.Pixel<<4),0===(3840&this._flags)&&(this._flags|=a.Pixel<<8),0===(61440&this._flags)&&(this._flags|=a.Pixel<<12),this._changedCallback()},a.prototype.fromStrings=function(a,b,c,d){return this._clear(),this._setStringValue(a,0,!1),this._setStringValue(b,1,!1),
this._setStringValue(c,2,!1),this._setStringValue(d,3,!1),this._changedCallback(),this},a.prototype.fromPixels=function(a,b,c,d){return this._clear(),this._pixels[0]=a,this._pixels[1]=b,this._pixels[2]=c,this._pixels[3]=d,this._changedCallback(),this},a.prototype.fromUniformPixels=function(a){return this._clear(),this._pixels[0]=a,this._pixels[1]=a,this._pixels[2]=a,this._pixels[3]=a,this._changedCallback(),this},a.prototype.auto=function(){return this._clear(),this._flags=a.Auto<<0|a.Auto<<4|a.Auto<<8|a.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this},a.prototype._clear=function(){this._flags=0,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._percentages[0]=null,this._percentages[1]=null,this._percentages[2]=null,this._percentages[3]=null},a.prototype._extractString=function(a,b){var c=a.trim().toLocaleLowerCase();return 0===c.indexOf("top:")?(c=c.substr(4).trim(),this._setStringValue(c,0,b)):0===c.indexOf("left:")?(c=c.substr(5).trim(),this._setStringValue(c,1,b)):0===c.indexOf("right:")?(c=c.substr(6).trim(),this._setStringValue(c,2,b)):0===c.indexOf("bottom:")?(c=c.substr(7).trim(),this._setStringValue(c,3,b)):!1},a.prototype._setStringValue=function(b,c,d){var e=b.trim().toLocaleLowerCase();if("auto"===e){if(this._isType(c,a.Auto))return!0;this._setType(c,a.Auto),this._pixels[c]=0,d&&this._changedCallback()}else{if("inherit"!==e){var f=e.indexOf("%");if(-1!==f){var g=e.substr(0,f),h=Math.round(Number(g))/100;return this._isType(c,a.Percentage)&&this._percentages[c]===h?!0:(this._setType(c,a.Percentage),isNaN(h)?!1:(this._percentages[c]=h,d&&this._changedCallback(),!0))}var i;f=e.indexOf("px"),i=-1!==f?e.substr(0,f).trim():e;var j=Number(i);return this._isType(c,a.Pixel)&&this._pixels[c]===j?!0:isNaN(j)?!1:(this._pixels[c]=j,this._setType(c,a.Pixel),d&&this._changedCallback(),!0)}if(this._isType(c,a.Inherit))return!0;this._setType(c,a.Inherit),this._pixels[c]=null,d&&this._changedCallback()}},a.prototype._setPixels=function(b,c,d){b=Math.round(b),this._isType(c,a.Pixel)&&this._pixels[c]===b||(this._setType(c,a.Pixel),this._pixels[c]=b,d&&this._changedCallback())},a.prototype._setPercentage=function(b,c,d){b=Math.min(1,b),b=Math.max(0,b),b=Math.round(100*b)/100,this._isType(c,a.Percentage)&&this._percentages[c]===b||(this._setType(c,a.Percentage),this._percentages[c]=b,d&&this._changedCallback())},a.prototype._getStringValue=function(b){var c=this._flags>>4*b&15;switch(c){case a.Auto:return"auto";case a.Pixel:return this._pixels[b]+"px";case a.Percentage:return 100*this._percentages[b]+"%";case a.Inherit:return"inherit"}return""},a.prototype._isType=function(a,b){var c=this._flags>>4*a&15;return c===b},a.prototype._getType=function(b,c){var d=this._flags>>4*b&15;if(c&&d===a.Inherit){var e=this._parentAccess();return e?e._getType(b,!0):a.Auto}return d},a.prototype._setType=function(a,b){this._flags&=~(15<<4*a),this._flags|=b<<4*a},a.prototype.setTop=function(a){"string"==typeof a?this._setStringValue(a,0,!0):this.topPixels=a},a.prototype.setLeft=function(a){"string"==typeof a?this._setStringValue(a,1,!0):this.leftPixels=a},a.prototype.setRight=function(a){"string"==typeof a?this._setStringValue(a,2,!0):this.rightPixels=a},a.prototype.setBottom=function(a){"string"==typeof a?this._setStringValue(a,3,!0):this.bottomPixels=a},Object.defineProperty(a.prototype,"top",{get:function(){return this._getStringValue(0)},set:function(a){this._setStringValue(a,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"left",{get:function(){return this._getStringValue(1)},set:function(a){this._setStringValue(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){return this._getStringValue(2)},set:function(a){this._setStringValue(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottom",{get:function(){return this._getStringValue(3)},set:function(a){this._setStringValue(a,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"topPixels",{get:function(){return this._pixels[0]},set:function(a){this._setPixels(a,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"leftPixels",{get:function(){return this._pixels[1]},set:function(a){this._setPixels(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightPixels",{get:function(){return this._pixels[2]},set:function(a){this._setPixels(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottomPixels",{get:function(){return this._pixels[3]},set:function(a){this._setPixels(a,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"topPercentage",{get:function(){return this._percentages[0]},set:function(a){this._setPercentage(a,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"leftPercentage",{get:function(){return this._percentages[1]},set:function(a){this._setPercentage(a,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightPercentage",{get:function(){return this._percentages[2]},set:function(a){this._setPercentage(a,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottomPercentage",{get:function(){return this._percentages[3]},set:function(a){this._setPercentage(a,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"topMode",{get:function(){return this._getType(0,!1)},set:function(a){this._setType(0,a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"leftMode",{get:function(){return this._getType(1,!1)},set:function(a){this._setType(1,a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightMode",{get:function(){return this._getType(2,!1)},set:function(a){this._setType(2,a)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bottomMode",{get:function(){return this._getType(3,!1)},set:function(a){this._setType(3,a)},enumerable:!0,configurable:!0}),a.prototype._computePixels=function(b,c,d){var e=this._getType(b,!1);if(e===a.Inherit)return void this._parentAccess()._computePixels(b,c,d);if(e===a.Percentage){var f=(0===b||3===b?c.height:c.width)*this._percentages[b];this._pixels[b]=f,d&&this._changedCallback()}},a.prototype.computeWithAlignment=function(b,c,d,f,g){var h=this._getType(0,!0),i=this._getType(1,!0),j=this._getType(2,!0),k=this._getType(3,!0),l=c&&null!=c.width,m=c&&null!=c.height,n=l?c.width:0,o=m?c.height:0,p=h===a.Auto,q=i===a.Auto,r=j===a.Auto,s=k===a.Auto;switch(d.horizontal){case e.AlignLeft:q?f.x=0:(this._computePixels(1,b,!0),f.x=this.leftPixels),g.width=n;break;case e.AlignRight:r?f.x=Math.round(b.width-n):(this._computePixels(2,b,!0),f.x=Math.round(b.width-(n+this.rightPixels))),g.width=n;break;case e.AlignStretch:q?f.x=0:(this._computePixels(1,b,!0),f.x=this.leftPixels);var t=0;r||(this._computePixels(2,b,!0),t=this.rightPixels),g.width=b.width-(f.x+t);break;case e.AlignCenter:q||this._computePixels(1,b,!0),r||this._computePixels(2,b,!0);var u=(q?0:this.leftPixels)-(r?0:this.rightPixels);f.x=Math.round((b.width-n)/2+u),g.width=n}switch(d.vertical){case e.AlignTop:p?f.y=b.height-o:(this._computePixels(0,b,!0),f.y=Math.round(b.height-(o+this.topPixels))),g.height=o;break;case e.AlignBottom:s?f.y=0:(this._computePixels(3,b,!0),f.y=this.bottomPixels),g.height=o;break;case e.AlignStretch:s?f.y=0:(this._computePixels(3,b,!0),f.y=this.bottomPixels);var v=0;p||(this._computePixels(0,b,!0),v=this.topPixels),g.height=b.height-(f.y+v);break;case e.AlignCenter:p||this._computePixels(0,b,!0),s||this._computePixels(3,b,!0);var u=(s?0:this.bottomPixels)-(p?0:this.topPixels);f.y=Math.round((b.height-o)/2+u),g.height=o}},a.prototype.compute=function(a,b,c){this._computePixels(0,a,!0),this._computePixels(1,a,!0),this._computePixels(2,a,!0),this._computePixels(3,a,!0),b.x=this.leftPixels,c.width=a.width-(b.x+this.rightPixels),b.y=this.bottomPixels,c.height=a.height-(b.y+this.topPixels)},a.prototype.computeArea=function(a,b){this._computePixels(0,a,!0),this._computePixels(1,a,!0),this._computePixels(2,a,!0),this._computePixels(3,a,!0),b.width=this.leftPixels+a.width+this.rightPixels,b.height=this.bottomPixels+a.height+this.topPixels},a.Auto=1,a.Inherit=2,a.Percentage=4,a.Pixel=8,a}();a.PrimitiveThickness=g;var h=function(){function b(){this.findFirstOnly=!1,this.intersectHidden=!1,this.pickPosition=a.Vector2.Zero()}return Object.defineProperty(b.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&this.intersectedPrimitives.length>0},enumerable:!0,configurable:!0}),b.prototype.isPrimIntersected=function(a){for(var b=0,c=this.intersectedPrimitives;b<c.length;b++){var d=c[b];if(d.prim===a)return d.intersectionLocation}return null},b.prototype._exit=function(a){a&&(this._globalPickPosition=null)},b}();a.IntersectInfo2D=h;var i=function(b){function c(d){null==d&&(d={}),b.call(this);var e,f;if(c._isCanvasInit)e=this,f=null,this._canvasPreInit(d);else if(null!=d.parent){if(f=d.parent,e=d.parent.owner,!e)throw new Error("Parent "+f.id+" of "+d.id+" doesn't have a valid owner!");if(!(this instanceof a.Group2D||this instanceof a.Sprite2D&&null!==d.id&&0===d.id.indexOf("__cachedSpriteOfGroup__")||e.cachingStrategy!==a.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||f!==e))throw new Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive")}if(this._layoutEngine=a.CanvasLayoutEngine.Singleton,this._size=null,this._actualSize=null,this._boundingSize=null,this._layoutArea=a.Size.Zero(),this._layoutAreaPos=a.Vector2.Zero(),this._marginOffset=a.Vector2.Zero(),this._parentMargingOffset=a.Vector2.Zero(),this._parentContentArea=a.Size.Zero(),this._contentArea=new a.Size(null,null),this._pointerEventObservable=new a.Observable,this._siblingDepthOffset=this._hierarchyDepthOffset=0,this._boundingInfo=new a.BoundingInfo2D,this._owner=e,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=d.id,this.propertyChanged=new a.Observable,this._children=new Array,this._localTransform=new a.Matrix,this._globalTransform=null,this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._hierarchyDepth=0,this._renderGroup=null,this._setFlags(a.SmartPropertyPrim.flagIsPickable|a.SmartPropertyPrim.flagBoundingInfoDirty),null!=f&&(f.addChild(this),this._patchHierarchy(f.owner)),this.owner&&this instanceof a.Group2D){var g=this;g.detectGroupStates()}if(null!=d.children)for(var h=0,i=d.children;h<i.length;h++){var j=i[h];this.addChild(j),j._patchHierarchy(this.owner)}if(null!=d.position?this.position=d.position:null!=d.x||null!=d.y?this.position=new a.Vector2(d.x||0,d.y||0):this._position=null,this.rotation=null==d.rotation?0:d.rotation,this.scale=null==d.scale?1:d.scale,this.levelVisible=null==d.isVisible?!0:d.isVisible,this.origin=d.origin||new a.Vector2(.5,.5),null!=d.layoutEngine)if("string"==typeof d.layoutEngine){var k=d.layoutEngine.toLocaleLowerCase().trim();"canvas"===k||"canvaslayoutengine"===k?this.layoutEngine=a.CanvasLayoutEngine.Singleton:0===k.indexOf("stackpanel")||0===k.indexOf("horizontalstackpanel")?this.layoutEngine=a.StackPanelLayoutEngine.Horizontal:0===k.indexOf("verticalstackpanel")&&(this.layoutEngine=a.StackPanelLayoutEngine.Vertical)}else d.layoutEngine instanceof a.LayoutEngineBase&&(this.layoutEngine=d.layoutEngine);d.marginTop&&this.margin.setTop(d.marginTop),d.marginLeft&&this.margin.setLeft(d.marginLeft),d.marginRight&&this.margin.setRight(d.marginRight),d.marginBottom&&this.margin.setBottom(d.marginBottom),d.margin&&("string"==typeof d.margin?this.margin.fromString(d.margin):this.margin.fromUniformPixels(d.margin)),d.marginHAlignment&&(this.marginAlignment.horizontal=d.marginHAlignment),d.marginVAlignment&&(this.marginAlignment.vertical=d.marginVAlignment),d.marginAlignment&&this.marginAlignment.fromString(d.marginAlignment),d.paddingTop&&this.padding.setTop(d.paddingTop),d.paddingLeft&&this.padding.setLeft(d.paddingLeft),d.paddingRight&&this.padding.setRight(d.paddingRight),d.paddingBottom&&this.padding.setBottom(d.paddingBottom),d.padding&&this.padding.fromString(d.padding),this._parentLayoutDirty(),this._positioningDirty()}return __extends(c,b),Object.defineProperty(c.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new a.ActionManager(this.owner.scene)),this._actionManager},enumerable:!0,configurable:!0}),c.prototype.traverseUp=function(a){for(var b=this;null!=b;){if(a(b))return b;b=b._parent}return null},Object.defineProperty(c.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualPosition",{get:function(){return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:c._nullPosition},set:function(a){this._actualPosition=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualX",{get:function(){return this.actualPosition.x},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualY",{get:function(){return this.actualPosition.y},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"position",{get:function(){return this._position},set:function(a){this._checkPositionChange()&&(this._position=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"x",{get:function(){return this._position?this._position.x:null},set:function(b){this._checkPositionChange()&&(this._position||(this._position=a.Vector2.Zero()),this._position.x!==b&&(this._position.x=b,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"y",{get:function(){return this._position?this._position.y:null},set:function(b){this._checkPositionChange()&&(this._position||(this._position=a.Vector2.Zero()),this._position.y!==b&&(this._position.y=b,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"size",{get:function(){return this._size&&null!=this._size.width&&null!=this._size.height?this._size:c.boundinbBoxReentrency?c.nullSize:this._boundingSize?this._boundingSize:(c.boundinbBoxReentrency=!0,this.boundingInfo,c.boundinbBoxReentrency=!1,this._boundingSize)},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this.size?this.size.width:null},set:function(b){return this.size?void(this.size.width!==b&&(this.size.width=b,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new a.Size(b,0))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.size?this.size.height:null},set:function(b){return this.size?void(this.size.height!==b&&(this.size.height=b,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new a.Size(0,b))},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"rotation",{get:function(){return this._rotation},set:function(a){this._rotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"scale",{get:function(){return this._scale},set:function(a){this._scale=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this._size},set:function(a){this._actualSize.equals(a)||(this._actualSize=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"actualZOffset",{get:function(){return this._zOrder||1-this._hierarchyDepthOffset},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"minSize",{get:function(){return this._minSize},set:function(a){this._minSize&&a&&this._minSize.equals(a)||(this._minSize=a,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"maxSize",{get:function(){return this._maxSize},set:function(a){this._maxSize&&a&&this._maxSize.equals(a)||(this._maxSize=a,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"origin",{get:function(){return this._origin},set:function(a){this._origin=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"levelVisible",{get:function(){return this._isFlagSet(a.SmartPropertyPrim.flagLevelVisible)},set:function(b){this._changeFlags(a.SmartPropertyPrim.flagLevelVisible,b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isVisible",{get:function(){return this._isFlagSet(a.SmartPropertyPrim.flagIsVisible)},set:function(b){this._changeFlags(a.SmartPropertyPrim.flagIsVisible,b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"zOrder",{get:function(){return this._zOrder},set:function(a){this._zOrder=a,this.onZOrderChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"margin",{get:function(){var a=this;return this._margin||(this._margin=new g(function(){return a.parent?a.parent.margin:null},function(){return a._positioningDirty()})),this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_hasMargin",{get:function(){return null!==this._margin||null!==this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"padding",{get:function(){var a=this;return this._padding||(this._padding=new g(function(){return a.parent?a.parent.padding:null},function(){return a._positioningDirty()})),this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_hasPadding",{get:function(){return null!==this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"marginAlignment",{get:function(){var a=this;return this._marginAlignment||(this._marginAlignment=new e(function(){return a._positioningDirty()})),this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=a.CanvasLayoutEngine.Singleton),this._layoutEngine},set:function(a){this._layoutEngine!==a&&this._changeLayoutEngine(a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"layoutArea",{get:function(){return this._layoutArea},set:function(a){this._layoutArea.equals(a)||(this._positioningDirty(),this._layoutArea=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"layoutAreaPos",{get:function(){return this._layoutAreaPos},set:function(a){this._layoutAreaPos.equals(a)||(this._positioningDirty(),this._layoutAreaPos=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isPickable",{get:function(){return this._isFlagSet(a.SmartPropertyPrim.flagIsPickable)},set:function(b){this._changeFlags(a.SmartPropertyPrim.flagIsPickable,b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"hierarchyDepth",{get:function(){return this._hierarchyDepth},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"globalTransform",{get:function(){return this._globalTransform},enumerable:!0,configurable:!0}),c.prototype.getGlobalPosition=function(){var b=new a.Vector2(0,0);return this.getGlobalPositionByRef(b),b},c.prototype.getGlobalPositionByRef=function(a){a.x=this.globalTransform.m[12],a.y=this.globalTransform.m[13]},Object.defineProperty(c.prototype,"invGlobalTransform",{get:function(){return this._invGlobalTransform},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"localTransform",{get:function(){return this._updateLocalTransform(),this._localTransform},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"boundingInfo",{get:function(){if(this._isFlagSet(a.SmartPropertyPrim.flagBoundingInfoDirty)){this._boundingInfo=this.levelBoundingInfo.clone();for(var b=this._boundingInfo,c=new a.BoundingInfo2D,d=0,e=this._children;d<e.length;d++){var f=e[d];f.boundingInfo.transformToRef(f.localTransform,c),b.unionToRef(c,b)}this._boundingSize=a.Size.Zero();var g=this._boundingInfo.max();this._boundingSize=new a.Size(this._size&&null!=this._size.width?this._size.width:Math.ceil(g.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(g.y)),this._clearFlags(a.SmartPropertyPrim.flagBoundingInfoDirty)}return this._boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isSizeAuto",{get:function(){return null==this._size},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isPositionAuto",{get:function(){return null==this._position},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable},enumerable:!0,configurable:!0}),c.prototype.findById=function(a){if(this._id===a)return this;for(var b=0,c=this._children;b<c.length;b++){var d=c[b],e=d.findById(a);if(null!=e)return e}},c.prototype.onZOrderChanged=function(){},c.prototype.levelIntersect=function(a){return!1},c.prototype.setPointerEventCapture=function(a){return this.owner._setPointerCapture(a,this)},c.prototype.releasePointerEventsCapture=function(a){return this.owner._releasePointerCapture(a,this)},c.prototype.intersect=function(b){if(!b)return!1;var c=!b._globalPickPosition;if(c&&(b._globalPickPosition=a.Vector2.Zero(),a.Vector2.TransformToRef(b.pickPosition,this.globalTransform,b._globalPickPosition),b._localPickPosition=b.pickPosition.clone(),b.intersectedPrimitives=new Array,b.topMostIntersectedPrimitive=null),!b.intersectHidden&&!this.isVisible)return!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(b._localPickPosition))return b._exit(c),!1;var d=!1;if(this.isPickable&&(d=this.levelIntersect(b))){var e=new f(this,b._localPickPosition.clone());if(b.intersectedPrimitives.push(e),(!b.topMostIntersectedPrimitive||b.topMostIntersectedPrimitive.prim.actualZOffset>e.prim.actualZOffset)&&(b.topMostIntersectedPrimitive=e),b.findFirstOnly)return b._exit(c),!0}if(!d||!b.findFirstOnly)for(var g=0,h=this._children;g<h.length;g++){var i=h[g];if(i.isPickable&&(b.intersectHidden||i.isVisible)&&(a.Vector2.TransformToRef(b._globalPickPosition,i.invGlobalTransform,b._localPickPosition),i.intersect(b)&&b.findFirstOnly))return b._exit(c),!0}return b._exit(c),b.isIntersected},c.prototype.moveChild=function(a,b){if(a.parent!==this)return!1;var c,d,e=this._children.indexOf(a),f=b?this._children.indexOf(b):-1;b?(c=this._children[f]._siblingDepthOffset,d=this._children[f+1]._siblingDepthOffset):(c=1,d=this._children[1]._siblingDepthOffset),a._siblingDepthOffset=(d-c)/2,this._children.splice(f+1,0,this._children.splice(e,1)[0])},c.prototype.addChild=function(a){a._parent=this,this._boundingBoxDirty(),this._patchHierarchyDepth(a),this._children.push(a)},c.prototype.dispose=function(){if(!b.prototype.dispose.call(this))return!1;if(this._actionManager&&(this._actionManager.dispose(),this._actionManager=null),this._parent){var a=this._parent._children.indexOf(this);void 0!==a&&this._parent._children.splice(a,1),this._parent=null}if(this._children)for(;this._children.length>0;)this._children[this._children.length-1].dispose();return!0},c.prototype.onPrimBecomesDirty=function(){this._renderGroup&&this._renderGroup._addPrimToDirtyList(this)},c.prototype._needPrepare=function(){return this._areSomeFlagsSet(a.SmartPropertyPrim.flagVisibilityChanged|a.SmartPropertyPrim.flagModelDirty)||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep},c.prototype._prepareRender=function(a){this._prepareRenderPre(a),this._prepareRenderPost(a)},c.prototype._prepareRenderPre=function(a){},c.prototype._prepareRenderPost=function(b){if(this instanceof a.Group2D){var d=this;if(d.isRenderableGroup)return}this._children.length>0&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(c.isVisibleProperty.flagId))&&this._children.forEach(function(c){c instanceof a.Group2D&&c.isRenderableGroup||c._prepareRender(b)}),this._clearFlags(a.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0},c.prototype._canvasPreInit=function(a){},c.CheckParent=function(a){},c.prototype.updateCachedStatesOf=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.updateCachedStates(b)}},c.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty()},c.prototype._setLayoutDirty=function(){this.isDirty||this.onPrimBecomesDirty(),this._setFlags(a.SmartPropertyPrim.flagLayoutDirty)},c.prototype._checkPositionChange=function(){return this.parent&&this.parent.layoutEngine.isChildPositionAllowed===!1?(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1):!0},c.prototype._positioningDirty=function(){this.isDirty||this.onPrimBecomesDirty(),this._setFlags(a.SmartPropertyPrim.flagPositioningDirty)},c.prototype._changeLayoutEngine=function(a){this._layoutEngine=a},c.prototype._updateLocalTransform=function(){var b=!1,d=null;this._parent?(d=this._parent._marginOffset,b=!d.equals(this._parentMargingOffset),this._parentMargingOffset.copyFrom(d)):d=c._v0;var e=c.actualPositionProperty.flagId|c.rotationProperty.flagId|c.scaleProperty.flagId|c.originProperty.flagId;if(b||this.checkPropertiesDirty(e)){var f,g=a.Quaternion.RotationAxis(new a.Vector3(0,0,1),this._rotation);if(0===this._origin.x&&0===this._origin.y)f=a.Matrix.Compose(new a.Vector3(this._scale,this._scale,1),g,new a.Vector3(this.actualPosition.x+d.x,this.actualPosition.y+d.y,0)),this._localTransform=f;else{var h=this.actualSize;a.Matrix.TranslationToRef(-h.width*this._origin.x,-h.height*this._origin.y,0,c._t0),g.toRotationMatrix(c._t1),c._t0.multiplyToRef(c._t1,c._t2),a.Matrix.ScalingToRef(this._scale,this._scale,1,c._t0),c._t2.multiplyToRef(c._t0,c._t1),a.Matrix.TranslationToRef(h.width*this._origin.x+this.actualPosition.x+d.x,h.height*this._origin.y+this.actualPosition.y+d.y,0,c._t2),c._t1.multiplyToRef(c._t2,this._localTransform)}return this.clearPropertiesDirty(e),!0}return!1},c.prototype.updateCachedStates=function(b){if(!this.isDisposed){this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(a.SmartPropertyPrim.flagLayoutDirty|a.SmartPropertyPrim.flagPositioningDirty))&&this._parent.updateCachedStates(!1);var d=this.checkPropertiesDirty(c.sizeProperty.flagId);if(!this._isFlagSet(a.SmartPropertyPrim.flagLayoutDirty)&&d){var e=this.size;e&&(null!=this.size.width&&(this.actualSize.width=this.size.width),null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(c.sizeProperty.flagId))}var f=this._isFlagSet(a.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(a.SmartPropertyPrim.flagLayoutDirty)&&(this._layoutEngine.updateLayout(this),this._clearFlags(a.SmartPropertyPrim.flagLayoutDirty));var g=f&&!this._isFlagSet(a.SmartPropertyPrim.flagPositioningDirty);if(!g&&(d||this._isFlagSet(a.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&(this._updatePositioning(),this._clearFlags(a.SmartPropertyPrim.flagPositioningDirty),g=!0),g&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){var h=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible,this._changeFlags(a.SmartPropertyPrim.flagVisibilityChanged,h!==this.isVisible);var i=this._updateLocalTransform(),j=null!=this._parent?this._parent._globalTransformStep!==this._parentTransformStep:!1;if(!this._globalTransform||i||j){var k=this._parent?this._parent._globalTransform:null;this._globalTransform=this._parent?this._localTransform.multiply(k):this._localTransform,this._invGlobalTransform=a.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0}this._globalTransformProcessStep=this.owner._globalTransformProcessStep}if(b)for(var l=0,m=this._children;l<m.length;l++){var n=m[l];n.updateCachedStates(!(n instanceof a.Group2D&&n.isRenderableGroup))}}},c.prototype._updatePositioning=function(){this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=e.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=e.AlignStretch)),this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size,this.marginAlignment,this._marginOffset,c._size),this.actualPosition=this._marginOffset.add(this._layoutAreaPos),null!=this.size.width&&(this.size.width=c._size.width),null!=this.size.height&&(this.size.height=c._size.height),this.actualSize.copyFrom(c._size.clone())),this._hasPadding?(this._getInitialContentAreaToRef(this.actualSize,c._icPos,c._icArea),c._icArea.width=Math.max(0,c._icArea.width),c._icArea.height=Math.max(0,c._icArea.height),this.padding.compute(c._icArea,this._marginOffset,c._size),this._marginOffset.x+=c._icPos.x,this._marginOffset.y+=c._icPos.y,this._contentArea.copyFrom(c._size)):(this._getInitialContentAreaToRef(this.actualSize,c._icPos,c._icArea),c._icArea.width=Math.max(0,c._icArea.width),c._icArea.height=Math.max(0,c._icArea.height),this._marginOffset.copyFrom(c._icPos),this._contentArea.copyFrom(c._icArea))},Object.defineProperty(c.prototype,"contentArea",{get:function(){return this._isFlagSet(a.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(a.SmartPropertyPrim.flagPositioningDirty)),this._contentArea},enumerable:!0,configurable:!0}),c.prototype._patchHierarchy=function(b){if(this._owner=b,null==this._renderGroup){if(this instanceof a.Group2D){var c=this;c.detectGroupStates(),c._trackedNode&&!c._isFlagSet(a.SmartPropertyPrim.flagTrackedGroup)&&c.owner._registerTrackedNode(this)}if(this._parent&&(this._renderGroup=this.parent.traverseUp(function(b){return b instanceof a.Group2D&&b.isRenderableGroup}),this._parentLayoutDirty()),this._renderGroup&&this.isDirty){var d=this._renderGroup._renderableData._primDirtyList,e=d.indexOf(this);-1===e&&d.push(this)}for(var f=0,g=this._children;f<g.length;f++){var h=g[f];this._patchHierarchyDepth(h),h._patchHierarchy(b)}}},c.prototype._patchHierarchyDepth=function(b){b._hierarchyDepth=this._hierarchyDepth+1,b._hierarchyDepthOffset=this._hierarchyDepthOffset+(this._children.length+1)*this._siblingDepthOffset,b._siblingDepthOffset=this._siblingDepthOffset/a.Canvas2D.hierarchyLevelMaxSiblingCount},c.prototype._getInitialContentAreaToRef=function(a,b,c){c.width=a.width,c.height=a.height,b.x=b.y=0},c.PRIM2DBASE_PROPCOUNT=15,c._nullPosition=a.Vector2.Zero(),c.boundinbBoxReentrency=!1,c.nullSize=a.Size.Zero(),c._isCanvasInit=!1,c._t0=new a.Matrix,c._t1=new a.Matrix,c._t2=new a.Matrix,c._v0=a.Vector2.Zero(),c._icPos=a.Vector2.Zero(),c._icArea=a.Size.Zero(),c._size=a.Size.Zero(),__decorate([a.instanceLevelProperty(1,function(a){return c.actualPositionProperty=a},!1,!0)],c.prototype,"actualPosition",null),__decorate([a.dynamicLevelProperty(1,function(a){return c.positionProperty=a},!1,!0)],c.prototype,"position",null),__decorate([a.dynamicLevelProperty(2,function(a){return c.sizeProperty=a},!1,!0)],c.prototype,"size",null),__decorate([a.instanceLevelProperty(3,function(a){return c.rotationProperty=a},!1,!0)],c.prototype,"rotation",null),__decorate([a.instanceLevelProperty(4,function(a){return c.scaleProperty=a},!1,!0)],c.prototype,"scale",null),__decorate([a.dynamicLevelProperty(5,function(a){return c.originProperty=a},!1,!0)],c.prototype,"origin",null),
__decorate([a.dynamicLevelProperty(6,function(a){return c.levelVisibleProperty=a})],c.prototype,"levelVisible",null),__decorate([a.instanceLevelProperty(7,function(a){return c.isVisibleProperty=a})],c.prototype,"isVisible",null),__decorate([a.instanceLevelProperty(8,function(a){return c.zOrderProperty=a})],c.prototype,"zOrder",null),__decorate([a.dynamicLevelProperty(9,function(a){return c.marginProperty=a})],c.prototype,"margin",null),__decorate([a.dynamicLevelProperty(10,function(a){return c.paddingProperty=a})],c.prototype,"padding",null),__decorate([a.dynamicLevelProperty(11,function(a){return c.marginAlignmentProperty=a})],c.prototype,"marginAlignment",null),c=__decorate([a.className("Prim2DBase")],c)}(a.SmartPropertyPrim);a.Prim2DBase=i}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d){this._partCount=d,this.owner=b,this.modelRenderCache=c,this.modelRenderCache.addRef(),this.partIndexFromId=new a.StringDictionary,this._usedShaderCategories=new Array(d),this._strides=new Array(d),this._opaqueData=null,this._alphaTestData=null,this._transparentData=null,this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1}return b.prototype.dispose=function(){if(this._isDisposed)return!1;this.modelRenderCache&&this.modelRenderCache.dispose();var a=this.owner.owner.engine;return this.opaqueData&&(this.opaqueData.forEach(function(b){return b.dispose(a)}),this.opaqueData=null),this.partIndexFromId=null,this._isDisposed=!0,!0},Object.defineProperty(b.prototype,"hasOpaqueData",{get:function(){return null!=this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasAlphaTestData",{get:function(){return null!=this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"hasTransparentData",{get:function(){return null!=this._transparentData},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=new Array(this._partCount);for(var a=0;a<this._partCount;a++)this._opaqueData[a]=new d(this._strides[a])}return this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"alphaTestData",{get:function(){if(!this._alphaTestData){this._alphaTestData=new Array(this._partCount);for(var a=0;a<this._partCount;a++)this._alphaTestData[a]=new d(this._strides[a])}return this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=new Array(this._partCount);for(var a=0;a<this._partCount;a++){var b=this.modelRenderCache._partData[a]._zBiasOffset;this._transparentData[a]=new e(this._strides[a],b)}}return this._transparentData},enumerable:!0,configurable:!0}),b.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var a=0;a<this._transparentData.length;a++){var b=this._transparentData[a];b._partData.sort()}this.transparentOrderDirty=!1}},Object.defineProperty(b.prototype,"usedShaderCategories",{get:function(){return this._usedShaderCategories},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"strides",{get:function(){return this._strides},enumerable:!0,configurable:!0}),b}();a.GroupInstanceInfo=b;var c=function(){function a(){}return a}();a.TransparentSegment=c;var d=function(){function b(b){this._partData=null,this._partBuffer=null,this._partBufferSize=0,this._partData=new a.DynamicFloatArray(b/4,50),this._isDisposed=!1}return b.prototype.dispose=function(a){return this._isDisposed?!1:(this._partBuffer&&(a._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0))},b}();a.GroupInfoPartData=d;var e=function(a){function b(b,c){a.call(this,b),this._partData.compareValueOffset=c,this._partData.sortingAscending=!1}return __extends(b,a),b}(d);a.TransparentGroupInfoPartData=e;var f=function(){function b(b,c){this._engine=b,this._modelKey=c,this._nextKey=1,this._refCounter=1,this._instancesData=new a.StringDictionary,this._partData=null}return b.prototype.dispose=function(){if(0!==--this._refCounter)return!1;var a=this._engine.getExternalData("__BJSCANVAS2D__");return a&&a.DisposeModelRenderCache(this),!0},Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this._refCounter<=0},enumerable:!0,configurable:!0}),b.prototype.addRef=function(){return++this._refCounter},Object.defineProperty(b.prototype,"modelKey",{get:function(){return this._modelKey},enumerable:!0,configurable:!0}),b.prototype.render=function(a,b){return!0},b.prototype.addInstanceDataParts=function(a){var b=this._nextKey.toString();if(!this._instancesData.add(b,a))throw Error("Key: "+b+" is already allocated");return++this._nextKey,b},b.prototype.removeInstanceData=function(a){this._instancesData.remove(a)},b.prototype.getPartIndexFromId=function(a){for(var b=0;b<this._partData.length;b++)if(this._partData[b]._partId===a)return b;return null},b.prototype.loadInstancingAttributes=function(a,b){var c=this.getPartIndexFromId(a);if(null===c)return null;var d=this._partsClassInfo[c],e=this._partData[c]._partUsedCategories,f=d.classContent.getInstancingAttributeInfos(b,e);return f},b.prototype.setupUniforms=function(a,c,d,e){var f=this._partData[c],g=f._partDataStride/4*e,h=this._partsClassInfo[c];h.fullContent.forEach(function(c,e){if(!e.category||-1!==f._partUsedCategories.indexOf(e.category))switch(e.dataType){case 4:var h=e.instanceOffset.get(f._partJoinedUsedCategories);a.setFloat(e.attributeName,d.buffer[g+h]);break;case 0:var h=e.instanceOffset.get(f._partJoinedUsedCategories);b.v2.x=d.buffer[g+h+0],b.v2.y=d.buffer[g+h+1],a.setVector2(e.attributeName,b.v2);break;case 5:case 1:var h=e.instanceOffset.get(f._partJoinedUsedCategories);b.v3.x=d.buffer[g+h+0],b.v3.y=d.buffer[g+h+1],b.v3.z=d.buffer[g+h+2],a.setVector3(e.attributeName,b.v3);break;case 6:case 2:var h=e.instanceOffset.get(f._partJoinedUsedCategories);b.v4.x=d.buffer[g+h+0],b.v4.y=d.buffer[g+h+1],b.v4.z=d.buffer[g+h+2],b.v4.w=d.buffer[g+h+3],a.setVector4(e.attributeName,b.v4)}})},b.v2=a.Vector2.Zero(),b.v3=a.Vector3.Zero(),b.v4=a.Vector4.Zero(),b}();a.ModelRenderCache=f;var g=function(){function a(){}return a}();a.ModelRenderCachePartData=g}(BABYLON||(BABYLON={}));var BABYLON;!function(a){function b(b,e){return function(f,g,h){var i=a.ClassTreeInfo.getOrRegister(f,function(a){return new c(a)}),j=i.getLevelOf(f),k=g;e=e||k;var l=j.levelContent.get(k);if(l)throw new Error("The ID "+k+" is already taken by another instance data");l=new d,l.attributeName=e,l.category=b||null,l.category&&(l.delimitedCategory=";"+l.category+";"),j.levelContent.add(k,l),h.get=function(){return null},h.set=function(a){if(!l.category||-1!==c._CurCategories.indexOf(l.delimitedCategory)){l.size?l.instanceOffset.contains(c._CurCategories)||j.classContent.mapProperty(l,!1):(l.setSize(a),j.classContent.mapProperty(l,!0));var b=this;if(b.dataBuffer&&b.dataElements){var d=b.dataElements[b.curElement].offset+l.instanceOffset.get(c._CurCategories);l.writeData(b.dataBuffer.buffer,d,a)}}}}}var c=function(){function b(b){this._baseInfo=b,this._nextOffset=new a.StringDictionary,this._attributes=new Array}return b.prototype.mapProperty=function(a,c){var d=this._nextOffset.getOrAdd(b._CurCategories,0);a.instanceOffset.add(b._CurCategories,this._getBaseOffset(b._CurCategories)+d),this._nextOffset.set(b._CurCategories,d+a.size/4),c&&this._attributes.push(a)},b.prototype.getInstancingAttributeInfos=function(b,c){for(var d=";"+c.join(";")+";",e=new Array,f=this;f;){for(var g=0,h=f._attributes;g<h.length;g++){var i=h[g];if(!i.category||-1!==c.indexOf(i.category)){var j=b.getAttributeLocationByName(i.attributeName),k=new a.InstancingAttributeInfo;k.index=j,k.attributeSize=i.size/4,k.offset=4*i.instanceOffset.get(d),k.attributeName=i.attributeName,e.push(k)}}f=f._baseInfo}return e},b.prototype.getShaderAttributes=function(a){for(var b=new Array,c=this;c;){for(var d=0,e=c._attributes;d<e.length;d++){var f=e[d];f.category&&-1===a.indexOf(f.category)||b.push(f.attributeName)}c=c._baseInfo}return b},b.prototype._getBaseOffset=function(a){for(var b=0,c=this._baseInfo;c;)b+=c._nextOffset.getOrAdd(a,0),c=c._baseInfo;return b},b}();a.InstanceClassInfo=c;var d=function(){function b(){this.instanceOffset=new a.StringDictionary}return b.prototype.setSize=function(b){if(b instanceof a.Vector2)return this.size=8,void(this.dataType=0);if(b instanceof a.Vector3)return this.size=12,void(this.dataType=1);if(b instanceof a.Vector4)return this.size=16,void(this.dataType=2);if(b instanceof a.Matrix)throw new Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof b?(this.size=4,void(this.dataType=4)):b instanceof a.Color3?(this.size=12,void(this.dataType=5)):b instanceof a.Color4?(this.size=16,void(this.dataType=6)):b instanceof a.Size?(this.size=8,void(this.dataType=7)):void 0},b.prototype.writeData=function(a,b,c){switch(this.dataType){case 0:var d=c;a[b+0]=d.x,a[b+1]=d.y;break;case 1:var d=c;a[b+0]=d.x,a[b+1]=d.y,a[b+2]=d.z;break;case 2:var d=c;a[b+0]=d.x,a[b+1]=d.y,a[b+2]=d.z,a[b+3]=d.w;break;case 5:var d=c;a[b+0]=d.r,a[b+1]=d.g,a[b+2]=d.b;break;case 6:var d=c;a[b+0]=d.r,a[b+1]=d.g,a[b+2]=d.b,a[b+3]=d.a;break;case 4:var d=c;a[b]=d;break;case 3:for(var d=c,e=0;16>e;e++)a[b+e]=d.m[e];break;case 7:var f=c;a[b+0]=f.width,a[b+1]=f.height}},b}();a.InstancePropInfo=d,a.instanceData=b;var e=function(){function c(a,b){this.id=a,this.curElement=0,this.dataElementCount=b}return Object.defineProperty(c.prototype,"zBias",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transformX",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"transformY",{get:function(){return null},enumerable:!0,configurable:!0}),c.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=a.ClassTreeInfo.get(Object.getPrototypeOf(this))),this.typeInfo},c.prototype.allocElements=function(){if(this.dataBuffer){for(var a=new Array(this.dataElementCount),b=0;b<this.dataElementCount;b++)a[b]=this.dataBuffer.allocElement();this.dataElements=a}},c.prototype.freeElements=function(){if(this.dataElements){for(var a=0,b=this.dataElements;a<b.length;a++){var c=b[a];this.dataBuffer.freeElement(c)}this.dataElements=null}},Object.defineProperty(c.prototype,"dataElementCount",{get:function(){return this._dataElementCount},set:function(a){a!==this._dataElementCount&&(this.freeElements(),this._dataElementCount=a,this.allocElements())},enumerable:!0,configurable:!0}),__decorate([b()],c.prototype,"zBias",null),__decorate([b()],c.prototype,"transformX",null),__decorate([b()],c.prototype,"transformY",null),c}();a.InstanceDataBase=e;var f=function(b){function d(a){b.call(this,a),this._isTransparent=!1,this._isAlphaTest=!1,this._transparentPrimitiveInfo=null}return __extends(d,b),Object.defineProperty(d.prototype,"isAlphaTest",{get:function(){return this._isAlphaTest},set:function(a){this._isAlphaTest=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(a){this._isTransparent=a},enumerable:!0,configurable:!0}),d.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach(function(a){a.freeElements()}),this._instanceDataParts=null),!0):!1},d.prototype._prepareRenderPre=function(c){b.prototype._prepareRenderPre.call(this,c),this._isFlagSet(a.SmartPropertyPrim.flagModelDirty)&&this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null);var d=!1;this._modelRenderCache&&!this._isFlagSet(a.SmartPropertyPrim.flagModelDirty)||(d=this._createModelRenderCache());var e=null,f=!1;this._modelRenderInstanceID||(f=!0,e=this._createModelDataParts()),d&&this.setupModelRenderCache(this._modelRenderCache),(this._isFlagSet(a.SmartPropertyPrim.flagVisibilityChanged)||c.forceRefreshPrimitive||f||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep)&&(this.isTransparent,this._updateInstanceDataParts(e))},d.prototype._createModelRenderCache=function(){var b=this,c=!1;return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,function(a){var d=b.createModelRenderCache(a);return c=!0,d}),this._clearFlags(a.SmartPropertyPrim.flagModelDirty),c||this._modelRenderCache.addRef(),c},d.prototype._createModelDataParts=function(){var b=this,c=this.createInstanceDataParts();this._instanceDataParts=c,this._modelRenderCache._partData||this._setupModelRenderCache(c);var d=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,function(c){for(var d=new a.GroupInstanceInfo(b.renderGroup,b._modelRenderCache,b._modelRenderCache._partData.length),e=0;e<b._modelRenderCache._partData.length;e++){var f=b._instanceDataParts[e];d.partIndexFromId.add(f.id.toString(),e),d.usedShaderCategories[e]=";"+b.getUsedShaderCategories(f).join(";")+";",d.strides[e]=b._modelRenderCache._partData[e]._partDataStride}return d}),e=null;e=this.isTransparent?d.transparentData:this.isAlphaTest?d.alphaTestData:d.opaqueData;for(var f=0;f<c.length;f++){var g=c[f];g.dataBuffer=e[f]._partData,g.allocElements()}return this._modelRenderInstanceID=this._modelRenderCache.addInstanceDataParts(this._instanceDataParts),d},d.prototype._setupModelRenderCache=function(b){var d=new Array;this._modelRenderCache._partData=new Array;for(var e=0;e<b.length;e++){var f=b[e],g=new a.ModelRenderCachePartData;this._modelRenderCache._partData.push(g);var h=this.getUsedShaderCategories(f),i=f.getClassTreeInfo(),j=this.isVisible;this.isVisible=!0;var k=";"+h.join(";")+";";g._partJoinedUsedCategories=k,c._CurCategories=k;var l=this.beforeRefreshForLayoutConstruction(f);this.refreshInstanceDataPart(f),this.afterRefreshForLayoutConstruction(f,l),this.isVisible=j;var m=0;i.fullContent.forEach(function(b,c){c.category&&-1===h.indexOf(c.category)||("zBias"===c.attributeName&&(g._zBiasOffset=c.instanceOffset.get(k)),c.size?m+=c.size:console.log("ERROR: Couldn't detect the size of the Property "+c.attributeName+" from type "+a.Tools.getClassName(i.type)+". Property is ignored."))}),g._partDataStride=m,g._partUsedCategories=h,g._partId=f.id,d.push(i)}this._modelRenderCache._partsClassInfo=d},d.prototype.onZOrderChanged=function(){if(this.isTransparent&&this._transparentPrimitiveInfo){this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo);var a=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey);a.transparentOrderDirty=!0}},d.prototype._updateInstanceDataParts=function(b){b||(b=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey)),this.isTransparent&&this._isFlagSet(a.SmartPropertyPrim.flagVisibilityChanged)&&(this.isVisible?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=this.renderGroup._renderableData.addNewTransparentPrimitiveInfo(this,b)):this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),b.transparentOrderDirty=!0);for(var d=0,e=this._instanceDataParts;d<e.length;d++){var f=e[d];this._isFlagSet(a.SmartPropertyPrim.flagVisibilityChanged)&&!f.dataElements&&f.allocElements(),c._CurCategories=b.usedShaderCategories[b.partIndexFromId.get(f.id.toString())],this.refreshInstanceDataPart(f)||f.dataElements&&f.freeElements()}this._instanceDirtyFlags=0,this.isTransparent?b.transparentDirty=!0:this.isAlphaTest?b.alphaTestDirty=!0:b.opaqueDirty=!0,this._clearFlags(a.SmartPropertyPrim.flagVisibilityChanged)},d.prototype._getFirstIndexInDataBuffer=function(){for(var a=0,b=this._instanceDataParts;a<b.length;a++){var c=b[a];if(c)return c.dataElements[0].offset/c.dataBuffer.stride}return null},d.prototype._getLastIndexInDataBuffer=function(){for(var a=0,b=this._instanceDataParts;a<b.length;a++){var c=b[a];if(c)return c.dataElements[c.dataElements.length-1].offset/c.dataBuffer.stride}return null},d.prototype._getNextPrimZOrder=function(){for(var a=this._instanceDataParts.length,b=0;a>b;b++){var c=this._instanceDataParts[b];if(c){var d=c.dataBuffer.stride,e=c.dataElements[c.dataElements.length-1].offset;return c.dataBuffer.totalElementCount*d<=e?null:c.dataBuffer[e+d+this.modelRenderCache._partData[b]._zBiasOffset]}}return null},d.prototype._getPrevPrimZOrder=function(){for(var a=this._instanceDataParts.length,b=0;a>b;b++){var c=this._instanceDataParts[b];if(c){var d=c.dataBuffer.stride,e=c.dataElements[0].offset;return 0===e?null:c.dataBuffer[e-d+this.modelRenderCache._partData[b]._zBiasOffset]}}return null},d.prototype.transformPointWithOriginByRef=function(a,b,c){var d=this.actualSize;c.x=a.x-(this.origin.x+(b?b.x:0))*d.width,c.y=a.y-(this.origin.y+(b?b.y:0))*d.height},d.prototype.transformPointWithOriginToRef=function(a,b,c){return this.transformPointWithOriginByRef(a,b,c),c},d.prototype.getDataPartEffectInfo=function(b,c,d){void 0===d&&(d=null);var e=a.Tools.first(this._instanceDataParts,function(a){return a.id===b});if(!e)return null;var f=this.owner.supportInstancedArray;if(null!=d){if(d&&f===!1)return null;f=d}var g=e.getClassTreeInfo(),h=this.getUsedShaderCategories(e),i=g.classContent.getShaderAttributes(h),j="";return h.forEach(function(a){j+="#define "+a+"\n"}),f&&(j+="#define Instanced\n"),{attributes:f?c.concat(i):c,uniforms:f?[]:i,defines:j}},Object.defineProperty(d.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache},enumerable:!0,configurable:!0}),d.prototype.createModelRenderCache=function(a){return null},d.prototype.setupModelRenderCache=function(a){},d.prototype.createInstanceDataParts=function(){return null},d.prototype.getUsedShaderCategories=function(a){return[]},d.prototype.beforeRefreshForLayoutConstruction=function(a){},d.prototype.afterRefreshForLayoutConstruction=function(a,b){},d.prototype.refreshInstanceDataPart=function(a){return this.isVisible?(a.isVisible=this.isVisible,1===a.dataElementCount&&(a.curElement=0,this.updateInstanceDataPart(a)),!0):!1},d.prototype.updateInstanceDataPart=function(b,c){void 0===c&&(c=null);var d=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),e=this.renderGroup.viewportSize,f=this.actualZOffset,g=0,h=0;c&&(g=c.x*d.m[0]+c.y*d.m[4],h=c.x*d.m[1]+c.y*d.m[5]);var i=e.width,j=e.height,k=1/f,l=new a.Vector4(2*d.m[0]/i,2*d.m[4]/i,0,2*(d.m[12]+g)/i-1),m=new a.Vector4(2*d.m[1]/j,2*d.m[5]/j,0,2*(d.m[13]+h)/j-1);b.transformX=l,b.transformY=m,b.zBias=new a.Vector2(f,k)},d.RENDERABLEPRIM2D_PROPCOUNT=a.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,__decorate([a.dynamicLevelProperty(a.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,function(a){return d.isAlphaTestProperty=a})],d.prototype,"isAlphaTest",null),__decorate([a.dynamicLevelProperty(a.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(a){return d.isTransparentProperty=a})],d.prototype,"isTransparent",null),d=__decorate([a.className("RenderablePrim2D")],d)}(a.Prim2DBase);a.RenderablePrim2D=f}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c){b.call(this,c),c||(c={});var d=null;c.border&&(d="string"==typeof c.border?a.Canvas2D.GetBrushFromString(c.border):c.border);var e=null;c.fill&&(e="string"==typeof c.fill?a.Canvas2D.GetBrushFromString(c.fill):c.fill),this.border=d,this.fill=e,this.borderThickness=c.borderThickness}return __extends(c,b),Object.defineProperty(c.prototype,"border",{get:function(){return this._border},set:function(a){this._border=a,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"fill",{get:function(){return this._fill},set:function(a){this._fill=a,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"borderThickness",{get:function(){return this._borderThickness},set:function(a){this._borderThickness=a},enumerable:!0,configurable:!0}),c.prototype.getUsedShaderCategories=function(d){var e=b.prototype.getUsedShaderCategories.call(this,d);if(d.id===c.SHAPE2D_FILLPARTID){var f=this.fill;f instanceof a.SolidColorBrush2D&&e.push(c.SHAPE2D_CATEGORY_FILLSOLID),f instanceof a.GradientColorBrush2D&&e.push(c.SHAPE2D_CATEGORY_FILLGRADIENT)}if(d.id===c.SHAPE2D_BORDERPARTID){e.push(c.SHAPE2D_CATEGORY_BORDER);var g=this.border;g instanceof a.SolidColorBrush2D&&e.push(c.SHAPE2D_CATEGORY_BORDERSOLID),g instanceof a.GradientColorBrush2D&&e.push(c.SHAPE2D_CATEGORY_BORDERGRADIENT)}return e},c.prototype.refreshInstanceDataPart=function(d){if(!b.prototype.refreshInstanceDataPart.call(this,d))return!1;if(d.id===c.SHAPE2D_FILLPARTID){var e=d;if(this.fill){var f=this.fill;if(f instanceof a.SolidColorBrush2D)e.fillSolidColor=f.color;else if(f instanceof a.GradientColorBrush2D){e.fillGradientColor1=f.color1,e.fillGradientColor2=f.color2;var g=a.Matrix.Compose(new a.Vector3(f.scale,f.scale,f.scale),a.Quaternion.RotationAxis(new a.Vector3(0,0,1),f.rotation),new a.Vector3(f.translation.x,f.translation.y,0)),h=new a.Vector4(g.m[1],g.m[5],g.m[9],g.m[13]);e.fillGradientTY=h}}}else if(d.id===c.SHAPE2D_BORDERPARTID){var e=d;if(this.border){e.borderThickness=this.borderThickness;var i=this.border;if(i instanceof a.SolidColorBrush2D)e.borderSolidColor=i.color;else if(i instanceof a.GradientColorBrush2D){e.borderGradientColor1=i.color1,e.borderGradientColor2=i.color2;var g=a.Matrix.Compose(new a.Vector3(i.scale,i.scale,i.scale),a.Quaternion.RotationAxis(new a.Vector3(0,0,1),i.rotation),new a.Vector3(i.translation.x,i.translation.y,0)),h=new a.Vector4(g.m[1],g.m[5],g.m[9],g.m[13]);e.borderGradientTY=h}}}return!0},c.prototype._updateTransparencyStatus=function(){this.isTransparent=this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent()},c.SHAPE2D_BORDERPARTID=1,c.SHAPE2D_FILLPARTID=2,c.SHAPE2D_CATEGORY_BORDER="Border",c.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",c.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",c.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",c.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",c.SHAPE2D_PROPCOUNT=a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([a.modelLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(a){return c.borderProperty=a},!0)],c.prototype,"border",null),__decorate([a.modelLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(a){return c.fillProperty=a},!0)],c.prototype,"fill",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(a){return c.borderThicknessProperty=a})],c.prototype,"borderThickness",null),c=__decorate([a.className("Shape2D")],c)}(a.RenderablePrim2D);a.Shape2D=b;var c=function(c){function d(){c.apply(this,arguments)}return __extends(d,c),Object.defineProperty(d.prototype,"fillSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"fillGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderThickness",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"borderGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_FILLSOLID)],d.prototype,"fillSolidColor",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientColor1",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientColor2",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_FILLGRADIENT)],d.prototype,"fillGradientTY",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_BORDER)],d.prototype,"borderThickness",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_BORDERSOLID)],d.prototype,"borderSolidColor",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientColor1",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientColor2",null),__decorate([a.instanceData(b.SHAPE2D_CATEGORY_BORDERGRADIENT)],d.prototype,"borderGradientTY",null),d}(a.InstanceDataBase);a.Shape2DInstanceData=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function d(c){null==c&&(c={}),null==c.origin&&(c.origin=new a.Vector2(0,0)),b.call(this,c);var e=c.size||c.width||c.height?c.size||new a.Size(c.width||0,c.height||0):null;this._trackedNode=null==c.trackNode?null:c.trackNode,this._trackedNode&&this.owner&&this.owner._registerTrackedNode(this),this._cacheBehavior=null==c.cacheBehavior?d.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:c.cacheBehavior,this.size=e,this._viewportPosition=a.Vector2.Zero()}return __extends(d,b),d._createCachedCanvasGroup=function(b){var c=new d({parent:b,id:"__cachedCanvasGroup__",position:a.Vector2.Zero(),origin:a.Vector2.Zero(),size:null,isVisible:!0});return c},d.prototype.applyCachedTexture=function(b,c){if(this._bindCacheTarget(),b)for(var d=b.uvs,e=this._renderableData._cacheNode.UVs,f=0;4>f;f++)d[2*f+0]=e[f].x,d[2*f+1]=e[f].y;c&&(c.diffuseTexture=this._renderableData._cacheTexture,c.emissiveColor=new a.Color3(1,1,1)),this._renderableData._cacheTexture.hasAlpha=!0,this._unbindCacheTarget()},Object.defineProperty(d.prototype,"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cacheTexture",{get:function(){return this._renderableData?this._renderableData._cacheTexture:null},enumerable:!0,configurable:!0}),d.prototype.dispose=function(){return b.prototype.dispose.call(this)?(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(),this._renderableData=null),!0):!1},Object.defineProperty(d.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"size",{get:function(){return this._size},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"viewportSize",{get:function(){return this._viewportSize},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"actualSize",{get:function(){var b;if(this._size)b=new a.Size(Math.ceil(this._size.width),Math.ceil(this._size.height));else{var c=this.boundingInfo.max();b=new a.Size(Math.ceil(c.x),Math.ceil(c.y))}return b.equals(this._actualSize)||(this.onPrimitivePropertyDirty(d.actualSizeProperty.flagId),this._actualSize=b,this.handleGroupChanged(d.actualSizeProperty)),b},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cacheBehavior",{get:function(){return this._cacheBehavior},enumerable:!0,configurable:!0}),d.prototype._addPrimToDirtyList=function(a){this._renderableData._primDirtyList.push(a)},d.prototype._renderCachedCanvas=function(){this.updateCachedStates(!0);var b=new a.PrepareRender2DContext;this._prepareGroupRender(b),this._groupRender()},Object.defineProperty(d.prototype,"trackedNode",{get:function(){return this._trackedNode},set:function(b){null!=b?(this._isFlagSet(a.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),this._trackedNode=b):(this._isFlagSet(a.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null)},enumerable:!0,configurable:!0}),d.prototype.levelIntersect=function(a){return!0},d.prototype.updateLevelBoundingInfo=function(){var b;b=this.size?this.size:new a.Size(0,0),a.BoundingInfo2D.CreateFromSizeToRef(b,this._levelBoundingInfo)},d.prototype._prepareGroupRender=function(b){var c=null;if((this._renderableData._primDirtyList.length>0||b.forceRefreshPrimitive)&&(c=this._renderableData._primDirtyList.sort(function(a,b){return a.hierarchyDepth-b.hierarchyDepth}),this.updateCachedStatesOf(c,!0)),this._isCachedGroup){var d=this.actualSize.clone();d.equals(this._viewportSize)||(b.forceRefreshPrimitive=!0),this._viewportSize=d}else{var e=this._globalTransform.getTranslation(),f=this.actualSize.clone(),g=this.owner._renderingSize;f.height=Math.min(f.height,g.height-e.y),f.width=Math.min(f.width,g.width-e.x);var h=e.x,i=e.y;this._viewportPosition.x=h,this._viewportPosition.y=i;var j=f.width,k=f.height;this._viewportSize?(this._viewportSize.width===j&&this._viewportSize.height===k||(b.forceRefreshPrimitive=!0),this._viewportSize.width=j,this._viewportSize.height=k):this._viewportSize=new a.Size(j,k)}if(this._renderableData._primDirtyList.length>0||b.forceRefreshPrimitive)if(this._cacheGroupDirty=this._isCachedGroup,b.forceRefreshPrimitive)for(var l=0,m=this._children;l<m.length;l++){var n=m[l];n._prepareRender(b)}else c||(c=this._renderableData._primDirtyList.sort(function(a,b){return a.hierarchyDepth-b.hierarchyDepth})),c.forEach(function(a){!a.isDisposed&&a._needPrepare()&&a._prepareRender(b)}),this._renderableData._primDirtyList.forEach(function(a){return a._resetPropertiesDirty()}),this._renderableData._primDirtyList.splice(0);this._renderableData._childrenRenderableGroups.forEach(function(a){a._prepareGroupRender(b)})},d.prototype._groupRender=function(){for(var b=this,c=this.owner.engine,d=0,e=0,f=this._renderableData._childrenRenderableGroups;e<f.length;e++){var g=f[e];g._groupRender()}if(!this.isCachedGroup||this._cacheGroupDirty){if(this.isCachedGroup)this._bindCacheTarget();else var h=c.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);var i=c.getAlphaTesting()===!0,j=c.getDepthWrite()===!0;c.setAlphaTesting(!1),c.setDepthWrite(!0);var k=new a.Render2DContext(a.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach(function(a,e){var f=b._prepareContext(c,k,e);if(null!==f&&(!b.owner.supportInstancedArray||f>0)){var g=!e.modelRenderCache.render(e,k);e.opaqueDirty=g,d+=g?1:0}}),c.setAlphaTesting(!0),c.setDepthWrite(!0),k=new a.Render2DContext(a.Render2DContext.RenderModeAlphaTest),this._renderableData._renderGroupInstancesInfo.forEach(function(a,e){var f=b._prepareContext(c,k,e);if(null!==f&&(!b.owner.supportInstancedArray||f>0)){var g=!e.modelRenderCache.render(e,k);e.opaqueDirty=g,d+=g?1:0}}),c.setAlphaTesting(!0),c.setDepthWrite(!1),this._renderableData._transparentListChanged&&this._updateTransparentData(),d+=this._renderTransparentData(),this._cacheGroupDirty=0!==d,this.isCachedGroup?this._unbindCacheTarget():h&&c.setViewport(h),c.setAlphaTesting(i),c.setDepthWrite(j)}},d.prototype._updateTransparentData=function(){var b=this._renderableData;if(null!==b._firstChangedPrim){b._transparentPrimitives.sort(function(a,b){return b._primitive.actualZOffset-a._primitive.actualZOffset});var c=function(a,c){var d=b._transparentPrimitives[c];if(a.groupInsanceInfo!==d._groupInstanceInfo)return!1;var e=d._primitive.actualZOffset;
return d._transparentSegment=a,e<a.endZ&&(a.endZ=e,a.endDataIndex=d._primitive._getLastIndexInDataBuffer()+1),!0};b._transparentSegments.splice(0);for(var d=null,e=0;e<b._transparentPrimitives.length;e++){var f=b._transparentPrimitives[e];if(f._groupInstanceInfo.transparentOrderDirty&&f._groupInstanceInfo.sortTransparentData(),f._transparentSegment=null,d&&c(d,e),!f._transparentSegment){var g=new a.TransparentSegment;g.groupInsanceInfo=f._groupInstanceInfo;var h=f._primitive;g.startZ=h.actualZOffset,g.startDataIndex=h._getFirstIndexInDataBuffer(),g.endDataIndex=h._getLastIndexInDataBuffer()+1,g.endZ=g.startZ,f._transparentSegment=g,b._transparentSegments.push(g)}d=f._transparentSegment}b._firstChangedPrim=null,b._transparentListChanged=!1}},d.prototype._renderTransparentData=function(){for(var b=0,c=new a.Render2DContext(a.Render2DContext.RenderModeTransparent),d=this._renderableData,e=d._transparentSegments.length,f=0;e>f;f++){var g=d._transparentSegments[f],h=g.groupInsanceInfo,i=h.modelRenderCache;c.useInstancing=!1,c.partDataStartIndex=g.startDataIndex,c.partDataEndIndex=g.endDataIndex,c.groupInfoPartData=h.transparentData;var j=!i.render(h,c);b+=j?1:0}return b},d.prototype._prepareContext=function(b,c,d){var e,f,g=null;switch(c.renderMode){case a.Render2DContext.RenderModeOpaque:if(!d.hasOpaqueData)return null;e=function(a){d.opaqueDirty=a},f=function(){return d.opaqueDirty},c.groupInfoPartData=d.opaqueData,g=d.opaqueData;break;case a.Render2DContext.RenderModeAlphaTest:if(!d.hasAlphaTestData)return null;e=function(a){d.alphaTestDirty=a},f=function(){return d.alphaTestDirty},c.groupInfoPartData=d.alphaTestData,g=d.alphaTestData;break;default:throw new Error("_prepareContext is only for opaque or alphaTest")}var h=0;if(this.owner.supportInstancedArray){c.useInstancing=!0;for(var i=0;i<g.length;i++){var j=g[i],k=j._partData,l=k.pack();h+=k.usedElementCount;var m=k.usedElementCount*k.stride*4;!j._partBuffer||j._partBufferSize<m?(j._partBuffer&&b.deleteInstancesBuffer(j._partBuffer),j._partBuffer=b.createInstancesBuffer(m),j._partBufferSize=m,e(!1),b.updateArrayBuffer(l)):f()&&(b.bindArrayBuffer(j._partBuffer),b.updateArrayBuffer(l))}e(!1)}else{c.partDataStartIndex=0;for(var i=0;!c.groupInfoPartData[i];)i++;c.partDataEndIndex=c.groupInfoPartData[i]._partData.usedElementCount}return h},d.prototype._bindCacheTarget=function(){var b,c,d=this._renderableData;if(d._cacheNode){var e=d._cacheNode.contentSize,f=Math.ceil(this.actualSize.width),g=Math.ceil(this.actualSize.height);(e.width<f||e.height<g)&&(b=Math.floor(1.07*e.width),c=Math.floor(1.07*e.height),d._cacheTexture.freeRect(d._cacheNode),d._cacheNode=null)}if(!d._cacheNode){var h=this.owner._allocateGroupCache(this,this.renderGroup,b?new a.Size(b,c):null);d._cacheNode=h.node,d._cacheTexture=h.texture,d._cacheRenderSprite=h.sprite;var e=d._cacheNode.contentSize}var i=d._cacheNode;d._cacheTexture.bindTextureForPosSize(i.pos,this.actualSize,!0)},d.prototype._unbindCacheTarget=function(){this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture()},d.prototype.handleGroupChanged=function(b){var c=this._renderableData;this.isCachedGroup&&c._cacheRenderSprite&&(b.id===a.Prim2DBase.actualPositionProperty.id?c._cacheRenderSprite.actualPosition=this.actualPosition.clone():b.id===a.Prim2DBase.rotationProperty.id?c._cacheRenderSprite.rotation=this.rotation:b.id===a.Prim2DBase.scaleProperty.id?c._cacheRenderSprite.scale=this.scale:b.id===a.Prim2DBase.originProperty.id?c._cacheRenderSprite.origin=this.origin.clone():b.id===d.actualSizeProperty.id&&(c._cacheRenderSprite.size=this.actualSize.clone()))},d.prototype.detectGroupStates=function(){var b=this instanceof a.Canvas2D,e=this.owner.cachingStrategy;if(e===a.Canvas2D.CACHESTRATEGY_DONTCACHE)this._isRenderableGroup=b,this._isCachedGroup=!1;else if(e===a.Canvas2D.CACHESTRATEGY_CANVAS)b?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,this._isCachedGroup=!1);else if(e===a.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS)b?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1);else if(e===a.Canvas2D.CACHESTRATEGY_ALLGROUPS){var f=this.cacheBehavior;f!==d.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&f!==d.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=f===d.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),f===d.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0)}if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new c)),this._isCachedGroup)for(var g=this.parent;g;){if(g instanceof d&&g._isRenderableGroup){-1===g._renderableData._childrenRenderableGroups.indexOf(this)&&g._renderableData._childrenRenderableGroups.push(this);break}g=g.parent}},d.GROUP2D_PROPCOUNT=a.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,d.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,d.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,d.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,__decorate([a.instanceLevelProperty(a.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(a){return d.sizeProperty=a},!1,!0)],d.prototype,"size",null),__decorate([a.instanceLevelProperty(a.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,function(a){return d.actualSizeProperty=a})],d.prototype,"actualSize",null),d=__decorate([a.className("Group2D")],d)}(a.Prim2DBase);a.Group2D=b;var c=function(){function b(){this._primDirtyList=new Array,this._childrenRenderableGroups=new Array,this._renderGroupInstancesInfo=new a.StringDictionary,this._transparentPrimitives=new Array,this._transparentSegments=new Array,this._firstChangedPrim=null,this._transparentListChanged=!1,this._cacheNode=null,this._cacheTexture=null,this._cacheRenderSprite=null}return b.prototype.dispose=function(){this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=null),this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null),this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null),this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach(function(a,b){b.dispose()}),this._renderGroupInstancesInfo=null)},b.prototype.addNewTransparentPrimitiveInfo=function(a,b){var c=new d;return c._primitive=a,c._groupInstanceInfo=b,c._transparentSegment=null,this._transparentPrimitives.push(c),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(c),c},b.prototype.removeTransparentPrimitiveInfo=function(a){var b=this._transparentPrimitives.indexOf(a);-1!==b&&(this._transparentPrimitives.splice(b,1),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(a))},b.prototype.transparentPrimitiveZChanged=function(a){this._transparentListChanged=!0,this.updateSmallestZChangedPrim(a)},b.prototype.updateSmallestZChangedPrim=function(a){if(a._primitive){var b=a._primitive.actualZOffset,c=this._firstChangedPrim?this._firstChangedPrim._primitive.actualZOffset:Number.MIN_VALUE;b>c&&(this._firstChangedPrim=a)}},b}();a.RenderableGroupData=c;var d=function(){function a(){}return a}();a.TransparentPrimitiveInfo=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c){b.call(this,a,c),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(c,b),c.prototype.render=function(b,c){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=b.owner.owner.engine,e=0;this.effectFill&&this.effectBorder&&(e=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var f=d.getAlphaMode();if(this.effectFill){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_FILLPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(i),d.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,i),c.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_FILLPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_BORDERPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectBorderInstanced:this.effectBorder;if(d.enableEffect(i),d.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,i),c.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_BORDERPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.borderIndicesCount)}return d.setAlphaMode(f),this.effectFill&&this.effectBorder&&d.setDepthFunction(e),!0},c.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c}(a.ModelRenderCache);a.Rectangle2DRenderCache=b;var c=function(b){function c(a){b.call(this,a,1)}return __extends(c,b),Object.defineProperty(c.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData()],c.prototype,"properties",null),c}(a.Shape2DInstanceData);a.Rectangle2DInstanceData=c;var d=function(d){function e(b){if(null==b&&(b={}),d.call(this,b),null!=b.size)this.size=b.size;else if(b.width||b.height){var c=new a.Size(b.width,b.height);this.size=c}var e=null==b.roundRadius?0:b.roundRadius,f=null==b.borderThickness?1:b.borderThickness;this.roundRadius=e,this.borderThickness=f}return __extends(e,d),Object.defineProperty(e.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notRounded",{get:function(){return this._notRounded},set:function(a){this._notRounded=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roundRadius",{get:function(){return this._roundRadius},set:function(a){this._roundRadius=a,this.notRounded=0===a,this._positioningDirty()},enumerable:!0,configurable:!0}),e.prototype.levelIntersect=function(a){if(this.notRounded)return!0;var b=this.size;e._i0.x=a._localPickPosition.x,e._i0.y=a._localPickPosition.y;var c=this.roundRadius,d=c*c;return e._i1.x=c,e._i1.y=c,e._i0.x<=e._i1.x&&e._i0.y<=e._i1.y?(e._i2.x=e._i0.x-e._i1.x,e._i2.y=e._i0.y-e._i1.y,e._i2.lengthSquared()<=d):(e._i1.x=c,e._i1.y=b.height-c,e._i0.x<=e._i1.x&&e._i0.y>=e._i1.y?(e._i2.x=e._i0.x-e._i1.x,e._i2.y=e._i0.y-e._i1.y,e._i2.lengthSquared()<=d):(e._i1.x=b.width-c,e._i1.y=b.height-c,e._i0.x>=e._i1.x&&e._i0.y>=e._i1.y?(e._i2.x=e._i0.x-e._i1.x,e._i2.y=e._i0.y-e._i1.y,e._i2.lengthSquared()<=d):(e._i1.x=b.width-c,e._i1.y=c,e._i0.x>=e._i1.x&&e._i0.y<=e._i1.y?(e._i2.x=e._i0.x-e._i1.x,e._i2.y=e._i0.y-e._i1.y,e._i2.lengthSquared()<=d):!0)))},e.prototype.updateLevelBoundingInfo=function(){a.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},e.prototype.createModelRenderCache=function(a){var c=new b(this.owner.engine,a);return c},e.prototype.setupModelRenderCache=function(b){var c=b,d=this.owner.engine;if(this.fill){for(var f=4*(this.notRounded?1:e.roundSubdivisions)+1,g=new Float32Array(f),h=0;f>h;h++)g[h]=h;c.fillVB=d.createVertexBuffer(g);for(var i=f-1,j=new Float32Array(3*i),h=0;i>h;h++)j[3*h+0]=0,j[3*h+2]=h+1,j[3*h+1]=h+2;j[3*i-2]=1,c.fillIB=d.createIndexBuffer(j),c.fillIndicesCount=3*i;var k=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["index"],!0);k&&(c.effectFillInstanced=d.createEffect("rect2d",k.attributes,k.uniforms,[],k.defines,null)),k=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["index"],!1),c.effectFill=d.createEffect("rect2d",k.attributes,k.uniforms,[],k.defines,null)}if(this.border){for(var f=4*(this.notRounded?1:e.roundSubdivisions)*2,g=new Float32Array(f),h=0;f>h;h++)g[h]=h;c.borderVB=d.createVertexBuffer(g);for(var i=f,l=i/2,j=new Float32Array(3*i),h=0;l>h;h++){var m=h,n=(h+1)%l;j[6*h+0]=l+n,j[6*h+1]=l+m,j[6*h+2]=m,j[6*h+3]=n,j[6*h+4]=l+n,j[6*h+5]=m}c.borderIB=d.createIndexBuffer(j),c.borderIndicesCount=3*i;var k=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0);k&&(c.effectBorderInstanced=d.createEffect("rect2d",k.attributes,k.uniforms,[],k.defines,null)),k=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1),c.effectBorder=d.createEffect("rect2d",k.attributes,k.uniforms,[],k.defines,null)}return c},e.prototype._getInitialContentAreaToRef=function(a,b,c){if(this._notRounded)d.prototype._getInitialContentAreaToRef.call(this,a,b,c);else{var e=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));b.x=b.y=e,c.width=Math.max(0,a.width-2*e),c.height=Math.max(0,a.height-2*e)}},e.prototype.createInstanceDataParts=function(){var b=new Array;return this.border&&b.push(new c(a.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&b.push(new c(a.Shape2D.SHAPE2D_FILLPARTID)),b},e.prototype.refreshInstanceDataPart=function(b){if(!d.prototype.refreshInstanceDataPart.call(this,b))return!1;if(b.id===a.Shape2D.SHAPE2D_BORDERPARTID){var c=b,e=this.actualSize;c.properties=new a.Vector3(e.width,e.height,this.roundRadius||0)}else if(b.id===a.Shape2D.SHAPE2D_FILLPARTID){var c=b,e=this.actualSize;c.properties=new a.Vector3(e.width,e.height,this.roundRadius||0)}return!0},e._i0=a.Vector2.Zero(),e._i1=a.Vector2.Zero(),e._i2=a.Vector2.Zero(),e.roundSubdivisions=16,__decorate([a.instanceLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+1,function(a){return e.actualSizeProperty=a},!1,!0)],e.prototype,"actualSize",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return e.notRoundedProperty=a})],e.prototype,"notRounded",null),__decorate([a.instanceLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+3,function(a){return e.roundRadiusProperty=a})],e.prototype,"roundRadius",null),e=__decorate([a.className("Rectangle2D")],e)}(a.Shape2D);a.Rectangle2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c){b.call(this,a,c),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFillInstanced=null,this.effectFill=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorderInstanced=null,this.effectBorder=null}return __extends(c,b),c.prototype.render=function(b,c){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=b.owner.owner.engine,e=0;this.effectFill&&this.effectBorder&&(e=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var f=d.getAlphaMode();if(this.effectFill){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_FILLPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(i),d.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,i),c.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_FILLPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_BORDERPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectBorderInstanced:this.effectBorder;if(d.enableEffect(i),d.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,i),c.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_BORDERPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.borderIndicesCount)}return d.setAlphaMode(f),this.effectFill&&this.effectBorder&&d.setDepthFunction(e),!0},c.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c}(a.ModelRenderCache);a.Ellipse2DRenderCache=b;var c=function(b){function c(a){b.call(this,a,1)}return __extends(c,b),Object.defineProperty(c.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData()],c.prototype,"properties",null),c}(a.Shape2DInstanceData);a.Ellipse2DInstanceData=c;var d=function(d){function e(b){if(null==b&&(b={}),d.call(this,b),null!=b.size)this.size=b.size;else if(b.width||b.height){var c=new a.Size(b.width,b.height);this.size=c}var e=null==b.subdivisions?64:b.subdivisions;this.subdivisions=e}return __extends(e,d),Object.defineProperty(e.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisions",{get:function(){return this._subdivisions},set:function(a){this._subdivisions=a},enumerable:!0,configurable:!0}),e.prototype.levelIntersect=function(a){var b=this.size.width/2,c=this.size.height/2,d=a._localPickPosition.x-b,e=a._localPickPosition.y-c;return 1>=d*d/(b*b)+e*e/(c*c)},e.prototype.updateLevelBoundingInfo=function(){a.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},e.prototype.createModelRenderCache=function(a){var c=new b(this.owner.engine,a);return c},e.prototype.setupModelRenderCache=function(b){var c=b,d=this.owner.engine;if(this.fill){for(var e=this.subdivisions+1,f=new Float32Array(e),g=0;e>g;g++)f[g]=g;c.fillVB=d.createVertexBuffer(f);for(var h=e-1,i=new Float32Array(3*h),g=0;h>g;g++)i[3*g+0]=0,i[3*g+2]=g+1,i[3*g+1]=g+2;i[3*h-2]=1,c.fillIB=d.createIndexBuffer(i),c.fillIndicesCount=3*h;var j=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["index"],!0);j&&(c.effectFillInstanced=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},j.attributes,j.uniforms,[],j.defines,null)),j=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["index"],!1),c.effectFill=d.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},j.attributes,j.uniforms,[],j.defines,null)}if(this.border){for(var e=2*this.subdivisions,f=new Float32Array(e),g=0;e>g;g++)f[g]=g;c.borderVB=d.createVertexBuffer(f);for(var h=e,k=h/2,i=new Float32Array(3*h),g=0;k>g;g++){var l=g,m=(g+1)%k;i[6*g+0]=k+m,i[6*g+1]=k+l,i[6*g+2]=l,i[6*g+3]=m,i[6*g+4]=k+m,i[6*g+5]=l}c.borderIB=d.createIndexBuffer(i),c.borderIndicesCount=3*h;var j=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0);j&&(c.effectBorderInstanced=d.createEffect("ellipse2d",j.attributes,j.uniforms,[],j.defines,null)),j=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1),c.effectBorder=d.createEffect("ellipse2d",j.attributes,j.uniforms,[],j.defines,null)}return c},e.prototype.createInstanceDataParts=function(){var b=new Array;return this.border&&b.push(new c(a.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&b.push(new c(a.Shape2D.SHAPE2D_FILLPARTID)),b},e.prototype.refreshInstanceDataPart=function(b){if(!d.prototype.refreshInstanceDataPart.call(this,b))return!1;if(b.id===a.Shape2D.SHAPE2D_BORDERPARTID){var c=b,e=this.actualSize;c.properties=new a.Vector3(e.width,e.height,this.subdivisions)}else if(b.id===a.Shape2D.SHAPE2D_FILLPARTID){var c=b,e=this.actualSize;c.properties=new a.Vector3(e.width,e.height,this.subdivisions)}return!0},__decorate([a.instanceLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+1,function(a){return e.acutalSizeProperty=a},!1,!0)],e.prototype,"actualSize",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return e.subdivisionsProperty=a})],e.prototype,"subdivisions",null),e=__decorate([a.className("Ellipse2D")],e)}(a.Shape2D);a.Ellipse2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.texture=null,this.effect=null,this.effectInstanced=null}return __extends(c,b),c.prototype.render=function(b,c){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var e=b.owner.owner.engine,f=c.useInstancing?this.effectInstanced:this.effect;e.enableEffect(f),f.setTexture("diffuseSampler",this.texture),e.bindBuffersDirectly(this.vb,this.ib,[1],4,f);var g=e.getAlphaMode();c.renderMode!==a.Render2DContext.RenderModeOpaque&&e.setAlphaMode(a.Engine.ALPHA_COMBINE);var h=c.groupInfoPartData[0];if(c.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(d.SPRITE2D_MAINPARTID,f)),e.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingAttributes),e.draw(!0,0,6,h._partData.usedElementCount),e.unbindInstanceAttributes();else for(var i=c.partDataStartIndex;i<c.partDataEndIndex;i++)this.setupUniforms(f,0,h._partData,i),e.draw(!0,0,6);return e.setAlphaMode(g),!0},c.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.texture&&(this.texture.dispose(),this.texture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0):!1},c}(a.ModelRenderCache);a.Sprite2DRenderCache=b;var c=function(b){function c(a){b.call(this,a,1)}return __extends(c,b),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData()],c.prototype,"topLeftUV",null),__decorate([a.instanceData()],c.prototype,"sizeUV",null),__decorate([a.instanceData()],c.prototype,"textureSize",null),__decorate([a.instanceData()],c.prototype,"properties",null),c}(a.InstanceDataBase);a.Sprite2DInstanceData=c;var d=function(d){function e(b,c){if(c||(c={}),d.call(this,c),this.texture=b,this.texture.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=a.Texture.CLAMP_ADDRESSMODE,this.size=c.spriteSize||null,this.spriteLocation=c.spriteLocation||new a.Vector2(0,0),this.spriteFrame=0,this.invertY=null==c.invertY?!1:c.invertY,this.alignToPixel=null==c.alignToPixel?!0:c.alignToPixel,this._isTransparent=!0,!this.size){var e=b.getSize();this.size=new a.Size(e.width,e.height)}}return __extends(e,d),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(a){this._texture=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(a){this._actualSize=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spriteLocation",{get:function(){return this._location},set:function(a){this._location=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(a){this._spriteFrame=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invertY",{get:function(){return this._invertY},set:function(a){this._invertY=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignToPixel",{get:function(){return this._alignToPixel},set:function(a){this._alignToPixel=a},enumerable:!0,configurable:!0}),e.prototype.updateLevelBoundingInfo=function(){a.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo)},e.prototype.getAnimatables=function(){var a=new Array;return this.texture&&this.texture.animations&&this.texture.animations.length>0&&a.push(this.texture),a},e.prototype.levelIntersect=function(a){return!0},e._createCachedCanvasSprite=function(b,c,d,f){var g=new e(c,{parent:b,id:"__cachedCanvasSprite__",position:a.Vector2.Zero(),origin:a.Vector2.Zero(),spriteSize:d,spriteLocation:f,alignToPixel:!0});return g},e.prototype.createModelRenderCache=function(a){var c=new b(this.owner.engine,a);return c},e.prototype.setupModelRenderCache=function(a){for(var b=a,c=this.owner.engine,d=new Float32Array(4),f=0;4>f;f++)d[f]=f;b.vb=c.createVertexBuffer(d);var g=new Float32Array(6);g[0]=0,g[1]=2,g[2]=1,g[3]=0,g[4]=3,g[5]=2,b.ib=c.createIndexBuffer(g),b.texture=this.texture;var h=this.getDataPartEffectInfo(e.SPRITE2D_MAINPARTID,["index"],!0);return h&&(b.effectInstanced=c.createEffect("sprite2d",h.attributes,h.uniforms,["diffuseSampler"],h.defines,null)),h=this.getDataPartEffectInfo(e.SPRITE2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("sprite2d",h.attributes,h.uniforms,["diffuseSampler"],h.defines,null),b},e.prototype.createInstanceDataParts=function(){return[new c(e.SPRITE2D_MAINPARTID)]},e.prototype.refreshInstanceDataPart=function(b){if(!d.prototype.refreshInstanceDataPart.call(this,b))return!1;if(b.id===e.SPRITE2D_MAINPARTID){var c=this._instanceDataParts[0],f=this.texture.getBaseSize(),g=this.spriteLocation,h=this.actualSize;c.topLeftUV=new a.Vector2(g.x/f.width,g.y/f.height);var i=new a.Vector2(h.width/f.width,h.height/f.height);c.sizeUV=i,e._prop.x=this.spriteFrame,e._prop.y=this.invertY?1:0,e._prop.z=this.alignToPixel?1:0,c.properties=e._prop,c.textureSize=new a.Vector2(f.width,f.height)}return!0},e.SPRITE2D_MAINPARTID=1,e._prop=a.Vector3.Zero(),__decorate([a.modelLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(a){return e.textureProperty=a})],e.prototype,"texture",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(a){return e.actualSizeProperty=a},!1,!0)],e.prototype,"actualSize",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(a){return e.spriteLocationProperty=a})],e.prototype,"spriteLocation",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(a){return e.spriteFrameProperty=a})],e.prototype,"spriteFrame",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,function(a){return e.invertYProperty=a})],e.prototype,"invertY",null),e=__decorate([a.className("Sprite2D")],e)}(a.RenderablePrim2D);a.Sprite2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.fontTexture=null,this.effect=null,this.effectInstanced=null}return __extends(c,b),c.prototype.render=function(b,c){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var e=b.owner.owner.engine;this.fontTexture.update();var f=c.useInstancing?this.effectInstanced:this.effect;e.enableEffect(f),f.setTexture("diffuseSampler",this.fontTexture),e.bindBuffersDirectly(this.vb,this.ib,[1],4,f);var g=e.getAlphaMode();e.setAlphaMode(a.Engine.ALPHA_COMBINE,!0);var h=c.groupInfoPartData[0];if(c.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(d.TEXT2D_MAINPARTID,f)),e.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingAttributes),e.draw(!0,0,6,h._partData.usedElementCount),e.unbindInstanceAttributes();else for(var i=c.partDataStartIndex;i<c.partDataEndIndex;i++)this.setupUniforms(f,0,h._partData,i),e.draw(!0,0,6);return e.setAlphaMode(g),!0},c.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.dispose(),this.fontTexture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0):!1},c}(a.ModelRenderCache);a.Text2DRenderCache=b;var c=function(b){function c(a,c){b.call(this,a,c)}return __extends(c,b),Object.defineProperty(c.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData()],c.prototype,"topLeftUV",null),__decorate([a.instanceData()],c.prototype,"sizeUV",null),__decorate([a.instanceData()],c.prototype,"textureSize",null),__decorate([a.instanceData()],c.prototype,"color",null),c}(a.InstanceDataBase);a.Text2DInstanceData=c;var d=function(d){function e(b,c){c||(c={}),d.call(this,c),this.fontName=null==c.fontName?"12pt Arial":c.fontName,this.defaultFontColor=null==c.defaultFontColor?new a.Color4(1,1,1,1):c.defaultFontColor,this._tabulationSize=null==c.tabulationSize?4:c.tabulationSize,
this._textSize=null,this.text=b,this.size=null==c.size?null:c.size,this.isAlphaTest=!0}return __extends(e,d),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(a){if(this._fontName)throw new Error("Font Name change is not supported right now.");this._fontName=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor},set:function(a){this._defaultFontColor=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(a){this._text=a,this._textSize=null,this._size=null,this._updateCharCount(),this.textSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return null!=this._size?this._size:this.textSize},set:function(a){this._size=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textSize",{get:function(){if(!this._textSize){if(!this.owner)return e.nullSize;var b=this.fontTexture.measureText(this._text,this._tabulationSize);b.equals(this._textSize)||(this.onPrimitivePropertyDirty(a.Prim2DBase.sizeProperty.flagId),this._positioningDirty()),this._textSize=b}return this._textSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontTexture",{get:function(){return this._fontTexture?this._fontTexture:(this._fontTexture=a.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){return d.prototype.dispose.call(this)?(this._fontTexture&&(a.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture=null),!0):!1},e.prototype.updateLevelBoundingInfo=function(){a.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},e.prototype.levelIntersect=function(a){return!0},e.prototype.createModelRenderCache=function(a){var c=new b(this.owner.engine,a);return c},e.prototype.setupModelRenderCache=function(a){var b=a,c=this.owner.engine;b.fontTexture=this.fontTexture;for(var d=new Float32Array(4),f=0;4>f;f++)d[f]=f;b.vb=c.createVertexBuffer(d);var g=new Float32Array(6);g[0]=0,g[1]=2,g[2]=1,g[3]=0,g[4]=3,g[5]=2,b.ib=c.createIndexBuffer(g);var h=this.getDataPartEffectInfo(e.TEXT2D_MAINPARTID,["index"],!0);return h&&(b.effectInstanced=c.createEffect("text2d",h.attributes,h.uniforms,["diffuseSampler"],h.defines,null)),h=this.getDataPartEffectInfo(e.TEXT2D_MAINPARTID,["index"],!1),b.effect=c.createEffect("text2d",h.attributes,h.uniforms,["diffuseSampler"],h.defines,null),b},e.prototype.createInstanceDataParts=function(){return[new c(e.TEXT2D_MAINPARTID,this._charCount)]},e.prototype.beforeRefreshForLayoutConstruction=function(a){if(!this._charCount){var b=this._text;return this.text="A",b}},e.prototype.afterRefreshForLayoutConstruction=function(a,b){void 0!==b&&(this.text=b)},e.prototype.refreshInstanceDataPart=function(b){if(!d.prototype.refreshInstanceDataPart.call(this,b))return!1;if(b.id===e.TEXT2D_MAINPARTID){var c=b,f=this.fontTexture,g=f.getSize(),h=a.Vector2.Zero(),i=this.fontTexture.lineHeight;h.y=(this.textSize.height/i-1)*i;var j=0;c.dataElementCount=this._charCount,c.curElement=0;for(var k=0,l=this.text;k<l.length;k++){var m=l[k];if("\n"===m&&(h.x=0,h.y-=f.lineHeight),"	"!==m){if(!(" ">m)){this.updateInstanceDataPart(c,h);var n=f.getChar(m);h.x+=n.charWidth,c.topLeftUV=n.topLeftUV;var o=n.bottomRightUV.subtract(n.topLeftUV);c.sizeUV=o,c.textureSize=new a.Vector2(g.width,g.height),c.color=this.defaultFontColor,++c.curElement}}else{var p=j+this._tabulationSize;p-=p%this._tabulationSize,h.x+=(p-j)*f.spaceWidth,j=p}}}return!0},e.prototype._updateCharCount=function(){for(var a=0,b=0,c=this._text;b<c.length;b++){var d=c[b];"\r"===d||"\n"===d||"	"===d||" ">d||++a}this._charCount=a},e.TEXT2D_MAINPARTID=1,__decorate([a.modelLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(a){return e.fontProperty=a},!1,!0)],e.prototype,"fontName",null),__decorate([a.dynamicLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(a){return e.defaultFontColorProperty=a})],e.prototype,"defaultFontColor",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(a){return e.textProperty=a},!1,!0)],e.prototype,"text",null),__decorate([a.instanceLevelProperty(a.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(a){return e.sizeProperty=a})],e.prototype,"size",null),e=__decorate([a.className("Text2D")],e)}(a.RenderablePrim2D);a.Text2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(a,c){b.call(this,a,c),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(c,b),c.prototype.render=function(b,c){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var d=b.owner.owner.engine,e=0;this.effectFill&&this.effectBorder&&(e=d.getDepthFunction(),d.setDepthFunctionToLessOrEqual());var f=d.getAlphaMode();if(this.effectFill){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_FILLPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectFillInstanced:this.effectFill;if(d.enableEffect(i),d.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,i),c.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_FILLPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingFillAttributes),d.draw(!0,0,this.fillIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var g=b.partIndexFromId.get(a.Shape2D.SHAPE2D_BORDERPARTID.toString()),h=c.groupInfoPartData[g];c.renderMode!==a.Render2DContext.RenderModeOpaque&&d.setAlphaMode(a.Engine.ALPHA_COMBINE);var i=c.useInstancing?this.effectBorderInstanced:this.effectBorder;if(d.enableEffect(i),d.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,i),c.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(a.Shape2D.SHAPE2D_BORDERPARTID,i)),d.updateAndBindInstancesBuffer(h._partBuffer,null,this.instancingBorderAttributes),d.draw(!0,0,this.borderIndicesCount,h._partData.usedElementCount),d.unbindInstanceAttributes();else for(var j=c.partDataStartIndex;j<c.partDataEndIndex;j++)this.setupUniforms(i,g,h._partData,j),d.draw(!0,0,this.borderIndicesCount)}return d.setAlphaMode(f),this.effectFill&&this.effectBorder&&d.setDepthFunction(e),!0},c.prototype.dispose=function(){return b.prototype.dispose.call(this)?(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0):!1},c}(a.ModelRenderCache);a.Lines2DRenderCache=b;var c=function(b){function c(a){b.call(this,a,1)}return __extends(c,b),Object.defineProperty(c.prototype,"boundingMin",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"boundingMax",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([a.instanceData(a.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],c.prototype,"boundingMin",null),__decorate([a.instanceData(a.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],c.prototype,"boundingMax",null),c}(a.Shape2DInstanceData);a.Lines2DInstanceData=c;var d=function(d){function e(b,c){c||(c={}),d.call(this,c),this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,this._size=a.Size.Zero(),this._boundingMin=null,this._boundingMax=null;var e=null==c.fillThickness?1:c.fillThickness,f=null==c.startCap?0:c.startCap,g=null==c.endCap?0:c.endCap,h=null==c.closed?!1:c.closed;this.points=b,this.fillThickness=e,this.startCap=f,this.endCap=g,this.closed=h}return __extends(e,d),Object.defineProperty(e,"NoCap",{get:function(){return e._noCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RoundCap",{get:function(){return e._roundCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TriangleCap",{get:function(){return e._triangleCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"SquareAnchorCap",{get:function(){return e._squareAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RoundAnchorCap",{get:function(){return e._roundAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DiamondAnchorCap",{get:function(){return e._diamondAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ArrowCap",{get:function(){return e._arrowCap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{get:function(){return this._points},set:function(a){this._points=a,this._boundingBoxDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillThickness",{get:function(){return this._fillThickness},set:function(a){this._fillThickness=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startCap",{get:function(){return this._startCap},set:function(a){this._startCap=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endCap",{get:function(){return this._endCap},set:function(a){this._endCap=a},enumerable:!0,configurable:!0}),e.prototype.levelIntersect=function(b){var c=this;null==this._contour&&this._computeLines2D();var d=this.points.length,f=this.closed?d+1:d,g=b._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,e._prevA),this.transformPointWithOriginToRef(this._contour[1],null,e._prevB);for(var h=1;f>h;h++){if(this.transformPointWithOriginToRef(this._contour[h%d*2+0],null,e._curA),this.transformPointWithOriginToRef(this._contour[h%d*2+1],null,e._curB),a.Vector2.PointInTriangle(g,e._prevA,e._prevB,e._curA))return!0;if(a.Vector2.PointInTriangle(g,e._curA,e._prevB,e._curB))return!0;e._prevA.x=e._curA.x,e._prevA.y=e._curA.y,e._prevB.x=e._curB.x,e._prevB.y=e._curB.y}var i=function(b,d){for(var f=b.length,h=0;f>h;h+=3)if(e._curA.x=d[2*b[h+0]+0],e._curA.y=d[2*b[h+0]+1],c.transformPointWithOriginToRef(e._curA,null,e._curB),e._curA.x=d[2*b[h+1]+0],e._curA.y=d[2*b[h+1]+1],c.transformPointWithOriginToRef(e._curA,null,e._prevA),e._curA.x=d[2*b[h+2]+0],e._curA.y=d[2*b[h+2]+1],c.transformPointWithOriginToRef(e._curA,null,e._prevB),a.Vector2.PointInTriangle(g,e._prevA,e._prevB,e._curB))return!0;return!1};if(this._startCapTriIndices){if(i(this._startCapTriIndices,this._startCapContour))return!0;if(i(this._endCapTriIndices,this._endCapContour))return!0}return!1},Object.defineProperty(e.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingMax",{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax},enumerable:!0,configurable:!0}),e.prototype.getUsedShaderCategories=function(b){var c=d.prototype.getUsedShaderCategories.call(this,b),e=c.indexOf(a.Shape2D.SHAPE2D_CATEGORY_BORDER);return-1!==e&&c.splice(e,1),c},e.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D(),a.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,this._levelBoundingInfo)},e.prototype.createModelRenderCache=function(a){var c=new b(this.owner.engine,a);return c},e.prototype._perp=function(a,b){b.x=a.y,b.y=-a.x},e.prototype._direction=function(a,b,c){a.subtractToRef(b,c),c.normalize()},e.prototype._computeMiter=function(b,c,d,f){return d.addToRef(f,b),b.normalize(),c.x=-b.y,c.y=b.x,e._miterTps.x=-d.y,e._miterTps.y=d.x,1/a.Vector2.Dot(c,e._miterTps)},e.prototype._intersect=function(a,b,c,d,e,f,g,h){var i=(a-c)*(f-h)-(b-d)*(e-g);if(0===i)return!1;var j=((e-g)*(a*d-b*c)-(a-c)*(e*h-f*g))/i;return j<Math.min(a,c)||j>Math.max(a,c)?!1:!(j<Math.min(e,g)||j>Math.max(e,g))},e.prototype._updateMinMax=function(a,b){b>=a.length||(this._boundingMin.x=Math.min(this._boundingMin.x,a[b]),this._boundingMax.x=Math.max(this._boundingMax.x,a[b]),this._boundingMin.y=Math.min(this._boundingMin.y,a[b+1]),this._boundingMax.y=Math.max(this._boundingMax.y,a[b+1]))},e.prototype._store=function(b,c,d,f,g,h,i,j,k){var l=null!=j&&!isNaN(j),m=d*(l?8:4);if(!(m>=b.length)){0===d?this._perp(h,e._startDir):d===f-1&&(this._perp(h,e._endDir),e._endDir.x*=-1,e._endDir.y*=-1);var n=!1;if(b[m+0]=g.x+h.x*i,b[m+1]=g.y+h.y*i,b[m+2]=g.x+h.x*-i,b[m+3]=g.y+h.y*-i,this._updateMinMax(b,m),this._updateMinMax(b,m+2),void 0!==k){var o=k*(l?8:4);if(this._intersect(b[m+0],b[m+1],b[o+0],b[o+1],b[m+2],b[m+3],b[o+2],b[o+3])){n=!0;var p=b[m+0];b[m+0]=b[m+2],b[m+2]=p,p=b[m+1],b[m+1]=b[m+3],b[m+3]=p}}if(l){var q=i+j;b[m+4]=g.x+h.x*(n?-q:q),b[m+5]=g.y+h.y*(n?-q:q),b[m+6]=g.x+h.x*(n?q:-q),b[m+7]=g.y+h.y*(n?q:-q),this._updateMinMax(b,m+4),this._updateMinMax(b,m+6)}c&&(m+=l?4:0,c.push(new a.Vector2(b[m+0],b[m+1])),c.push(new a.Vector2(b[m+2],b[m+3])))}},e.prototype._getCapSize=function(a,b){void 0===b&&(b=!1);var c=e._roundCapSubDiv,d=0,f=0;switch(a){case e.NoCap:!this.closed&&b?(d=4,f=6):d=f=0;break;case e.RoundCap:b?(d=c,f=3*(c-2)):(d=c/2+1,f=c/2*3);break;case e.ArrowCap:b?(d=12,f=24):(d=3,f=3);break;case e.TriangleCap:b?(d=6,f=12):(d=3,f=3);break;case e.DiamondAnchorCap:b?(d=10,f=24):(d=5,f=9);break;case e.SquareAnchorCap:b?(d=12,f=30):(d=4,f=6);break;case e.RoundAnchorCap:b?(d=2*c,f=6*(c-1)):(d=c+1,f=3*(c+1))}return{vbsize:2*d,ibsize:f}},e.prototype._storeVertex=function(a,b,c,d,f,g,h){var i=Math.cos(f),j=Math.sin(f);e._tpsV.x=i*g.x+-j*g.y+d.x,e._tpsV.y=j*g.x+i*g.y+d.y;var k=b+2*c;return a[k+0]=e._tpsV.x,a[k+1]=e._tpsV.y,h&&(h.push(e._tpsV.x),h.push(e._tpsV.y)),this._updateMinMax(a,k),(b+2*c)/2},e.prototype._storeIndex=function(a,b,c,d){a[b+c]=d},e.prototype._buildCap=function(b,c,d,f,g,h,i,j,k,l){var m=e._roundCapSubDiv,n=new a.Vector2(1,0),o=Math.atan2(k.y,k.x)-Math.atan2(n.y,n.x),p=h/2,q=h,r=null!=i,s=i;switch(j){case e.NoCap:if(r&&!this.closed){var t=0,u=0,v=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,p+s),l),w=this._storeVertex(b,c,t++,g,o,new a.Vector2(s,p+s),l),x=this._storeVertex(b,c,t++,g,o,new a.Vector2(s,-(p+s)),l),y=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,-(p+s)),l);this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,y)}break;case e.ArrowCap:p*=2;case e.TriangleCap:if(r){var z=j===e.TriangleCap?s:Math.sqrt(s*s*2),v=this._storeVertex(b,c,0,g,o,new a.Vector2(0,p),null),w=this._storeVertex(b,c,1,g,o,new a.Vector2(p,0),null),x=this._storeVertex(b,c,2,g,o,new a.Vector2(0,-p),null),y=this._storeVertex(b,c,3,g,o,new a.Vector2(0,p+z),l),A=this._storeVertex(b,c,4,g,o,new a.Vector2(p+z,0),l),B=this._storeVertex(b,c,5,g,o,new a.Vector2(0,-(p+z)),l),u=0;if(this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,A),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,A),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,A),j===e.ArrowCap){var C=h/2,D=this._storeVertex(b,c,9,g,o,new a.Vector2(0,-(C+s)),null),E=this._storeVertex(b,c,11,g,o,new a.Vector2(-s,-(p+z)),l),F=this._storeVertex(b,c,10,g,o,new a.Vector2(-s,-(C+s)),l),G=this._storeVertex(b,c,6,g,o,new a.Vector2(0,C+s),null),H=this._storeVertex(b,c,7,g,o,new a.Vector2(-s,C+s),l),I=this._storeVertex(b,c,8,g,o,new a.Vector2(-s,p+z),l);this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,E),this._storeIndex(d,f,u++,F),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,E)}}else{var v=this._storeVertex(b,c,0,g,o,new a.Vector2(0,p),l),w=this._storeVertex(b,c,1,g,o,new a.Vector2(p,0),l),x=this._storeVertex(b,c,2,g,o,new a.Vector2(0,-p),l);this._storeIndex(d,f,0,v),this._storeIndex(d,f,1,w),this._storeIndex(d,f,2,x)}break;case e.RoundCap:if(r)for(var J=-Math.PI/2,K=Math.PI/(m/2-1),u=0,L=0;m/2>L;L++){var v=this._storeVertex(b,c,2*L+0,g,o,new a.Vector2(Math.cos(J)*p,Math.sin(J)*p),null),w=this._storeVertex(b,c,2*L+1,g,o,new a.Vector2(Math.cos(J)*(p+s),Math.sin(J)*(p+s)),l);L>0&&(this._storeIndex(d,f,u++,v-2),this._storeIndex(d,f,u++,w-2),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,v-2),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,v)),J+=K}else{var M=this._storeVertex(b,c,0,g,o,new a.Vector2(0,0),null),J=-Math.PI/2,K=Math.PI/(m/2-1);this._storeVertex(b,c,1,g,o,new a.Vector2(Math.cos(J)*p,Math.sin(J)*p),null),J+=K;for(var L=1;m/2>L;L++){var w=this._storeVertex(b,c,L+1,g,o,new a.Vector2(Math.cos(J)*p,Math.sin(J)*p),l);this._storeIndex(d,f,3*L+0,M),this._storeIndex(d,f,3*L+1,w-1),this._storeIndex(d,f,3*L+2,w),J+=K}}break;case e.SquareAnchorCap:var t=0,M=r?null:l,v=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,q),M),w=this._storeVertex(b,c,t++,g,o,new a.Vector2(2*q,q),M),x=this._storeVertex(b,c,t++,g,o,new a.Vector2(2*q,-q),M),y=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,-q),M);if(r){var A=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,p+s),null),B=this._storeVertex(b,c,t++,g,o,new a.Vector2(-s,p+s),l),G=this._storeVertex(b,c,t++,g,o,new a.Vector2(-s,q+s),l),H=this._storeVertex(b,c,t++,g,o,new a.Vector2(2*q+s,q+s),l),I=this._storeVertex(b,c,t++,g,o,new a.Vector2(2*q+s,-(q+s)),l),D=this._storeVertex(b,c,t++,g,o,new a.Vector2(-s,-(q+s)),l),F=this._storeVertex(b,c,t++,g,o,new a.Vector2(-s,-(p+s)),l),E=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,-(p+s)),null),u=0;this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,A),this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,F),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,F),this._storeIndex(d,f,u++,E),this._storeIndex(d,f,u++,y)}else this._storeIndex(d,f,0,v),this._storeIndex(d,f,1,w),this._storeIndex(d,f,2,x),this._storeIndex(d,f,3,v),this._storeIndex(d,f,4,x),this._storeIndex(d,f,5,y);break;case e.RoundAnchorCap:var N=Math.sqrt(q*q-p*p),O=new a.Vector2(N,0),J=a.Tools.ToRadians(-150),K=a.Tools.ToRadians(300)/(m-1);if(r)for(var u=0,L=0;m>L;L++){var v=this._storeVertex(b,c,2*L+0,g,o,new a.Vector2(N+Math.cos(J)*q,Math.sin(J)*q),null),w=this._storeVertex(b,c,2*L+1,g,o,new a.Vector2(N+Math.cos(J)*(q+s),Math.sin(J)*(q+s)),l);L>0&&(this._storeIndex(d,f,u++,v-2),this._storeIndex(d,f,u++,w-2),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,v-2),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,v)),J+=K}else{var M=this._storeVertex(b,c,0,g,o,O,null);this._storeVertex(b,c,1,g,o,new a.Vector2(N+Math.cos(J)*q,Math.sin(J)*q),null),J+=K;for(var L=1;m>L;L++){var w=this._storeVertex(b,c,L+1,g,o,new a.Vector2(N+Math.cos(J)*q,Math.sin(J)*q),l);this._storeIndex(d,f,3*L+0,M),this._storeIndex(d,f,3*L+1,w-1),this._storeIndex(d,f,3*L+2,w),J+=K}this._storeIndex(d,f,3*m+0,M),this._storeIndex(d,f,3*m+1,M+1),this._storeIndex(d,f,3*m+2,M+m)}break;case e.DiamondAnchorCap:var t=0,M=r?null:l,v=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,p),M),w=this._storeVertex(b,c,t++,g,o,new a.Vector2(p,q),M),x=this._storeVertex(b,c,t++,g,o,new a.Vector2(3*p,0),M),y=this._storeVertex(b,c,t++,g,o,new a.Vector2(p,-q),M),A=this._storeVertex(b,c,t++,g,o,new a.Vector2(0,-p),M);if(r){var z=Math.sqrt(s*s*2),B=this._storeVertex(b,c,t++,g,o,new a.Vector2(-z,p),l),G=this._storeVertex(b,c,t++,g,o,new a.Vector2(p,q+z),l),H=this._storeVertex(b,c,t++,g,o,new a.Vector2(3*p+z,0),l),I=this._storeVertex(b,c,t++,g,o,new a.Vector2(p,-(q+z)),l),D=this._storeVertex(b,c,t++,g,o,new a.Vector2(-z,-p),l),u=0;this._storeIndex(d,f,u++,B),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,v),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,G),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,w),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,H),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,x),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,I),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,y),this._storeIndex(d,f,u++,D),this._storeIndex(d,f,u++,A)}else this._storeIndex(d,f,0,v),this._storeIndex(d,f,1,w),this._storeIndex(d,f,2,x),this._storeIndex(d,f,3,v),this._storeIndex(d,f,4,x),this._storeIndex(d,f,5,A),this._storeIndex(d,f,6,A),this._storeIndex(d,f,7,x),this._storeIndex(d,f,8,y)}return null},e.prototype._buildLine=function(b,c,d,e){var f=a.Vector2.Zero(),g=a.Vector2.Zero(),h=a.Vector2.Zero(),i=a.Vector2.Zero(),j=null;this.closed&&this.points.push(this.points[0]);for(var k=this.points.length,l=1;k>l;l++){var m=this.points[l-1],n=this.points[l],o=l<this.points.length-1?this.points[l+1]:null;if(this._direction(n,m,f),j||(j=a.Vector2.Zero(),this._perp(f,j)),1===l&&this._store(b,c,0,k,this.points[0],j,d,e),o){this._direction(o,n,g);var p=this._computeMiter(h,i,f,g);this._store(b,c,l,k,this.points[l],i,p*d,p*e,l-1)}else this._perp(f,j),this._store(b,c,l,k,this.points[l],j,d,e,l-1)}if(this.points.length>2&&this.closed){var q=this.points[k-2],r=this.points[0],s=this.points[1];this._direction(r,q,f),this._direction(s,r,g),this._perp(f,j);var t=this._computeMiter(h,i,f,g);if(this._store(b,null,0,k,this.points[0],i,t*d,t*e,1),c){var u=null==e?0:4;c[0].x=b[u+0],c[0].y=b[u+1],c[1].x=b[u+2],c[1].y=b[u+3]}}this.closed&&this.points.splice(k-1)},e.prototype.setupModelRenderCache=function(b){var c=b,d=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){c.fillVB=d.createVertexBuffer(this._fillVB),c.fillIB=d.createIndexBuffer(this._fillIB),c.fillIndicesCount=this._fillIB.length;var e=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["position"],!0);e&&(c.effectFillInstanced=d.createEffect("lines2d",e.attributes,e.uniforms,[],e.defines,null)),e=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_FILLPARTID,["position"],!1),c.effectFill=d.createEffect("lines2d",e.attributes,e.uniforms,[],e.defines,null)}if(this.border){c.borderVB=d.createVertexBuffer(this._borderVB),c.borderIB=d.createIndexBuffer(this._borderIB),c.borderIndicesCount=this._borderIB.length;var e=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["position"],!0);e&&(c.effectBorderInstanced=d.createEffect({vertex:"lines2d",fragment:"lines2d"},e.attributes,e.uniforms,[],e.defines,null)),e=this.getDataPartEffectInfo(a.Shape2D.SHAPE2D_BORDERPARTID,["position"],!1),c.effectBorder=d.createEffect({vertex:"lines2d",fragment:"lines2d"},e.attributes,e.uniforms,[],e.defines,null)}return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,c},e.prototype._computeLines2D=function(){this._boundingMin=new a.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),this._boundingMax=new a.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);var b=new Array,c=new Array,d=new Array;if(this.fill){var f=this._getCapSize(this.startCap),g=this._getCapSize(this.endCap),h=this.points.length,i=2*h*2+f.vbsize+g.vbsize;this._fillVB=new Float32Array(i);var j=this._fillVB,k=this.fillThickness/2,l=this.points.length;this._buildLine(j,this.border?null:b,k);var m=2*l,n=2*(h-(this.closed?0:1));this._fillIB=new Float32Array(3*n+f.ibsize+g.ibsize);for(var o=this._fillIB,p=0;n>p;p+=2)o[3*p+0]=p+0,o[3*p+1]=p+1,o[3*p+2]=(p+2)%m,o[3*p+3]=p+1,o[3*p+4]=(p+3)%m,o[3*p+5]=(p+2)%m;this._buildCap(j,2*h*2,o,3*n,this.points[0],this.fillThickness,null,this.startCap,e._startDir,this.border?null:c),this._buildCap(j,2*h*2+f.vbsize,o,3*n+f.ibsize,this.points[l-1],this.fillThickness,null,this.endCap,e._endDir,this.border?null:c)}if(this.border){var f=this._getCapSize(this.startCap,!0),g=this._getCapSize(this.endCap,!0),h=this.points.length,i=2*h*2*2+f.vbsize+g.vbsize;this._borderVB=new Float32Array(i);var j=this._borderVB,k=this.fillThickness/2,q=this.borderThickness,l=this.points.length;this._buildLine(j,b,k,q);var m=2*l*2,n=2*(h-(this.closed?0:1))*2;this._borderIB=new Float32Array(3*n+f.ibsize+g.ibsize);for(var o=this._borderIB,p=0;n>p;p+=4)o[3*p+0]=p+0,o[3*p+1]=p+2,o[3*p+2]=(p+6)%m,o[3*p+3]=p+0,o[3*p+4]=(p+6)%m,o[3*p+5]=(p+4)%m,o[3*p+6]=p+3,o[3*p+7]=p+1,o[3*p+8]=(p+5)%m,o[3*p+9]=p+3,o[3*p+10]=(p+5)%m,o[3*p+11]=(p+7)%m;this._buildCap(j,2*h*2*2,o,3*n,this.points[0],this.fillThickness,this.borderThickness,this.startCap,e._startDir,c),this._buildCap(j,2*h*2*2+f.vbsize,o,3*n+f.ibsize,this.points[l-1],this.fillThickness,this.borderThickness,this.endCap,e._endDir,d)}if(this._contour=b,c.length>0){var r=Earcut.earcut(c,null,2);this._startCapTriIndices=r,this._startCapContour=c}if(d.length>0){var s=Earcut.earcut(d,null,2);this._endCapContour=d,this._endCapTriIndices=s}var t=this._boundingMax.subtract(this._boundingMin);this._size.width=t.x,this._size.height=t.y},Object.defineProperty(e.prototype,"size",{get:function(){return null==this._size&&this._computeLines2D(),this._size},enumerable:!0,configurable:!0}),e.prototype.createInstanceDataParts=function(){var b=new Array;return this.border&&b.push(new c(a.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&b.push(new c(a.Shape2D.SHAPE2D_FILLPARTID)),b},e.prototype.refreshInstanceDataPart=function(b){if(!d.prototype.refreshInstanceDataPart.call(this,b))return!1;if(b.id===a.Shape2D.SHAPE2D_BORDERPARTID){var c=b;this.border instanceof a.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax)}else if(b.id===a.Shape2D.SHAPE2D_FILLPARTID){var c=b;this.fill instanceof a.GradientColorBrush2D&&(c.boundingMin=this.boundingMin,c.boundingMax=this.boundingMax)}return!0},e._prevA=a.Vector2.Zero(),e._prevB=a.Vector2.Zero(),e._curA=a.Vector2.Zero(),e._curB=a.Vector2.Zero(),e._miterTps=a.Vector2.Zero(),e._startDir=a.Vector2.Zero(),e._endDir=a.Vector2.Zero(),e._tpsV=a.Vector2.Zero(),e._noCap=0,e._roundCap=1,e._triangleCap=2,e._squareAnchorCap=3,e._roundAnchorCap=4,e._diamondAnchorCap=5,e._arrowCap=6,e._roundCapSubDiv=36,__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+1,function(a){return e.pointsProperty=a})],e.prototype,"points",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+2,function(a){return e.fillThicknessProperty=a})],e.prototype,"fillThickness",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+3,function(a){return e.closedProperty=a})],e.prototype,"closed",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+4,function(a){return e.startCapProperty=a})],e.prototype,"startCap",null),__decorate([a.modelLevelProperty(a.Shape2D.SHAPE2D_PROPCOUNT+5,function(a){return e.endCapProperty=a})],e.prototype,"endCap",null),e=__decorate([a.className("Lines2D")],e)}(a.Shape2D);a.Lines2D=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._modelCache=new a.StringDictionary}return b.prototype.GetOrAddModelCache=function(a,b){return this._modelCache.getOrAddWithFactory(a,b)},b.prototype.DisposeModelRenderCache=function(a){return a.isDisposed?(this._modelCache.remove(a.modelKey),!0):!1},b}();a.Canvas2DEngineBoundData=b;var c=function(c){function d(e,f){var g=this;c.call(this,f),this.worldSpaceToNodeLocal=function(b){var c=g._worldSpaceNode;if(c){var d=c.getWorldMatrix().clone();d.invert();var e=a.Vector3.TransformCoordinates(b,d),f=g._renderScaleFactor,h=new a.Vector2(e.x*f,e.y*f),i=g.actualSize;return g.origin,h.x+=.5*i.width,h.y+=.5*i.width,h}},this._notifDebugMode=!1,this._mapCounter=0,a.Prim2DBase._isCanvasInit=!1,f||(f={});var h=null==f.renderScaleFactor?1:f.renderScaleFactor;this._cachingStrategy!==d.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new a.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:f.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=a.Vector2.Zero(),this._background.levelVisible=!1,null!=f.backgroundRoundRadius&&(this.backgroundRoundRadius=f.backgroundRoundRadius),null!=f.backgroundBorder&&("string"==typeof f.backgroundBorder?this.backgroundBorder=d.GetBrushFromString(f.backgroundBorder):this.backgroundBorder=f.backgroundBorder),null!=f.backgroundBorderThickNess&&(this.backgroundBorderThickness=f.backgroundBorderThickNess),null!=f.backgroundFill&&("string"==typeof f.backgroundFill?this.backgroundFill=d.GetBrushFromString(f.backgroundFill):this.backgroundFill=f.backgroundFill),this._background._patchHierarchy(this));var i=e.getEngine();this.__engineData=i.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",function(a){return new b}),this._renderScaleFactor=h,this._primPointerInfo=new a.PrimitivePointerInfo,this._capturedPointers=new a.StringDictionary,this._pickStartingPosition=a.Vector2.Zero(),this._hierarchyLevelMaxSiblingCount=50,this._hierarchyDepthOffset=0,this._siblingDepthOffset=1/this._hierarchyLevelMaxSiblingCount,this._scene=e,this._engine=i,this._renderingSize=new a.Size(0,0),this._trackedGroups=new Array,this._patchHierarchy(this);var j=null==f.enableInteraction?!0:f.enableInteraction;this._fitRenderingDevice=!f.size,f.size?(f.size.height*=h,f.size.width*=h):f.size=new a.Size(i.getRenderWidth(),i.getRenderHeight()),e.onDisposeObservable.add(function(a,b){g.dispose()}),this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add(function(a,b){g._engine.clear(null,!1,!0),g._render()}):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(a,b){g._render()}),this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays,this._setupInteraction(j)}return __extends(d,c),d.prototype._canvasPreInit=function(a){var b=null==a.cachingStrategy?d.CACHESTRATEGY_DONTCACHE:a.cachingStrategy;this._cachingStrategy=b,this._isScreenSpace=null==a.isScreenSpace?!0:a.isScreenSpace},d.prototype._setupInteraction=function(a){var b=this;if(a!==this._interactionEnabled)if(this._interactionEnabled=a,this._isScreenSpace){if(!a)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add(function(a,c){
var d=1/b.engine.getHardwareScalingLevel(),e=a.localPosition.multiplyByFloats(d,d);b._handlePointerEventForInteraction(a,e,c)})}else{var c=this.scene;a?(c.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=c.onPointerObservable.add(function(a,c){if(a.pickInfo.hit&&a.pickInfo.pickedMesh===b._worldSpaceNode&&b.worldSpaceToNodeLocal){var d=b.worldSpaceToNodeLocal(a.pickInfo.pickedPoint);b._handlePointerEventForInteraction(a,d,c)}})):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null)}},d.prototype._setPointerCapture=function(b,c){if(this.isPointerCaptured(b))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(b)}catch(d){}return this._primPointerInfo.updateRelatedTarget(c,a.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(c,a.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(b.toString(),c),!0},d.prototype._releasePointerCapture=function(b,c){if(this._capturedPointers.get(b.toString())!==c)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(b)}catch(d){}return this._primPointerInfo.updateRelatedTarget(c,a.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(c,a.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(b.toString()),!0},d.prototype.isPointerCaptured=function(a){return this._capturedPointers.contains(a.toString())},d.prototype.getCapturedPrimitive=function(a){return 0===this._capturedPointers.count?null:this._capturedPointers.get(a.toString())},d.prototype._handlePointerEventForInteraction=function(b,c,d){if(!this.isDisposed){this._updatePointerInfo(b,c);var e=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==e),this._updateOverStatus(),this._actualOverPrimitive||e){var f=e||this._actualOverPrimitive.prim,g=e?this._primPointerInfo.canvasPointerPos.subtract(new a.Vector2(f.globalTransform.m[12],f.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(f,g),b.type===a.PointerEventTypes.POINTERWHEEL?this._bubbleNotifyPrimPointerObserver(f,a.PrimitivePointerInfo.PointerMouseWheel,b.event):b.type===a.PointerEventTypes.POINTERMOVE?this._bubbleNotifyPrimPointerObserver(f,a.PrimitivePointerInfo.PointerMove,b.event):b.type===a.PointerEventTypes.POINTERDOWN?this._bubbleNotifyPrimPointerObserver(f,a.PrimitivePointerInfo.PointerDown,b.event):b.type===a.PointerEventTypes.POINTERUP&&this._bubbleNotifyPrimPointerObserver(f,a.PrimitivePointerInfo.PointerUp,b.event)}}},d.prototype._updatePointerInfo=function(b,c){var d=this._primPointerInfo;d.canvasPointerPos||(d.canvasPointerPos=a.Vector2.Zero());var e=this._scene.cameraToUseForPointers||this._scene.activeCamera,f=this._scene.getEngine();if(this._isScreenSpace){var g=e.viewport,h=g.toGlobal(f.getRenderWidth(),f.getRenderHeight()),i=c.x-h.x,j=c.y-h.y;d.canvasPointerPos.x=i-this.actualPosition.x,d.canvasPointerPos.y=f.getRenderHeight()-j-this.actualPosition.y}else d.canvasPointerPos.x=c.x,d.canvasPointerPos.y=c.y;if(d.mouseWheelDelta=0,b.type===a.PointerEventTypes.POINTERWHEEL){var k=b.event;k.wheelDelta?d.mouseWheelDelta=k.wheelDelta/(40*a.PrimitivePointerInfo.MouseWheelPrecision):k.detail&&(d.mouseWheelDelta=-k.detail/a.PrimitivePointerInfo.MouseWheelPrecision)}else{var l=b.event;d.ctrlKey=l.ctrlKey,d.altKey=l.altKey,d.shiftKey=l.shiftKey,d.metaKey=l.metaKey,d.button=l.button,d.buttons=l.buttons,d.pointerId=l.pointerId,d.width=l.width,d.height=l.height,d.presssure=l.pressure,d.tilt.x=l.tiltX,d.tilt.y=l.tiltY,d.isCaptured=null!==this.getCapturedPrimitive(l.pointerId)}},d.prototype._updateIntersectionList=function(a,b){if(this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);var c=d._interInfo;if(c.pickPosition.x=a.x,c.pickPosition.y=a.y,c.findFirstOnly=!1,!b&&!this.boundingInfo.doesIntersect(c.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(c),this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=c.intersectedPrimitives,this._previousOverPrimitive=this._actualOverPrimitive,this._actualOverPrimitive=c.topMostIntersectedPrimitive,this._intersectionRenderId=this.scene.getRenderId()}},d.prototype._updateOverStatus=function(){if(this.scene.getRenderId()!==this._hoverStatusRenderId&&this._previousIntersectionList&&this._actualIntersectionList){var b=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,c=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(b!==c){var d=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(d&&d===b||!d&&b)&&(this._primPointerInfo.updateRelatedTarget(b,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(b,a.PrimitivePointerInfo.PointerOut,null)),(d&&d===c||!d&&c)&&(this._primPointerInfo.updateRelatedTarget(c,this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(c,a.PrimitivePointerInfo.PointerOver,null))}this._hoverStatusRenderId=this.scene.getRenderId()}},d.prototype._updatePrimPointerPos=function(a){if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var b=0,c=this._actualIntersectionList;b<c.length;b++){var d=c[b];if(d.prim===a)return void(this._primPointerInfo.primitivePointerPos=d.intersectionLocation)}},d.prototype._debugExecObserver=function(b,c){if(this._notifDebugMode){for(var d="",e=0;e<b.hierarchyDepth;e++)d+="  ";var f=this._primPointerInfo;d+="[RID:"+this.scene.getRenderId()+"] ["+b.hierarchyDepth+"] event:"+a.PrimitivePointerInfo.getEventTypeName(c)+", id: "+b.id+" ("+a.Tools.getClassName(b)+"), primPos: "+f.primitivePointerPos.toString()+", canvasPos: "+f.canvasPointerPos.toString(),console.log(d)}},d.prototype._bubbleNotifyPrimPointerObserver=function(b,c,d){var e=this._primPointerInfo;0!==(c&(a.PrimitivePointerInfo.PointerOver|a.PrimitivePointerInfo.PointerOut))&&this._notifParents(b,c);for(var f=!1,g=b;g;){if(!f&&(this._updatePrimPointerPos(g),this._debugExecObserver(g,c),g._pointerEventObservable.notifyObservers(e,c),this._triggerActionManager(g,e,c,d),e.cancelBubble)){if(0===(c&(a.PrimitivePointerInfo.PointerOver|a.PrimitivePointerInfo.PointerOut)))return;f=!0}f&&this._updatePrimPointerPos(g),c===a.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(g,a.PrimitivePointerInfo.PointerEnter),g._pointerEventObservable.notifyObservers(e,a.PrimitivePointerInfo.PointerEnter)):c===a.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(g,a.PrimitivePointerInfo.PointerLeave),g._pointerEventObservable.notifyObservers(e,a.PrimitivePointerInfo.PointerLeave)),g=g.parent}},d.prototype._triggerActionManager=function(b,c,d,e){var f=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(d&a.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=c.primitivePointerPos.clone(),this._pickStartingTime=(new Date).getTime(),this._pickedDownPrim=null,b.actionManager){if(this._pickedDownPrim=b,b.actionManager.hasPickTriggers){var g=a.ActionEvent.CreateNewFromPrimitive(b,c.primitivePointerPos,e);switch(e.button){case 0:b.actionManager.processTrigger(a.ActionManager.OnLeftPickTrigger,g);break;case 1:b.actionManager.processTrigger(a.ActionManager.OnCenterPickTrigger,g);break;case 2:b.actionManager.processTrigger(a.ActionManager.OnRightPickTrigger,g)}b.actionManager.processTrigger(a.ActionManager.OnPickDownTrigger,g)}b.actionManager.hasSpecificTrigger(a.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var c=f._primPointerInfo,d=f.getCapturedPrimitive(c.pointerId);f._updateIntersectionList(c.canvasPointerPos,null!==d);var g=new a.IntersectInfo2D;g.pickPosition=c.canvasPointerPos.clone(),g.findFirstOnly=!1,f.intersect(g),null!==g.isPrimIntersected(b)&&b.actionManager&&0!==f._pickStartingTime&&(new Date).getTime()-f._pickStartingTime>a.ActionManager.LongPressDelay&&Math.abs(f._pickStartingPosition.x-g.pickPosition.x)<a.ActionManager.DragMovementThreshold&&Math.abs(f._pickStartingPosition.y-g.pickPosition.y)<a.ActionManager.DragMovementThreshold&&(f._pickStartingTime=0,b.actionManager.processTrigger(a.ActionManager.OnLongPressTrigger,a.ActionEvent.CreateNewFromPrimitive(b,c.primitivePointerPos,e)))},a.ActionManager.LongPressDelay)}}else if(0!==(d&a.PrimitivePointerInfo.PointerUp)){this._pickStartingTime=0;var g=a.ActionEvent.CreateNewFromPrimitive(b,c.primitivePointerPos,e);b.actionManager&&(b.actionManager.processTrigger(a.ActionManager.OnPickUpTrigger,g),Math.abs(this._pickStartingPosition.x-c.canvasPointerPos.x)<a.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-c.canvasPointerPos.y)<a.ActionManager.DragMovementThreshold&&b.actionManager.processTrigger(a.ActionManager.OnPickTrigger,g)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==b&&this._pickedDownPrim.actionManager.processTrigger(a.ActionManager.OnPickOutTrigger,g)}else if(0!==(d&a.PrimitivePointerInfo.PointerOver)){if(b.actionManager){var g=a.ActionEvent.CreateNewFromPrimitive(b,c.primitivePointerPos,e);b.actionManager.processTrigger(a.ActionManager.OnPointerOverTrigger,g)}}else if(0!==(d&a.PrimitivePointerInfo.PointerOut)&&b.actionManager){var g=a.ActionEvent.CreateNewFromPrimitive(b,c.primitivePointerPos,e);b.actionManager.processTrigger(a.ActionManager.OnPointerOutTrigger,g)}},d.prototype._notifParents=function(b,c){for(var d=this._primPointerInfo,e=this;e;)this._updatePrimPointerPos(e),c===a.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(e,a.PrimitivePointerInfo.PointerEnter),e._pointerEventObservable.notifyObservers(d,a.PrimitivePointerInfo.PointerEnter)):c===a.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(e,a.PrimitivePointerInfo.PointerLeave),e._pointerEventObservable.notifyObservers(d,a.PrimitivePointerInfo.PointerLeave)),e=e.parent},d.prototype.dispose=function(){return c.prototype.dispose.call(this)?(this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),void(this._groupCacheMaps&&(this._groupCacheMaps.forEach(function(a){return a.dispose()}),this._groupCacheMaps=null))):!1},Object.defineProperty(d.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"worldSpaceCanvasNode",{get:function(){return this._worldSpaceNode},set:function(a){this._worldSpaceNode=a},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"supportInstancedArray",{get:function(){return this._supprtInstancedArray},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundFill",{get:function(){return this._background&&this._background.isVisible?this._background.fill:null},set:function(a){this.checkBackgroundAvailability(),a!==this._background.fill&&(this._background.fill=a,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundBorder",{get:function(){return this._background&&this._background.isVisible?this._background.border:null},set:function(a){this.checkBackgroundAvailability(),a!==this._background.border&&(this._background.border=a,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundBorderThickness",{get:function(){return this._background&&this._background.isVisible?this._background.borderThickness:null},set:function(a){this.checkBackgroundAvailability(),a!==this._background.borderThickness&&(this._background.borderThickness=a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:null},set:function(a){this.checkBackgroundAvailability(),a!==this._background.roundRadius&&(this._background.roundRadius=a,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"interactionEnabled",{get:function(){return this._interactionEnabled},set:function(a){this._setupInteraction(a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"_engineData",{get:function(){return this.__engineData},enumerable:!0,configurable:!0}),d.prototype.checkBackgroundAvailability=function(){if(this._cachingStrategy===d.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS")},d.prototype.onPrimBecomesDirty=function(){this._addPrimToDirtyList(this)},d.prototype._updateTrackedNodes=function(){var b=this.scene.cameraToUseForPointers||this.scene.activeCamera;b.getViewMatrix().multiplyToRef(b.getProjectionMatrix(),d._m);for(var c=this.engine.getRenderHeight(),e=b.viewport.toGlobal(this.engine.getRenderWidth(),c),f=0,g=this._trackedGroups;f<g.length;f++){var h=g[f];if(!h.isDisposed&&h.isVisible){var i=h.trackedNode,j=i.getWorldMatrix(),k=a.Vector3.Project(d._v,j,d._m,e);h.x=Math.round(k.x),h.y=Math.round(c-k.y)}}},d.prototype._updateCanvasState=function(){if(this.scene.getRenderId()!==this._updateRenderId){var b=!1,c=this.engine.getRenderWidth();c!==this._renderingSize.width&&(b=!0),this._renderingSize.width=c;var d=this.engine.getRenderHeight();d!==this._renderingSize.height&&(b=!0),this._renderingSize.height=d,b&&this._fitRenderingDevice&&(this.size=this._renderingSize,this._background&&(this._background.size=this.size),this._setLayoutDirty());var e=new a.PrepareRender2DContext;++this._globalTransformProcessStep,this.updateCachedStates(!1),this._prepareGroupRender(e),this._updateRenderId=this.scene.getRenderId()}},d.prototype._render=function(){this._updateTrackedNodes(),this._updateCanvasState(),this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1),this._updateOverStatus()),this.engine.setState(!1),this._groupRender(),this._cachingStrategy===d.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas()},d.prototype._allocateGroupCache=function(b,c,e){var f=b.actualSize;f=new a.Size(Math.ceil(f.width),Math.ceil(f.height)),e&&(f.width=Math.max(e.width,f.width),f.height=Math.max(e.height,f.height)),this._groupCacheMaps||(this._groupCacheMaps=new Array);for(var g=null,h=0,i=this._groupCacheMaps;h<i.length;h++){var j=i[h],k=j.allocateRect(f);if(k){g={node:k,texture:j};break}}if(!g){var l=new a.Size(d._groupTextureCacheSize,d._groupTextureCacheSize);(f.width>l.width||f.height>l.height)&&(l.width=Math.pow(2,Math.ceil(Math.log(f.width)/Math.log(2))),l.height=Math.pow(2,Math.ceil(Math.log(f.height)/Math.log(2))));var m="groupsMapChache"+this._mapCounter+"forCanvas"+this.id;j=new a.MapTexture(m,this._scene,l),this._groupCacheMaps.push(j);var k=j.allocateRect(f);g={node:k,texture:j}}if(b!==this||this._isScreenSpace){var k=g.node;if(this._cachingStrategy===d.CACHESTRATEGY_CANVAS){this._cachedCanvasGroup=a.Group2D._createCachedCanvasGroup(this);var n=new a.Sprite2D(j,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:k.contentSize,spriteLocation:k.pos});n.zOrder=1,n.origin=a.Vector2.Zero()}else{var n=new a.Sprite2D(j,{parent:c,id:"__cachedSpriteOfGroup__"+b.id,x:b.actualPosition.x,y:b.actualPosition.y,spriteSize:k.contentSize,spriteLocation:k.pos});n.origin=b.origin.clone(),g.sprite=n}}return g},d.prototype._registerTrackedNode=function(b){b._isFlagSet(a.SmartPropertyPrim.flagTrackedGroup)||(this._trackedGroups.push(b),b._setFlags(a.SmartPropertyPrim.flagTrackedGroup))},d.prototype._unregisterTrackedNode=function(b){if(b._isFlagSet(a.SmartPropertyPrim.flagTrackedGroup)){var c=this._trackedGroups.indexOf(b);-1!==c&&this._trackedGroups.splice(c,1),b._clearFlags(a.SmartPropertyPrim.flagTrackedGroup)}},d.GetSolidColorBrush=function(b){return d._solidColorBrushes.getOrAddWithFactory(b.toHexString(),function(){return new a.SolidColorBrush2D(b.clone(),!0)})},d.GetSolidColorBrushFromHex=function(b){return d._solidColorBrushes.getOrAddWithFactory(b,function(){return new a.SolidColorBrush2D(a.Color4.FromHexString(b),!0)})},d.GetGradientColorBrush=function(b,c,e,f,g){return void 0===e&&(e=a.Vector2.Zero()),void 0===f&&(f=0),void 0===g&&(g=1),d._gradientColorBrushes.getOrAddWithFactory(a.GradientColorBrush2D.BuildKey(b,c,e,f,g),function(){return new a.GradientColorBrush2D(b,c,e,f,g,!0)})},d.GetBrushFromString=function(b){b=b.trim();var c=b.split(",");if(1===c.length){var e=null;if(0===b.indexOf("solid:"))e=b.substr(6).trim();else{if(0!==b.indexOf("#"))return null;e=b}return d.GetSolidColorBrushFromHex(e)}0===c[0].indexOf("gradient:")&&(c[0]=c[0].substr(9).trim());try{var f=a.Color4.FromHexString(c[0].trim()),g=a.Color4.FromHexString(c[1].trim()),h=a.Vector2.Zero();if(c.length>2){var i=c[2].trim();if("["!==i.charAt(0)||"]"!==i.charAt(i.length-1))return null;var j=i.indexOf(":"),k=parseFloat(i.substr(1,j)),l=parseFloat(i.substr(j+1,i.length-(j+1)));h=new a.Vector2(k,l)}var m=0;c.length>3&&(m=a.Tools.ToRadians(parseFloat(c[3].trim())));var n=1;return c.length>4&&(n=parseFloat(c[4].trim())),d.GetGradientColorBrush(f,g,h,m,n)}catch(o){return null}},d.CACHESTRATEGY_TOPLEVELGROUPS=1,d.CACHESTRATEGY_ALLGROUPS=2,d.CACHESTRATEGY_CANVAS=3,d.CACHESTRATEGY_DONTCACHE=4,d.hierarchyLevelMaxSiblingCount=50,d._interInfo=new a.IntersectInfo2D,d._v=a.Vector3.Zero(),d._m=a.Matrix.Identity(),d._groupTextureCacheSize=1024,d._solidColorBrushes=new a.StringDictionary,d._gradientColorBrushes=new a.StringDictionary,d=__decorate([a.className("Canvas2D")],d)}(a.Group2D);a.Canvas2D=c;var d=function(b){function d(d,e,f){a.Prim2DBase._isCanvasInit=!0;var g=f;if(g.isScreenSpace=!1,g.size=e.clone(),f.cachingStrategy=null==f.cachingStrategy?c.CACHESTRATEGY_CANVAS:f.cachingStrategy,f.cachingStrategy!==c.CACHESTRATEGY_CANVAS)throw new Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");b.call(this,d,f),a.Prim2DBase._isCanvasInit=!1;var h=!f||null==f.customWorldSpaceNode,i=f?f.id||null:null;if(h){var j=new a.WorldSpaceCanvas2DNode(i,d,this),k=a.VertexData.CreatePlane({width:e.width,height:e.height,sideOrientation:f&&f.sideOrientation||a.Mesh.DEFAULTSIDE}),l=new a.StandardMaterial(i+"_Material",d);this.applyCachedTexture(k,l),k.applyToMesh(j,!1),l.specularColor=new a.Color3(0,0,0),l.disableLighting=!0,l.useAlphaFromDiffuseTexture=!0,j.position=f&&f.worldPosition||a.Vector3.Zero(),j.rotationQuaternion=f&&f.worldRotation||a.Quaternion.Identity(),j.material=l,this._worldSpaceNode=j}else this._worldSpaceNode=f.customWorldSpaceNode,this.applyCachedTexture(null,null)}return __extends(d,b),d=__decorate([a.className("WorldSpaceCanvas2D")],d)}(c);a.WorldSpaceCanvas2D=d;var e=function(b){function c(c,d){a.Prim2DBase._isCanvasInit=!0,b.call(this,c,d)}return __extends(c,b),c=__decorate([a.className("ScreenSpaceCanvas2D")],c)}(c);a.ScreenSpaceCanvas2D=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c),this._canvas=d}return __extends(b,a),b.prototype.dispose=function(){a.prototype.dispose.call(this),this._canvas&&(this._canvas.dispose(),this._canvas=null)},b}(a.Mesh);a.WorldSpaceCanvas2DNode=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.layoutDirtyOnPropertyChangedMask=0}return b.prototype.updateLayout=function(a){},Object.defineProperty(b.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),b.prototype.isLocked=function(){return this._isLocked},b.prototype.lock=function(){return this._isLocked?!1:(this._isLocked=!0,!0)},b=__decorate([a.className("LayoutEngineBase")],b)}();a.LayoutEngineBase=b;var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.updateLayout=function(b){if(b._isFlagSet(a.SmartPropertyPrim.flagLayoutDirty)){for(var c=0,d=b.children;c<d.length;c++){var e=d[c];this._doUpdate(e)}b._clearFlags(a.SmartPropertyPrim.flagLayoutDirty)}},c.prototype._doUpdate=function(b){b instanceof a.Canvas2D?b.layoutArea=b.actualSize:b.parent instanceof a.Canvas2D?b.layoutArea=b.owner.actualSize:b.layoutArea=b.parent.contentArea},Object.defineProperty(c.prototype,"isChildPositionAllowed",{get:function(){return!0},enumerable:!0,configurable:!0}),c.Singleton=new c,c=__decorate([a.className("CanvasLayoutEngine")],c)}(b);a.CanvasLayoutEngine=c;var d=function(b){function c(){b.call(this),this._isHorizontal=!0,this.layoutDirtyOnPropertyChangedMask=a.Prim2DBase.sizeProperty.flagId}return __extends(c,b),Object.defineProperty(c,"Horizontal",{get:function(){return c._horizontal||(c._horizontal=new c,c._horizontal.isHorizontal=!0,c._horizontal.lock()),c._horizontal},enumerable:!0,configurable:!0}),Object.defineProperty(c,"Vertical",{get:function(){return c._vertical||(c._vertical=new c,c._vertical.isHorizontal=!1,c._vertical.lock()),c._vertical},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isHorizontal",{get:function(){return this._isHorizontal},set:function(a){this.isLocked()||(this._isHorizontal=a)},enumerable:!0,configurable:!0}),c.prototype.updateLayout=function(b){if(b._isFlagSet(a.SmartPropertyPrim.flagLayoutDirty)){for(var c=0,d=0,e=this.isHorizontal,f=0,g=0,h=b.children;g<h.length;g++){var i=h[g],j=i.layoutArea;i.margin.computeArea(i.actualSize,j),f=Math.max(f,e?j.height:j.width)}for(var k=0,l=b.children;k<l.length;k++){var i=l[k];i.layoutAreaPos=new a.Vector2(c,d);var j=i.layoutArea;e?(c+=j.width,i.layoutArea=new a.Size(j.width,f)):(d+=j.height,i.layoutArea=new a.Size(f,j.height))}b._clearFlags(a.SmartPropertyPrim.flagLayoutDirty)}},Object.defineProperty(c.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),c._horizontal=null,c._vertical=null,c=__decorate([a.className("StackPanelLayoutEngine")],c)}(b);a.StackPanelLayoutEngine=d}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){b.call(this,c,d),this._textures={},this._floats={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._matrices3x3={},this._matrices2x2={},this._cachedWorldViewMatrix=new a.Matrix,this._shaderPath=e,f.needAlphaBlending=f.needAlphaBlending||!1,f.needAlphaTesting=f.needAlphaTesting||!1,f.attributes=f.attributes||["position","normal","uv"],f.uniforms=f.uniforms||["worldViewProjection"],f.samplers=f.samplers||[],f.defines=f.defines||[],this._options=f}return __extends(c,b),c.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},c.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},c.prototype._checkUniform=function(a){-1===this._options.uniforms.indexOf(a)&&this._options.uniforms.push(a)},c.prototype.setTexture=function(a,b){return-1===this._options.samplers.indexOf(a)&&this._options.samplers.push(a),this._textures[a]=b,this},c.prototype.setFloat=function(a,b){return this._checkUniform(a),this._floats[a]=b,this},c.prototype.setFloats=function(a,b){return this._checkUniform(a),this._floatsArrays[a]=b,this},c.prototype.setColor3=function(a,b){return this._checkUniform(a),this._colors3[a]=b,this},c.prototype.setColor4=function(a,b){return this._checkUniform(a),this._colors4[a]=b,this},c.prototype.setVector2=function(a,b){return this._checkUniform(a),this._vectors2[a]=b,this},c.prototype.setVector3=function(a,b){return this._checkUniform(a),this._vectors3[a]=b,this},c.prototype.setVector4=function(a,b){return this._checkUniform(a),this._vectors4[a]=b,this},c.prototype.setMatrix=function(a,b){return this._checkUniform(a),this._matrices[a]=b,this},c.prototype.setMatrix3x3=function(a,b){return this._checkUniform(a),this._matrices3x3[a]=b,this},c.prototype.setMatrix2x2=function(a,b){return this._checkUniform(a),this._matrices2x2[a]=b,this},c.prototype.isReady=function(b,c){var d=this.getScene(),e=d.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===d.getRenderId())return!0;var f=[],g=new a.EffectFallbacks;c&&f.push("#define INSTANCES");for(var h=0;h<this._options.defines.length;h++)f.push(this._options.defines[h]);b&&b.useBones&&b.computeBonesUsingShaders&&(f.push("#define NUM_BONE_INFLUENCERS "+b.numBoneInfluencers),f.push("#define BonesPerMesh "+(b.skeleton.bones.length+1)),g.addCPUSkinningFallback(0,b)),e.getAlphaTesting()&&f.push("#define ALPHATEST");var i=this._effect,j=f.join("\n");return this._effect=e.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,j,g,this.onCompiled,this.onError),this._effect.isReady()?(i!==this._effect&&d.resetCachedMaterial(),this._renderId=d.getRenderId(),!0):!1},c.prototype.bindOnlyWorldMatrix=function(a){var b=this.getScene();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",a),-1!==this._options.uniforms.indexOf("worldView")&&(a.multiplyToRef(b.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",a.multiply(b.getTransformMatrix()))},c.prototype.bind=function(a,c){if(this.bindOnlyWorldMatrix(a),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),c&&c.useBones&&c.computeBonesUsingShaders&&this._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c));for(var d in this._textures)this._effect.setTexture(d,this._textures[d]);for(d in this._floats)this._effect.setFloat(d,this._floats[d]);for(d in this._floatsArrays)this._effect.setArray(d,this._floatsArrays[d]);for(d in this._colors3)this._effect.setColor3(d,this._colors3[d]);for(d in this._colors4){var e=this._colors4[d];this._effect.setFloat4(d,e.r,e.g,e.b,e.a)}for(d in this._vectors2)this._effect.setVector2(d,this._vectors2[d]);for(d in this._vectors3)this._effect.setVector3(d,this._vectors3[d]);for(d in this._vectors4)this._effect.setVector4(d,this._vectors4[d]);for(d in this._matrices)this._effect.setMatrix(d,this._matrices[d]);for(d in this._matrices3x3)this._effect.setMatrix3x3(d,this._matrices3x3[d]);for(d in this._matrices2x2)this._effect.setMatrix2x2(d,this._matrices2x2[d])}b.prototype.bind.call(this,a,c)},c.prototype.clone=function(a){var b=new c(a,this.getScene(),this._shaderPath,this._options);return b},c.prototype.dispose=function(a,c){if(c)for(var d in this._textures)this._textures[d].dispose();this._textures={},b.prototype.dispose.call(this,a,c)},c.prototype.serialize=function(){var b=a.SerializationHelper.Serialize(this);b.customType="BABYLON.ShaderMaterial",b.options=this._options,b.shaderPath=this._shaderPath,b.textures={};for(var c in this._textures)b.textures[c]=this._textures[c].serialize();b.floats={};for(c in this._floats)b.floats[c]=this._floats[c];b.floatArrays={};for(c in this._floatsArrays)b.floatArrays[c]=this._floatsArrays[c];b.colors3={};for(c in this._colors3)b.colors3[c]=this._colors3[c].asArray();b.colors4={};for(c in this._colors4)b.colors4[c]=this._colors4[c].asArray();b.vectors2={};for(c in this._vectors2)b.vectors2[c]=this._vectors2[c].asArray();b.vectors3={};for(c in this._vectors3)b.vectors3[c]=this._vectors3[c].asArray();b.vectors4={};for(c in this._vectors4)b.vectors4[c]=this._vectors4[c].asArray();b.matrices={};for(c in this._matrices)b.matrices[c]=this._matrices[c].asArray();b.matrices3x3={};for(c in this._matrices3x3)b.matrices3x3[c]=this._matrices3x3[c];b.matrices2x2={};for(c in this._matrices2x2)b.matrices2x2[c]=this._matrices2x2[c];return b},c.Parse=function(b,d,e){var f=a.SerializationHelper.Parse(function(){return new c(b.name,d,b.shaderPath,b.options)},b,d,e);for(var g in b.textures)f.setTexture(g,a.Texture.Parse(b.textures[g],d,e));for(g in b.floats)f.setFloat(g,b.floats[g]);for(g in b.floatsArrays)f.setFloats(g,b.floatsArrays[g]);for(g in b.colors3)f.setColor3(g,a.Color3.FromArray(b.colors3[g]));for(g in b.colors4)f.setColor4(g,a.Color4.FromArray(b.colors4[g]));for(g in b.vectors2)f.setVector2(g,a.Vector2.FromArray(b.vectors2[g]));for(g in b.vectors3)f.setVector3(g,a.Vector3.FromArray(b.vectors3[g]));for(g in b.vectors4)f.setVector4(g,a.Vector4.FromArray(b.vectors4[g]));for(g in b.matrices)f.setMatrix(g,a.Matrix.FromArray(b.matrices[g]));for(g in b.matrices3x3)f.setMatrix3x3(g,b.matrices3x3[g]);for(g in b.matrices2x2)f.setMatrix2x2(g,b.matrices2x2[g]);return f},c}(a.Material);a.ShaderMaterial=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}var e=542327876,f=131072,g=512,h=4,i=64,j=131072,k=c("DXT1"),l=c("DXT3"),m=c("DXT5"),n=31,o=0,p=1,q=2,r=3,s=4,t=7,u=20,v=21,w=22,x=28,y=function(){function b(){}return b.GetDDSInfo=function(a){var b=new Int32Array(a,0,n),c=1;return b[q]&f&&(c=Math.max(1,b[t])),{width:b[s],height:b[r],mipmapCount:c,isFourCC:(b[u]&h)===h,isRGB:(b[u]&i)===i,isLuminance:(b[u]&j)===j,isCube:(b[x]&g)===g}},b.GetRGBAArrayBuffer=function(a,b,c,d,e){for(var f=new Uint8Array(d),g=new Uint8Array(e),h=0,i=b-1;i>=0;i--)for(var j=0;a>j;j++){var k=c+4*(j+i*a);f[h+2]=g[k],f[h+1]=g[k+1],f[h]=g[k+2],f[h+3]=g[k+3],h+=4}return f},b.GetRGBArrayBuffer=function(a,b,c,d,e){for(var f=new Uint8Array(d),g=new Uint8Array(e),h=0,i=b-1;i>=0;i--)for(var j=0;a>j;j++){var k=c+3*(j+i*a);f[h+2]=g[k],f[h+1]=g[k+1],f[h]=g[k+2],h+=3}return f},b.GetLuminanceArrayBuffer=function(a,b,c,d,e){for(var f=new Uint8Array(d),g=new Uint8Array(e),h=0,i=b-1;i>=0;i--)for(var j=0;a>j;j++){var k=c+(j+i*a);f[h]=g[k],h++}return f},b.UploadDDSLevels=function(c,g,h,i,j,u){var x,y,z,A,B,C,D,E,F,G,H=new Int32Array(h,0,n);if(H[o]!=e)return void a.Tools.Error("Invalid magic number in DDS header");if(!i.isFourCC&&!i.isRGB&&!i.isLuminance)return void a.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(i.isFourCC)switch(x=H[v]){case k:y=8,z=g.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case l:y=16,z=g.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case m:y=16,z=g.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",d(x))}F=1,H[q]&f&&j!==!1&&(F=Math.max(1,H[t]));for(var I=H[w],J=0;u>J;J++){var K=1===u?c.TEXTURE_2D:c.TEXTURE_CUBE_MAP_POSITIVE_X+J;for(A=H[s],B=H[r],D=H[p]+4,G=0;F>G;++G){if(i.isRGB)24===I?(C=A*B*3,E=b.GetRGBArrayBuffer(A,B,D,C,h),c.texImage2D(K,G,c.RGB,A,B,0,c.RGB,c.UNSIGNED_BYTE,E)):(C=A*B*4,E=b.GetRGBAArrayBuffer(A,B,D,C,h),c.texImage2D(K,G,c.RGBA,A,B,0,c.RGBA,c.UNSIGNED_BYTE,E));else if(i.isLuminance){var L=c.getParameter(c.UNPACK_ALIGNMENT),M=A,N=Math.floor((A+L-1)/L)*L;C=N*(B-1)+M,E=b.GetLuminanceArrayBuffer(A,B,D,C,h),c.texImage2D(K,G,c.LUMINANCE,A,B,0,c.LUMINANCE,c.UNSIGNED_BYTE,E)}else C=Math.max(4,A)/4*Math.max(4,B)/4*y,E=new Uint8Array(h,D,C),c.compressedTexImage2D(K,G,z,A,B,0,E);D+=C,A*=.5,B*=.5,A=Math.max(1,A),B=Math.max(1,B)}}},b}();b.DDSTools=y}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){return void 0===b&&(b=!0),void 0===c&&(c=10),this._useDeltaForWorldStep=b,
this.name="CannonJSPlugin",this._physicsMaterials=[],this._fixedTimeStep=1/60,this._currentCollisionGroup=2,this._minus90X=new a.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new a.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=a.Vector3.Zero(),this._tmpQuaternion=new a.Quaternion,this._tmpDeltaPosition=a.Vector3.Zero(),this._tmpDeltaRotation=new a.Quaternion,this._tmpUnityRotation=new a.Quaternion,this.isSupported()?(this.world=new CANNON.World,this.world.broadphase=new CANNON.NaiveBroadphase,void(this.world.solver.iterations=c)):void a.Tools.Error("CannonJS is not available. Please make sure you included the js file.")}return b.prototype.setGravity=function(a){this.world.gravity.copy(a)},b.prototype.setTimeStep=function(a){this._fixedTimeStep=a},b.prototype.executeStep=function(a,b){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?1e3*a:0,3)},b.prototype.applyImpulse=function(a,b,c){var d=new CANNON.Vec3(c.x,c.y,c.z),e=new CANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyImpulse(e,d)},b.prototype.applyForce=function(a,b,c){var d=new CANNON.Vec3(c.x,c.y,c.z),e=new CANNON.Vec3(b.x,b.y,b.z);a.physicsBody.applyImpulse(e,d)},b.prototype.generatePhysicsBody=function(a){if(a.parent)return void(a.physicsBody&&(this.removePhysicsBody(a),a.forceUpdate()));if(a.isBodyInitRequired()){var b=this._createShape(a),c=a.physicsBody;c&&this.removePhysicsBody(a);var d=this._addMaterial("mat-"+a.uniqueId,a.getParam("friction"),a.getParam("restitution")),e={mass:a.getParam("mass"),material:d},f=a.getParam("nativeOptions");for(var g in f)f.hasOwnProperty(g)&&(e[g]=f[g]);a.physicsBody=new CANNON.Body(e),a.physicsBody.addEventListener("collide",a.onCollide),this.world.addEventListener("preStep",a.beforeStep),this.world.addEventListener("postStep",a.afterStep),a.physicsBody.addShape(b),this.world.add(a.physicsBody),c&&["force","torque","velocity","angularVelocity"].forEach(function(b){a.physicsBody[b].copy(c[b])}),this._processChildMeshes(a)}this._updatePhysicsBodyTransformation(a)},b.prototype._processChildMeshes=function(b){var c=this,d=b.object.getChildMeshes?b.object.getChildMeshes():[];if(d.length){var e=function(a,d){var f=d.getPhysicsImpostor();if(f){var g=f.parent;if(g!==b){var a=d.position;f.physicsBody&&(c.removePhysicsBody(f),f.physicsBody=null),f.parent=b,f.resetUpdateFlags(),b.physicsBody.addShape(c._createShape(f),new CANNON.Vec3(a.x,a.y,a.z)),b.physicsBody.mass+=f.getParam("mass")}}d.getChildMeshes().forEach(e.bind(c,d.position))};d.forEach(e.bind(this,a.Vector3.Zero()))}},b.prototype.removePhysicsBody=function(a){a.physicsBody.removeEventListener("collide",a.onCollide),this.world.removeEventListener("preStep",a.beforeStep),this.world.removeEventListener("postStep",a.afterStep),this.world.remove(a.physicsBody)},b.prototype.generateJoint=function(b){var c=b.mainImpostor.physicsBody,d=b.connectedImpostor.physicsBody;if(c&&d){var e,f=b.joint.jointData,g={pivotA:f.mainPivot?(new CANNON.Vec3).copy(f.mainPivot):null,pivotB:f.connectedPivot?(new CANNON.Vec3).copy(f.connectedPivot):null,axisA:f.mainAxis?(new CANNON.Vec3).copy(f.mainAxis):null,axisB:f.connectedAxis?(new CANNON.Vec3).copy(f.connectedAxis):null,maxForce:f.nativeParams.maxForce,collideConnected:!!f.collision};switch(b.joint.type){case a.PhysicsJoint.HingeJoint:case a.PhysicsJoint.Hinge2Joint:e=new CANNON.HingeConstraint(c,d,g);break;case a.PhysicsJoint.DistanceJoint:e=new CANNON.DistanceConstraint(c,d,f.maxDistance||2);break;case a.PhysicsJoint.SpringJoint:var h=f;e=new CANNON.Spring(c,d,{restLength:h.length,stiffness:h.stiffness,damping:h.damping,localAnchorA:g.pivotA,localAnchorB:g.pivotB});break;case a.PhysicsJoint.LockJoint:e=new CANNON.LockConstraint(c,d,g);break;case a.PhysicsJoint.PointToPointJoint:case a.PhysicsJoint.BallAndSocketJoint:default:e=new CANNON.PointToPointConstraint(c,g.pivotA,d,g.pivotA,g.maxForce)}e.collideConnected=!!f.collision,b.joint.physicsJoint=e,b.joint.type!==a.PhysicsJoint.SpringJoint?this.world.addConstraint(e):b.mainImpostor.registerAfterPhysicsStep(function(){e.applyForce()})}},b.prototype.removeJoint=function(a){this.world.removeConstraint(a.joint.physicsJoint)},b.prototype._addMaterial=function(a,b,c){var d,e;for(d=0;d<this._physicsMaterials.length;d++)if(e=this._physicsMaterials[d],e.friction===b&&e.restitution===c)return e;var f=new CANNON.Material(a);return f.friction=b,f.restitution=c,this._physicsMaterials.push(f),f},b.prototype._checkWithEpsilon=function(b){return b<a.PhysicsEngine.Epsilon?a.PhysicsEngine.Epsilon:b},b.prototype._createShape=function(b){var c,d=b.object,e=b.getObjectExtendSize();switch(b.type){case a.PhysicsEngine.SphereImpostor:var f=e.x,g=e.y,h=e.z;c=new CANNON.Sphere(Math.max(this._checkWithEpsilon(f),this._checkWithEpsilon(g),this._checkWithEpsilon(h))/2);break;case a.PhysicsImpostor.CylinderImpostor:c=new CANNON.Cylinder(this._checkWithEpsilon(e.x)/2,this._checkWithEpsilon(e.x)/2,this._checkWithEpsilon(e.y),16);break;case a.PhysicsImpostor.BoxImpostor:var i=e.scale(.5);c=new CANNON.Box(new CANNON.Vec3(this._checkWithEpsilon(i.x),this._checkWithEpsilon(i.y),this._checkWithEpsilon(i.z)));break;case a.PhysicsImpostor.PlaneImpostor:a.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),c=new CANNON.Plane;break;case a.PhysicsImpostor.MeshImpostor:var j=d.getVerticesData?d.getVerticesData(a.VertexBuffer.PositionKind):[],k=d.getIndices?d.getIndices():[];a.Tools.Warn("MeshImpostor only collides against spheres."),c=new CANNON.Trimesh(j,k);break;case a.PhysicsImpostor.HeightmapImpostor:c=this._createHeightmap(d);break;case a.PhysicsImpostor.ParticleImpostor:c=new CANNON.Particle}return c},b.prototype._createHeightmap=function(b,c){for(var d=b.getVerticesData(a.VertexBuffer.PositionKind),e=[],f=c||~~(Math.sqrt(d.length/3)-1),g=Math.min(b.getBoundingInfo().boundingBox.extendSize.x,b.getBoundingInfo().boundingBox.extendSize.z),h=2*g/f,i=b.getBoundingInfo().boundingBox.extendSize.y,j=0;j<d.length;j+=3){var k=Math.round(d[j+0]/h+f/2),l=Math.round(-1*(d[j+2]/h-f/2)),m=d[j+1]+i;e[k]||(e[k]=[]),e[k][l]||(e[k][l]=m),e[k][l]=Math.max(m,e[k][l])}for(var k=0;f>=k;++k){if(!e[k]){for(var n=1;!e[(k+n)%f];)n++;e[k]=e[(k+n)%f].slice()}for(var l=0;f>=l;++l)if(!e[k][l]){for(var o,n=1;void 0===o;)o=e[k][(l+n++)%f];e[k][l]=o}}var p=new CANNON.Heightfield(e,{elementSize:h});return p.minY=i,p},b.prototype._updatePhysicsBodyTransformation=function(b){var c=b.object;c.computeWorldMatrix&&c.computeWorldMatrix(!0);var d=b.getObjectCenter();b.getObjectExtendSize(),this._tmpDeltaPosition.copyFrom(c.position.subtract(d)),this._tmpPosition.copyFrom(d);var e=c.rotationQuaternion;if(b.type!==a.PhysicsImpostor.PlaneImpostor&&b.type!==a.PhysicsImpostor.HeightmapImpostor&&b.type!==a.PhysicsImpostor.CylinderImpostor||(e=e.multiply(this._minus90X),b.setDeltaRotation(this._plus90X)),b.type===a.PhysicsEngine.HeightmapImpostor){var f=c,g=f.rotationQuaternion;f.rotationQuaternion=this._tmpUnityRotation,f.computeWorldMatrix(!0);var h=d.clone(),i=f.getPivotMatrix()||a.Matrix.Translation(0,0,0);f.rotationQuaternion=g;var j=a.Matrix.Translation(f.getBoundingInfo().boundingBox.extendSize.x,0,-f.getBoundingInfo().boundingBox.extendSize.z);f.setPivotMatrix(j),f.computeWorldMatrix(!0);var k=f.getBoundingInfo().boundingBox.center.subtract(d).subtract(f.position).negate();this._tmpPosition.copyFromFloats(k.x,k.y-f.getBoundingInfo().boundingBox.extendSize.y,k.z),this._tmpDeltaPosition.copyFrom(f.getBoundingInfo().boundingBox.center.subtract(h)),this._tmpDeltaPosition.y+=f.getBoundingInfo().boundingBox.extendSize.y,f.setPivotMatrix(i),f.computeWorldMatrix(!0)}else b.type===a.PhysicsEngine.MeshImpostor&&(this._tmpDeltaPosition.copyFromFloats(0,0,0),this._tmpPosition.copyFrom(c.position));b.setDeltaPosition(this._tmpDeltaPosition),b.physicsBody.position.copy(this._tmpPosition),b.physicsBody.quaternion.copy(e)},b.prototype.setTransformationFromPhysicsBody=function(a){a.object.position.copyFrom(a.physicsBody.position),a.object.rotationQuaternion.copyFrom(a.physicsBody.quaternion)},b.prototype.setPhysicsBodyTransformation=function(a,b,c){a.physicsBody.position.copy(b),a.physicsBody.quaternion.copy(c)},b.prototype.isSupported=function(){return void 0!==window.CANNON},b.prototype.setLinearVelocity=function(a,b){a.physicsBody.velocity.copy(b)},b.prototype.setAngularVelocity=function(a,b){a.physicsBody.angularVelocity.copy(b)},b.prototype.getLinearVelocity=function(b){var c=b.physicsBody.velocity;return c?new a.Vector3(c.x,c.y,c.z):null},b.prototype.getAngularVelocity=function(b){var c=b.physicsBody.angularVelocity;return c?new a.Vector3(c.x,c.y,c.z):null},b.prototype.setBodyMass=function(a,b){a.physicsBody.mass=b,a.physicsBody.updateMassProperties()},b.prototype.sleepBody=function(a){a.physicsBody.sleep()},b.prototype.wakeUpBody=function(a){a.physicsBody.wakeUp()},b.prototype.updateDistanceJoint=function(a,b,c){a.physicsJoint.distance=b},b.prototype.enableMotor=function(a,b){b||a.physicsJoint.enableMotor()},b.prototype.disableMotor=function(a,b){b||a.physicsJoint.disableMotor()},b.prototype.setMotor=function(a,b,c,d){d||(a.physicsJoint.enableMotor(),a.physicsJoint.setMotorSpeed(b),c&&this.setLimit(a,c))},b.prototype.setLimit=function(a,b,c){a.physicsJoint.motorEquation.maxForce=b,a.physicsJoint.motorEquation.minForce=void 0===c?-b:c},b.prototype.dispose=function(){},b}();a.CannonJSPlugin=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=a.Vector3.Zero(),this.world=new OIMO.World(1/60,2,b,!0),this.world.clear(),this.world.isNoStat=!0}return b.prototype.setGravity=function(a){this.world.gravity.copy(a)},b.prototype.setTimeStep=function(a){this.world.timeStep=a},b.prototype.executeStep=function(a,b){var c=this;b.forEach(function(a){a.beforeStep()}),this.world.step(),b.forEach(function(a){a.afterStep(),c._tmpImpostorsArray[a.uniqueId]=a});for(var d=this.world.contacts;null!==d;)if(!d.touching||d.body1.sleeping||d.body2.sleeping){var e=this._tmpImpostorsArray[+d.body1.name],f=this._tmpImpostorsArray[+d.body2.name];e&&f?(e.onCollide({body:f.physicsBody}),f.onCollide({body:e.physicsBody}),d=d.next):d=d.next}else d=d.next},b.prototype.applyImpulse=function(a,b,c){var d=a.physicsBody.massInfo.mass;a.physicsBody.applyImpulse(c.scale(OIMO.INV_SCALE),b.scale(OIMO.INV_SCALE*d))},b.prototype.applyForce=function(b,c,d){a.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(b,c,d)},b.prototype.generatePhysicsBody=function(b){function c(a){a.getChildMeshes&&a.getChildMeshes().forEach(function(a){a.physicsImpostor&&(g.push(a.physicsImpostor),a.physicsImpostor._init())})}function d(b){return Math.max(b,a.PhysicsEngine.Epsilon)}var e=this;if(b.parent)return void(b.physicsBody&&(this.removePhysicsBody(b),b.forceUpdate()));if(b.isBodyInitRequired()){var f={name:b.uniqueId,config:[b.getParam("mass")||1,b.getParam("friction"),b.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==b.getParam("mass"),world:this.world},g=[b];c(b.object),g.forEach(function(c){var g=c.object.rotationQuaternion,h=(new OIMO.Euler).setFromQuaternion({x:b.object.rotationQuaternion.x,y:b.object.rotationQuaternion.y,z:b.object.rotationQuaternion.z,s:b.object.rotationQuaternion.w}),i=c.getObjectExtendSize();if(c===b){var j=b.getObjectCenter();b.object.position.subtractToRef(j,e._tmpPositionVector),f.pos.push(j.x),f.pos.push(j.y),f.pos.push(j.z),f.rot.push(h.x/(OIMO.degtorad||OIMO.TO_RAD)),f.rot.push(h.y/(OIMO.degtorad||OIMO.TO_RAD)),f.rot.push(h.z/(OIMO.degtorad||OIMO.TO_RAD))}else f.pos.push(c.object.position.x),f.pos.push(c.object.position.y),f.pos.push(c.object.position.z),f.rot.push(0),f.rot.push(0),f.rot.push(0);switch(c.type){case a.PhysicsImpostor.ParticleImpostor:a.Tools.Warn("No Particle support in Oimo.js. using SphereImpostor instead");case a.PhysicsImpostor.SphereImpostor:var k=i.x,l=i.y,m=i.z,n=Math.max(d(k),d(l),d(m))/2;f.type.push("sphere"),f.size.push(n),f.size.push(n),f.size.push(n);break;case a.PhysicsImpostor.CylinderImpostor:var o=d(i.x)/2,p=d(i.y);f.type.push("cylinder"),f.size.push(o),f.size.push(p),f.size.push(p);break;case a.PhysicsImpostor.PlaneImpostor:case a.PhysicsImpostor.BoxImpostor:default:var o=d(i.x),p=d(i.y),q=d(i.z);f.type.push("box"),f.size.push(o),f.size.push(p),f.size.push(q)}c.object.rotationQuaternion=g}),b.physicsBody=new OIMO.Body(f).body}else this._tmpPositionVector.copyFromFloats(0,0,0);b.setDeltaPosition(this._tmpPositionVector)},b.prototype.removePhysicsBody=function(a){this.world.removeRigidBody(a.physicsBody)},b.prototype.generateJoint=function(b){var c=b.mainImpostor.physicsBody,d=b.connectedImpostor.physicsBody;if(c&&d){var e,f=b.joint.jointData,g=f.nativeParams||{},h={body1:c,body2:d,axe1:g.axe1||(f.mainAxis?f.mainAxis.asArray():null),axe2:g.axe2||(f.connectedAxis?f.connectedAxis.asArray():null),pos1:g.pos1||(f.mainPivot?f.mainPivot.asArray():null),pos2:g.pos2||(f.connectedPivot?f.connectedPivot.asArray():null),min:g.min,max:g.max,collision:g.collision||f.collision,spring:g.spring,world:this.world};switch(b.joint.type){case a.PhysicsJoint.BallAndSocketJoint:e="jointBall";break;case a.PhysicsJoint.SpringJoint:a.Tools.Warn("Oimo.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var i=f;h.min=i.length||h.min,h.max=Math.max(h.min,h.max);case a.PhysicsJoint.DistanceJoint:e="jointDistance",h.max=f.maxDistance;break;case a.PhysicsJoint.PrismaticJoint:e="jointPrisme";break;case a.PhysicsJoint.SliderJoint:e="jointSlide";break;case a.PhysicsJoint.WheelJoint:e="jointWheel";break;case a.PhysicsJoint.HingeJoint:default:e="jointHinge"}h.type=e,b.joint.physicsJoint=new OIMO.Link(h).joint}},b.prototype.removeJoint=function(b){try{this.world.removeJoint(b.joint.physicsJoint)}catch(c){a.Tools.Warn(c)}},b.prototype.isSupported=function(){return void 0!==OIMO},b.prototype.setTransformationFromPhysicsBody=function(a){if(!a.physicsBody.sleeping){if(a.physicsBody.shapes.next){var b=this._getLastShape(a.physicsBody);a.object.position.x=b.position.x*OIMO.WORLD_SCALE,a.object.position.y=b.position.y*OIMO.WORLD_SCALE,a.object.position.z=b.position.z*OIMO.WORLD_SCALE}else a.object.position.copyFrom(a.physicsBody.getPosition());a.object.rotationQuaternion.copyFrom(a.physicsBody.getQuaternion()),a.object.rotationQuaternion.normalize()}},b.prototype.setPhysicsBodyTransformation=function(a,b,c){var d=a.physicsBody;d.position.init(b.x*OIMO.INV_SCALE,b.y*OIMO.INV_SCALE,b.z*OIMO.INV_SCALE),d.orientation.init(c.w,c.x,c.y,c.z),d.syncShapes(),d.awake()},b.prototype._getLastShape=function(a){for(var b=a.shapes;b.next;)b=b.next;return b},b.prototype.setLinearVelocity=function(a,b){a.physicsBody.linearVelocity.init(b.x,b.y,b.z)},b.prototype.setAngularVelocity=function(a,b){a.physicsBody.angularVelocity.init(b.x,b.y,b.z)},b.prototype.getLinearVelocity=function(b){var c=b.physicsBody.linearVelocity;return c?new a.Vector3(c.x,c.y,c.z):null},b.prototype.getAngularVelocity=function(b){var c=b.physicsBody.angularVelocity;return c?new a.Vector3(c.x,c.y,c.z):null},b.prototype.setBodyMass=function(a,b){var c=0===b;a.physicsBody.shapes.density=c?1:b,a.physicsBody.setupMass(c?2:1)},b.prototype.sleepBody=function(a){a.physicsBody.sleep()},b.prototype.wakeUpBody=function(a){a.physicsBody.awake()},b.prototype.updateDistanceJoint=function(a,b,c){a.physicsJoint.limitMotoe.upperLimit=b,void 0!==c&&(a.physicsJoint.limitMotoe.lowerLimit=c)},b.prototype.setMotor=function(a,b,c,d){var e=d?a.physicsJoint.rotationalLimitMotor2:a.physicsJoint.rotationalLimitMotor1||a.physicsJoint.rotationalLimitMotor||a.physicsJoint.limitMotor;e&&e.setMotor(b,c)},b.prototype.setLimit=function(a,b,c,d){var e=d?a.physicsJoint.rotationalLimitMotor2:a.physicsJoint.rotationalLimitMotor1||a.physicsJoint.rotationalLimitMotor||a.physicsJoint.limitMotor;e&&e.setLimit(b,void 0===c?-b:c)},b.prototype.dispose=function(){this.world.clear()},b}();a.OimoJSPlugin=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this,b,"displayPass",["passSampler"],["passSampler"],c,d,e,f,g)}return __extends(b,a),b}(a.PostProcess);a.DisplayPassPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a,b,c){this.quality=a,this.distance=b,this.optimizeMesh=c}return a}();a.SimplificationSettings=b;var c=function(){function b(){this.running=!1,this._simplificationArray=[]}return b.prototype.addTask=function(a){this._simplificationArray.push(a)},b.prototype.executeNext=function(){var a=this._simplificationArray.pop();a?(this.running=!0,this.runSimplification(a)):this.running=!1},b.prototype.runSimplification=function(b){var c=this;if(b.parallelProcessing)b.settings.forEach(function(a){var d=c.getSimplifier(b);d.simplify(a,function(d){b.mesh.addLODLevel(a.distance,d),d.isVisible=!0,a.quality===b.settings[b.settings.length-1].quality&&b.successCallback&&b.successCallback(),c.executeNext()})});else{var d=this.getSimplifier(b),e=function(a,c){d.simplify(a,function(d){b.mesh.addLODLevel(a.distance,d),d.isVisible=!0,c()})};a.AsyncLoop.Run(b.settings.length,function(a){e(b.settings[a.index],function(){a.executeNext()})},function(){b.successCallback&&b.successCallback(),c.executeNext()})}},b.prototype.getSimplifier=function(a){switch(a.simplificationType){case d.QUADRATIC:default:return new i(a.mesh)}},b}();a.SimplificationQueue=c,function(a){a[a.QUADRATIC=0]="QUADRATIC"}(a.SimplificationType||(a.SimplificationType={}));var d=a.SimplificationType,e=function(){function a(a){this.vertices=a,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return a}();a.DecimationTriangle=e;var f=function(){function a(a,b){this.position=a,this.id=b,this.isBorder=!0,this.q=new g,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return a.prototype.updatePosition=function(a){this.position.copyFrom(a)},a}();a.DecimationVertex=f;var g=function(){function a(a){this.data=new Array(10);for(var b=0;10>b;++b)a&&a[b]?this.data[b]=a[b]:this.data[b]=0}return a.prototype.det=function(a,b,c,d,e,f,g,h,i){var j=this.data[a]*this.data[e]*this.data[i]+this.data[c]*this.data[d]*this.data[h]+this.data[b]*this.data[f]*this.data[g]-this.data[c]*this.data[e]*this.data[g]-this.data[a]*this.data[f]*this.data[h]-this.data[b]*this.data[d]*this.data[i];return j},a.prototype.addInPlace=function(a){for(var b=0;10>b;++b)this.data[b]+=a.data[b]},a.prototype.addArrayInPlace=function(a){for(var b=0;10>b;++b)this.data[b]+=a[b]},a.prototype.add=function(b){for(var c=new a,d=0;10>d;++d)c.data[d]=this.data[d]+b.data[d];return c},a.FromData=function(b,c,d,e){return new a(a.DataFromNumbers(b,c,d,e))},a.DataFromNumbers=function(a,b,c,d){return[a*a,a*b,a*c,a*d,b*b,b*c,b*d,c*c,c*d,d*d]},a}();a.QuadraticMatrix=g;var h=function(){function a(a,b){this.vertexId=a,this.triangleId=b}return a}();a.Reference=h;var i=function(){function b(b){this._mesh=b,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=a.Epsilon}return b.prototype.simplify=function(b,c){var d=this;this.initDecimatedMesh(),a.AsyncLoop.Run(this._mesh.subMeshes.length,function(a){d.initWithMesh(a.index,function(){d.runDecimation(b,a.index,function(){a.executeNext()})},b.optimizeMesh)},function(){setTimeout(function(){c(d._reconstructedMesh)},0)})},b.prototype.isTriangleOnBoundingBox=function(a){var b=this,c=0;return a.vertices.forEach(function(a){var d=0,e=a.position,f=b._mesh.getBoundingInfo().boundingBox;(f.maximum.x-e.x<b.boundingBoxEpsilon||e.x-f.minimum.x>b.boundingBoxEpsilon)&&++d,f.maximum.y!==e.y&&e.y!==f.minimum.y||++d,f.maximum.z!==e.z&&e.z!==f.minimum.z||++d,d>1&&++c}),c>1&&console.log(a,c),c>1},b.prototype.runDecimation=function(b,c,d){var e=this,f=~~(this.triangles.length*b.quality),g=0,h=this.triangles.length,i=function(b,c){setTimeout(function(){b%5===0&&e.updateMesh(0===b);for(var d=0;d<e.triangles.length;++d)e.triangles[d].isDirty=!1;var i=1e-9*Math.pow(b+3,e.aggressiveness),j=function(b){var c=~~((e.triangles.length/2+b)%e.triangles.length),d=e.triangles[c];if(d&&!(d.error[3]>i||d.deleted||d.isDirty))for(var f=0;3>f;++f)if(d.error[f]<i){var h=[],j=[],k=d.vertices[f],l=d.vertices[(f+1)%3];if(k.isBorder||l.isBorder)continue;var m=a.Vector3.Zero(),n=a.Vector3.Zero(),o=a.Vector2.Zero(),p=new a.Color4(0,0,0,1);e.calculateError(k,l,m,n,o,p);var q=[];if(e.isFlipped(k,l,m,h,d.borderFactor,q))continue;if(e.isFlipped(l,k,m,j,d.borderFactor,q))continue;if(h.indexOf(!0)<0||j.indexOf(!0)<0)continue;var r=[];if(q.forEach(function(a){-1===r.indexOf(a)&&(a.deletePending=!0,r.push(a))}),r.length%2!==0)continue;k.q=l.q.add(k.q),k.updatePosition(m);var s=e.references.length;g=e.updateTriangles(k,k,h,g),g=e.updateTriangles(k,l,j,g);var t=e.references.length-s;if(t<=k.triangleCount){if(t)for(var u=0;t>u;u++)e.references[k.triangleStart+u]=e.references[s+u]}else k.triangleStart=s;k.triangleCount=t;break}};a.AsyncLoop.SyncAsyncForLoop(e.triangles.length,e.syncIterations,j,c,function(){return f>=h-g})},0)};a.AsyncLoop.Run(this.decimationIterations,function(a){f>=h-g?a.breakLoop():i(a.index,function(){a.executeNext()})},function(){setTimeout(function(){e.reconstructMesh(c),d()},0)})},b.prototype.initWithMesh=function(b,c,d){var g=this;this.vertices=[],this.triangles=[];var h=this._mesh.getVerticesData(a.VertexBuffer.PositionKind),i=this._mesh.getIndices(),j=this._mesh.subMeshes[b],k=function(a){if(d)for(var b=0;b<g.vertices.length;++b)if(g.vertices[b].position.equals(a))return g.vertices[b];return null},l=[],m=function(b){var c=b+j.verticesStart,d=a.Vector3.FromArray(h,3*c),e=k(d)||new f(d,g.vertices.length);e.originalOffsets.push(c),e.id===g.vertices.length&&g.vertices.push(e),l.push(e.id)},n=j.verticesCount;a.AsyncLoop.SyncAsyncForLoop(n,this.syncIterations/4>>0,m,function(){var b=function(a){var b=j.indexStart/3+a,c=3*b,d=i[c+0],f=i[c+1],h=i[c+2],k=g.vertices[l[d-j.verticesStart]],m=g.vertices[l[f-j.verticesStart]],n=g.vertices[l[h-j.verticesStart]],o=new e([k,m,n]);o.originalOffset=c,g.triangles.push(o)};a.AsyncLoop.SyncAsyncForLoop(j.indexCount/3,g.syncIterations,b,function(){g.init(c)})})},b.prototype.init=function(b){var c=this,d=function(b){var d=c.triangles[b];d.normal=a.Vector3.Cross(d.vertices[1].position.subtract(d.vertices[0].position),d.vertices[2].position.subtract(d.vertices[0].position)).normalize();for(var e=0;3>e;e++)d.vertices[e].q.addArrayInPlace(g.DataFromNumbers(d.normal.x,d.normal.y,d.normal.z,-a.Vector3.Dot(d.normal,d.vertices[0].position)))};a.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,d,function(){var d=function(a){for(var b=c.triangles[a],d=0;3>d;++d)b.error[d]=c.calculateError(b.vertices[d],b.vertices[(d+1)%3]);b.error[3]=Math.min(b.error[0],b.error[1],b.error[2])};a.AsyncLoop.SyncAsyncForLoop(c.triangles.length,c.syncIterations,d,function(){c.initialized=!0,b()})})},b.prototype.reconstructMesh=function(b){var c,d=[];for(c=0;c<this.vertices.length;++c)this.vertices[c].triangleCount=0;var e,f;for(c=0;c<this.triangles.length;++c)if(!this.triangles[c].deleted){for(e=this.triangles[c],f=0;3>f;++f)e.vertices[f].triangleCount=1;d.push(e)}var g=this._reconstructedMesh.getVerticesData(a.VertexBuffer.PositionKind)||[],h=this._reconstructedMesh.getVerticesData(a.VertexBuffer.NormalKind)||[],i=this._reconstructedMesh.getVerticesData(a.VertexBuffer.UVKind)||[],j=this._reconstructedMesh.getVerticesData(a.VertexBuffer.ColorKind)||[],k=this._mesh.getVerticesData(a.VertexBuffer.NormalKind),l=this._mesh.getVerticesData(a.VertexBuffer.UVKind),m=this._mesh.getVerticesData(a.VertexBuffer.ColorKind),n=0;for(c=0;c<this.vertices.length;++c){var o=this.vertices[c];o.id=n,o.triangleCount&&o.originalOffsets.forEach(function(a){g.push(o.position.x),g.push(o.position.y),g.push(o.position.z),h.push(k[3*a]),h.push(k[3*a+1]),h.push(k[3*a+2]),l&&l.length?(i.push(l[2*a]),i.push(l[2*a+1])):m&&m.length&&(j.push(m[4*a]),j.push(m[4*a+1]),j.push(m[4*a+2]),j.push(m[4*a+3])),++n})}var p=this._reconstructedMesh.getTotalIndices(),q=this._reconstructedMesh.getTotalVertices(),r=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var s=this._reconstructedMesh.getIndices(),t=this._mesh.getIndices();for(c=0;c<d.length;++c)e=d[c],[0,1,2].forEach(function(a){var b=t[e.originalOffset+a],c=e.vertices[a].originalOffsets.indexOf(b);0>c&&(c=0),s.push(e.vertices[a].id+c+q)});this._reconstructedMesh.setIndices(s),this._reconstructedMesh.setVerticesData(a.VertexBuffer.PositionKind,g),this._reconstructedMesh.setVerticesData(a.VertexBuffer.NormalKind,h),i.length>0&&this._reconstructedMesh.setVerticesData(a.VertexBuffer.UVKind,i),j.length>0&&this._reconstructedMesh.setVerticesData(a.VertexBuffer.ColorKind,j);var u=this._mesh.subMeshes[b];b>0&&(this._reconstructedMesh.subMeshes=[],r.forEach(function(b){new a.SubMesh(b.materialIndex,b.verticesStart,b.verticesCount,b.indexStart,b.indexCount,b.getMesh())}),new a.SubMesh(u.materialIndex,q,n,p,3*d.length,this._reconstructedMesh))},b.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new a.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},b.prototype.isFlipped=function(b,c,d,e,f,g){for(var h=0;h<b.triangleCount;++h){var i=this.triangles[this.references[b.triangleStart+h].triangleId];if(!i.deleted){var j=this.references[b.triangleStart+h].vertexId,k=i.vertices[(j+1)%3],l=i.vertices[(j+2)%3];if(k!==c&&l!==c){var m=k.position.subtract(d);m=m.normalize();var n=l.position.subtract(d);if(n=n.normalize(),Math.abs(a.Vector3.Dot(m,n))>.999)return!0;var o=a.Vector3.Cross(m,n).normalize();if(e[h]=!1,a.Vector3.Dot(o,i.normal)<.2)return!0}else e[h]=!0,g.push(i)}}return!1},b.prototype.updateTriangles=function(a,b,c,d){for(var e=d,f=0;f<b.triangleCount;++f){var g=this.references[b.triangleStart+f],h=this.triangles[g.triangleId];h.deleted||(c[f]&&h.deletePending?(h.deleted=!0,e++):(h.vertices[g.vertexId]=a,h.isDirty=!0,h.error[0]=this.calculateError(h.vertices[0],h.vertices[1])+h.borderFactor/2,h.error[1]=this.calculateError(h.vertices[1],h.vertices[2])+h.borderFactor/2,h.error[2]=this.calculateError(h.vertices[2],h.vertices[0])+h.borderFactor/2,h.error[3]=Math.min(h.error[0],h.error[1],h.error[2]),this.references.push(g)))}return e},b.prototype.identifyBorder=function(){for(var a=0;a<this.vertices.length;++a){var b,c=[],d=[],e=this.vertices[a];for(b=0;b<e.triangleCount;++b)for(var f=this.triangles[this.references[e.triangleStart+b].triangleId],g=0;3>g;g++){for(var h=0,i=f.vertices[g];h<c.length&&d[h]!==i.id;)++h;h===c.length?(c.push(1),d.push(i.id)):c[h]++}for(b=0;b<c.length;++b)1===c[b]?this.vertices[d[b]].isBorder=!0:this.vertices[d[b]].isBorder=!1}},b.prototype.updateMesh=function(a){void 0===a&&(a=!1);var b;if(!a){var c=[];for(b=0;b<this.triangles.length;++b)this.triangles[b].deleted||c.push(this.triangles[b]);this.triangles=c}for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleCount=0,this.vertices[b].triangleStart=0;var d,e,f;for(b=0;b<this.triangles.length;++b)for(d=this.triangles[b],e=0;3>e;++e)f=d.vertices[e],f.triangleCount++;var g=0;for(b=0;b<this.vertices.length;++b)this.vertices[b].triangleStart=g,g+=this.vertices[b].triangleCount,this.vertices[b].triangleCount=0;var i=new Array(3*this.triangles.length);for(b=0;b<this.triangles.length;++b)for(d=this.triangles[b],e=0;3>e;++e)f=d.vertices[e],i[f.triangleStart+f.triangleCount]=new h(e,b),f.triangleCount++;this.references=i,a&&this.identifyBorder()},b.prototype.vertexError=function(a,b){var c=b.x,d=b.y,e=b.z;return a.data[0]*c*c+2*a.data[1]*c*d+2*a.data[2]*c*e+2*a.data[3]*c+a.data[4]*d*d+2*a.data[5]*d*e+2*a.data[6]*d+a.data[7]*e*e+2*a.data[8]*e+a.data[9]},b.prototype.calculateError=function(b,c,d,e,f,g){var h=b.q.add(c.q),i=b.isBorder&&c.isBorder,j=0,k=h.det(0,1,2,1,4,5,2,5,7);if(0===k||i){var l=b.position.add(c.position).divide(new a.Vector3(2,2,2)),m=this.vertexError(h,b.position),n=this.vertexError(h,c.position),o=this.vertexError(h,l);j=Math.min(m,n,o),j===m?d&&d.copyFrom(b.position):j===n?d&&d.copyFrom(c.position):d&&d.copyFrom(l)}else d||(d=a.Vector3.Zero()),d.x=-1/k*h.det(1,2,3,4,5,6,5,7,8),d.y=1/k*h.det(0,2,3,1,5,6,2,7,8),d.z=-1/k*h.det(0,1,3,1,4,6,2,5,8),j=this.vertexError(h,d);return j},b}();a.QuadraticErrorSimplification=i}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=[],c=function(c,d){if(!b[c.id]){if(c instanceof a.Geometry.Primitives.Box)d.boxes.push(c.serialize());else if(c instanceof a.Geometry.Primitives.Sphere)d.spheres.push(c.serialize());else if(c instanceof a.Geometry.Primitives.Cylinder)d.cylinders.push(c.serialize());else if(c instanceof a.Geometry.Primitives.Torus)d.toruses.push(c.serialize());else if(c instanceof a.Geometry.Primitives.Ground)d.grounds.push(c.serialize());else if(c instanceof a.Geometry.Primitives.Plane)d.planes.push(c.serialize());else if(c instanceof a.Geometry.Primitives.TorusKnot)d.torusKnots.push(c.serialize());else{if(c instanceof a.Geometry.Primitives._Primitive)throw new Error("Unknown primitive type");d.vertexData.push(c.serializeVerticeData())}b[c.id]=!0}},d=function(b,d){var e={};e.name=b.name,e.id=b.id,a.Tags.HasTags(b)&&(e.tags=a.Tags.GetTags(b)),e.position=b.position.asArray(),b.rotationQuaternion?e.rotationQuaternion=b.rotationQuaternion.asArray():b.rotation&&(e.rotation=b.rotation.asArray()),e.scaling=b.scaling.asArray(),e.localMatrix=b.getPivotMatrix().asArray(),e.isEnabled=b.isEnabled(),e.isVisible=b.isVisible,e.infiniteDistance=b.infiniteDistance,e.pickable=b.isPickable,e.receiveShadows=b.receiveShadows,e.billboardMode=b.billboardMode,e.visibility=b.visibility,e.checkCollisions=b.checkCollisions,b.parent&&(e.parentId=b.parent.id);var f=b._geometry;if(f){var g=f.id;e.geometryId=g,b.getScene().getGeometryByID(g)||c(f,d.geometries),e.subMeshes=[];for(var h=0;h<b.subMeshes.length;h++){var i=b.subMeshes[h];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}b.material?e.materialId=b.material.id:b.material=null,b.skeleton&&(e.skeletonId=b.skeleton.id),b.getPhysicsImpostor()&&(e.physicsMass=b.getPhysicsMass(),e.physicsFriction=b.getPhysicsFriction(),e.physicsRestitution=b.getPhysicsRestitution(),e.physicsImpostor=b.getPhysicsImpostor().type),e.instances=[];for(var j=0;j<b.instances.length;j++){var k=b.instances[j],l={name:k.name,position:k.position.asArray(),scaling:k.scaling.asArray()};k.rotationQuaternion?l.rotationQuaternion=k.rotationQuaternion.asArray():k.rotation&&(l.rotation=k.rotation.asArray()),e.instances.push(l),a.Animation.AppendSerializedAnimations(k,l),l.ranges=k.serializeAnimationRanges()}return a.Animation.AppendSerializedAnimations(b,e),e.ranges=b.serializeAnimationRanges(),e.layerMask=b.layerMask,b.actionManager&&(e.actions=b.actionManager.serialize(b.name)),e},e=function(b,e){if(b.delayLoadState===a.Engine.DELAYLOADSTATE_LOADED||b.delayLoadState===a.Engine.DELAYLOADSTATE_NONE){b.material&&(b.material instanceof a.StandardMaterial?(e.materials=e.materials||[],e.materials.some(function(a){return a.id===b.material.id})||e.materials.push(b.material.serialize())):b.material instanceof a.MultiMaterial&&(e.multiMaterials=e.multiMaterials||[],e.multiMaterials.some(function(a){return a.id===b.material.id})||e.multiMaterials.push(b.material.serialize())));var f=b._geometry;f&&(e.geometries||(e.geometries={},e.geometries.boxes=[],e.geometries.spheres=[],e.geometries.cylinders=[],e.geometries.toruses=[],e.geometries.grounds=[],e.geometries.planes=[],e.geometries.torusKnots=[],e.geometries.vertexData=[]),c(f,e.geometries)),b.skeleton&&(e.skeletons=e.skeletons||[],e.skeletons.push(b.skeleton.serialize())),e.meshes=e.meshes||[],e.meshes.push(d(b,e))}},f=function(){function f(){}
return f.ClearCache=function(){b=[]},f.Serialize=function(e){var f={};f.useDelayedTextureLoading=e.useDelayedTextureLoading,f.autoClear=e.autoClear,f.clearColor=e.clearColor.asArray(),f.ambientColor=e.ambientColor.asArray(),f.gravity=e.gravity.asArray(),f.collisionsEnabled=e.collisionsEnabled,f.workerCollisions=e.workerCollisions,e.fogMode&&0!==e.fogMode&&(f.fogMode=e.fogMode,f.fogColor=e.fogColor.asArray(),f.fogStart=e.fogStart,f.fogEnd=e.fogEnd,f.fogDensity=e.fogDensity),e.isPhysicsEnabled()&&(f.physicsEnabled=!0,f.physicsGravity=e.getPhysicsEngine().gravity.asArray(),f.physicsEngine=e.getPhysicsEngine().getPhysicsPluginName()),f.lights=[];var g,h;for(g=0;g<e.lights.length;g++)h=e.lights[g],f.lights.push(h.serialize());for(f.cameras=[],g=0;g<e.cameras.length;g++){var i=e.cameras[g];f.cameras.push(i.serialize())}e.activeCamera&&(f.activeCameraID=e.activeCamera.id),a.Animation.AppendSerializedAnimations(e,f),f.materials=[],f.multiMaterials=[];var j;for(g=0;g<e.materials.length;g++)j=e.materials[g],f.materials.push(j.serialize());for(f.multiMaterials=[],g=0;g<e.multiMaterials.length;g++){var k=e.multiMaterials[g];f.multiMaterials.push(k.serialize())}for(f.skeletons=[],g=0;g<e.skeletons.length;g++)f.skeletons.push(e.skeletons[g].serialize());f.geometries={},f.geometries.boxes=[],f.geometries.spheres=[],f.geometries.cylinders=[],f.geometries.toruses=[],f.geometries.grounds=[],f.geometries.planes=[],f.geometries.torusKnots=[],f.geometries.vertexData=[],b=[];var l=e.getGeometries();for(g=0;g<l.length;g++){var m=l[g];m.isReady()&&c(m,f.geometries)}for(f.meshes=[],g=0;g<e.meshes.length;g++){var n=e.meshes[g];if(n instanceof a.Mesh){var o=n;o.delayLoadState!==a.Engine.DELAYLOADSTATE_LOADED&&o.delayLoadState!==a.Engine.DELAYLOADSTATE_NONE||f.meshes.push(d(o,f))}}for(f.particleSystems=[],g=0;g<e.particleSystems.length;g++)f.particleSystems.push(e.particleSystems[g].serialize());for(f.lensFlareSystems=[],g=0;g<e.lensFlareSystems.length;g++)f.lensFlareSystems.push(e.lensFlareSystems[g].serialize());for(f.shadowGenerators=[],g=0;g<e.lights.length;g++)h=e.lights[g],h.getShadowGenerator()&&f.shadowGenerators.push(h.getShadowGenerator().serialize());return e.actionManager&&(f.actions=e.actionManager.serialize("scene")),f},f.SerializeMesh=function(b,c,d){void 0===c&&(c=!1),void 0===d&&(d=!1);var f={};if(b=b instanceof Array?b:[b],c||d)for(var g=0;g<b.length;++g)d&&b[g].getDescendants().forEach(function(c){c instanceof a.Mesh&&b.indexOf(c)<0&&b.push(c)}),c&&b[g].parent&&b.indexOf(b[g].parent)<0&&b.push(b[g].parent);return b.forEach(function(a){e(a,f)}),f},f}();a.SceneSerializer=f}(BABYLON||(BABYLON={}));var Earcut;!function(a){function b(a,b,d){d=d||2;var f=b&&b.length,g=f?b[0]*d:a.length,h=c(a,0,g,d,!0),i=[];if(!h)return i;var k,l,m,n,o,p,q;if(f&&(h=j(a,b,h,d)),a.length>80*d){k=m=a[0],l=n=a[1];for(var r=d;g>r;r+=d)o=a[r],p=a[r+1],k>o&&(k=o),l>p&&(l=p),o>m&&(m=o),p>n&&(n=p);q=Math.max(m-k,n-l)}return e(h,i,d,k,l,q,void 0),i}function c(a,b,c,d,e){var f,g;if(e===E(a,b,c,d)>0)for(f=b;c>f;f+=d)g=A(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=A(f,a[f],a[f+1],g);return g&&u(g,g.next)&&(B(g),g=g.next),g}function d(a,b){if(!a)return a;b||(b=a);var c,d=a;do if(c=!1,d.steiner||!u(d,d.next)&&0!==t(d.prev,d,d.next))d=d.next;else{if(B(d),d=b=d.prev,d===d.next)return null;c=!0}while(c||d!==b);return b}function e(a,b,c,j,k,l,m){if(a){!m&&l&&n(a,j,k,l);for(var o,p,q=a;a.prev!==a.next;)if(o=a.prev,p=a.next,l?g(a,j,k,l):f(a))b.push(o.i/c),b.push(a.i/c),b.push(p.i/c),B(a),a=p.next,q=p.next;else if(a=p,a===q){m?1===m?(a=h(a,b,c),e(a,b,c,j,k,l,2)):2===m&&i(a,b,c,j,k,l):e(d(a,void 0),b,c,j,k,l,1);break}}}function f(a){var b=a.prev,c=a,d=a.next;if(t(b,c,d)>=0)return!1;for(var e=a.next.next;e!==a.prev;){if(r(b.x,b.y,c.x,c.y,d.x,d.y,e.x,e.y)&&t(e.prev,e,e.next)>=0)return!1;e=e.next}return!0}function g(a,b,c,d){var e=a.prev,f=a,g=a.next;if(t(e,f,g)>=0)return!1;for(var h=e.x<f.x?e.x<g.x?e.x:g.x:f.x<g.x?f.x:g.x,i=e.y<f.y?e.y<g.y?e.y:g.y:f.y<g.y?f.y:g.y,j=e.x>f.x?e.x>g.x?e.x:g.x:f.x>g.x?f.x:g.x,k=e.y>f.y?e.y>g.y?e.y:g.y:f.y>g.y?f.y:g.y,l=p(h,i,b,c,d),m=p(j,k,b,c,d),n=a.nextZ;n&&n.z<=m;){if(n!==a.prev&&n!==a.next&&r(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&t(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(n=a.prevZ;n&&n.z>=l;){if(n!==a.prev&&n!==a.next&&r(e.x,e.y,f.x,f.y,g.x,g.y,n.x,n.y)&&t(n.prev,n,n.next)>=0)return!1;n=n.prevZ}return!0}function h(a,b,c){var d=a;do{var e=d.prev,f=d.next.next;!u(e,f)&&v(e,d,d.next,f)&&x(e,f)&&x(f,e)&&(b.push(e.i/c),b.push(d.i/c),b.push(f.i/c),B(d),B(d.next),d=a=f),d=d.next}while(d!==a);return d}function i(a,b,c,f,g,h){var i=a;do{for(var j=i.next.next;j!==i.prev;){if(i.i!==j.i&&s(i,j)){var k=z(i,j);return i=d(i,i.next),k=d(k,k.next),e(i,b,c,f,g,h,void 0),void e(k,b,c,f,g,h,void 0)}j=j.next}i=i.next}while(i!==a)}function j(a,b,e,f){var g,h,i,j,m,n=[];for(g=0,h=b.length;h>g;g++)i=b[g]*f,j=h-1>g?b[g+1]*f:a.length,m=c(a,i,j,f,!1),m===m.next&&(m.steiner=!0),n.push(q(m));for(n.sort(k),g=0;g<n.length;g++)l(n[g],e),e=d(e,e.next);return e}function k(a,b){return a.x-b.x}function l(a,b){if(b=m(a,b)){var c=z(b,a);d(c,c.next)}}function m(a,b){var c,d=b,e=a.x,f=a.y,g=-(1/0);do{if(f<=d.y&&f>=d.next.y){var h=d.x+(f-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(e>=h&&h>g){if(g=h,h===e){if(f===d.y)return d;if(f===d.next.y)return d.next}c=d.x<d.next.x?d:d.next}}d=d.next}while(d!==b);if(!c)return null;if(e===g)return c.prev;var i,j=c,k=c.x,l=c.y,m=1/0;for(d=c.next;d!==j;)e>=d.x&&d.x>=k&&r(l>f?e:g,f,k,l,l>f?g:e,f,d.x,d.y)&&(i=Math.abs(f-d.y)/(e-d.x),(m>i||i===m&&d.x>c.x)&&x(d,a)&&(c=d,m=i)),d=d.next;return c}function n(a,b,c,d){var e=a;do null===e.z&&(e.z=p(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,o(e)}function o(a){var b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;j>b&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0===h?(e=d,d=d.nextZ,i--):0!==i&&d?c.z<=d.z?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--):(e=c,c=c.nextZ,h--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1);return a}function p(a,b,c,d,e){return a=32767*(a-c)/e,b=32767*(b-d)/e,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),b=16711935&(b|b<<8),b=252645135&(b|b<<4),b=858993459&(b|b<<2),b=1431655765&(b|b<<1),a|b<<1}function q(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function r(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0}function s(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!w(a,b)&&x(a,b)&&x(b,a)&&y(a,b)}function t(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function u(a,b){return a.x===b.x&&a.y===b.y}function v(a,b,c,d){return u(a,b)&&u(c,d)||u(a,d)&&u(c,b)?!0:t(a,b,c)>0!=t(a,b,d)>0&&t(c,d,a)>0!=t(c,d,b)>0}function w(a,b){var c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&v(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}function x(a,b){return t(a.prev,a,a.next)<0?t(a,b,a.next)>=0&&t(a,a.prev,b)>=0:t(a,b,a.prev)<0||t(a,a.next,b)<0}function y(a,b){var c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}function z(a,b){var c=new C(a.i,a.x,a.y),d=new C(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function A(a,b,c,d){var e=new C(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function B(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function C(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(a,b,c,d){var e=b&&b.length,f=e?b[0]*c:a.length,g=Math.abs(E(a,0,f,c));if(e)for(var h=0,i=b.length;i>h;h++){var j=b[h]*c,k=i-1>h?b[h+1]*c:a.length;g-=Math.abs(E(a,j,k,c))}var l=0;for(h=0;h<d.length;h+=3){var m=d[h]*c,n=d[h+1]*c,o=d[h+2]*c;l+=Math.abs((a[m]-a[o])*(a[n+1]-a[m+1])-(a[m]-a[n])*(a[o+1]-a[m+1]))}return 0===g&&0===l?0:Math.abs((l-g)/g)}function E(a,b,c,d){for(var e=0,f=b,g=c-d;c>f;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}function F(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;b>g;g++)c.vertices.push(a[e][f][g]);e>0&&(d+=a[e-1].length,c.holes.push(d))}return c}a.earcut=b,a.deviation=D,a.flatten=F}(Earcut||(Earcut={}));var BABYLON;!function(a){var b=0,c=function(){function b(a,b,c){this.pos=a,this.normal=b,this.uv=c}return b.prototype.clone=function(){return new b(this.pos.clone(),this.normal.clone(),this.uv.clone())},b.prototype.flip=function(){this.normal=this.normal.scale(-1)},b.prototype.interpolate=function(c,d){return new b(a.Vector3.Lerp(this.pos,c.pos,d),a.Vector3.Lerp(this.normal,c.normal,d),a.Vector2.Lerp(this.uv,c.uv,d))},b}(),d=function(){function b(a,b){this.normal=a,this.w=b}return b.FromPoints=function(c,d,e){var f=e.subtract(c),g=d.subtract(c);if(0===f.lengthSquared()||0===g.lengthSquared())return null;var h=a.Vector3.Normalize(a.Vector3.Cross(f,g));return new b(h,a.Vector3.Dot(h,c))},b.prototype.clone=function(){return new b(this.normal.clone(),this.w)},b.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},b.prototype.splitPolygon=function(c,d,f,g,h){var i,j,k=0,l=1,m=2,n=3,o=0,p=[];for(i=0;i<c.vertices.length;i++){j=a.Vector3.Dot(this.normal,c.vertices[i].pos)-this.w;var q=j<-b.EPSILON?m:j>b.EPSILON?l:k;o|=q,p.push(q)}switch(o){case k:(a.Vector3.Dot(this.normal,c.plane.normal)>0?d:f).push(c);break;case l:g.push(c);break;case m:h.push(c);break;case n:var r=[],s=[];for(i=0;i<c.vertices.length;i++){var t=(i+1)%c.vertices.length,u=p[i],v=p[t],w=c.vertices[i],x=c.vertices[t];if(u!==m&&r.push(w),u!==l&&s.push(u!==m?w.clone():w),(u|v)===n){j=(this.w-a.Vector3.Dot(this.normal,w.pos))/a.Vector3.Dot(this.normal,x.pos.subtract(w.pos));var y=w.interpolate(x,j);r.push(y),s.push(y.clone())}}var z;r.length>=3&&(z=new e(r,c.shared),z.plane&&g.push(z)),s.length>=3&&(z=new e(s,c.shared),z.plane&&h.push(z))}},b.EPSILON=1e-5,b}(),e=function(){function a(a,b){this.vertices=a,this.shared=b,this.plane=d.FromPoints(a[0].pos,a[1].pos,a[2].pos)}return a.prototype.clone=function(){var b=this.vertices.map(function(a){return a.clone()});return new a(b,this.shared)},a.prototype.flip=function(){this.vertices.reverse().map(function(a){a.flip()}),this.plane.flip()},a}(),f=function(){function a(a){this.plane=null,this.front=null,this.back=null,this.polygons=[],a&&this.build(a)}return a.prototype.clone=function(){var b=new a;return b.plane=this.plane&&this.plane.clone(),b.front=this.front&&this.front.clone(),b.back=this.back&&this.back.clone(),b.polygons=this.polygons.map(function(a){return a.clone()}),b},a.prototype.invert=function(){for(var a=0;a<this.polygons.length;a++)this.polygons[a].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var b=this.front;this.front=this.back,this.back=b},a.prototype.clipPolygons=function(a){if(!this.plane)return a.slice();for(var b=[],c=[],d=0;d<a.length;d++)this.plane.splitPolygon(a[d],b,c,b,c);return this.front&&(b=this.front.clipPolygons(b)),c=this.back?this.back.clipPolygons(c):[],b.concat(c)},a.prototype.clipTo=function(a){this.polygons=a.clipPolygons(this.polygons),this.front&&this.front.clipTo(a),this.back&&this.back.clipTo(a)},a.prototype.allPolygons=function(){var a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a},a.prototype.build=function(b){if(b.length){this.plane||(this.plane=b[0].plane.clone());for(var c=[],d=[],e=0;e<b.length;e++)this.plane.splitPolygon(b[e],this.polygons,this.polygons,c,d);c.length&&(this.front||(this.front=new a),this.front.build(c)),d.length&&(this.back||(this.back=new a),this.back.build(d))}},a}(),g=function(){function d(){this.polygons=new Array}return d.FromMesh=function(f){var g,h,i,j,k,l,m,n,o,p,q,r=new Array;if(!(f instanceof a.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";f.computeWorldMatrix(!0),m=f.getWorldMatrix(),n=f.position.clone(),o=f.rotation.clone(),f.rotationQuaternion&&(p=f.rotationQuaternion.clone()),q=f.scaling.clone();for(var s=f.getIndices(),t=f.getVerticesData(a.VertexBuffer.PositionKind),u=f.getVerticesData(a.VertexBuffer.NormalKind),v=f.getVerticesData(a.VertexBuffer.UVKind),w=f.subMeshes,x=0,y=w.length;y>x;x++)for(var z=w[x].indexStart,A=w[x].indexCount+w[x].indexStart;A>z;z+=3){l=[];for(var B=0;3>B;B++){var C=new a.Vector3(u[3*s[z+B]],u[3*s[z+B]+1],u[3*s[z+B]+2]);i=new a.Vector2(v[2*s[z+B]],v[2*s[z+B]+1]);var D=new a.Vector3(t[3*s[z+B]],t[3*s[z+B]+1],t[3*s[z+B]+2]);j=a.Vector3.TransformCoordinates(D,m),h=a.Vector3.TransformNormal(C,m),g=new c(j,h,i),l.push(g)}k=new e(l,{subMeshId:x,meshId:b,materialIndex:w[x].materialIndex}),k.plane&&r.push(k)}var E=d.FromPolygons(r);return E.matrix=m,E.position=n,E.rotation=o,E.scaling=q,E.rotationQuaternion=p,b++,E},d.FromPolygons=function(a){var b=new d;return b.polygons=a,b},d.prototype.clone=function(){var a=new d;return a.polygons=this.polygons.map(function(a){return a.clone()}),a.copyTransformAttributes(this),a},d.prototype.toPolygons=function(){return this.polygons},d.prototype.union=function(a){var b=new f(this.clone().polygons),c=new f(a.clone().polygons);return b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),d.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},d.prototype.unionInPlace=function(a){var b=new f(this.polygons),c=new f(a.polygons);b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),this.polygons=b.allPolygons()},d.prototype.subtract=function(a){var b=new f(this.clone().polygons),c=new f(a.clone().polygons);return b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),d.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},d.prototype.subtractInPlace=function(a){var b=new f(this.polygons),c=new f(a.polygons);b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),this.polygons=b.allPolygons()},d.prototype.intersect=function(a){var b=new f(this.clone().polygons),c=new f(a.clone().polygons);return b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),d.FromPolygons(b.allPolygons()).copyTransformAttributes(this)},d.prototype.intersectInPlace=function(a){var b=new f(this.polygons),c=new f(a.polygons);b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),this.polygons=b.allPolygons()},d.prototype.inverse=function(){var a=this.clone();return a.inverseInPlace(),a},d.prototype.inverseInPlace=function(){this.polygons.map(function(a){a.flip()})},d.prototype.copyTransformAttributes=function(a){return this.matrix=a.matrix,this.position=a.position,this.rotation=a.rotation,this.scaling=a.scaling,this.rotationQuaternion=a.rotationQuaternion,this},d.prototype.buildMeshGeometry=function(b,c,d){var e=this.matrix.clone();e.invert();var f,g,h,i=new a.Mesh(b,c),j=[],k=[],l=[],m=[],n=a.Vector3.Zero(),o=a.Vector3.Zero(),p=a.Vector2.Zero(),q=this.polygons,r=[0,0,0],s={},t=0,u={};d&&q.sort(function(a,b){return a.shared.meshId===b.shared.meshId?a.shared.subMeshId-b.shared.subMeshId:a.shared.meshId-b.shared.meshId});for(var v=0,w=q.length;w>v;v++){f=q[v],u[f.shared.meshId]||(u[f.shared.meshId]={}),u[f.shared.meshId][f.shared.subMeshId]||(u[f.shared.meshId][f.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:f.shared.materialIndex}),h=u[f.shared.meshId][f.shared.subMeshId];for(var x=2,y=f.vertices.length;y>x;x++){r[0]=0,r[1]=x-1,r[2]=x;for(var z=0;3>z;z++){n.copyFrom(f.vertices[r[z]].pos),o.copyFrom(f.vertices[r[z]].normal),p.copyFrom(f.vertices[r[z]].uv);var A=a.Vector3.TransformCoordinates(n,e),B=a.Vector3.TransformNormal(o,e);g=s[A.x+","+A.y+","+A.z],"undefined"!=typeof g&&l[3*g]===B.x&&l[3*g+1]===B.y&&l[3*g+2]===B.z&&m[2*g]===p.x&&m[2*g+1]===p.y||(j.push(A.x,A.y,A.z),m.push(p.x,p.y),l.push(o.x,o.y,o.z),g=s[A.x+","+A.y+","+A.z]=j.length/3-1),k.push(g),h.indexStart=Math.min(t,h.indexStart),h.indexEnd=Math.max(t,h.indexEnd),t++}}}if(i.setVerticesData(a.VertexBuffer.PositionKind,j),i.setVerticesData(a.VertexBuffer.NormalKind,l),i.setVerticesData(a.VertexBuffer.UVKind,m),i.setIndices(k),d){var C,D=0;i.subMeshes=new Array;for(var E in u){C=-1;for(var F in u[E])h=u[E][F],a.SubMesh.CreateFromIndices(h.materialIndex+D,h.indexStart,h.indexEnd-h.indexStart+1,i),C=Math.max(h.materialIndex,C);D+=++C}}return i},d.prototype.toMesh=function(a,b,c,d){var e=this.buildMeshGeometry(a,c,d);return e.material=b,e.position.copyFrom(this.position),e.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(e.rotationQuaternion=this.rotationQuaternion.clone()),e.scaling.copyFrom(this.scaling),e.computeWorldMatrix(!0),e},d}();a.CSG=g}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){var g=this;b.call(this,c,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,f.postProcessScaleFactor,d,a.Texture.BILINEAR_SAMPLINGMODE,null,null),this._isRightEye=e,this._distortionFactors=f.distortionK,this._postProcessScaleFactor=f.postProcessScaleFactor,this._lensCenterOffset=f.lensCenterOffset,this.onSizeChangedObservable.add(function(){g.aspectRatio=.5*g.width/g.height,g._scaleIn=new a.Vector2(2,2/g.aspectRatio),g._scaleFactor=new a.Vector2(.5*(1/g._postProcessScaleFactor),.5*(1/g._postProcessScaleFactor)*g.aspectRatio),g._lensCenter=new a.Vector2(g._isRightEye?.5-.5*g._lensCenterOffset:.5+.5*g._lensCenterOffset,.5)}),this.onApplyObservable.add(function(a){a.setFloat2("LensCenter",g._lensCenter.x,g._lensCenter.y),a.setFloat2("Scale",g._scaleFactor.x,g._scaleFactor.y),a.setFloat2("ScaleIn",g._scaleIn.x,g._scaleIn.y),a.setFloat4("HmdWarpParam",g._distortionFactors[0],g._distortionFactors[1],g._distortionFactors[2],g._distortionFactors[3])})}return __extends(c,b),c}(a.PostProcess);a.VRDistortionCorrectionPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){!function(a){a[a.X=0]="X",a[a.Y=1]="Y",a[a.Z=2]="Z"}(a.JoystickAxis||(a.JoystickAxis={}));var b=a.JoystickAxis,c=function(){function c(d){var e=this;d?this._leftJoystick=!0:this._leftJoystick=!1,this._joystickIndex=c._globalJoystickIndex,c._globalJoystickIndex++,this._axisTargetedByLeftAndRight=b.X,this._axisTargetedByUpAndDown=b.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new a.StringDictionary,this.deltaPosition=a.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._rotationSpeed=25,this._inverseRotationSpeed=1/(this._rotationSpeed/1e3),this._rotateOnAxisRelativeToMesh=!1,this._onResize=function(a){c.vjCanvasWidth=window.innerWidth,c.vjCanvasHeight=window.innerHeight,c.vjCanvas.width=c.vjCanvasWidth,c.vjCanvas.height=c.vjCanvasHeight,c.halfWidth=c.vjCanvasWidth/2,c.halfHeight=c.vjCanvasHeight/2},c.vjCanvas||(window.addEventListener("resize",this._onResize,!1),c.vjCanvas=document.createElement("canvas"),c.vjCanvasWidth=window.innerWidth,c.vjCanvasHeight=window.innerHeight,c.vjCanvas.width=window.innerWidth,c.vjCanvas.height=window.innerHeight,c.vjCanvas.style.width="100%",c.vjCanvas.style.height="100%",c.vjCanvas.style.position="absolute",c.vjCanvas.style.backgroundColor="transparent",c.vjCanvas.style.top="0px",c.vjCanvas.style.left="0px",c.vjCanvas.style.zIndex="5",c.vjCanvas.style.msTouchAction="none",c.vjCanvas.setAttribute("touch-action","none"),c.vjCanvasContext=c.vjCanvas.getContext("2d"),c.vjCanvasContext.strokeStyle="#ffffff",c.vjCanvasContext.lineWidth=2,document.body.appendChild(c.vjCanvas)),c.halfWidth=c.vjCanvas.width/2,c.halfHeight=c.vjCanvas.height/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new a.Vector2(0,0),this._joystickPreviousPointerPos=new a.Vector2(0,0),this._joystickPointerStartPos=new a.Vector2(0,0),this._deltaJoystickVector=new a.Vector2(0,0),this._onPointerDownHandlerRef=function(a){e._onPointerDown(a)},this._onPointerMoveHandlerRef=function(a){e._onPointerMove(a)},this._onPointerOutHandlerRef=function(a){e._onPointerUp(a)},this._onPointerUpHandlerRef=function(a){e._onPointerUp(a)},c.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),c.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),c.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),c.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),c.vjCanvas.addEventListener("contextmenu",function(a){a.preventDefault()},!1),requestAnimationFrame(function(){e._drawVirtualJoystick()})}return c.prototype.setJoystickSensibility=function(a){this._joystickSensibility=a,this._inversedSensibility=1/(this._joystickSensibility/1e3)},c.prototype._onPointerDown=function(a){var b;a.preventDefault(),b=this._leftJoystick===!0?a.clientX<c.halfWidth:a.clientX>c.halfWidth,b&&this._joystickPointerID<0?(this._joystickPointerID=a.pointerId,this._joystickPointerStartPos.x=a.clientX,this._joystickPointerStartPos.y=a.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(a.pointerId.toString(),a)):c._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(a.pointerId.toString(),{x:a.clientX,y:a.clientY,prevX:a.clientX,prevY:a.clientY}))},c.prototype._onPointerMove=function(a){if(this._joystickPointerID==a.pointerId){this._joystickPointerPos.x=a.clientX,this._joystickPointerPos.y=a.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var c=this.reverseLeftRight?-1:1,d=c*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case b.X:this.deltaPosition.x=Math.min(1,Math.max(-1,d));break;case b.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,d));break;case b.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,d))}var e=this.reverseUpDown?1:-1,f=e*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case b.X:this.deltaPosition.x=Math.min(1,Math.max(-1,f));break;case b.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,f));break;case b.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,f))}}else{var g=this._touches.get(a.pointerId.toString());g&&(g.x=a.clientX,g.y=a.clientY)}},c.prototype._onPointerUp=function(a){if(this._joystickPointerID==a.pointerId)c.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{var b=this._touches.get(a.pointerId.toString());b&&c.vjCanvasContext.clearRect(b.prevX-43,b.prevY-43,86,86)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(a.pointerId.toString())},c.prototype.setJoystickColor=function(a){this._joystickColor=a},c.prototype.setActionOnTouch=function(a){this._action=a},c.prototype.setAxisForLeftRight=function(a){switch(a){case b.X:case b.Y:case b.Z:this._axisTargetedByLeftAndRight=a;break;default:this._axisTargetedByLeftAndRight=b.X}},c.prototype.setAxisForUpDown=function(a){switch(a){case b.X:case b.Y:case b.Z:this._axisTargetedByUpAndDown=a;break;default:this._axisTargetedByUpAndDown=b.Y}},c.prototype._clearCanvas=function(){this._leftJoystick?c.vjCanvasContext.clearRect(0,0,c.vjCanvasWidth/2,c.vjCanvasHeight):c.vjCanvasContext.clearRect(c.vjCanvasWidth/2,0,c.vjCanvasWidth,c.vjCanvasHeight)},c.prototype._drawVirtualJoystick=function(){var a=this;this.pressed&&this._touches.forEach(function(b){b.pointerId===a._joystickPointerID?(c.vjCanvasContext.clearRect(a._joystickPointerStartPos.x-63,a._joystickPointerStartPos.y-63,126,126),c.vjCanvasContext.clearRect(a._joystickPreviousPointerPos.x-41,a._joystickPreviousPointerPos.y-41,82,82),c.vjCanvasContext.beginPath(),c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.strokeStyle=a._joystickColor,c.vjCanvasContext.arc(a._joystickPointerStartPos.x,a._joystickPointerStartPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=a._joystickColor,c.vjCanvasContext.lineWidth=2,c.vjCanvasContext.arc(a._joystickPointerStartPos.x,a._joystickPointerStartPos.y,60,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle=a._joystickColor,c.vjCanvasContext.arc(a._joystickPointerPos.x,a._joystickPointerPos.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),a._joystickPreviousPointerPos=a._joystickPointerPos.clone()):(c.vjCanvasContext.clearRect(b.prevX-43,b.prevY-43,86,86),c.vjCanvasContext.beginPath(),c.vjCanvasContext.fillStyle="white",c.vjCanvasContext.beginPath(),c.vjCanvasContext.strokeStyle="red",c.vjCanvasContext.lineWidth=6,c.vjCanvasContext.arc(b.x,b.y,40,0,2*Math.PI,!0),c.vjCanvasContext.stroke(),c.vjCanvasContext.closePath(),b.prevX=b.x,b.prevY=b.y)}),requestAnimationFrame(function(){a._drawVirtualJoystick()})},c.prototype.releaseCanvas=function(){c.vjCanvas&&(c.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),c.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),c.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),c.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(c.vjCanvas),c.vjCanvas=null)},c._globalJoystickIndex=0,c}();a.VirtualJoystick=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.inputs.addVirtualJoystick()}return __extends(b,a),b}(a.FreeCamera);a.VirtualJoysticksCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){}return b.prototype.getLeftJoystick=function(){return this._leftjoystick},b.prototype.getRightJoystick=function(){return this._rightjoystick},b.prototype.checkInputs=function(){if(this._leftjoystick){var b=this.camera,c=50*b._computeLocalCameraSpeed(),d=a.Matrix.RotationYawPitchRoll(b.rotation.y,b.rotation.x,0),e=a.Vector3.TransformCoordinates(new a.Vector3(this._leftjoystick.deltaPosition.x*c,this._leftjoystick.deltaPosition.y*c,this._leftjoystick.deltaPosition.z*c),d);b.cameraDirection=b.cameraDirection.add(e),b.cameraRotation=b.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},b.prototype.attachControl=function(b,c){this._leftjoystick=new a.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(a.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(a.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new a.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(a.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(a.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},b.prototype.detachControl=function(a){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},b.prototype.getTypeName=function(){return"FreeCameraVirtualJoystickInput"},b.prototype.getSimpleName=function(){return"virtualJoystick"},b}();a.FreeCameraVirtualJoystickInput=b,a.CameraInputTypes.FreeCameraVirtualJoystickInput=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g){var h=this;a.call(this,b,"anaglyph",null,["leftSampler"],c,d[1],e,f,g),this._passedProcess=d[0]._rigPostProcess,this.onApplyObservable.add(function(a){a.setTextureFromPostProcess("leftSampler",h._passedProcess)})}return __extends(b,a),b}(a.PostProcess);a.AnaglyphPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a){this._scene=a}return b.prototype.render=function(b,c,d){var e=this;void 0===d&&(d=!1);var f=this._scene,g=this._scene.getEngine(),h=null!==g.getCaps().instancedArrays&&null!==c.visibleInstances[b._id]&&void 0!==c.visibleInstances[b._id];if(this.isReady(b,h)){var i=b.getRenderingMesh(),j=b.getMaterial();if(g.enableEffect(this._effect),this._effect.setFloat("offset",d?0:i.outlineWidth),this._effect.setColor4("color",d?i.overlayColor:i.outlineColor,d?i.overlayAlpha:1),this._effect.setMatrix("viewProjection",f.getTransformMatrix()),i.useBones&&i.computeBonesUsingShaders&&this._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),i._bind(b,this._effect,a.Material.TriangleFillMode),j&&j.needAlphaTesting()){var k=j.getAlphaTestTexture();this._effect.setTexture("diffuseSampler",k),this._effect.setMatrix("diffuseMatrix",k.getTextureMatrix())}i._processRendering(b,this._effect,a.Material.TriangleFillMode,c,h,function(a,b){e._effect.setMatrix("world",b)})}},b.prototype.isReady=function(b,c){var d=[],e=[a.VertexBuffer.PositionKind,a.VertexBuffer.NormalKind],f=b.getMesh(),g=b.getMaterial();g&&g.needAlphaTesting()&&(d.push("#define ALPHATEST"),f.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(e.push(a.VertexBuffer.UVKind),d.push("#define UV1")),f.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(e.push(a.VertexBuffer.UV2Kind),d.push("#define UV2"))),f.useBones&&f.computeBonesUsingShaders?(e.push(a.VertexBuffer.MatricesIndicesKind),e.push(a.VertexBuffer.MatricesWeightsKind),f.numBoneInfluencers>4&&(e.push(a.VertexBuffer.MatricesIndicesExtraKind),e.push(a.VertexBuffer.MatricesWeightsExtraKind)),d.push("#define NUM_BONE_INFLUENCERS "+f.numBoneInfluencers),d.push("#define BonesPerMesh "+(f.skeleton.bones.length+1))):d.push("#define NUM_BONE_INFLUENCERS 0"),c&&(d.push("#define INSTANCES"),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"));var h=d.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,this._effect=this._scene.getEngine().createEffect("outline",e,["world","mBones","viewProjection","diffuseMatrix","offset","color"],["diffuseSampler"],h)),this._effect.isReady()},b}();a.OutlineRenderer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d){this.name=a,this.meshesNames=b,this.rootUrl=c,this.sceneFilename=d,this.isCompleted=!1}return b.prototype.run=function(b,c,d){var e=this;a.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,b,function(a,b,d){e.loadedMeshes=a,e.loadedParticleSystems=b,e.loadedSkeletons=d,e.isCompleted=!0,e.onSuccess&&e.onSuccess(e),c()},null,function(){e.onError&&e.onError(e),d()})},b}();a.MeshAssetTask=b;var c=function(){function b(a,b){this.name=a,this.url=b,this.isCompleted=!1}return b.prototype.run=function(b,c,d){var e=this;a.Tools.LoadFile(this.url,function(a){e.text=a,e.isCompleted=!0,e.onSuccess&&e.onSuccess(e),c()},null,b.database,!1,function(){e.onError&&e.onError(e),d()})},b}();a.TextFileAssetTask=c;var d=function(){function b(a,b){this.name=a,this.url=b,this.isCompleted=!1}return b.prototype.run=function(b,c,d){var e=this;a.Tools.LoadFile(this.url,function(a){e.data=a,e.isCompleted=!0,e.onSuccess&&e.onSuccess(e),c()},null,b.database,!0,function(){e.onError&&e.onError(e),d()})},b}();a.BinaryFileAssetTask=d;var e=function(){function a(a,b){this.name=a,this.url=b,this.isCompleted=!1}return a.prototype.run=function(a,b,c){var d=this,e=new Image;e.onload=function(){d.image=e,d.isCompleted=!0,d.onSuccess&&d.onSuccess(d),b()},e.onerror=function(){d.onError&&d.onError(d),c()},e.src=this.url},a}();a.ImageAssetTask=e;var f=function(){function b(b,c,d,e,f){void 0===f&&(f=a.Texture.TRILINEAR_SAMPLINGMODE),this.name=b,
this.url=c,this.noMipmap=d,this.invertY=e,this.samplingMode=f,this.isCompleted=!1}return b.prototype.run=function(b,c,d){var e=this,f=function(){e.isCompleted=!0,e.onSuccess&&e.onSuccess(e),c()},g=function(){e.onError&&e.onError(e),d()};this.texture=new a.Texture(this.url,b,this.noMipmap,this.invertY,this.samplingMode,f,g)},b}();a.TextureAssetTask=f;var g=function(){function g(a){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=a}return g.prototype.addMeshTask=function(a,c,d,e){var f=new b(a,c,d,e);return this._tasks.push(f),f},g.prototype.addTextFileTask=function(a,b){var d=new c(a,b);return this._tasks.push(d),d},g.prototype.addBinaryFileTask=function(a,b){var c=new d(a,b);return this._tasks.push(c),c},g.prototype.addImageTask=function(a,b){var c=new e(a,b);return this._tasks.push(c),c},g.prototype.addTextureTask=function(b,c,d,e,g){void 0===g&&(g=a.Texture.TRILINEAR_SAMPLINGMODE);var h=new f(b,c,d,e,g);return this._tasks.push(h),h},g.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},g.prototype._runTask=function(a){var b=this;a.run(this._scene,function(){b.onTaskSuccess&&b.onTaskSuccess(a),b._decreaseWaitingTasksCount()},function(){b.onTaskError&&b.onTaskError(a),b._decreaseWaitingTasksCount()})},g.prototype.reset=function(){return this._tasks=new Array,this},g.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var a=0;a<this._tasks.length;a++){var b=this._tasks[a];this._runTask(b)}return this},g}();a.AssetsManager=g}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this.compensateDistortion=!0}return Object.defineProperty(b.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"leftHMatrix",{get:function(){var b=this.hScreenSize/4-this.lensSeparationDistance/2,c=4*b/this.hScreenSize;return a.Matrix.Translation(c,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightHMatrix",{get:function(){var b=this.hScreenSize/4-this.lensSeparationDistance/2,c=4*b/this.hScreenSize;return a.Matrix.Translation(-c,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"leftPreViewMatrix",{get:function(){return a.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightPreViewMatrix",{get:function(){return a.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),b.GetDefault=function(){var a=new b;return a.hResolution=1280,a.vResolution=800,a.hScreenSize=.149759993,a.vScreenSize=.0935999975,a.vScreenCenter=.0467999987,a.eyeToScreenDistance=.0410000011,a.lensSeparationDistance=.063500002,a.interpupillaryDistance=.064000003,a.distortionK=[1,.219999999,.239999995,0],a.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],a.postProcessScaleFactor=1.714605507808412,a.lensCenterOffset=.151976421,a},b}();a.VRCameraMetrics=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){void 0===f&&(f=!0),b.call(this,c,d,e),this.rotationQuaternion=new a.Quaternion;var g=a.VRCameraMetrics.GetDefault();g.compensateDistortion=f,this.setCameraRigMode(a.Camera.RIG_MODE_VR,{vrCameraMetrics:g}),this.inputs.addDeviceOrientation()}return __extends(c,b),c.prototype.getTypeName=function(){return"VRDeviceOrientationFreeCamera"},c}(a.FreeCamera);a.VRDeviceOrientationFreeCamera=b;var c=function(b){function c(c,d,e,f,g,h,i){void 0===i&&(i=!0),b.call(this,c,d,e,f,g,h);var j=a.VRCameraMetrics.GetDefault();j.compensateDistortion=i,this.setCameraRigMode(a.Camera.RIG_MODE_VR,{vrCameraMetrics:j}),this.inputs.addVRDeviceOrientation()}return __extends(c,b),c.prototype.getTypeName=function(){return"VRDeviceOrientationArcRotateCamera"},c}(a.ArcRotateCamera);a.VRDeviceOrientationArcRotateCamera=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){void 0===f&&(f=!0),b.call(this,c,d,e),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._vrEnabled=!1;var g=a.VRCameraMetrics.GetDefault();g.compensateDistortion=f,this.setCameraRigMode(a.Camera.RIG_MODE_VR,{vrCameraMetrics:g}),this._getWebVRDevices=this._getWebVRDevices.bind(this),this.rotationQuaternion=new a.Quaternion}return __extends(c,b),c.prototype._getWebVRDevices=function(a){var b=a.length,c=0;for(this._sensorDevice=null,this._hmdDevice=null;b>c&&null===this._hmdDevice;)a[c]instanceof HMDVRDevice&&(this._hmdDevice=a[c]),c++;for(c=0;b>c&&null===this._sensorDevice;)a[c]instanceof PositionSensorVRDevice&&(!this._hmdDevice||a[c].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=a[c]),c++;this._vrEnabled=!(!this._sensorDevice||!this._hmdDevice)},c.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this.rotationQuaternion.copyFrom(this._cacheState.orientation),this.rotationQuaternion.z*=-1,this.rotationQuaternion.w*=-1),b.prototype._checkInputs.call(this)},c.prototype.attachControl=function(c,d){b.prototype.attachControl.call(this,c,d),d=a.Camera.ForceAttachControlToAlwaysPreventDefault?!1:d,navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},c.prototype.detachControl=function(a){b.prototype.detachControl.call(this,a),this._vrEnabled=!1},c.prototype.requestVRFullscreen=function(a){this._hmdDevice&&this.getEngine().switchFullscreen(a,{vrDisplay:this._hmdDevice})},c.prototype.getTypeName=function(){return"WebVRFreeCamera"},c}(a.FreeCamera);a.WebVRFreeCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a){void 0===a&&(a=0),this.priority=a,this.apply=function(a){return!0}}return a}();a.SceneOptimization=b;var c=function(a){function b(b,c){var d=this;void 0===b&&(b=0),void 0===c&&(c=1024),a.call(this,b),this.priority=b,this.maximumSize=c,this.apply=function(a){for(var b=!0,c=0;c<a.textures.length;c++){var e=a.textures[c];if(e.canRescale){var f=e.getSize(),g=Math.max(f.width,f.height);g>d.maximumSize&&(e.scale(.5),b=!1)}}return b}}return __extends(b,a),b}(b);a.TextureOptimization=c;var d=function(a){function b(b,c){var d=this;void 0===b&&(b=0),void 0===c&&(c=2),a.call(this,b),this.priority=b,this.maximumScale=c,this._currentScale=1,this.apply=function(a){return d._currentScale++,a.getEngine().setHardwareScalingLevel(d._currentScale),d._currentScale>=d.maximumScale}}return __extends(b,a),b}(b);a.HardwareScalingOptimization=d;var e=function(a){function b(){a.apply(this,arguments),this.apply=function(a){return a.shadowsEnabled=!1,!0}}return __extends(b,a),b}(b);a.ShadowsOptimization=e;var f=function(a){function b(){a.apply(this,arguments),this.apply=function(a){return a.postProcessesEnabled=!1,!0}}return __extends(b,a),b}(b);a.PostProcessesOptimization=f;var g=function(a){function b(){a.apply(this,arguments),this.apply=function(a){return a.lensFlaresEnabled=!1,!0}}return __extends(b,a),b}(b);a.LensFlaresOptimization=g;var h=function(a){function b(){a.apply(this,arguments),this.apply=function(a){return a.particlesEnabled=!1,!0}}return __extends(b,a),b}(b);a.ParticlesOptimization=h;var i=function(a){function b(){a.apply(this,arguments),this.apply=function(a){return a.renderTargetsEnabled=!1,!0}}return __extends(b,a),b}(b);a.RenderTargetsOptimization=i;var j=function(b){function c(){var d=this;b.apply(this,arguments),this._canBeMerged=function(b){if(!(b instanceof a.Mesh))return!1;var c=b;return c.isVisible&&c.isEnabled()?c.instances.length>0?!1:c.skeleton||c.hasLODLevels?!1:!c.parent:!1},this.apply=function(b,e){for(var f=b.meshes.slice(0),g=f.length,h=0;g>h;h++){var i=new Array,j=f[h];if(d._canBeMerged(j)){i.push(j);for(var k=h+1;g>k;k++){var l=f[k];d._canBeMerged(l)&&l.material===j.material&&l.checkCollisions===j.checkCollisions&&(i.push(l),g--,f.splice(k,1),k--)}i.length<2||a.Mesh.MergeMeshes(i)}}return void 0!=e?e&&b.createOrUpdateSelectionOctree():c.UpdateSelectionTree&&b.createOrUpdateSelectionOctree(),!0}}return __extends(c,b),Object.defineProperty(c,"UpdateSelectionTree",{get:function(){return c._UpdateSelectionTree},set:function(a){c._UpdateSelectionTree=a},enumerable:!0,configurable:!0}),c._UpdateSelectionTree=!1,c}(b);a.MergeMeshesOptimization=j;var k=function(){function a(a,b){void 0===a&&(a=60),void 0===b&&(b=2e3),this.targetFrameRate=a,this.trackerDuration=b,this.optimizations=new Array}return a.LowDegradationAllowed=function(b){var d=new a(b),i=0;return d.optimizations.push(new j(i)),d.optimizations.push(new e(i)),d.optimizations.push(new g(i)),i++,d.optimizations.push(new f(i)),d.optimizations.push(new h(i)),i++,d.optimizations.push(new c(i,1024)),d},a.ModerateDegradationAllowed=function(b){var k=new a(b),l=0;return k.optimizations.push(new j(l)),k.optimizations.push(new e(l)),k.optimizations.push(new g(l)),l++,k.optimizations.push(new f(l)),k.optimizations.push(new h(l)),l++,k.optimizations.push(new c(l,512)),l++,k.optimizations.push(new i(l)),l++,k.optimizations.push(new d(l,2)),k},a.HighDegradationAllowed=function(b){var k=new a(b),l=0;return k.optimizations.push(new j(l)),k.optimizations.push(new e(l)),k.optimizations.push(new g(l)),l++,k.optimizations.push(new f(l)),k.optimizations.push(new h(l)),l++,k.optimizations.push(new c(l,256)),l++,k.optimizations.push(new i(l)),l++,k.optimizations.push(new d(l,4)),k},a}();a.SceneOptimizerOptions=k;var l=function(){function a(){}return a._CheckCurrentState=function(b,c,d,e,f){if(b.getEngine().getFps()>=c.targetFrameRate)return void(e&&e());for(var g=!0,h=!0,i=0;i<c.optimizations.length;i++){var j=c.optimizations[i];j.priority===d&&(h=!1,g=g&&j.apply(b))}return h?void(f&&f()):(g&&d++,void b.executeWhenReady(function(){setTimeout(function(){a._CheckCurrentState(b,c,d,e,f)},c.trackerDuration)}))},a.OptimizeAsync=function(b,c,d,e){c||(c=k.ModerateDegradationAllowed()),b.executeWhenReady(function(){setTimeout(function(){a._CheckCurrentState(b,c,0,d,e)},c.trackerDuration)})},a}();a.SceneOptimizer=l}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(a){var b=function(){function a(a,b){this.distance=a,this.mesh=b}return a}();a.MeshLODLevel=b}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i,j){void 0===h&&(h=!0),void 0===i&&(i=!1),void 0===j&&(j=a.Texture.TRILINEAR_SAMPLINGMODE),b.call(this,null,g,!h,i),this.format=f,this._texture=g.getEngine().createRawTexture(c,d,e,f,h,i,j),this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE}return __extends(c,b),c.prototype.update=function(a){this.getScene().getEngine().updateRawTexture(this._texture,a,this.format,this._invertY)},c.CreateLuminanceTexture=function(b,d,e,f,g,h,i){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=a.Texture.TRILINEAR_SAMPLINGMODE),new c(b,d,e,a.Engine.TEXTUREFORMAT_LUMINANCE,f,g,h,i)},c.CreateLuminanceAlphaTexture=function(b,d,e,f,g,h,i){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=a.Texture.TRILINEAR_SAMPLINGMODE),new c(b,d,e,a.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,f,g,h,i)},c.CreateAlphaTexture=function(b,d,e,f,g,h,i){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=a.Texture.TRILINEAR_SAMPLINGMODE),new c(b,d,e,a.Engine.TEXTUREFORMAT_ALPHA,f,g,h,i)},c.CreateRGBTexture=function(b,d,e,f,g,h,i){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=a.Texture.TRILINEAR_SAMPLINGMODE),new c(b,d,e,a.Engine.TEXTUREFORMAT_RGB,f,g,h,i)},c.CreateRGBATexture=function(b,d,e,f,g,h,i){return void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=a.Texture.TRILINEAR_SAMPLINGMODE),new c(b,d,e,a.Engine.TEXTUREFORMAT_RGBA,f,g,h,i)},c}(a.Texture);a.RawTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c){a.call(this,b.x,b.y),this.index=c}return __extends(b,a),b}(a.Vector2),c=function(){function c(){this.elements=new Array}return c.prototype.add=function(a){var c=this,d=new Array;return a.forEach(function(a){if(0===d.length||!a.equalsWithEpsilon(d[0])){var e=new b(a,c.elements.length);d.push(e),c.elements.push(e)}}),d},c.prototype.computeBounds=function(){var b=new a.Vector2(this.elements[0].x,this.elements[0].y),c=new a.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(a){a.x<b.x?b.x=a.x:a.x>c.x&&(c.x=a.x),a.y<b.y?b.y=a.y:a.y>c.y&&(c.y=a.y)}),{min:b,max:c,width:c.x-b.x,height:c.y-b.y}},c}(),d=function(){function b(){}return b.Rectangle=function(b,c,d,e){return[new a.Vector2(b,c),new a.Vector2(d,c),new a.Vector2(d,e),new a.Vector2(b,e)]},b.Circle=function(b,c,d,e){void 0===c&&(c=0),void 0===d&&(d=0),void 0===e&&(e=32);for(var f=new Array,g=0,h=2*Math.PI/e,i=0;e>i;i++)f.push(new a.Vector2(c+Math.cos(g)*b,d+Math.sin(g)*b)),g-=h;return f},b.Parse=function(b){var c,d=b.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(a){return!isNaN(a)}),e=[];for(c=0;c<(2147483646&d.length);c+=2)e.push(new a.Vector2(d[c],d[c+1]));return e},b.StartingAt=function(b,c){return a.Path2.StartingAt(b,c)},b}();a.Polygon=d;var e=function(){function b(b,d,e){this._points=new c,this._outlinepoints=new c,this._holes=[],this._epoints=new Array,this._eholes=new Array,this._name=b,this._scene=e;var f;f=d instanceof a.Path2?d.getPoints():d,this._addToepoint(f),this._points.add(f),this._outlinepoints.add(f)}return b.prototype._addToepoint=function(a){for(var b=0;b<a.length;b++){var c=a[b];this._epoints.push(c.x,c.y)}},b.prototype.addHole=function(a){this._points.add(a);var b=new c;return b.add(a),this._holes.push(b),this._eholes.push(this._epoints.length/2),this._addToepoint(a),this},b.prototype.build=function(b,c){var d=this;void 0===b&&(b=!1);var e=new a.Mesh(this._name,this._scene),f=[],g=[],h=[],i=this._points.computeBounds();this._points.elements.forEach(function(a){f.push(0,1,0),g.push(a.x,0,a.y),h.push((a.x-i.min.x)/i.width,(a.y-i.min.y)/i.height)});for(var j=[],k=Earcut.earcut(this._epoints,this._eholes,2),l=0;l<k.length;l++)j.push(k[l]);if(c>0){var m=g.length/3;this._points.elements.forEach(function(a){f.push(0,-1,0),g.push(a.x,-c,a.y),h.push(1-(a.x-i.min.x)/i.width,1-(a.y-i.min.y)/i.height)});for(var n=j.length,l=0;n>l;l+=3){var o=j[l+0],p=j[l+1],q=j[l+2];j.push(q+m),j.push(p+m),j.push(o+m)}this.addSide(g,f,h,j,i,this._outlinepoints,c,!1),this._holes.forEach(function(a){d.addSide(g,f,h,j,i,a,c,!0)})}return e.setVerticesData(a.VertexBuffer.PositionKind,g,b),e.setVerticesData(a.VertexBuffer.NormalKind,f,b),e.setVerticesData(a.VertexBuffer.UVKind,h,b),e.setIndices(j),e},b.prototype.addSide=function(b,c,d,e,f,g,h,i){for(var j=b.length/3,k=0,l=0;l<g.elements.length;l++){var m,n=g.elements[l];m=l+1>g.elements.length-1?g.elements[0]:g.elements[l+1],b.push(n.x,0,n.y),b.push(n.x,-h,n.y),b.push(m.x,0,m.y),b.push(m.x,-h,m.y);var o=new a.Vector3(n.x,0,n.y),p=new a.Vector3(m.x,0,m.y),q=p.subtract(o),r=new a.Vector3(0,1,0),s=a.Vector3.Cross(q,r);s=s.normalize(),d.push(k/f.width,0),d.push(k/f.width,1),k+=q.length(),d.push(k/f.width,0),d.push(k/f.width,1),i?(c.push(s.x,s.y,s.z),c.push(s.x,s.y,s.z),c.push(s.x,s.y,s.z),c.push(s.x,s.y,s.z),e.push(j),e.push(j+2),e.push(j+1),e.push(j+1),e.push(j+2),e.push(j+3)):(c.push(-s.x,-s.y,-s.z),c.push(-s.x,-s.y,-s.z),c.push(-s.x,-s.y,-s.z),c.push(-s.x,-s.y,-s.z),e.push(j),e.push(j+1),e.push(j+2),e.push(j+1),e.push(j+3),e.push(j+2)),j+=4}},b}();a.PolygonMeshBuilder=e}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d){void 0===d&&(d=2),this.maxDepth=d,this.dynamicContent=new Array,this._maxBlockCapacity=c||64,this._selectionContent=new a.SmartArray(1024),this._creationFunc=b}return b.prototype.update=function(a,c,d){b._CreateBlocks(a,c,d,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},b.prototype.addMesh=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];c.addEntry(a)}},b.prototype.select=function(a,b){this._selectionContent.reset();for(var c=0;c<this.blocks.length;c++){var d=this.blocks[c];d.select(a,this._selectionContent,b)}return b?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},b.prototype.intersects=function(a,b,c){this._selectionContent.reset();for(var d=0;d<this.blocks.length;d++){var e=this.blocks[d];e.intersects(a,b,this._selectionContent,c)}return c?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},b.prototype.intersectsRay=function(a){this._selectionContent.reset();for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];c.intersectsRay(a,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},b._CreateBlocks=function(b,c,d,e,f,g,h,i){h.blocks=new Array;for(var j=new a.Vector3((c.x-b.x)/2,(c.y-b.y)/2,(c.z-b.z)/2),k=0;2>k;k++)for(var l=0;2>l;l++)for(var m=0;2>m;m++){var n=b.add(j.multiplyByFloats(k,l,m)),o=b.add(j.multiplyByFloats(k+1,l+1,m+1)),p=new a.OctreeBlock(n,o,e,f+1,g,i);p.addEntries(d),h.blocks.push(p)}},b.CreationFuncForMeshes=function(a,b){!a.isBlocked&&a.getBoundingInfo().boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},b.CreationFuncForSubMeshes=function(a,b){a.getBoundingInfo().boundingBox.intersectsMinMax(b.minPoint,b.maxPoint)&&b.entries.push(a)},b}();a.Octree=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(a,b,c,d,e,f){this.entries=new Array,this._boundingVectors=new Array,this._capacity=c,this._depth=d,this._maxDepth=e,this._creationFunc=f,this._minPoint=a,this._maxPoint=b,this._boundingVectors.push(a.clone()),this._boundingVectors.push(b.clone()),this._boundingVectors.push(a.clone()),this._boundingVectors[2].x=b.x,this._boundingVectors.push(a.clone()),this._boundingVectors[3].y=b.y,this._boundingVectors.push(a.clone()),this._boundingVectors[4].z=b.z,this._boundingVectors.push(b.clone()),this._boundingVectors[5].z=a.z,this._boundingVectors.push(b.clone()),this._boundingVectors[6].x=a.x,this._boundingVectors.push(b.clone()),this._boundingVectors[7].y=a.y}return Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),b.prototype.addEntry=function(a){if(this.blocks)for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];c.addEntry(a)}else this._creationFunc(a,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},b.prototype.addEntries=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.addEntry(c)}},b.prototype.select=function(b,c,d){if(a.BoundingBox.IsInFrustum(this._boundingVectors,b)){if(this.blocks){for(var e=0;e<this.blocks.length;e++){var f=this.blocks[e];f.select(b,c,d)}return}d?c.concat(this.entries):c.concatWithNoDuplicate(this.entries)}},b.prototype.intersects=function(b,c,d,e){if(a.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,b,c)){if(this.blocks){for(var f=0;f<this.blocks.length;f++){var g=this.blocks[f];g.intersects(b,c,d,e)}return}e?d.concat(this.entries):d.concatWithNoDuplicate(this.entries)}},b.prototype.intersectsRay=function(a,b){if(a.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var c=0;c<this.blocks.length;c++){var d=this.blocks[c];d.intersectsRay(a,b)}return}b.concatWithNoDuplicate(this.entries)}},b.prototype.createInnerBlocks=function(){a.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},b}();a.OctreeBlock=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i,j){var k=this;void 0===h&&(h=a.Texture.BILINEAR_SAMPLINGMODE),b.call(this,c,"blur",["screenSize","direction","blurWidth"],null,f,g,h,i,j),this.direction=d,this.blurWidth=e,this.onApplyObservable.add(function(a){a.setFloat2("screenSize",k.width,k.height),a.setVector2("direction",k.direction),a.setFloat("blurWidth",k.blurWidth)})}return __extends(c,b),c}(a.PostProcess);a.BlurPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i,j,k,l){var m=this;b.call(this,c,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],h,i,j,k,l),this.color=e,this.depth=f,this.colorLevel=g,this.onActivateObservable.add(function(b){m._refRexture=m._refRexture||new a.Texture(d,b.getScene())}),this.onApplyObservable.add(function(a){a.setColor3("baseColor",m.color),a.setFloat("depth",m.depth),a.setFloat("colorLevel",m.colorLevel),a.setTexture("refractionSampler",m._refRexture)})}return __extends(c,b),c.prototype.dispose=function(a){this._refRexture&&this._refRexture.dispose(),b.prototype.dispose.call(this,a)},c}(a.PostProcess);a.RefractionPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g){a.call(this,b,"blackAndWhite",null,null,c,d,e,f,g)}return __extends(b,a),b}(a.PostProcess);a.BlackAndWhitePostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g,h){var i=this;a.call(this,b,"convolution",["kernel","screenSize"],null,d,e,f,g,h),this.kernel=c,this.onApply=function(a){a.setFloat2("screenSize",i.width,i.height),a.setArray("kernel",i.kernel)}}return __extends(b,a),b.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],b.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],b.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],b.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],b.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],b.GaussianKernel=[0,1,0,1,1,1,0,1,0],b}(a.PostProcess);a.ConvolutionPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g,h){var i=this;a.call(this,b,"filter",["kernelMatrix"],null,d,e,f,g,h),this.kernelMatrix=c,this.onApply=function(a){a.setMatrix("kernelMatrix",i.kernelMatrix)}}return __extends(b,a),b}(a.PostProcess);a.FilterPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d,e,f,g){var h=this;a.call(this,b,"fxaa",["texelSize"],null,c,d,e,f,g),this.onSizeChangedObservable.add(function(){h.texelWidth=1/h.width,h.texelHeight=1/h.height}),this.onApplyObservable.add(function(a){a.setFloat2("texelSize",h.texelWidth,h.texelHeight)})}return __extends(b,a),b}(a.PostProcess);a.FxaaPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h){var i=this;b.call(this,c,"stereoscopicInterlace",["stepSize"],["camASampler"],1,d[1],f,g,h,e?"#define IS_STEREOSCOPIC_HORIZ 1":void 0),this._passedProcess=d[0]._rigPostProcess,this._stepSize=new a.Vector2(1/this.width,1/this.height),this.onSizeChangedObservable.add(function(){i._stepSize=new a.Vector2(1/i.width,1/i.height)}),this.onApplyObservable.add(function(a){a.setTextureFromPostProcess("camASampler",i._passedProcess),a.setFloat2("stepSize",i._stepSize.x,i._stepSize.y)})}return __extends(c,b),c}(a.PostProcess);a.StereoscopicInterlacePostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f){this.size=b,this.position=c,this.dispose=function(){this.texture&&this.texture.dispose();var a=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(a,1)},this.color=d||new a.Color3(1,1,1),this.texture=e?new a.Texture(e,f.getScene(),!0):null,this._system=f,f.lensFlares.push(this)}return b}();a.LensFlare=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d){this.name=b,this.lensFlares=new Array,this.borderLimit=300,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=d,this._emitter=c,this.id=b,d.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(a){return a.material&&a.isVisible&&a.isEnabled()&&a.isBlocker&&0!=(a.layerMask&d.activeCamera.layerMask)};var e=d.getEngine(),f=[];f.push(1,1),f.push(-1,1),f.push(-1,-1),f.push(1,-1),this._vertexBuffers[a.VertexBuffer.PositionKind]=new a.VertexBuffer(e,f,a.VertexBuffer.PositionKind,!1,!1,2);var g=[];g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),this._indexBuffer=e.createIndexBuffer(g),this._effect=e.createEffect("lensFlare",[a.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled=a},enumerable:!0,configurable:!0}),b.prototype.getScene=function(){return this._scene},b.prototype.getEmitter=function(){return this._emitter},b.prototype.setEmitter=function(a){this._emitter=a},b.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},b.prototype.computeEffectivePosition=function(b){var c=this.getEmitterPosition();return c=a.Vector3.Project(c,a.Matrix.Identity(),this._scene.getTransformMatrix(),b),this._positionX=c.x,this._positionY=c.y,c=a.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),c.z>0&&this._positionX>b.x&&this._positionX<b.x+b.width&&this._positionY>b.y&&this._positionY<b.y+b.height},b.prototype._isVisible=function(){if(!this._isEnabled)return!1;var b=this.getEmitterPosition(),c=b.subtract(this._scene.activeCamera.position),d=c.length();c.normalize();var e=new a.Ray(this._scene.activeCamera.position,c),f=this._scene.pickWithRay(e,this.meshesSelectionPredicate,!0);return!f.hit||f.distance>d},b.prototype.render=function(){if(!this._effect.isReady())return!1;var b=this._scene.getEngine(),c=this._scene.activeCamera.viewport,d=c.toGlobal(b.getRenderWidth(!0),b.getRenderHeight(!0));if(!this.computeEffectivePosition(d))return!1;if(!this._isVisible())return!1;var e,f;e=this._positionX<this.borderLimit+d.x?this.borderLimit+d.x-this._positionX:this._positionX>d.x+d.width-this.borderLimit?this._positionX-d.x-d.width+this.borderLimit:0,f=this._positionY<this.borderLimit+d.y?this.borderLimit+d.y-this._positionY:this._positionY>d.y+d.height-this.borderLimit?this._positionY-d.y-d.height+this.borderLimit:0;var g=e>f?e:f;g>this.borderLimit&&(g=this.borderLimit);var h=1-g/this.borderLimit;if(0>h)return!1;h>1&&(h=1);var i=d.x+d.width/2,j=d.y+d.height/2,k=i-this._positionX,l=j-this._positionY;b.enableEffect(this._effect),b.setState(!1),b.setDepthBuffer(!1),b.setAlphaMode(a.Engine.ALPHA_ONEONE),b.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var m=0;m<this.lensFlares.length;m++){var n=this.lensFlares[m],o=i-k*n.position,p=j-l*n.position,q=n.size,r=n.size*b.getAspectRatio(this._scene.activeCamera,!0),s=2*(o/d.width)-1,t=1-2*(p/d.height),u=a.Matrix.FromValues(q/2,0,0,0,0,r/2,0,0,0,0,1,0,s,t,0,1);this._effect.setMatrix("viewportMatrix",u),this._effect.setTexture("textureSampler",n.texture),this._effect.setFloat4("color",n.color.r*h,n.color.g*h,n.color.b*h,1),b.draw(!0,0,6)}return b.setDepthBuffer(!0),b.setAlphaMode(a.Engine.ALPHA_DISABLE),!0},b.prototype.dispose=function(){var b=this._vertexBuffers[a.VertexBuffer.PositionKind];for(b&&(b.dispose(),this._vertexBuffers[a.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var c=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(c,1)},b.Parse=function(c,d,e){var f=d.getLastEntryByID(c.emitterId),g=c.name||"lensFlareSystem#"+c.emitterId,h=new b(g,f,d);h.id=c.id||g,h.borderLimit=c.borderLimit;for(var i=0;i<c.flares.length;i++){var j=c.flares[i];new a.LensFlare(j.size,j.position,a.Color3.FromArray(j.color),e+j.textureName,h)}return h},b.prototype.serialize=function(){var b={};b.id=this.id,b.name=this.name,b.emitterId=this.getEmitter().id,b.borderLimit=this.borderLimit,b.flares=[];for(var c=0;c<this.lensFlares.length;c++){var d=this.lensFlares[c];b.flares.push({size:d.size,position:d.position,color:d.color.asArray(),textureName:a.Tools.GetFilename(d.texture.name)})}return b},b}();a.LensFlareSystem=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.inputs.addDeviceOrientation()}return __extends(b,a),Object.defineProperty(b.prototype,"angularSensibility",{get:function(){return 0},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"moveSensibility",{get:function(){return 0},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.getTypeName=function(){return"DeviceOrientationCamera"},b}(a.FreeCamera);a.DeviceOrientationCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.inputs.addGamepad()}return __extends(b,a),Object.defineProperty(b.prototype,"gamepadAngularSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"gamepadMoveSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadMoveSensibility=a)},enumerable:!0,configurable:!0}),b.prototype.getTypeName=function(){return"UniversalCamera"},b}(a.TouchCamera);a.UniversalCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(a){var b=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported="GamepadEvent"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this._callbackGamepadConnected=a,this.gamepadSupportAvailable&&(this.gamepadEventSupported?(this._onGamepadConnectedEvent=function(a){b._onGamepadConnected(a)},this._onGamepadDisonnectedEvent=function(a){b._onGamepadDisconnected(a)},window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1)):this._startMonitoringGamepads())}return a.prototype.dispose=function(){a.gamepadDOMInfo&&document.body.removeChild(a.gamepadDOMInfo),this._onGamepadConnectedEvent&&(window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.removeEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1),this._onGamepadConnectedEvent=null,this._onGamepadDisonnectedEvent=null)},a.prototype._onGamepadConnected=function(a){var b=this._addNewGamepad(a.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(b),this._startMonitoringGamepads()},a.prototype._addNewGamepad=function(b){this.oneGamepadConnected||(this.oneGamepadConnected=!0,a.gamepadDOMInfo&&(document.body.removeChild(a.gamepadDOMInfo),a.gamepadDOMInfo=null));var c;return c=-1!==b.id.search("Xbox 360")||-1!==b.id.search("xinput")?new h(b.id,b.index,b):new e(b.id,b.index,b),this.babylonGamepads.push(c),c},a.prototype._onGamepadDisconnected=function(a){for(var b in this.babylonGamepads)if(this.babylonGamepads[b].index==a.gamepad.index){this.babylonGamepads.splice(+b,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},a.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},a.prototype._stopMonitoringGamepads=function(){
this.isMonitoring=!1},a.prototype._checkGamepadsStatus=function(){var a=this;this._updateGamepadObjects();for(var b in this.babylonGamepads)this.babylonGamepads[b].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){a._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){a._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){a._checkGamepadsStatus()}))},a.prototype._updateGamepadObjects=function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],b=0;b<a.length;b++)if(a[b])if(a[b].index in this.babylonGamepads)this.babylonGamepads[b].browserGamepad=a[b];else{var c=this._addNewGamepad(a[b]);this._callbackGamepadConnected&&this._callbackGamepadConnected(c)}},a}();a.Gamepads=b;var c=function(){function a(a,b){this.x=a,this.y=b}return a}();a.StickValues=c;var d=function(){function a(a,b,c){this.id=a,this.index=b,this.browserGamepad=c,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return a.prototype.onleftstickchanged=function(a){this._onleftstickchanged=a},a.prototype.onrightstickchanged=function(a){this._onrightstickchanged=a},Object.defineProperty(a.prototype,"leftStick",{get:function(){return this._leftStick},set:function(a){!this._onleftstickchanged||this._leftStick.x===a.x&&this._leftStick.y===a.y||this._onleftstickchanged(a),this._leftStick=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rightStick",{get:function(){return this._rightStick},set:function(a){!this._onrightstickchanged||this._rightStick.x===a.x&&this._rightStick.y===a.y||this._onrightstickchanged(a),this._rightStick=a},enumerable:!0,configurable:!0}),a.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},a}();a.Gamepad=d;var e=function(a){function b(b,c,d){a.call(this,b,c,d),this.id=b,this.index=c,this.gamepad=d,this._buttons=new Array(d.buttons.length)}return __extends(b,a),b.prototype.onbuttondown=function(a){this._onbuttondown=a},b.prototype.onbuttonup=function(a){this._onbuttonup=a},b.prototype._setButtonValue=function(a,b,c){return a!==b&&(this._onbuttondown&&1===a&&this._onbuttondown(c),this._onbuttonup&&0===a&&this._onbuttonup(c)),a},b.prototype.update=function(){a.prototype.update.call(this);for(var b=0;b<this._buttons.length;b++)this._buttons[b]=this._setButtonValue(this.gamepad.buttons[b].value,this._buttons[b],b)},b}(d);a.GenericPad=e,function(a){a[a.A=0]="A",a[a.B=1]="B",a[a.X=2]="X",a[a.Y=3]="Y",a[a.Start=4]="Start",a[a.Back=5]="Back",a[a.LB=6]="LB",a[a.RB=7]="RB",a[a.LeftStick=8]="LeftStick",a[a.RightStick=9]="RightStick"}(a.Xbox360Button||(a.Xbox360Button={}));var f=a.Xbox360Button;!function(a){a[a.Up=0]="Up",a[a.Down=1]="Down",a[a.Left=2]="Left",a[a.Right=3]="Right"}(a.Xbox360Dpad||(a.Xbox360Dpad={}));var g=a.Xbox360Dpad,h=function(a){function b(){a.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return __extends(b,a),b.prototype.onlefttriggerchanged=function(a){this._onlefttriggerchanged=a},b.prototype.onrighttriggerchanged=function(a){this._onrighttriggerchanged=a},Object.defineProperty(b.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(a){this._onlefttriggerchanged&&this._leftTrigger!==a&&this._onlefttriggerchanged(a),this._leftTrigger=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(a){this._onrighttriggerchanged&&this._rightTrigger!==a&&this._onrighttriggerchanged(a),this._rightTrigger=a},enumerable:!0,configurable:!0}),b.prototype.onbuttondown=function(a){this._onbuttondown=a},b.prototype.onbuttonup=function(a){this._onbuttonup=a},b.prototype.ondpaddown=function(a){this._ondpaddown=a},b.prototype.ondpadup=function(a){this._ondpadup=a},b.prototype._setButtonValue=function(a,b,c){return a!==b&&(this._onbuttondown&&1===a&&this._onbuttondown(c),this._onbuttonup&&0===a&&this._onbuttonup(c)),a},b.prototype._setDPadValue=function(a,b,c){return a!==b&&(this._ondpaddown&&1===a&&this._ondpaddown(c),this._ondpadup&&0===a&&this._ondpadup(c)),a},Object.defineProperty(b.prototype,"buttonA",{get:function(){return this._buttonA},set:function(a){this._buttonA=this._setButtonValue(a,this._buttonA,f.A)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonB",{get:function(){return this._buttonB},set:function(a){this._buttonB=this._setButtonValue(a,this._buttonB,f.B)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonX",{get:function(){return this._buttonX},set:function(a){this._buttonX=this._setButtonValue(a,this._buttonX,f.X)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonY",{get:function(){return this._buttonY},set:function(a){this._buttonY=this._setButtonValue(a,this._buttonY,f.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(a){this._buttonStart=this._setButtonValue(a,this._buttonStart,f.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(a){this._buttonBack=this._setButtonValue(a,this._buttonBack,f.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(a){this._buttonLB=this._setButtonValue(a,this._buttonLB,f.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(a){this._buttonRB=this._setButtonValue(a,this._buttonRB,f.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(a){this._buttonLeftStick=this._setButtonValue(a,this._buttonLeftStick,f.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(a){this._buttonRightStick=this._setButtonValue(a,this._buttonRightStick,f.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(a){this._dPadUp=this._setDPadValue(a,this._dPadUp,g.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(a){this._dPadDown=this._setDPadValue(a,this._dPadDown,g.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(a){this._dPadLeft=this._setDPadValue(a,this._dPadLeft,g.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(a){this._dPadRight=this._setDPadValue(a,this._dPadRight,g.Right)},enumerable:!0,configurable:!0}),b.prototype.update=function(){a.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},b}(d);a.Xbox360Pad=h}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e){a.Tools.Warn("Deprecated. Please use Universal Camera instead."),b.call(this,c,d,e)}return __extends(c,b),Object.defineProperty(c.prototype,"gamepadAngularSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadAngularSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadAngularSensibility=a)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"gamepadMoveSensibility",{get:function(){var a=this.inputs.attached.gamepad;return a?a.gamepadMoveSensibility:void 0},set:function(a){var b=this.inputs.attached.gamepad;b&&(b.gamepadMoveSensibility=a)},enumerable:!0,configurable:!0}),c.prototype.getTypeName=function(){return"GamepadCamera"},c}(a.UniversalCamera);a.GamepadCamera=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=b,this._audioEngine=a.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return b.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},b.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},b.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},b.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},b.prototype.drawDebugCanvas=function(){var a=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){a.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var b=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var c=0;c<this.getFrequencyBinCount();c++){var d=b[c],e=d/this.BARGRAPHAMPLITUDE,f=this.DEBUGCANVASSIZE.height*e,g=this.DEBUGCANVASSIZE.height-f-1,h=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),i=c/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+i+", 100%, 50%)",this._debugCanvasContext.fillRect(c*h,g,h,f)}}},b.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},b.prototype.connectAudioNodes=function(a,b){this._audioEngine.canUseWebAudio&&(a.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(b))},b.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},b}();a.Analyser=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c){var d=this;void 0===c&&(c=a.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=a.Matrix.Zero(),this._projectionMatrix=a.Matrix.Zero(),this._transformMatrix=a.Matrix.Zero(),this._worldViewProjection=a.Matrix.Zero(),this._scene=b;var e=b.getEngine();this._depthMap=new a.RenderTargetTexture("depthMap",{width:e.getRenderWidth(),height:e.getRenderHeight()},this._scene,!1,!0,c),this._depthMap.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClearObservable.add(function(b){b.clear(new a.Color4(1,1,1,1),!0,!0)});var f=function(b){var c=b.getRenderingMesh(),e=d._scene,f=e.getEngine();f.setState(b.getMaterial().backFaceCulling);var g=c._getInstancesRenderList(b._id);if(!g.mustReturn){var h=null!==f.getCaps().instancedArrays&&null!==g.visibleInstances[b._id];if(d.isReady(b,h)){f.enableEffect(d._effect),c._bind(b,d._effect,a.Material.TriangleFillMode);var i=b.getMaterial();if(d._effect.setMatrix("viewProjection",e.getTransformMatrix()),d._effect.setFloat("far",e.activeCamera.maxZ),i&&i.needAlphaTesting()){var j=i.getAlphaTestTexture();d._effect.setTexture("diffuseSampler",j),d._effect.setMatrix("diffuseMatrix",j.getTextureMatrix())}c.useBones&&c.computeBonesUsingShaders&&d._effect.setMatrices("mBones",c.skeleton.getTransformMatrices(c)),c._processRendering(b,d._effect,a.Material.TriangleFillMode,g,h,function(a,b){return d._effect.setMatrix("world",b)})}}};this._depthMap.customRenderFunction=function(a,b){var c;for(c=0;c<a.length;c++)f(a.data[c]);for(c=0;c<b.length;c++)f(b.data[c])}}return b.prototype.isReady=function(b,c){var d=b.getMaterial();if(d.disableDepthWrite)return!1;var e=[],f=[a.VertexBuffer.PositionKind],g=b.getMesh();g.getScene(),d&&d.needAlphaTesting()&&(e.push("#define ALPHATEST"),g.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(f.push(a.VertexBuffer.UVKind),e.push("#define UV1")),g.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(f.push(a.VertexBuffer.UV2Kind),e.push("#define UV2"))),g.useBones&&g.computeBonesUsingShaders?(f.push(a.VertexBuffer.MatricesIndicesKind),f.push(a.VertexBuffer.MatricesWeightsKind),g.numBoneInfluencers>4&&(f.push(a.VertexBuffer.MatricesIndicesExtraKind),f.push(a.VertexBuffer.MatricesWeightsExtraKind)),e.push("#define NUM_BONE_INFLUENCERS "+g.numBoneInfluencers),e.push("#define BonesPerMesh "+(g.skeleton.bones.length+1))):e.push("#define NUM_BONE_INFLUENCERS 0"),c&&(e.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));var h=e.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,this._effect=this._scene.getEngine().createEffect("depth",f,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],h)),this._effect.isReady()},b.prototype.getDepthMap=function(){return this._depthMap},b.prototype.dispose=function(){this._depthMap.dispose()},b}();a.DepthRenderer=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){var g=this;b.call(this,d.getEngine(),c),this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",this.SSAORenderEffect="SSAORenderEffect",this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",this.SSAOCombineRenderEffect="SSAOCombineRenderEffect",this.totalStrength=1,this.radius=1e-4,this.area=.0075,this.fallOff=1e-6,this.base=.5,this._firstUpdate=!0,this._scene=d,this._createRandomTexture(),this._depthTexture=d.enableDepthRenderer().getDepthMap();var h=e.ssaoRatio||e,i=e.combineRatio||e;this._ratio={ssaoRatio:h,combineRatio:i},this._originalColorPostProcess=new a.PassPostProcess("SSAOOriginalSceneColor",i,null,a.Texture.BILINEAR_SAMPLINGMODE,d.getEngine(),!1),this._createSSAOPostProcess(h),this._createBlurPostProcess(h),this._createSSAOCombinePostProcess(i),this.addEffect(new a.PostProcessRenderEffect(d.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return g._originalColorPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(d.getEngine(),this.SSAORenderEffect,function(){return g._ssaoPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurHRenderEffect,function(){return g._blurHPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(d.getEngine(),this.SSAOBlurVRenderEffect,function(){return g._blurVPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(d.getEngine(),this.SSAOCombineRenderEffect,function(){return g._ssaoCombinePostProcess},!0)),d.postProcessRenderPipelineManager.addPipeline(this),f&&d.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,f)}return __extends(c,b),c.prototype.getBlurHPostProcess=function(){return a.Tools.Error("SSAORenderinPipeline.getBlurHPostProcess() is deprecated, no more blur post-process exists"),null},c.prototype.getBlurVPostProcess=function(){return a.Tools.Error("SSAORenderinPipeline.getBlurVPostProcess() is deprecated, no more blur post-process exists"),null},c.prototype.dispose=function(a){void 0===a&&(a=!1);for(var b=0;b<this._scene.cameras.length;b++){var c=this._scene.cameras[b];this._originalColorPostProcess.dispose(c),this._ssaoPostProcess.dispose(c),this._blurHPostProcess.dispose(c),this._blurVPostProcess.dispose(c),this._ssaoCombinePostProcess.dispose(c)}this._randomTexture.dispose(),a&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},c.prototype._createBlurPostProcess=function(b){for(var c=this,d=[],e=-8;8>e;e++)d.push(2*e);this._blurHPostProcess=new a.PostProcess("BlurH","ssao",["outSize","samplerOffsets"],["depthSampler"],b,null,a.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16"),this._blurHPostProcess.onApply=function(a){a.setFloat("outSize",c._ssaoCombinePostProcess.width),a.setTexture("depthSampler",c._depthTexture),c._firstUpdate&&a.setArray("samplerOffsets",d)},this._blurVPostProcess=new a.PostProcess("BlurV","ssao",["outSize","samplerOffsets"],["depthSampler"],b,null,a.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define SAMPLES 16"),this._blurVPostProcess.onApply=function(a){a.setFloat("outSize",c._ssaoCombinePostProcess.height),a.setTexture("depthSampler",c._depthTexture),c._firstUpdate&&(a.setArray("samplerOffsets",d),c._firstUpdate=!1)}},c.prototype._createSSAOPostProcess=function(b){var c=this,d=16,e=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],f=1/d;this._ssaoPostProcess=new a.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],b,null,a.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+d+"\n#define SSAO"),new a.Vector2(0,0),this._ssaoPostProcess.onApply=function(a){c._firstUpdate&&(a.setArray3("sampleSphere",e),a.setFloat("samplesFactor",f),a.setFloat("randTextureTiles",4)),a.setFloat("totalStrength",c.totalStrength),a.setFloat("radius",c.radius),a.setFloat("area",c.area),a.setFloat("fallOff",c.fallOff),a.setFloat("base",c.base),a.setTexture("textureSampler",c._depthTexture),a.setTexture("randomSampler",c._randomTexture)}},c.prototype._createSSAOCombinePostProcess=function(b){var c=this;this._ssaoCombinePostProcess=new a.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],b,null,a.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(a){a.setTextureFromPostProcess("originalColor",c._originalColorPostProcess)}},c.prototype._createRandomTexture=function(){var b=512;this._randomTexture=new a.DynamicTexture("SSAORandomTexture",b,this._scene,!1,a.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=a.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=a.Texture.WRAP_ADDRESSMODE;for(var c=this._randomTexture.getContext(),d=function(a,b){return Math.random()*(b-a)+a},e=a.Vector3.Zero(),f=0;b>f;f++)for(var g=0;b>g;g++)e.x=Math.floor(255*d(-1,1)),e.y=Math.floor(255*d(-1,1)),e.z=Math.floor(255*d(-1,1)),c.fillStyle="rgb("+e.x+", "+e.y+", "+e.z+")",c.fillRect(f,g,1,1);this._randomTexture.update(!1)},__decorate([a.serialize()],c.prototype,"totalStrength",void 0),__decorate([a.serialize()],c.prototype,"radius",void 0),__decorate([a.serialize()],c.prototype,"area",void 0),__decorate([a.serialize()],c.prototype,"fallOff",void 0),__decorate([a.serialize()],c.prototype,"base",void 0),__decorate([a.serialize()],c.prototype,"_ratio",void 0),c}(a.PostProcessRenderPipeline);a.SSAORenderingPipeline=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(d,e,f,g,h,i,j,k,l){var m=this;void 0===h&&(h=100),void 0===i&&(i=a.Texture.BILINEAR_SAMPLINGMODE),b.call(this,d,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],e.postProcessRatio||e,f,i,j,k,"#define NUM_SAMPLES "+h),this._screenCoordinates=a.Vector2.Zero(),this.customMeshPosition=a.Vector3.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926,l=null===f?l:f.getScene();var j=l.getEngine();this._viewPort=new a.Viewport(0,0,1,1).toGlobal(j.getRenderWidth(),j.getRenderHeight()),this.mesh=null!==g?g:c.CreateDefaultMesh("VolumetricLightScatteringMesh",l),this._createPass(l,e.passRatio||e),this.onActivate=function(a){m.isSupported||m.dispose(a),m.onActivate=null},this.onApplyObservable.add(function(a){m._updateMeshScreenCoordinates(l),a.setTexture("lightScatteringSampler",m._volumetricLightScatteringRTT),a.setFloat("exposure",m.exposure),a.setFloat("decay",m.decay),a.setFloat("weight",m.weight),a.setFloat("density",m.density),a.setVector2("meshPositionOnScreen",m._screenCoordinates)})}return __extends(c,b),Object.defineProperty(c.prototype,"useDiffuseColor",{get:function(){return a.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(b){a.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),c.prototype.isReady=function(b,c){var d=b.getMesh();if(d===this.mesh)return d.material.isReady(d);var e=[],f=[a.VertexBuffer.PositionKind],g=b.getMaterial();g&&(g.needAlphaTesting()&&e.push("#define ALPHATEST"),d.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(f.push(a.VertexBuffer.UVKind),e.push("#define UV1")),d.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(f.push(a.VertexBuffer.UV2Kind),e.push("#define UV2"))),d.useBones&&d.computeBonesUsingShaders?(f.push(a.VertexBuffer.MatricesIndicesKind),f.push(a.VertexBuffer.MatricesWeightsKind),e.push("#define NUM_BONE_INFLUENCERS "+d.numBoneInfluencers),e.push("#define BonesPerMesh "+(d.skeleton.bones.length+1))):e.push("#define NUM_BONE_INFLUENCERS 0"),c&&(e.push("#define INSTANCES"),f.push("world0"),f.push("world1"),f.push("world2"),f.push("world3"));var h=e.join("\n");return this._cachedDefines!==h&&(this._cachedDefines=h,this._volumetricLightScatteringPass=d.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},f,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],h)),this._volumetricLightScatteringPass.isReady()},c.prototype.setCustomMeshPosition=function(a){this.customMeshPosition=a},c.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},c.prototype.dispose=function(a){var c=a.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==c&&a.getScene().customRenderTargets.splice(c,1),this._volumetricLightScatteringRTT.dispose(),b.prototype.dispose.call(this,a)},c.prototype.getPass=function(){return this._volumetricLightScatteringRTT},c.prototype._meshExcluded=function(a){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(a)},c.prototype._createPass=function(b,c){var d=this,e=b.getEngine();this._volumetricLightScatteringRTT=new a.RenderTargetTexture("volumetricLightScatteringMap",{width:e.getRenderWidth()*c,height:e.getRenderHeight()*c},b,!1,!0,a.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=a.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,b.customRenderTargets.push(this._volumetricLightScatteringRTT);var f,g=function(b){var c=b.getRenderingMesh();if(!d._meshExcluded(c)){var e=c.getScene(),f=e.getEngine();f.setState(b.getMaterial().backFaceCulling);var g=c._getInstancesRenderList(b._id);if(!g.mustReturn){var h=null!==f.getCaps().instancedArrays&&null!==g.visibleInstances[b._id];if(d.isReady(b,h)){var i=d._volumetricLightScatteringPass;if(c===d.mesh&&(i=b.getMaterial().getEffect()),f.enableEffect(i),c._bind(b,i,a.Material.TriangleFillMode),c===d.mesh)b.getMaterial().bind(c.getWorldMatrix(),c);else{var j=b.getMaterial();if(d._volumetricLightScatteringPass.setMatrix("viewProjection",e.getTransformMatrix()),j&&j.needAlphaTesting()){var k=j.getAlphaTestTexture();d._volumetricLightScatteringPass.setTexture("diffuseSampler",k),k&&d._volumetricLightScatteringPass.setMatrix("diffuseMatrix",k.getTextureMatrix())}c.useBones&&c.computeBonesUsingShaders&&d._volumetricLightScatteringPass.setMatrices("mBones",c.skeleton.getTransformMatrices(c))}c._processRendering(b,d._volumetricLightScatteringPass,a.Material.TriangleFillMode,g,h,function(a,b){return i.setMatrix("world",b)})}}}},h=new a.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){f=b.clearColor,b.clearColor=h}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){b.clearColor=f}),this._volumetricLightScatteringRTT.customRenderFunction=function(c,d,e){var f,h=b.getEngine();for(f=0;f<c.length;f++)g(c.data[f]);for(h.setAlphaTesting(!0),f=0;f<d.length;f++)g(d.data[f]);if(h.setAlphaTesting(!1),e.length){for(f=0;f<e.length;f++){var i=e.data[f];i._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=i.getBoundingInfo().boundingSphere.centerWorld.subtract(b.activeCamera.position).length()}var j=e.data.slice(0,e.length);for(j.sort(function(a,b){return a._alphaIndex>b._alphaIndex?1:a._alphaIndex<b._alphaIndex?-1:a._distanceToCamera<b._distanceToCamera?1:a._distanceToCamera>b._distanceToCamera?-1:0}),h.setAlphaMode(a.Engine.ALPHA_COMBINE),f=0;f<j.length;f++)g(j[f]);h.setAlphaMode(a.Engine.ALPHA_DISABLE)}}},c.prototype._updateMeshScreenCoordinates=function(b){var c,d=b.getTransformMatrix();c=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var e=a.Vector3.Project(c,a.Matrix.Identity(),d,this._viewPort);this._screenCoordinates.x=e.x/this._viewPort.width,this._screenCoordinates.y=e.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},c.CreateDefaultMesh=function(b,c){var d=a.Mesh.CreatePlane(b,1,c);d.billboardMode=a.AbstractMesh.BILLBOARDMODE_ALL;var e=new a.StandardMaterial(b+"Material",c);return e.emissiveColor=new a.Color3(1,1,1),d.material=e,d},__decorate([a.serializeAsVector3()],c.prototype,"customMeshPosition",void 0),__decorate([a.serialize()],c.prototype,"useCustomMeshPosition",void 0),__decorate([a.serialize()],c.prototype,"invert",void 0),__decorate([a.serializeAsMeshReference()],c.prototype,"mesh",void 0),__decorate([a.serialize()],c.prototype,"excludedMeshes",void 0),__decorate([a.serialize()],c.prototype,"exposure",void 0),__decorate([a.serialize()],c.prototype,"decay",void 0),__decorate([a.serialize()],c.prototype,"weight",void 0),__decorate([a.serialize()],c.prototype,"density",void 0),c}(a.PostProcess);a.VolumetricLightScatteringPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g){var h=this;void 0===f&&(f=1),b.call(this,e.getEngine(),c),this.LensChromaticAberrationEffect="LensChromaticAberrationEffect",this.HighlightsEnhancingEffect="HighlightsEnhancingEffect",this.LensDepthOfFieldEffect="LensDepthOfFieldEffect",this._scene=e,this._depthTexture=e.enableDepthRenderer().getDepthMap(),d.grain_texture?this._grainTexture=d.grain_texture:this._createGrainTexture(),this._edgeBlur=d.edge_blur?d.edge_blur:0,this._grainAmount=d.grain_amount?d.grain_amount:0,this._chromaticAberration=d.chromatic_aberration?d.chromatic_aberration:0,this._distortion=d.distortion?d.distortion:0,this._highlightsGain=void 0!==d.dof_gain?d.dof_gain:-1,this._highlightsThreshold=d.dof_threshold?d.dof_threshold:1,this._dofDistance=void 0!==d.dof_focus_distance?d.dof_focus_distance:-1,this._dofAperture=d.dof_aperture?d.dof_aperture:1,this._dofDarken=d.dof_darken?d.dof_darken:0,this._dofPentagon=void 0!==d.dof_pentagon?d.dof_pentagon:!0,this._blurNoise=void 0!==d.blur_noise?d.blur_noise:!0,this._createChromaticAberrationPostProcess(f),this._createHighlightsPostProcess(f),this._createDepthOfFieldPostProcess(f/4),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),this.LensChromaticAberrationEffect,function(){return h._chromaticAberrationPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),this.HighlightsEnhancingEffect,function(){return h._highlightsPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),this.LensDepthOfFieldEffect,function(){return h._depthOfFieldPostProcess},!0)),-1===this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),e.postProcessRenderPipelineManager.addPipeline(this),g&&e.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(c,g)}return __extends(c,b),c.prototype.setEdgeBlur=function(a){this._edgeBlur=a},c.prototype.disableEdgeBlur=function(){this._edgeBlur=0},c.prototype.setGrainAmount=function(a){this._grainAmount=a},c.prototype.disableGrain=function(){this._grainAmount=0},c.prototype.setChromaticAberration=function(a){this._chromaticAberration=a},c.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},c.prototype.setEdgeDistortion=function(a){this._distortion=a},c.prototype.disableEdgeDistortion=function(){this._distortion=0},c.prototype.setFocusDistance=function(a){this._dofDistance=a},c.prototype.disableDepthOfField=function(){this._dofDistance=-1},c.prototype.setAperture=function(a){this._dofAperture=a},c.prototype.setDarkenOutOfFocus=function(a){this._dofDarken=a},c.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},c.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},c.prototype.enableNoiseBlur=function(){this._blurNoise=!0},c.prototype.disableNoiseBlur=function(){this._blurNoise=!1},c.prototype.setHighlightsGain=function(a){this._highlightsGain=a},c.prototype.setHighlightsThreshold=function(a){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=a;
},c.prototype.disableHighlights=function(){this._highlightsGain=-1},c.prototype.dispose=function(a){void 0===a&&(a=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),a&&this._scene.disableDepthRenderer()},c.prototype._createChromaticAberrationPostProcess=function(b){var c=this;this._chromaticAberrationPostProcess=new a.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],b,null,a.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(a){a.setFloat("chromatic_aberration",c._chromaticAberration),a.setFloat("screen_width",c._scene.getEngine().getRenderingCanvas().width),a.setFloat("screen_height",c._scene.getEngine().getRenderingCanvas().height)}},c.prototype._createHighlightsPostProcess=function(b){var c=this;this._highlightsPostProcess=new a.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],b,null,a.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(a){a.setFloat("gain",c._highlightsGain),a.setFloat("threshold",c._highlightsThreshold),a.setTextureFromPostProcess("textureSampler",c._chromaticAberrationPostProcess),a.setFloat("screen_width",c._scene.getEngine().getRenderingCanvas().width),a.setFloat("screen_height",c._scene.getEngine().getRenderingCanvas().height)}},c.prototype._createDepthOfFieldPostProcess=function(b){var c=this;this._depthOfFieldPostProcess=new a.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],b,null,a.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(a){a.setTexture("depthSampler",c._depthTexture),a.setTexture("grainSampler",c._grainTexture),a.setTextureFromPostProcess("textureSampler",c._highlightsPostProcess),a.setTextureFromPostProcess("highlightsSampler",c._depthOfFieldPostProcess),a.setFloat("grain_amount",c._grainAmount),a.setBool("blur_noise",c._blurNoise),a.setFloat("screen_width",c._scene.getEngine().getRenderingCanvas().width),a.setFloat("screen_height",c._scene.getEngine().getRenderingCanvas().height),a.setFloat("distortion",c._distortion),a.setBool("dof_enabled",-1!==c._dofDistance),a.setFloat("screen_distance",1/(.1-1/c._dofDistance)),a.setFloat("aperture",c._dofAperture),a.setFloat("darken",c._dofDarken),a.setFloat("edge_blur",c._edgeBlur),a.setBool("highlights",-1!==c._highlightsGain),a.setFloat("near",c._scene.activeCamera.minZ),a.setFloat("far",c._scene.activeCamera.maxZ)}},c.prototype._createGrainTexture=function(){var b=512;this._grainTexture=new a.DynamicTexture("LensNoiseTexture",b,this._scene,!1,a.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=a.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=a.Texture.WRAP_ADDRESSMODE;for(var c,d=this._grainTexture.getContext(),e=function(a,b){return Math.random()*(b-a)+a},f=0;b>f;f++)for(var g=0;b>g;g++)c=Math.floor(255*e(.42,.58)),d.fillStyle="rgb("+c+", "+c+", "+c+")",d.fillRect(f,g,1,1);this._grainTexture.update(!1)},c}(a.PostProcessRenderPipeline);a.LensRenderingPipeline=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i){var j=this;b.call(this,c,"colorCorrection",null,["colorTable"],e,f,g,h,i),this._colorTableTexture=new a.Texture(d,f.getScene(),!0,!1,a.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=a.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=a.Texture.CLAMP_ADDRESSMODE,this.onApply=function(a){a.setTexture("colorTable",j._colorTableTexture)}}return __extends(c,b),c}(a.PostProcess);a.ColorCorrectionPostProcess=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f){b.call(this,c,d,f),this.interaxialDistance=e,this.setCameraRigMode(a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"AnaglyphFreeCamera"},c}(a.FreeCamera);a.AnaglyphFreeCamera=b;var c=function(b){function c(c,d,e,f,g,h,i){b.call(this,c,d,e,f,g,i),this.interaxialDistance=h,this.setCameraRigMode(a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:h})}return __extends(c,b),c.prototype.getTypeName=function(){return"AnaglyphArcRotateCamera"},c}(a.ArcRotateCamera);a.AnaglyphArcRotateCamera=c;var d=function(b){function c(c,d,e,f){b.call(this,c,d,f),this.interaxialDistance=e,this.setCameraRigMode(a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"AnaglyphGamepadCamera"},c}(a.GamepadCamera);a.AnaglyphGamepadCamera=d;var e=function(b){function c(c,d,e,f){b.call(this,c,d,f),this.interaxialDistance=e,this.setCameraRigMode(a.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"AnaglyphUniversalCamera"},c}(a.UniversalCamera);a.AnaglyphUniversalCamera=e;var f=function(b){function c(c,d,e,f,g){b.call(this,c,d,g),this.interaxialDistance=e,this.isStereoscopicSideBySide=f,this.setCameraRigMode(f?a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"StereoscopicFreeCamera"},c}(a.FreeCamera);a.StereoscopicFreeCamera=f;var g=function(b){function c(c,d,e,f,g,h,i,j){b.call(this,c,d,e,f,g,j),this.interaxialDistance=h,this.isStereoscopicSideBySide=i,this.setCameraRigMode(i?a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:h})}return __extends(c,b),c.prototype.getTypeName=function(){return"StereoscopicArcRotateCamera"},c}(a.ArcRotateCamera);a.StereoscopicArcRotateCamera=g;var h=function(b){function c(c,d,e,f,g){b.call(this,c,d,g),this.interaxialDistance=e,this.isStereoscopicSideBySide=f,this.setCameraRigMode(f?a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"StereoscopicGamepadCamera"},c}(a.GamepadCamera);a.StereoscopicGamepadCamera=h;var i=function(b){function c(c,d,e,f,g){b.call(this,c,d,g),this.interaxialDistance=e,this.isStereoscopicSideBySide=f,this.setCameraRigMode(f?a.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:a.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:e})}return __extends(c,b),c.prototype.getTypeName=function(){return"StereoscopicUniversalCamera"},c}(a.UniversalCamera);a.StereoscopicUniversalCamera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(d,e,f,g,h){var i=this;void 0===g&&(g=null),b.call(this,e.getEngine(),d),this.gaussCoeff=.3,this.gaussMean=1,this.gaussStandDev=.8,this.gaussMultiplier=4,this.exposure=1,this.minimumLuminance=1,this.maximumLuminance=1e20,this.luminanceIncreaserate=.5,this.luminanceDecreaseRate=.5,this.brightThreshold=.8,this._needUpdate=!0,this._scene=e,this._createBrightPassPostProcess(e,f),this._createDownSampleX4PostProcess(e,f),this._createGaussianBlurPostProcess(e,f),this._createTextureAdderPostProcess(e,f),this._createLuminanceGeneratorPostProcess(e),this._createHDRPostProcess(e,f),null===g?this._originalPostProcess=new a.PassPostProcess("hdr",f,null,a.Texture.BILINEAR_SAMPLINGMODE,e.getEngine(),!1):this._originalPostProcess=g,this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRPassPostProcess",function(){return i._originalPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRBrightPass",function(){return i._brightPassPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRDownSampleX4",function(){return i._downSampleX4PostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRGaussianBlurH",function(){return i._guassianBlurHPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRGaussianBlurV",function(){return i._guassianBlurVPostProcess},!0)),this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRTextureAdder",function(){return i._textureAdderPostProcess},!0));for(var j=function(b){i.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDRDownSampler"+b,function(){return i._downSamplePostProcesses[b]},!0))},k=c.LUM_STEPS-1;k>=0;k--)j(k);this.addEffect(new a.PostProcessRenderEffect(e.getEngine(),"HDR",function(){return i._hdrPostProcess},!0)),e.postProcessRenderPipelineManager.addPipeline(this),null!==h&&e.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(d,h),this.update()}return __extends(c,b),c.prototype.update=function(){this._needUpdate=!0},c.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance},c.prototype.getOutputLuminance=function(){return this._hdrOutputLuminance},c.prototype.dispose=function(){this._originalPostProcess=void 0,this._brightPassPostProcess=void 0,this._downSampleX4PostProcess=void 0,this._guassianBlurHPostProcess=void 0,this._guassianBlurVPostProcess=void 0,this._textureAdderPostProcess=void 0;for(var a=c.LUM_STEPS-1;a>=0;a--)this._downSamplePostProcesses[a]=void 0;this._hdrPostProcess=void 0,this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},c.prototype._createHDRPostProcess=function(b,c){var d=this,e=0;this._hdrOutputLuminance=-1,this._hdrCurrentLuminance=1,this._hdrPostProcess=new a.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],c,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define HDR"),this._hdrPostProcess.onApply=function(c){if(d._hdrOutputLuminance<0)d._hdrOutputLuminance=d._hdrCurrentLuminance;else{var f=(e-(e+b.getEngine().getDeltaTime()))/1e3;d._hdrCurrentLuminance<d._hdrOutputLuminance+d.luminanceDecreaseRate*f?d._hdrOutputLuminance+=d.luminanceDecreaseRate*f:d._hdrCurrentLuminance>d._hdrOutputLuminance-d.luminanceIncreaserate*f?d._hdrOutputLuminance-=d.luminanceIncreaserate*f:d._hdrOutputLuminance=d._hdrCurrentLuminance}d._hdrOutputLuminance=a.MathTools.Clamp(d._hdrOutputLuminance,d.minimumLuminance,d.maximumLuminance),e+=b.getEngine().getDeltaTime(),c.setTextureFromPostProcess("textureSampler",d._textureAdderPostProcess),c.setTextureFromPostProcess("otherSampler",d._originalPostProcess),c.setFloat("exposure",d.exposure),c.setFloat("avgLuminance",d._hdrOutputLuminance),d._needUpdate=!1}},c.prototype._createTextureAdderPostProcess=function(b,c){var d=this;this._textureAdderPostProcess=new a.PostProcess("hdr","hdr",[],["otherSampler"],c,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define TEXTURE_ADDER"),this._textureAdderPostProcess.onApply=function(a){a.setTextureFromPostProcess("otherSampler",d._originalPostProcess)}},c.prototype._createDownSampleX4PostProcess=function(b,c){var d=this,e=new Array(32);this._downSampleX4PostProcess=new a.PostProcess("hdr","hdr",["dsOffsets"],[],c/4,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define DOWN_SAMPLE_X4"),this._downSampleX4PostProcess.onApply=function(a){if(d._needUpdate)for(var b=0,c=-2;2>c;c++)for(var f=-2;2>f;f++)e[b]=(c+.5)*(1/d._downSampleX4PostProcess.width),e[b+1]=(f+.5)*(1/d._downSampleX4PostProcess.height),b+=2;a.setArray2("dsOffsets",e)}},c.prototype._createBrightPassPostProcess=function(b,c){var d=this,e=new Array(8),f=function(a){if(d._needUpdate){var b=1/d._brightPassPostProcess.width,c=1/d._brightPassPostProcess.height;e[0]=-.5*b,e[1]=.5*c,e[2]=.5*b,e[3]=.5*c,e[4]=-.5*b,e[5]=-.5*c,e[6]=.5*b,e[7]=-.5*c}a.setArray2("dsOffsets",e),a.setFloat("brightThreshold",d.brightThreshold)};this._brightPassPostProcess=new a.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],c,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define BRIGHT_PASS"),this._brightPassPostProcess.onApply=f},c.prototype._createLuminanceGeneratorPostProcess=function(b){var d,e=this,f=c.LUM_STEPS,g=new Array(8),h=new Array(18);this._downSamplePostProcesses=new Array(f);var i=function(a,b){var c=1/a,d=1/b;g[0]=-.5*c,g[1]=.5*d,g[2]=.5*c,g[3]=.5*d,g[4]=-.5*c,g[5]=-.5*d,g[6]=.5*c,g[7]=-.5*d},j=function(a,b){for(var c=0,d=-1;2>d;d++)for(var e=-1;2>e;e++)h[c]=d/a,h[c+1]=e/b,c+=2},k=function(a){e._needUpdate&&i(e._textureAdderPostProcess.width,e._textureAdderPostProcess.height),a.setTextureFromPostProcess("textureSampler",e._textureAdderPostProcess),a.setArray2("lumOffsets",g)},l=function(a){var b=a;return function(a){i(e._downSamplePostProcesses[b].width,e._downSamplePostProcesses[b].height),j(e._downSamplePostProcesses[b].width,e._downSamplePostProcesses[b].height),d=.5/e._downSamplePostProcesses[b].width,a.setTextureFromPostProcess("textureSampler",e._downSamplePostProcesses[b+1]),a.setFloat("halfDestPixelSize",d),a.setArray2("dsOffsets",h)}},m=function(c){var d=b.getEngine().readPixels(0,0,1,1),f=new a.Vector4(1/16581375,1/65025,1/255,1);e._hdrCurrentLuminance=(d[0]*f.x+d[1]*f.y+d[2]*f.z+d[3]*f.w)/100},n={width:Math.pow(3,f-1),height:Math.pow(3,f-1)};this._downSamplePostProcesses[f-1]=new a.PostProcess("hdr","hdr",["lumOffsets"],[],n,null,a.Texture.NEAREST_SAMPLINGMODE,b.getEngine(),!1,"#define LUMINANCE_GENERATOR",a.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[f-1].onApply=k;for(var o=f-2;o>=0;o--){var p=Math.pow(3,o);n={width:p,height:p};var q="#define DOWN_SAMPLE\n";0===o&&(q+="#define FINAL_DOWN_SAMPLE\n"),this._downSamplePostProcesses[o]=new a.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],n,null,a.Texture.NEAREST_SAMPLINGMODE,b.getEngine(),!1,q,a.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[o].onApply=l(o),0===o&&(this._downSamplePostProcesses[o].onAfterRender=m)}},c.prototype._createGaussianBlurPostProcess=function(b,c){var d=this,e=new Array(9),f=new Array(9),g=new Array(9),h=["blurOffsets","blurWeights","multiplier"],i=function(a){for(var c={width:b.getEngine().getRenderWidth(),height:b.getEngine().getRenderHeight()},d=0;9>d;d++){var g=(d-4)*(1/(a===!0?c.height:c.width));a?f[d]=g:e[d]=g}},j=function(){for(var a=0,b=0;9>b;b++)a=(b-4)/4,g[b]=d.gaussCoeff*(1/Math.sqrt(2*Math.PI*d.gaussStandDev))*Math.exp(-((a-d.gaussMean)*(a-d.gaussMean))/(2*d.gaussStandDev*d.gaussStandDev))},k=function(a){return function(b){d._needUpdate&&(j(),i(a)),b.setArray("blurOffsets",a?f:e),b.setArray("blurWeights",g),b.setFloat("multiplier",d.gaussMultiplier)}};this._guassianBlurHPostProcess=new a.PostProcess("hdr","hdr",h,[],c/4,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define GAUSSIAN_BLUR_H"),this._guassianBlurHPostProcess.onApply=k(!1),this._guassianBlurVPostProcess=new a.PostProcess("hdr","hdr",h,[],c/4,null,a.Texture.BILINEAR_SAMPLINGMODE,b.getEngine(),!1,"#define GAUSSIAN_BLUR_V"),this._guassianBlurVPostProcess.onApply=k(!0)},c.LUM_STEPS=6,c}(a.PostProcessRenderPipeline);a.HDRRenderingPipeline=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function a(){this.edges=new Array,this.edgesConnectedCount=0}return a}(),c=function(){function c(a,b,c){void 0===b&&(b=.95),void 0===c&&(c=!1),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this._source=a,this._checkVerticesInsteadOfIndices=c,this._epsilon=b,this._prepareRessources(),this._generateEdgesLines()}return c.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new a.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},c.prototype.dispose=function(){var b=this._buffers[a.VertexBuffer.PositionKind];b&&(b.dispose(),this._buffers[a.VertexBuffer.PositionKind]=null),b=this._buffers[a.VertexBuffer.NormalKind],b&&(b.dispose(),this._buffers[a.VertexBuffer.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},c.prototype._processEdgeForAdjacencies=function(a,b,c,d,e){return a===c&&b===d||a===d&&b===c?0:a===d&&b===e||a===e&&b===d?1:a===e&&b===c||a===c&&b===e?2:-1},c.prototype._processEdgeForAdjacenciesWithVertices=function(a,b,c,d,e){return a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(d)||a.equalsWithEpsilon(d)&&b.equalsWithEpsilon(c)?0:a.equalsWithEpsilon(d)&&b.equalsWithEpsilon(e)||a.equalsWithEpsilon(e)&&b.equalsWithEpsilon(d)?1:a.equalsWithEpsilon(e)&&b.equalsWithEpsilon(c)||a.equalsWithEpsilon(c)&&b.equalsWithEpsilon(e)?2:-1},c.prototype._checkEdge=function(b,c,d,e,f){var g;if(void 0===c)g=!0;else{var h=a.Vector3.Dot(d[b],d[c]);g=h<this._epsilon}if(g){var i=this._linesPositions.length/3,j=e.subtract(f);j.normalize(),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(e.x),this._linesPositions.push(e.y),this._linesPositions.push(e.z),this._linesPositions.push(f.x),this._linesPositions.push(f.y),this._linesPositions.push(f.z),this._linesPositions.push(f.x),this._linesPositions.push(f.y),this._linesPositions.push(f.z),this._linesNormals.push(f.x),this._linesNormals.push(f.y),this._linesNormals.push(f.z),this._linesNormals.push(-1),this._linesNormals.push(f.x),this._linesNormals.push(f.y),this._linesNormals.push(f.z),this._linesNormals.push(1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),this._linesNormals.push(e.z),this._linesNormals.push(-1),this._linesNormals.push(e.x),this._linesNormals.push(e.y),this._linesNormals.push(e.z),this._linesNormals.push(1),this._linesIndices.push(i),this._linesIndices.push(i+1),this._linesIndices.push(i+2),this._linesIndices.push(i),this._linesIndices.push(i+2),this._linesIndices.push(i+3)}},c.prototype._generateEdgesLines=function(){var c,d,e=this._source.getVerticesData(a.VertexBuffer.PositionKind),f=this._source.getIndices(),g=new Array,h=new Array;for(c=0;c<f.length;c+=3){d=new b;var i=f[c],j=f[c+1],k=f[c+2];d.p0=new a.Vector3(e[3*i],e[3*i+1],e[3*i+2]),d.p1=new a.Vector3(e[3*j],e[3*j+1],e[3*j+2]),d.p2=new a.Vector3(e[3*k],e[3*k+1],e[3*k+2]);var l=a.Vector3.Cross(d.p1.subtract(d.p0),d.p2.subtract(d.p1));l.normalize(),h.push(l),g.push(d)}for(c=0;c<g.length;c++){d=g[c];for(var m=c+1;m<g.length;m++){var n=g[m];if(3===d.edgesConnectedCount)break;if(3!==n.edgesConnectedCount)for(var o=f[3*m],p=f[3*m+1],q=f[3*m+2],r=0;3>r;r++){var s;if(void 0===d.edges[r]){switch(r){case 0:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p0,d.p1,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(f[3*c],f[3*c+1],o,p,q);break;case 1:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p1,d.p2,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(f[3*c+1],f[3*c+2],o,p,q);break;case 2:s=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(d.p2,d.p0,n.p0,n.p1,n.p2):this._processEdgeForAdjacencies(f[3*c+2],f[3*c],o,p,q)}if(-1!==s&&(d.edges[r]=m,n.edges[s]=c,d.edgesConnectedCount++,n.edgesConnectedCount++,3===d.edgesConnectedCount))break}}}}for(c=0;c<g.length;c++){var t=g[c];this._checkEdge(c,t.edges[0],h,t.p0,t.p1),this._checkEdge(c,t.edges[1],h,t.p1,t.p2),this._checkEdge(c,t.edges[2],h,t.p2,t.p0)}var u=this._source.getScene().getEngine();this._buffers[a.VertexBuffer.PositionKind]=new a.VertexBuffer(u,this._linesPositions,a.VertexBuffer.PositionKind,!1),this._buffers[a.VertexBuffer.NormalKind]=new a.VertexBuffer(u,this._linesNormals,a.VertexBuffer.NormalKind,!1,!1,4),this._ib=u.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length},c.prototype.render=function(){if(this._lineShader.isReady()){var b=this._source.getScene(),c=b.getEngine();this._lineShader._preBind(),c.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),b.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),b.activeCamera.mode===a.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",c.getAspectRatio(b.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),c.draw(!0,0,this._indicesCount),this._lineShader.unbind(),c.setDepthWrite(!0)}},c}();a.EdgesRenderer=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){!function(a){a[a.Hable=0]="Hable",a[a.Reinhard=1]="Reinhard",a[a.HejiDawson=2]="HejiDawson",a[a.Photographic=3]="Photographic"}(a.TonemappingOperator||(a.TonemappingOperator={}));var b=a.TonemappingOperator,c=function(c){function d(d,e,f,g,h,i,j){var k=this;void 0===h&&(h=a.Texture.BILINEAR_SAMPLINGMODE),void 0===j&&(j=a.Engine.TEXTURETYPE_UNSIGNED_INT),c.call(this,d,"tonemap",["_ExposureAdjustment"],null,1,g,h,i,!0,l,j),this._operator=e,this.exposureAdjustment=f;var l="#define ";this._operator===b.Hable?l+="HABLE_TONEMAPPING":this._operator===b.Reinhard?l+="REINHARD_TONEMAPPING":this._operator===b.HejiDawson?l+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":this._operator===b.Photographic&&(l+="PHOTOGRAPHIC_TONEMAPPING"),this.updateEffect(l),this.onApply=function(a){a.setFloat("_ExposureAdjustment",k.exposureAdjustment)}}return __extends(d,c),d}(a.PostProcess);a.TonemapPostProcess=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e){var f=this;void 0===e&&(e=!0),this.name=b,this._viewMatrix=a.Matrix.Identity(),this._target=a.Vector3.Zero(),this._add=a.Vector3.Zero(),this.invertYAxis=!1,this.position=a.Vector3.Zero(),this._scene=d,this._scene.reflectionProbes.push(this),this._renderTargetTexture=new a.RenderTargetTexture(b,c,d,e,!0,a.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(b){switch(b){case 0:f._add.copyFromFloats(1,0,0);break;case 1:f._add.copyFromFloats(-1,0,0);break;case 2:f._add.copyFromFloats(0,f.invertYAxis?1:-1,0);break;case 3:f._add.copyFromFloats(0,f.invertYAxis?-1:1,0);break;case 4:f._add.copyFromFloats(0,0,1);break;case 5:f._add.copyFromFloats(0,0,-1)}f._attachedMesh&&f.position.copyFrom(f._attachedMesh.getAbsolutePosition()),f.position.addToRef(f._add,f._target),a.Matrix.LookAtLHToRef(f.position,f._target,a.Vector3.Up(),f._viewMatrix),d.setTransformMatrix(f._viewMatrix,f._projectionMatrix)}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){d.updateTransformMatrix(!0)}),this._projectionMatrix=a.Matrix.PerspectiveFovLH(Math.PI/2,1,d.activeCamera.minZ,d.activeCamera.maxZ)}return Object.defineProperty(b.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(a){this._renderTargetTexture.refreshRate=a},enumerable:!0,configurable:!0}),b.prototype.getScene=function(){return this._scene},Object.defineProperty(b.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),b.prototype.attachToMesh=function(a){this._attachedMesh=a},b.prototype.dispose=function(){var a=this._scene.reflectionProbes.indexOf(this);-1!==a&&this._scene.reflectionProbes.splice(a,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},b}();a.ReflectionProbe=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d,e,f){this.color=new a.Color4(1,1,1,1),this.position=a.Vector3.Zero(),this.rotation=a.Vector3.Zero(),this.scaling=new a.Vector3(1,1,1),this.uvs=new a.Vector4(0,0,1,1),this.velocity=a.Vector3.Zero(),this.alive=!0,this.isVisible=!0,this.idx=b,this._pos=c,this._model=d,this.shapeId=e,this.idxInShape=f}return Object.defineProperty(b.prototype,"scale",{get:function(){return this.scaling},set:function(a){this.scaling=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(a){this.rotationQuaternion=a},enumerable:!0,configurable:!0}),b}();a.SolidParticle=b;var c=function(){function a(a,b,c,d,e){this.shapeID=a,this._shape=b,this._shapeUV=c,this._positionFunction=d,this._vertexFunction=e}return a}();a.ModelShape=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b,c,d){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.counter=0,this.vars={},this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._shapeCounter=0,this._copy=new a.SolidParticle(null,null,null,null,null),this._color=new a.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._cam_axisZ=a.Vector3.Zero(),this._cam_axisY=a.Vector3.Zero(),this._cam_axisX=a.Vector3.Zero(),this._axisX=a.Axis.X,this._axisY=a.Axis.Y,this._axisZ=a.Axis.Z,this._fakeCamPos=a.Vector3.Zero(),this._rotMatrix=new a.Matrix,this._invertMatrix=new a.Matrix,this._rotated=a.Vector3.Zero(),this._quaternion=new a.Quaternion,this._vertex=a.Vector3.Zero(),this._normal=a.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._w=0,this._minimum=a.Tmp.Vector3[0],this._maximum=a.Tmp.Vector3[1],this.name=b,this._scene=c,this._camera=c.activeCamera,this._pickable=d?d.isPickable:!1,d&&d.updatable?this._updatable=d.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[])}return b.prototype.buildMesh=function(){if(0===this.nbParticles){var b=a.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(b,1),b.dispose()}this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),a.VertexData.ComputeNormals(this._positions32,this._indices,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals);var c=new a.VertexData;c.set(this._positions32,a.VertexBuffer.PositionKind),c.indices=this._indices,c.set(this._normals32,a.VertexBuffer.NormalKind),this._uvs32&&c.set(this._uvs32,a.VertexBuffer.UVKind),this._colors32&&c.set(this._colors32,a.VertexBuffer.ColorKind);var d=new a.Mesh(this.name,this._scene);return c.applyToMesh(d,this._updatable),this.mesh=d,this.mesh.isPickable=this._pickable,this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),d},b.prototype.digest=function(b,c){var d=c&&c.facetNb||1,e=c&&c.number,f=c&&c.delta||0,g=b.getVerticesData(a.VertexBuffer.PositionKind),h=b.getIndices(),i=b.getVerticesData(a.VertexBuffer.UVKind),j=b.getVerticesData(a.VertexBuffer.ColorKind),k=0,l=h.length/3;e?(e=e>l?l:e,d=Math.round(l/e),f=0):d=d>l?l:d;for(var m=[],n=[],o=[],p=[],q=a.Tmp.Vector3[0],r=d;l>k;){d=r+Math.floor((1+f)*Math.random()),k>l-d&&(d=l-k),m.length=0,n.length=0,o.length=0,p.length=0;for(var s=0,t=3*k;3*(k+d)>t;t++){n.push(s);var u=h[t];m.push(g[3*u],g[3*u+1],g[3*u+2]),i&&o.push(i[2*u],i[2*u+1]),j&&p.push(j[4*u],j[4*u+1],j[4*u+2],j[4*u+3]),s++}var v,w=this.nbParticles,x=this._posToShape(m),y=this._uvsToShapeUV(o);for(v=0;v<x.length;v++)q.addInPlace(x[v]);for(q.scaleInPlace(1/x.length),v=0;v<x.length;v++)x[v].subtractInPlace(q);var z=new a.ModelShape(this._shapeCounter,x,y,null,null);this._meshBuilder(this._index,x,this._positions,n,this._indices,o,this._uvs,p,this._colors,w,0,null),this._addParticle(w,this._positions.length,z,this._shapeCounter,0),this.particles[this.nbParticles].position.addInPlace(q),this._index+=x.length,w++,this.nbParticles++,this._shapeCounter++,k+=d}return this},b.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null},b.prototype._meshBuilder=function(b,c,d,e,f,g,h,i,j,k,l,m){var n,o=0,p=0;for(this._resetCopy(),m&&m.positionFunction&&m.positionFunction(this._copy,k,l),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),n=0;n<c.length;n++)this._vertex.x=c[n].x,this._vertex.y=c[n].y,this._vertex.z=c[n].z,m&&m.vertexFunction&&m.vertexFunction(this._copy,this._vertex,n),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,a.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),d.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),g&&(h.push((this._copy.uvs.z-this._copy.uvs.x)*g[o]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*g[o+1]+this._copy.uvs.y),o+=2),this._copy.color?this._color=this._copy.color:i&&i[p]?(this._color.r=i[p],this._color.g=i[p+1],this._color.b=i[p+2],this._color.a=i[p+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),j.push(this._color.r,this._color.g,this._color.b,this._color.a),p+=4;for(n=0;n<e.length;n++)f.push(b+e[n]);if(this._pickable){var q=e.length/3;for(n=0;q>n;n++)this.pickedParticles.push({idx:k,faceId:n})}},b.prototype._posToShape=function(b){for(var c=[],d=0;d<b.length;d+=3)c.push(new a.Vector3(b[d],b[d+1],b[d+2]));return c},b.prototype._uvsToShapeUV=function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b.push(a[c]);return b},b.prototype._addParticle=function(b,c,d,e,f){this.particles.push(new a.SolidParticle(b,c,d,e,f))},b.prototype.addShape=function(b,c,d){for(var e=b.getVerticesData(a.VertexBuffer.PositionKind),f=b.getIndices(),g=b.getVerticesData(a.VertexBuffer.UVKind),h=b.getVerticesData(a.VertexBuffer.ColorKind),i=this._posToShape(e),j=this._uvsToShapeUV(g),k=d?d.positionFunction:null,l=d?d.vertexFunction:null,m=new a.ModelShape(this._shapeCounter,i,j,k,l),n=this.nbParticles,o=0;c>o;o++)this._meshBuilder(this._index,i,this._positions,f,this._indices,g,this._uvs,h,this._colors,n,o,d),this._updatable&&this._addParticle(n,this._positions.length,m,this._shapeCounter,o),this._index+=i.length,n++;return this.nbParticles+=c,this._shapeCounter++,this._shapeCounter-1},b.prototype._rebuildParticle=function(b){this._resetCopy(),b._model._positionFunction&&b._model._positionFunction(this._copy,b.idx,b.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._shape=b._model._shape;for(var c=0;c<this._shape.length;c++)this._vertex.x=this._shape[c].x,this._vertex.y=this._shape[c].y,this._vertex.z=this._shape[c].z,b._model._vertexFunction&&b._model._vertexFunction(this._copy,this._vertex,c),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,a.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[b._pos+3*c]=this._copy.position.x+this._rotated.x,this._positions32[b._pos+3*c+1]=this._copy.position.y+this._rotated.y,
this._positions32[b._pos+3*c+2]=this._copy.position.z+this._rotated.z;b.position.x=0,b.position.y=0,b.position.z=0,b.rotation.x=0,b.rotation.y=0,b.rotation.z=0,b.rotationQuaternion=null,b.scaling.x=1,b.scaling.y=1,b.scaling.z=1},b.prototype.rebuildMesh=function(){for(var b=0;b<this.particles.length;b++)this._rebuildParticle(this.particles[b]);this.mesh.updateVerticesData(a.VertexBuffer.PositionKind,this._positions32,!1,!1)},b.prototype.setParticles=function(b,c,d){if(void 0===b&&(b=0),void 0===c&&(c=this.nbParticles-1),void 0===d&&(d=!0),this._updatable){this.beforeUpdateParticles(b,c,d),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,this.billboard&&(this._yaw=this.mesh.rotation.y,this._pitch=this.mesh.rotation.x,this._roll=this.mesh.rotation.z,this._quaternionRotationYPR(),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix),a.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._fakeCamPos),this._fakeCamPos.subtractToRef(this.mesh.position,this._cam_axisZ),a.Vector3.CrossToRef(this._cam_axisZ,this._axisX,this._cam_axisY),a.Vector3.CrossToRef(this._cam_axisZ,this._cam_axisY,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize(),this._cam_axisZ.normalize()),a.Matrix.IdentityToRef(this._rotMatrix);var e=0,f=0,g=0,h=0,i=0,j=0,k=0;this._computeBoundingBox&&(a.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),a.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)),c=c>this.nbParticles-1?this.nbParticles-1:c;for(var l=b;c>=l;l++){if(this._particle=this.particles[l],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._particle.isVisible)for(this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),this._computeParticleRotation&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),k=0;k<this._shape.length;k++)e=f+3*k,g=h+4*k,i=j+2*k,this._vertex.x=this._shape[k].x,this._vertex.y=this._shape[k].y,this._vertex.z=this._shape[k].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,k),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._w=this._vertex.x*this._rotMatrix.m[3]+this._vertex.y*this._rotMatrix.m[7]+this._vertex.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._positions32[e]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[e+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[e+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[e]<this._minimum.x&&(this._minimum.x=this._positions32[e]),this._positions32[e]>this._maximum.x&&(this._maximum.x=this._positions32[e]),this._positions32[e+1]<this._minimum.y&&(this._minimum.y=this._positions32[e+1]),this._positions32[e+1]>this._maximum.y&&(this._maximum.y=this._positions32[e+1]),this._positions32[e+2]<this._minimum.z&&(this._minimum.z=this._positions32[e+2]),this._positions32[e+2]>this._maximum.z&&(this._maximum.z=this._positions32[e+2])),this._computeParticleVertex||this.billboard||(this._normal.x=this._fixedNormal32[e],this._normal.y=this._fixedNormal32[e+1],this._normal.z=this._fixedNormal32[e+2],this._w=this._normal.x*this._rotMatrix.m[3]+this._normal.y*this._rotMatrix.m[7]+this._normal.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._normals32[e]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[e+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[e+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&(this._colors32[g]=this._particle.color.r,this._colors32[g+1]=this._particle.color.g,this._colors32[g+2]=this._particle.color.b,this._colors32[g+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[i]=this._shapeUV[2*k]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[i+1]=this._shapeUV[2*k+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(k=0;k<this._shape.length;k++)e=f+3*k,g=h+4*k,i=j+2*k,this._positions32[e]=this._camera.position.x,this._positions32[e+1]=this._camera.position.y,this._positions32[e+2]=this._camera.position.z,this._normals32[e]=0,this._normals32[e+1]=0,this._normals32[e+2]=0,this._computeParticleColor&&(this._colors32[g]=this._particle.color.r,this._colors32[g+1]=this._particle.color.g,this._colors32[g+2]=this._particle.color.b,this._colors32[g+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[i]=this._shapeUV[2*k]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[i+1]=this._shapeUV[2*k+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);f=e+3,h=g+4,j=i+2}if(d&&(this._computeParticleColor&&this.mesh.updateVerticesData(a.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(a.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(a.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen)){if(this._computeParticleVertex||this.billboard){a.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32);for(var m=0;m<this._normals32.length;m++)this._fixedNormal32[m]=this._normals32[m]}this.mesh.updateVerticesData(a.VertexBuffer.NormalKind,this._normals32,!1,!1)}this._computeBoundingBox&&(this.mesh._boundingInfo=new a.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(b,c,d)}},b.prototype._quaternionRotationYPR=function(){this._halfroll=.5*this._roll,this._halfpitch=.5*this._pitch,this._halfyaw=.5*this._yaw,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},b.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[3]=0,this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[7]=0,this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[11]=0,this._rotMatrix.m[12]=0,this._rotMatrix.m[13]=0,this._rotMatrix.m[14]=0,this._rotMatrix.m[15]=1},b.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},b.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo()},b.prototype.setVisibilityBox=function(b){var c=b/2;this.mesh._boundingInfo=new a.BoundingInfo(new a.Vector3(-c,-c,-c),new a.Vector3(c,c,c))},Object.defineProperty(b.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(a){this._alwaysVisible=a,this.mesh.alwaysSelectAsActiveMesh=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(a){this._isVisibilityBoxLocked=a,this.mesh.getBoundingInfo().isLocked=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(a){this._computeParticleRotation=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(a){this._computeParticleColor=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(a){this._computeParticleTexture=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(a){this._computeParticleVertex=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(a){this._computeBoundingBox=a},enumerable:!0,configurable:!0}),b.prototype.initParticles=function(){},b.prototype.recycleParticle=function(a){return a},b.prototype.updateParticle=function(a){return a},b.prototype.updateParticleVertex=function(a,b,c){return b},b.prototype.beforeUpdateParticles=function(a,b,c){},b.prototype.afterUpdateParticles=function(a,b,c){},b}();a.SolidParticleSystem=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(){function a(a,b,c,d){this.name=a,this.worldAxisForNormal=b,this.worldAxisForFileX=c,this.worldAxisForFileY=d}return a}(),d=function(){function b(){}return b.ConvertCubeMapToSphericalPolynomial=function(b){for(var c=new a.SphericalHarmonics,d=0,e=2/b.size,f=e,g=.5*e-1,h=0;6>h;h++)for(var i=this.FileFaces[h],j=b[i.name],k=g,l=0;l<b.size;l++){for(var m=g,n=0;n<b.size;n++){var o=i.worldAxisForFileX.scale(m).add(i.worldAxisForFileY.scale(k)).add(i.worldAxisForNormal);o.normalize();var p,q=Math.pow(1+m*m+k*k,-1.5),r=j[l*b.size*3+3*n+0],s=j[l*b.size*3+3*n+1],t=j[l*b.size*3+3*n+2],p=new a.Color3(r,s,t);c.addLight(o,p,q),d+=q,m+=e}k+=f}var u=4*Math.PI,v=u/d;return c.scale(v),c.scale(1/Math.PI),a.SphericalPolynomial.getSphericalPolynomialFromHarmonics(c)},b.FileFaces=[new c("right",new a.Vector3(1,0,0),new a.Vector3(0,0,-1),new a.Vector3(0,-1,0)),new c("left",new a.Vector3(-1,0,0),new a.Vector3(0,0,1),new a.Vector3(0,-1,0)),new c("up",new a.Vector3(0,1,0),new a.Vector3(1,0,0),new a.Vector3(0,0,1)),new c("down",new a.Vector3(0,-1,0),new a.Vector3(1,0,0),new a.Vector3(0,0,-1)),new c("front",new a.Vector3(0,0,1),new a.Vector3(1,0,0),new a.Vector3(0,-1,0)),new c("back",new a.Vector3(0,0,-1),new a.Vector3(-1,0,0),new a.Vector3(0,-1,0))],b}();b.CubeMapToSphericalPolynomialTools=d}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(){function b(){}return b.ConvertPanoramaToCubemap=function(a,b,c,d){if(!a)throw"ConvertPanoramaToCubemap: input cannot be null";if(a.length!=b*c*3)throw"ConvertPanoramaToCubemap: input size is wrong";var e=this.CreateCubemapTexture(d,this.FACE_FRONT,a,b,c),f=this.CreateCubemapTexture(d,this.FACE_BACK,a,b,c),g=this.CreateCubemapTexture(d,this.FACE_LEFT,a,b,c),h=this.CreateCubemapTexture(d,this.FACE_RIGHT,a,b,c),i=this.CreateCubemapTexture(d,this.FACE_UP,a,b,c),j=this.CreateCubemapTexture(d,this.FACE_DOWN,a,b,c);return{front:e,back:f,left:g,right:h,up:i,down:j,size:d}},b.CreateCubemapTexture=function(a,b,c,d,e){for(var f=new ArrayBuffer(a*a*4*3),g=new Float32Array(f),h=b[1].subtract(b[0]).scale(1/a),i=b[3].subtract(b[2]).scale(1/a),j=1/a,k=0,l=0;a>l;l++){for(var m=b[0],n=b[2],o=0;a>o;o++){var p=n.subtract(m).scale(k).add(m);p.normalize();var q=this.CalcProjectionSpherical(p,c,d,e);g[l*a*3+3*o+0]=q.r,g[l*a*3+3*o+1]=q.g,g[l*a*3+3*o+2]=q.b,m=m.add(h),n=n.add(i)}k+=j}return g},b.CalcProjectionSpherical=function(a,b,c,d){for(var e=Math.atan2(a.z,a.x),f=Math.acos(a.y);e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;var g=e/Math.PI,h=f/Math.PI;g=.5*g+.5;var i=Math.round(g*c);0>i?i=0:i>=c&&(i=c-1);var j=Math.round(h*d);0>j?j=0:j>=d&&(j=d-1);var k=d-j-1,l=b[k*c*3+3*i+0],m=b[k*c*3+3*i+1],n=b[k*c*3+3*i+2];return{r:l,g:m,b:n}},b.FACE_FRONT=[new a.Vector3(-1,-1,-1),new a.Vector3(1,-1,-1),new a.Vector3(-1,1,-1),new a.Vector3(1,1,-1)],b.FACE_BACK=[new a.Vector3(1,-1,1),new a.Vector3(-1,-1,1),new a.Vector3(1,1,1),new a.Vector3(-1,1,1)],b.FACE_RIGHT=[new a.Vector3(1,-1,-1),new a.Vector3(1,-1,1),new a.Vector3(1,1,-1),new a.Vector3(1,1,1)],b.FACE_LEFT=[new a.Vector3(-1,-1,1),new a.Vector3(-1,-1,-1),new a.Vector3(-1,1,1),new a.Vector3(-1,1,-1)],b.FACE_DOWN=[new a.Vector3(-1,1,-1),new a.Vector3(1,1,-1),new a.Vector3(-1,1,1),new a.Vector3(1,1,1)],b.FACE_UP=[new a.Vector3(-1,-1,1),new a.Vector3(1,-1,1),new a.Vector3(-1,-1,-1),new a.Vector3(1,-1,-1)],b}();b.PanoramaToCubeMapTools=c}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(a){var b=function(){function b(){}return b.Ldexp=function(a,b){return b>1023?a*Math.pow(2,1023)*Math.pow(2,b-1023):-1074>b?a*Math.pow(2,-1074)*Math.pow(2,b+1074):a*Math.pow(2,b)},b.Rgbe2float=function(a,b,c,d,e,f){e>0?(e=this.Ldexp(1,e-136),a[f+0]=b*e,a[f+1]=c*e,a[f+2]=d*e):(a[f+0]=0,a[f+1]=0,a[f+2]=0)},b.readStringLine=function(a,b){for(var c="",d="",e=b;e<a.length-b&&(d=String.fromCharCode(a[e]),"\n"!=d);e++)c+=d;return c},b.RGBE_ReadHeader=function(a){var b=0,c=0,d=this.readStringLine(a,0);if("#"!=d[0]||"?"!=d[1])throw"Bad HDR Format.";var e=!1,f=!1,g=0;do g+=d.length+1,d=this.readStringLine(a,g),"FORMAT=32-bit_rle_rgbe"==d?f=!0:0==d.length&&(e=!0);while(!e);if(!f)throw"HDR Bad header format, unsupported FORMAT";g+=d.length+1,d=this.readStringLine(a,g);var h=/^\-Y (.*) \+X (.*)$/g,i=h.exec(d);if(i.length<3)throw"HDR Bad header format, no size";if(c=parseInt(i[2]),b=parseInt(i[1]),8>c||c>32767)throw"HDR Bad header format, unsupported size";return g+=d.length+1,{height:b,width:c,dataPosition:g}},b.GetCubeMapTextureData=function(b,c){var d=new Uint8Array(b),e=this.RGBE_ReadHeader(d),f=this.RGBE_ReadPixels_RLE(d,e),g=a.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(f,e.width,e.height,c);return g},b.RGBE_ReadPixels=function(a,b){return this.RGBE_ReadPixels_RLE(a,b)},b.RGBE_ReadPixels_RLE=function(a,b){for(var c,d,e,f,g,h=b.height,i=b.width,j=b.dataPosition,k=0,l=0,m=0,n=new ArrayBuffer(4*i),o=new Uint8Array(n),p=new ArrayBuffer(b.width*b.height*4*3),q=new Float32Array(p);h>0;){if(c=a[j++],d=a[j++],e=a[j++],f=a[j++],2!=c||2!=d||128&e)throw"HDR Bad header format, not RLE";if((e<<8|f)!=i)throw"HDR Bad header format, wrong scan line width";for(k=0,m=0;4>m;m++)for(l=(m+1)*i;l>k;)if(c=a[j++],d=a[j++],c>128){if(g=c-128,0==g||g>l-k)throw"HDR Bad Format, bad scanline data (run)";for(;g-->0;)o[k++]=d}else{if(g=c,0==g||g>l-k)throw"HDR Bad Format, bad scanline data (non-run)";if(o[k++]=d,--g>0)for(var r=0;g>r;r++)o[k++]=a[j++]}for(m=0;i>m;m++)c=o[m],d=o[m+i],e=o[m+2*i],f=o[m+3*i],this.Rgbe2float(q,c,d,e,f,(b.height-h)*i*3+3*m);h--}return q},b}();a.HDRTools=b}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(){function b(){this.min=new a.Vector3(0,0,0),this.max=new a.Vector3(0,0,0),this.clear()}return b.prototype.clear=function(){this.min.x=b.MAX,this.min.y=b.MAX,this.min.z=b.MAX,this.max.x=b.MIN,this.max.y=b.MIN,this.max.z=b.MIN},b.prototype.augment=function(a,b,c){this.min.x=Math.min(this.min.x,a),this.min.y=Math.min(this.min.y,b),this.min.z=Math.min(this.min.z,c),this.max.x=Math.max(this.max.x,a),this.max.y=Math.max(this.max.y,b),this.max.z=Math.max(this.max.z,c)},b.prototype.clampMin=function(a,b,c){this.min.x=Math.max(this.min.x,a),this.min.y=Math.max(this.min.y,b),this.min.z=Math.max(this.min.z,c)},b.prototype.clampMax=function(a,b,c){this.max.x=Math.min(this.max.x,a),this.max.y=Math.min(this.max.y,b),this.max.z=Math.min(this.max.z,c)},b.prototype.empty=function(){return this.min.x>this.max.y||this.min.y>this.max.y||this.min.z>this.max.y},b.MAX=Number.MAX_VALUE,b.MIN=Number.MIN_VALUE,b}(),d=function(){function b(a,b,c,d,e,f,g,h,i,j){this.input=a,this.inputSize=b,this.outputSize=c,this.maxNumMipLevels=d,this.numChannels=e,this.isFloat=f,this.specularPower=g,this.cosinePowerDropPerMip=h,this.excludeBase=i,this.fixup=j,this._outputSurface=[],this._numMipLevels=0}return b.prototype.filterCubeMap=function(){return this.init(),this.filterCubeMapMipChain(),this._outputSurface},b.prototype.init=function(){var a,c,d;for(0==this.maxNumMipLevels&&(this.maxNumMipLevels=b.CP_MAX_MIPLEVELS),d=this.outputSize,c=0;c<this.maxNumMipLevels;c++){for(this._outputSurface.length++,this._outputSurface[c]=[],a=0;6>a;a++)this._outputSurface[c].length++,this.isFloat?this._outputSurface[c][a]=new Float32Array(d*d*this.numChannels):this._outputSurface[c][a]=new Uint32Array(d*d*this.numChannels);if(d>>=1,this._numMipLevels++,0==d)return void(this.maxNumMipLevels=c)}},b.prototype.filterCubeMapMipChain=function(){var a=this.specularPower;this.precomputeFilterLookupTables(this.inputSize);for(var b=0;b<this._numMipLevels;b++){this.excludeBase&&0==b&&(a=1e5);var c=this.input,d=this._outputSurface[b],e=this.outputSize>>b,f=this.getBaseFilterAngle(a);this.filterCubeSurfaces(c,this.inputSize,d,e,f,a),this.fixup&&this.fixupCubeEdges(d,e),this.excludeBase&&0==b&&(a=this.specularPower),a*=this.cosinePowerDropPerMip}},b.prototype.getBaseFilterAngle=function(a){var b=1e-6,c=180;return c=Math.acos(Math.pow(b,1/a)),c*=180/Math.PI,c*=2},b.prototype.precomputeFilterLookupTables=function(a){this._normCubeMap=[],this.buildNormalizerSolidAngleCubemap(a)},b.prototype.buildNormalizerSolidAngleCubemap=function(a){var b,c,d;for(b=0;6>b;b++)for(this._normCubeMap.push(new Float32Array(a*a*4)),this.input[b],d=0;a>d;d++)for(c=0;a>c;c++){var e=this.texelCoordToVect(b,c,d,a,this.fixup);this._normCubeMap[b][4*(d*a+c)+0]=e.x,this._normCubeMap[b][4*(d*a+c)+1]=e.y,this._normCubeMap[b][4*(d*a+c)+2]=e.z;var f=this.texelCoordSolidAngle(b,c,d,a);this._normCubeMap[b][4*(d*a+c)+4]=f}},b.prototype.texelCoordToVect=function(a,c,d,e,f){var g,h;if(g=2*(c+.5)/e-1,h=2*(d+.5)/e-1,f&&e>1){var i=Math.pow(e,2)/Math.pow(e-1,3);g=i*Math.pow(g,3)+g,h=i*Math.pow(h,3)+h}var j=b._sgFace2DMapping[a][b.CP_UDIR];b._vectorTemp.x=j[0]*g,b._vectorTemp.y=j[1]*g,b._vectorTemp.z=j[2]*g;var k=b._sgFace2DMapping[a][b.CP_VDIR];b._vectorTemp.x+=k[0]*h,b._vectorTemp.y+=k[1]*h,b._vectorTemp.z+=k[2]*h;var l=b._sgFace2DMapping[a][b.CP_FACEAXIS];return b._vectorTemp.x+=l[0],b._vectorTemp.y+=l[1],b._vectorTemp.z+=l[2],b._vectorTemp.normalize(),b._vectorTemp},b.prototype.vectToTexelCoord=function(a,c,d,e){var f,g,h=Math.abs(a),i=Math.abs(c),j=Math.abs(d);h>=i&&h>=j?(f=h,g=a>=0?b.CP_FACE_X_POS:b.CP_FACE_X_NEG):i>=h&&i>=j?(f=i,g=c>=0?b.CP_FACE_Y_POS:b.CP_FACE_Y_NEG):(f=j,g=d>=0?b.CP_FACE_Z_POS:b.CP_FACE_Z_NEG);var k=1/f;a*=k,c*=k,d*=k;var l=b._sgFace2DMapping[g][b.CP_UDIR],m=l[0]*a+l[1]*c+l[2]*d;l=b._sgFace2DMapping[g][b.CP_VDIR];var n=l[0]*a+l[1]*c+l[2]*d,o=Math.floor(.5*(e-1)*(m+1)),p=Math.floor(.5*(e-1)*(n+1));return b._vectorTemp.x=g,b._vectorTemp.y=o,b._vectorTemp.z=p,b._vectorTemp},b.prototype.areaElement=function(a,b){return Math.atan2(a*b,Math.sqrt(a*a+b*b+1))},b.prototype.texelCoordSolidAngle=function(a,b,c,d){b=2*(b+.5)/d-1,c=2*(c+.5)/d-1;var e=1/d,f=b-e,g=c-e,h=b+e,i=c+e,j=this.areaElement(f,g)-this.areaElement(f,i)-this.areaElement(h,g)+this.areaElement(h,i);return j},b.prototype.filterCubeSurfaces=function(a,b,d,e,f,g){var h,i,j,k=[];for(h=0;6>h;h++)k.push(new c);var l=180/Math.PI*Math.atan2(1,b),m=f/2;l>m&&(m=l),m>90&&(m=90);var n=Math.ceil(m/l);1>n&&(n=1);var o=Math.cos(Math.PI/180*m);for(h=0;6>h;h++)for(j=0;e>j;j++)for(i=0;e>i;i++){var p=this.texelCoordToVect(h,i,j,e,this.fixup).clone();this.clearFilterExtents(k),this.determineFilterExtents(p,b,n,k);var q=this.processFilterExtents(p,o,k,a,b,g);d[h][(j*e+i)*this.numChannels+0]=q.x,d[h][(j*e+i)*this.numChannels+1]=q.y,d[h][(j*e+i)*this.numChannels+2]=q.z}},b.prototype.clearFilterExtents=function(a){for(var b=0;6>b;b++)a[b].clear()},b.prototype.determineFilterExtents=function(a,c,d,e){var f,g,h,i=[0,0,0,0],j=[0,0,0,0],k=[0,0,0,0],l=this.vectToTexelCoord(a.x,a.y,a.z,c),m=l.x,n=l.y,o=l.z;e[m].augment(n-d,o-d,0),e[m].augment(n+d,o+d,0),e[m].clampMin(0,0,0),e[m].clampMax(c-1,c-1,0);var p=e[m].min.x,q=e[m].min.y,r=e[m].max.x,s=e[m].max.y;i[0]=d-n,j[0]=q,k[0]=s,i[1]=n+d-(c-1),j[1]=q,k[1]=s,i[2]=d-o,j[2]=p,k[2]=r,i[3]=o+d-(c-1),j[3]=p,k[3]=r;for(var t=0;4>t;t++){if(i[t]>0){switch(f=b._sgCubeNgh[m][t][0],g=b._sgCubeNgh[m][t][1],t!=g&&t+g!=3||(j[t]=c-1-j[t],k[t]=c-1-k[t]),b._sgCubeNgh[m][t][1]){case b.CP_EDGE_LEFT:e[f].augment(0,j[t],0),e[f].augment(i[t],k[t],0);break;case b.CP_EDGE_RIGHT:e[f].augment(c-1,j[t],0),e[f].augment(c-1-i[t],k[t],0);break;case b.CP_EDGE_TOP:e[f].augment(j[t],0,0),e[f].augment(k[t],i[t],0);break;case b.CP_EDGE_BOTTOM:e[f].augment(j[t],c-1,0),e[f].augment(k[t],c-1-i[t],0)}e[f].clampMin(0,0,0),e[f].clampMax(c-1,c-1,0)}if(i[t]>c){switch(m){case b.CP_FACE_X_POS:h=b.CP_FACE_X_NEG;break;case b.CP_FACE_X_NEG:h=b.CP_FACE_X_POS;break;case b.CP_FACE_Y_POS:h=b.CP_FACE_Y_NEG;break;case b.CP_FACE_Y_NEG:h=b.CP_FACE_Y_POS;break;case b.CP_FACE_Z_POS:h=b.CP_FACE_Z_NEG;break;case b.CP_FACE_Z_NEG:h=b.CP_FACE_Z_POS}e[h].augment(0,0,0),e[h].augment(c-1,c-1,0)}}},b.prototype.processFilterExtents=function(a,c,d,e,f,g){for(var h=[0,0,0,0],i=0,j=0,k=this.numChannels,l=f,m=4*l,n=l*this.numChannels,o=1,p=0;6>p;p++)if(!d[p].empty())for(var q=d[p].min.x,r=d[p].min.y,s=d[p].max.x,t=d[p].max.y,u=4*(r*l+q),v=this.numChannels*(r*l+q),w=r;t>=w;w++){for(var x=0,y=0,z=q;s>=z;z++){var A=this._normCubeMap[p][u+x+0],B=this._normCubeMap[p][u+x+1],C=this._normCubeMap[p][u+x+2],D=A*a.x+B*a.y+C*a.z;if(D>=c&&D>0){var E=this._normCubeMap[p][u+x+3];for(E*=Math.pow(D,g+o),j=0;k>j;j++)h[j]+=E*e[p][v+y],y++;i+=E}else y+=k;x+=4}u+=m,v+=n}if(0!=i)b._vectorTemp.x=h[0]/i,b._vectorTemp.y=h[1]/i,b._vectorTemp.z=h[2]/i,this.numChannels>3&&(b._vectorTemp.w=h[3]/i);else{var F=this.vectToTexelCoord(a.x,a.y,a.z,f).clone();b._vectorTemp.x=e[F.x][this.numChannels*(F.z*f+F.y)+0],b._vectorTemp.y=e[F.x][this.numChannels*(F.z*f+F.y)+1],b._vectorTemp.z=e[F.x][this.numChannels*(F.z*f+F.y)+2],this.numChannels>3&&(b._vectorTemp.z=e[F.x][this.numChannels*(F.z*f+F.y)+3])}return b._vectorTemp},b.prototype.fixupCubeEdges=function(a,c){var d,e,f,g,h=0,i=[0,0,0,0,0,0,0,0],j=[[],[],[],[]],k=[[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]]];if(!(1>c))if(1!=c){for(g=0;6>g;g++)for(j[0]=[g,0],j[1]=[g,(c-1)*this.numChannels],j[2]=[g,c*(c-1)*this.numChannels],j[3]=[g,(c*(c-1)+(c-1))*this.numChannels],h=0;4>h;h++){var l=b._sgCubeCornerList[g][h];k[l][i[l]]=j[h],i[l]++}for(h=0;8>h;h++)for(d=0;d<this.numChannels;d++){var m=0;for(f=0;3>f;f++)m+=a[k[h][f][0]][k[h][f][1]+d];for(m*=1/3,f=0;3>f;f++)a[k[h][f][0]][k[h][f][1]+d]=m}for(f=0;12>f;f++){var n=b._sgCubeEdgeList[f][0],o=b._sgCubeEdgeList[f][1],p=b._sgCubeNgh[n][o][0],q=b._sgCubeNgh[n][o][1],r=0,s=0,t=0,u=0;switch(o){case b.CP_EDGE_LEFT:t=this.numChannels*c;break;case b.CP_EDGE_RIGHT:r+=(c-1)*this.numChannels,t=this.numChannels*c;break;case b.CP_EDGE_TOP:t=this.numChannels;break;case b.CP_EDGE_BOTTOM:r+=c*(c-1)*this.numChannels,t=this.numChannels}if(o==q||o+q==3)switch(q){case b.CP_EDGE_LEFT:s+=(c-1)*c*this.numChannels,u=-(this.numChannels*c);break;case b.CP_EDGE_RIGHT:s+=((c-1)*c+(c-1))*this.numChannels,u=-(this.numChannels*c);break;case b.CP_EDGE_TOP:s+=(c-1)*this.numChannels,u=-this.numChannels;break;case b.CP_EDGE_BOTTOM:s+=((c-1)*c+(c-1))*this.numChannels,u=-this.numChannels}else switch(q){case b.CP_EDGE_LEFT:u=this.numChannels*c;break;case b.CP_EDGE_RIGHT:s+=(c-1)*this.numChannels,u=this.numChannels*c;break;case b.CP_EDGE_TOP:u=this.numChannels;break;case b.CP_EDGE_BOTTOM:s+=c*(c-1)*this.numChannels,u=this.numChannels}for(r+=t,s+=u,e=1;c-1>e;e++){for(d=0;d<this.numChannels;d++){var v=a[n][r+d],w=a[p][s+d],x=.5*(v+w);a[n][r+d]=x,a[p][s+d]=x}r+=t,s+=u}}}else for(d=0;d<this.numChannels;d++){var y=0;for(g=0;6>g;g++)y+=a[g][d];for(y/=6,g=0;6>g;g++)a[g][d]=y}},b.CP_MAX_MIPLEVELS=16,b.CP_UDIR=0,b.CP_VDIR=1,b.CP_FACEAXIS=2,b.CP_FACE_X_POS=0,b.CP_FACE_X_NEG=1,b.CP_FACE_Y_POS=2,b.CP_FACE_Y_NEG=3,b.CP_FACE_Z_POS=4,b.CP_FACE_Z_NEG=5,b.CP_EDGE_LEFT=0,b.CP_EDGE_RIGHT=1,b.CP_EDGE_TOP=2,b.CP_EDGE_BOTTOM=3,b.CP_CORNER_NNN=0,b.CP_CORNER_NNP=1,b.CP_CORNER_NPN=2,b.CP_CORNER_NPP=3,b.CP_CORNER_PNN=4,b.CP_CORNER_PNP=5,b.CP_CORNER_PPN=6,b.CP_CORNER_PPP=7,b._vectorTemp=new a.Vector4(0,0,0,0),b._sgFace2DMapping=[[[0,0,-1],[0,-1,0],[1,0,0]],[[0,0,1],[0,-1,0],[-1,0,0]],[[1,0,0],[0,0,1],[0,1,0]],[[1,0,0],[0,0,-1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,-1,0],[0,0,-1]]],b._sgCubeNgh=[[[b.CP_FACE_Z_POS,b.CP_EDGE_RIGHT],[b.CP_FACE_Z_NEG,b.CP_EDGE_LEFT],[b.CP_FACE_Y_POS,b.CP_EDGE_RIGHT],[b.CP_FACE_Y_NEG,b.CP_EDGE_RIGHT]],[[b.CP_FACE_Z_NEG,b.CP_EDGE_RIGHT],[b.CP_FACE_Z_POS,b.CP_EDGE_LEFT],[b.CP_FACE_Y_POS,b.CP_EDGE_LEFT],[b.CP_FACE_Y_NEG,b.CP_EDGE_LEFT]],[[b.CP_FACE_X_NEG,b.CP_EDGE_TOP],[b.CP_FACE_X_POS,b.CP_EDGE_TOP],[b.CP_FACE_Z_NEG,b.CP_EDGE_TOP],[b.CP_FACE_Z_POS,b.CP_EDGE_TOP]],[[b.CP_FACE_X_NEG,b.CP_EDGE_BOTTOM],[b.CP_FACE_X_POS,b.CP_EDGE_BOTTOM],[b.CP_FACE_Z_POS,b.CP_EDGE_BOTTOM],[b.CP_FACE_Z_NEG,b.CP_EDGE_BOTTOM]],[[b.CP_FACE_X_NEG,b.CP_EDGE_RIGHT],[b.CP_FACE_X_POS,b.CP_EDGE_LEFT],[b.CP_FACE_Y_POS,b.CP_EDGE_BOTTOM],[b.CP_FACE_Y_NEG,b.CP_EDGE_TOP]],[[b.CP_FACE_X_POS,b.CP_EDGE_RIGHT],[b.CP_FACE_X_NEG,b.CP_EDGE_LEFT],[b.CP_FACE_Y_POS,b.CP_EDGE_TOP],[b.CP_FACE_Y_NEG,b.CP_EDGE_BOTTOM]]],b._sgCubeEdgeList=[[b.CP_FACE_X_POS,b.CP_EDGE_LEFT],[b.CP_FACE_X_POS,b.CP_EDGE_RIGHT],[b.CP_FACE_X_POS,b.CP_EDGE_TOP],[b.CP_FACE_X_POS,b.CP_EDGE_BOTTOM],[b.CP_FACE_X_NEG,b.CP_EDGE_LEFT],[b.CP_FACE_X_NEG,b.CP_EDGE_RIGHT],[b.CP_FACE_X_NEG,b.CP_EDGE_TOP],[b.CP_FACE_X_NEG,b.CP_EDGE_BOTTOM],[b.CP_FACE_Z_POS,b.CP_EDGE_TOP],[b.CP_FACE_Z_POS,b.CP_EDGE_BOTTOM],[b.CP_FACE_Z_NEG,b.CP_EDGE_TOP],[b.CP_FACE_Z_NEG,b.CP_EDGE_BOTTOM]],b._sgCubeCornerList=[[b.CP_CORNER_PPP,b.CP_CORNER_PPN,b.CP_CORNER_PNP,b.CP_CORNER_PNN],[b.CP_CORNER_NPN,b.CP_CORNER_NPP,b.CP_CORNER_NNN,b.CP_CORNER_NNP],[b.CP_CORNER_NPN,b.CP_CORNER_PPN,b.CP_CORNER_NPP,b.CP_CORNER_PPP],[b.CP_CORNER_NNP,b.CP_CORNER_PNP,b.CP_CORNER_NNN,b.CP_CORNER_PNN],[b.CP_CORNER_NPP,b.CP_CORNER_PPP,b.CP_CORNER_NNP,b.CP_CORNER_PNP],[b.CP_CORNER_PPN,b.CP_CORNER_NPN,b.CP_CORNER_PNN,b.CP_CORNER_NNN]],b}();b.PMREMGenerator=d}(b=a.Internals||(a.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d,e,f,g,h,i){void 0===f&&(f=!1),void 0===g&&(g=!0),void 0===h&&(h=!1),void 0===i&&(i=!1),b.call(this,d),this._useInGammaSpace=!1,this._generateHarmonics=!0,this._isBABYLONPreprocessed=!1,this.coordinatesMode=a.Texture.CUBIC_MODE,this.sphericalPolynomial=null,this.isPMREM=!1,c&&(this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=a.Matrix.Identity(),e?(this._isBABYLONPreprocessed=!1,this._noMipmap=f,this._size=e,this._useInGammaSpace=h,this._usePMREMGenerator=i&&d.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace):(this._isBABYLONPreprocessed=!0,this._noMipmap=!1,this._useInGammaSpace=!1,this._usePMREMGenerator=d.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace),this.isPMREM=this._usePMREMGenerator,this._texture=this._getFromCache(c,this._noMipmap),this._texture||(d.useDelayedTextureLoading?this.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))}return __extends(c,b),c.prototype.loadBabylonTexture=function(){var b=this,c=0,d=null,e=!this._useInGammaSpace&&this.getScene().getEngine().getCaps().textureFloat?function(a){for(var e=[],f=30,g=0;c>g;g++){e.push([]);for(var h=3*Math.pow(b._size>>g,2),i=0;6>i;i++){var j=d.subarray(f,f+h);e[g].push(j),f+=h}}return e}:null,f=function(f){var g=new Int32Array(f);d=new Float32Array(f),g[0],b._size=g[1],b.getScene().getEngine().updateTextureSize(b._texture,b._size,b._size),b.sphericalPolynomial=new a.SphericalPolynomial,b.sphericalPolynomial.x.copyFromFloats(d[2],d[3],d[4]),b.sphericalPolynomial.y.copyFromFloats(d[5],d[6],d[7]),b.sphericalPolynomial.z.copyFromFloats(d[8],d[9],d[10]),b.sphericalPolynomial.xx.copyFromFloats(d[11],d[12],d[13]),b.sphericalPolynomial.yy.copyFromFloats(d[14],d[15],d[16]),b.sphericalPolynomial.zz.copyFromFloats(d[17],d[18],d[19]),b.sphericalPolynomial.xy.copyFromFloats(d[20],d[21],d[22]),b.sphericalPolynomial.yz.copyFromFloats(d[23],d[24],d[25]),b.sphericalPolynomial.zx.copyFromFloats(d[26],d[27],d[28]),c=g[29];for(var h=30,i=[],j=3*Math.pow(b._size,2),k=0;6>k;k++)i.push(d.subarray(h,h+j)),h+=j;for(var l=[],m=null,n=0;6>n;n++){var o=null;if(e)o=i[n];else{var p=[0,2,4,1,3,5][n];if(o=i[p],!b.getScene().getEngine().getCaps().textureFloat){var q=new ArrayBuffer(j);m=new Uint8Array(q)}for(var r=0;r<b._size*b._size;r++)if(b._useInGammaSpace&&(o[3*r+0]=Math.pow(o[3*r+0],a.ToGammaSpace),o[3*r+1]=Math.pow(o[3*r+1],a.ToGammaSpace),o[3*r+2]=Math.pow(o[3*r+2],a.ToGammaSpace)),m){var s=Math.max(255*o[3*r+0],0),t=Math.max(255*o[3*r+1],0),u=Math.max(255*o[3*r+2],0),v=Math.max(Math.max(s,t),u);if(v>255){var w=255/v;s*=w,t*=w,u*=w}m[3*r+0]=s,m[3*r+1]=t,m[3*r+2]=u}}m?l.push(m):l.push(o)}return l};this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,a.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?a.Engine.TEXTURETYPE_FLOAT:a.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,f,e)},c.prototype.loadHDRTexture=function(){var b=this,d=function(d){var e=a.Internals.HDRTools.GetCubeMapTextureData(d,b._size);b._generateHarmonics&&(b.sphericalPolynomial=a.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(e));for(var f=[],g=null,h=0;6>h;h++){if(!b.getScene().getEngine().getCaps().textureFloat){var i=new ArrayBuffer(b._size*b._size*3);g=new Uint8Array(i)}var j=e[c._facesMapping[h]];
if(b._useInGammaSpace||g)for(var k=0;k<b._size*b._size;k++)if(b._useInGammaSpace&&(j[3*k+0]=Math.pow(j[3*k+0],a.ToGammaSpace),j[3*k+1]=Math.pow(j[3*k+1],a.ToGammaSpace),j[3*k+2]=Math.pow(j[3*k+2],a.ToGammaSpace)),g){var l=Math.max(255*j[3*k+0],0),m=Math.max(255*j[3*k+1],0),n=Math.max(255*j[3*k+2],0),o=Math.max(Math.max(l,m),n);if(o>255){var p=255/o;l*=p,m*=p,n*=p}g[3*k+0]=l,g[3*k+1]=m,g[3*k+2]=n}g?f.push(g):f.push(j)}return f},e=null;!this._noMipmap&&this._usePMREMGenerator&&(e=function(c){var d=new a.Internals.PMREMGenerator(c,b._size,b._size,0,3,b.getScene().getEngine().getCaps().textureFloat,2048,.25,!1,!0);return d.filterCubeMap()}),this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,a.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?a.Engine.TEXTURETYPE_FLOAT:a.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,d,e)},c.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},c.prototype.clone=function(){var a=this._isBABYLONPreprocessed?null:this._size,b=new c(this.url,this.getScene(),a,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);return b.level=this.level,b.wrapU=this.wrapU,b.wrapV=this.wrapV,b.coordinatesIndex=this.coordinatesIndex,b.coordinatesMode=this.coordinatesMode,b},c.prototype.delayLoad=function(){this.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},c.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},c.Parse=function(b,c,d){var e=null;if(b.name&&!b.isRenderTarget){var f=b.isBABYLONPreprocessed?null:b.size;e=new a.HDRCubeTexture(d+b.name,c,f,e.generateHarmonics,e.useInGammaSpace,e.usePMREMGenerator),e.name=b.name,e.hasAlpha=b.hasAlpha,e.level=b.level,e.coordinatesMode=b.coordinatesMode}return e},c.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.hasAlpha=this.hasAlpha,a.isCube=!0,a.level=this.level,a.size=this._size,a.coordinatesMode=this.coordinatesMode,a.useInGammaSpace=this._useInGammaSpace,a.generateHarmonics=this._generateHarmonics,a.usePMREMGenerator=this._usePMREMGenerator,a.isBABYLONPreprocessed=this._isBABYLONPreprocessed,a},c.generateBabylonHDROnDisk=function(a,b,d){void 0===d&&(d=null);var e=function(a){var b=new Blob([a],{type:"application/octet-stream"}),c=window.URL.createObjectURL(b),d=document.createElement("a");document.body.appendChild(d),d.style.display="none",d.href=c,d.download="envmap.babylon.hdr",d.click()};c.generateBabylonHDR(a,b,e,d)},c.generateBabylonHDR=function(b,c,d,e){if(void 0===e&&(e=null),!b)return null;if(!a.Tools.IsExponentOfTwo(c))return null;var f=function(b){var e=a.Internals.HDRTools.GetCubeMapTextureData(b,c),f=a.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(e),g=[];g.push(e.right),g.push(e.left),g.push(e.up),g.push(e.down),g.push(e.front),g.push(e.back);var h=new a.Internals.PMREMGenerator(g,c,c,0,3,!0,2048,.25,!1,!0),i=h.filterCubeMap(),j=4;j+=4,j+=108,j+=4;for(var k=0;k<i.length;k++){var l=c>>k;j+=6*l*l*3*4}var m=new ArrayBuffer(j),n=new Int32Array(m),o=new Float32Array(m);n[0]=1,n[1]=c,f.x.toArray(o,2),f.y.toArray(o,5),f.z.toArray(o,8),f.xx.toArray(o,11),f.yy.toArray(o,14),f.zz.toArray(o,17),f.xy.toArray(o,20),f.yz.toArray(o,23),f.zx.toArray(o,26),n[29]=i.length;for(var p=30,k=0;k<i.length;k++)for(var q=3*Math.pow(c>>k,2),r=0;6>r;r++)o.set(i[k][r],p),p+=q;d(m)};a.Tools.LoadFile(b,function(a){f(a)},null,null,!0,e)},c._facesMapping=["right","up","front","left","down","back"],c}(a.BaseTexture);a.HDRCubeTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b;!function(b){var c=function(){function b(b,c,d,e,f){void 0===e&&(e=!0),void 0===f&&(f=1),this.skeleton=b,this.mesh=c,this.autoUpdateBonesMatrices=e,this.renderingGroupId=f,this.color=a.Color3.White(),this._debugLines=[],this._isEnabled=!1,this._scene=d,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(a){this._isEnabled!==a&&(this._isEnabled=a,a?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),b.prototype._getBonePosition=function(b,c,d,e,f,g){void 0===e&&(e=0),void 0===f&&(f=0),void 0===g&&(g=0);var h=a.Tmp.Matrix[0],i=c.getParent();if(h.copyFrom(c.getLocalMatrix()),0!==e||0!==f||0!==g){var j=a.Tmp.Matrix[1];a.Matrix.IdentityToRef(j),j.m[12]=e,j.m[13]=f,j.m[14]=g,j.multiplyToRef(h,h)}i&&h.multiplyToRef(i.getAbsoluteTransform(),h),h.multiplyToRef(d,h),b.x=h.m[12],b.y=h.m[13],b.z=h.m[14]},b.prototype._getLinesForBonesWithLength=function(b,c){for(var d=b.length,e=0;d>e;e++){var f=b[e],g=this._debugLines[e];g||(g=[a.Vector3.Zero(),a.Vector3.Zero()],this._debugLines[e]=g),this._getBonePosition(g[0],f,c),this._getBonePosition(g[1],f,c,0,f.length,0)}},b.prototype._getLinesForBonesNoLength=function(b,c){for(var d=b.length,e=0,f=d-1;f>=0;f--){var g=b[f],h=g.getParent();if(h){var i=this._debugLines[e];i||(i=[a.Vector3.Zero(),a.Vector3.Zero()],this._debugLines[e]=i),this._getBonePosition(i[0],g,c),this._getBonePosition(i[1],h,c),e++}}},b.prototype.update=function(){this.autoUpdateBonesMatrices&&this._updateBoneMatrix(this.skeleton.bones[0]),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?a.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=a.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.color=this.color},b.prototype._updateBoneMatrix=function(a){a.getParent()&&a.getLocalMatrix().multiplyToRef(a.getParent().getAbsoluteTransform(),a.getAbsoluteTransform());for(var b=a.children,c=b.length,d=0;c>d;d++)this._updateBoneMatrix(b[d])},b.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},b}();b.SkeletonViewer=c}(b=a.Debug||(a.Debug={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(){this._dirty=!0,this._tempColor=new a.Color4(0,0,0,0),this._globalCurve=new a.Color4(0,0,0,0),this._highlightsCurve=new a.Color4(0,0,0,0),this._midtonesCurve=new a.Color4(0,0,0,0),this._shadowsCurve=new a.Color4(0,0,0,0),this._positiveCurve=new a.Color4(0,0,0,0),this._negativeCurve=new a.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(b.prototype,"GlobalHue",{get:function(){return this._globalHue},set:function(a){this._globalHue=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"GlobalDensity",{get:function(){return this._globalDensity},set:function(a){this._globalDensity=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"GlobalSaturation",{get:function(){return this._globalSaturation},set:function(a){this._globalSaturation=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HighlightsHue",{get:function(){return this._highlightsHue},set:function(a){this._highlightsHue=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HighlightsDensity",{get:function(){return this._highlightsDensity},set:function(a){this._highlightsDensity=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HighlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(a){this._highlightsSaturation=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HighlightsExposure",{get:function(){return this._highlightsExposure},set:function(a){this._highlightsExposure=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MidtonesHue",{get:function(){return this._midtonesHue},set:function(a){this._midtonesHue=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MidtonesDensity",{get:function(){return this._midtonesDensity},set:function(a){this._midtonesDensity=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MidtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(a){this._midtonesSaturation=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MidtonesExposure",{get:function(){return this._midtonesExposure},set:function(a){this._midtonesExposure=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ShadowsHue",{get:function(){return this._shadowsHue},set:function(a){this._shadowsHue=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ShadowsDensity",{get:function(){return this._shadowsDensity},set:function(a){this._shadowsDensity=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ShadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(a){this._shadowsSaturation=a,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ShadowsExposure",{get:function(){return this._shadowsExposure},set:function(a){this._shadowsExposure=a,this._dirty=!0},enumerable:!0,configurable:!0}),b.Bind=function(a,b){a._dirty&&(a._dirty=!1,a.getColorGradingDataToRef(a._globalHue,a._globalDensity,a._globalSaturation,a._globalExposure,a._globalCurve),a.getColorGradingDataToRef(a._highlightsHue,a._highlightsDensity,a._highlightsSaturation,a._highlightsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._highlightsCurve),a.getColorGradingDataToRef(a._midtonesHue,a._midtonesDensity,a._midtonesSaturation,a._midtonesExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._midtonesCurve),a.getColorGradingDataToRef(a._shadowsHue,a._shadowsDensity,a._shadowsSaturation,a._shadowsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._shadowsCurve),a._highlightsCurve.subtractToRef(a._midtonesCurve,a._positiveCurve),a._midtonesCurve.subtractToRef(a._shadowsCurve,a._negativeCurve)),b.setFloat4("vCameraColorCurvePositive",a._positiveCurve.r,a._positiveCurve.g,a._positiveCurve.b,a._positiveCurve.a),b.setFloat4("vCameraColorCurveNeutral",a._midtonesCurve.r,a._midtonesCurve.g,a._midtonesCurve.b,a._midtonesCurve.a),b.setFloat4("vCameraColorCurveNegative",a._negativeCurve.r,a._negativeCurve.g,a._negativeCurve.b,a._negativeCurve.a)},b.PrepareUniforms=function(a){a.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},b.prototype.getColorGradingDataToRef=function(a,c,d,e,f){null!=a&&(a=b.clamp(a,0,360),c=b.clamp(c,-100,100),d=b.clamp(d,-100,100),e=b.clamp(e,-100,100),c=b.applyColorGradingSliderNonlinear(c),c*=.5,e=b.applyColorGradingSliderNonlinear(e),0>c&&(c*=-1,a=(a+180)%360),b.fromHSBToRef(a,c,50+.25*e,f),f.scaleToRef(2,f),f.a=1+.01*d)},b.applyColorGradingSliderNonlinear=function(a){a/=100;var b=Math.abs(a);return b=Math.pow(b,2),0>a&&(b*=-1),b*=100},b.fromHSBToRef=function(a,c,d,e){var f=b.clamp(a,0,360),g=b.clamp(c/100,0,1),h=b.clamp(d/100,0,1);if(0===g)e.r=h,e.g=h,e.b=h;else{f/=60;var i=Math.floor(f),j=f-i,k=h*(1-g),l=h*(1-g*j),m=h*(1-g*(1-j));switch(i){case 0:e.r=h,e.g=m,e.b=k;break;case 1:e.r=l,e.g=h,e.b=k;break;case 2:e.r=k,e.g=h,e.b=m;break;case 3:e.r=k,e.g=l,e.b=h;break;case 4:e.r=m,e.g=k,e.b=h;break;default:e.r=h,e.g=k,e.b=l}}e.a=1},b.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},b.prototype.clone=function(){return a.SerializationHelper.Clone(function(){return new b},this)},b.prototype.serialize=function(){return a.SerializationHelper.Serialize(this)},b.Parse=function(c){return a.SerializationHelper.Parse(function(){return new b},c,null,null)},__decorate([a.serialize()],b.prototype,"_globalHue",void 0),__decorate([a.serialize()],b.prototype,"_globalDensity",void 0),__decorate([a.serialize()],b.prototype,"_globalSaturation",void 0),__decorate([a.serialize()],b.prototype,"_globalExposure",void 0),__decorate([a.serialize()],b.prototype,"_highlightsHue",void 0),__decorate([a.serialize()],b.prototype,"_highlightsDensity",void 0),__decorate([a.serialize()],b.prototype,"_highlightsSaturation",void 0),__decorate([a.serialize()],b.prototype,"_highlightsExposure",void 0),__decorate([a.serialize()],b.prototype,"_midtonesHue",void 0),__decorate([a.serialize()],b.prototype,"_midtonesDensity",void 0),__decorate([a.serialize()],b.prototype,"_midtonesSaturation",void 0),__decorate([a.serialize()],b.prototype,"_midtonesExposure",void 0),b}();a.ColorCurves=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(b){function c(c,d){b.call(this,d),c&&(this._textureMatrix=a.Matrix.Identity(),this.name=c,this.url=c,this.hasAlpha=!1,this.isCube=!1,this.wrapU=a.Texture.CLAMP_ADDRESSMODE,this.wrapV=a.Texture.CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1,this._texture=this._getFromCache(c,!0),this._texture||(d.useDelayedTextureLoading?this.delayLoadState=a.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))}return __extends(c,b),c.prototype.getTextureMatrix=function(){return this._textureMatrix},c.prototype.load3dlTexture=function(){var b=this,d=this.getScene().getEngine().createRawTexture(null,1,1,a.Engine.TEXTUREFORMAT_RGBA,!1,!1,a.Texture.BILINEAR_SAMPLINGMODE);this._texture=d;var e=function(e){for(var f,g,h,i=e.split("\n"),j=0,k=0,l=0,m=0,n=0,o=0;o<i.length;o++)if(h=i[o],c._noneEmptyLineRegex.test(h)&&0!==h.indexOf("#")){var p=h.split(" ");if(0!==j){if(0!=j){var q=Math.max(parseInt(p[0]),0),r=Math.max(parseInt(p[1]),0),s=Math.max(parseInt(p[2]),0);n=Math.max(q,n),n=Math.max(r,n),n=Math.max(s,n);var t=4*(k+m*j+l*j*j);g[t+0]=q,g[t+1]=r,g[t+2]=s,g[t+3]=0,m++,m%j==0&&(l++,m=0,l%j==0&&(k++,l=0))}}else j=p.length,f=new Uint8Array(j*j*j*4),g=new Float32Array(j*j*j*4)}for(var o=0;o<g.length;o++){var u=g[o];f[o]=u/n*255}b.getScene().getEngine().updateTextureSize(d,j*j,j),b.getScene().getEngine().updateRawTexture(d,f,a.Engine.TEXTUREFORMAT_RGBA,!1)};return a.Tools.LoadFile(this.url,e),this._texture},c.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},c.prototype.clone=function(){var a=new c(this.url,this.getScene());return a.level=this.level,a},c.prototype.delayLoad=function(){this.delayLoadState===a.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=a.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},c.Parse=function(b,c,d){var e=null;return b.name&&!b.isRenderTarget&&(e=new a.ColorGradingTexture(b.name,c),e.name=b.name,e.level=b.level),e},c.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.level=this.level,a},c._noneEmptyLineRegex=/\S+/,c}(a.BaseTexture);a.ColorGradingTexture=b}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(a){function b(){a.call(this),this.ALBEDO=!1,this.AMBIENT=!1,this.OPACITY=!1,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.REFLECTIVITY=!1,this.BUMP=!1,this.PARALLAX=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.ALPHAFROMALBEDO=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.OPACITYFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHALBEDO=!1,this.LIGHTMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.CAMERATONEMAP=!1,this.CAMERACONTRAST=!1,this.CAMERACOLORGRADING=!1,this.CAMERACOLORCURVES=!1,this.OVERLOADEDVALUES=!1,this.OVERLOADEDSHADOWVALUES=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.LINKREFRACTIONTOTRANSPARENCY=!1,this.REFRACTIONMAPINLINEARSPACE=!1,this.LODBASEDMICROSFURACE=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.RADIANCEOVERALPHA=!1,this.USEPMREMREFLECTION=!1,this.USEPMREMREFRACTION=!1,this.OPENGLNORMALMAP=!1,this.INVERTNORMALMAPX=!1,this.INVERTNORMALMAPY=!1,this.rebuild()}return __extends(b,a),b}(a.MaterialDefines),c=function(c){function d(d,e){var f=this;c.call(this,d,e),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this._lightingInfos=new a.Vector4(this.directIntensity,this.emissiveIntensity,this.environmentIntensity,this.specularIntensity),this.disableBumpMap=!1,this.overloadedShadowIntensity=1,this.overloadedShadeIntensity=1,this._overloadedShadowInfos=new a.Vector4(this.overloadedShadowIntensity,this.overloadedShadeIntensity,0,0),this.cameraExposure=1,this.cameraContrast=1,this.cameraColorGradingTexture=null,this._cameraColorGradingScaleOffset=new a.Vector4(1,1,0,0),this._cameraColorGradingInfos=new a.Vector4(1,1,0,0),this.cameraColorCurves=null,this._cameraInfos=new a.Vector4(1,1,0,0),this._microsurfaceTextureLods=new a.Vector2(0,0),this.overloadedAmbient=a.Color3.White(),this.overloadedAmbientIntensity=0,this.overloadedAlbedo=a.Color3.White(),this.overloadedAlbedoIntensity=0,this.overloadedReflectivity=new a.Color3(.3,.3,.3),this.overloadedReflectivityIntensity=0,this.overloadedEmissive=a.Color3.White(),this.overloadedEmissiveIntensity=0,this._overloadedIntensity=new a.Vector4(this.overloadedAmbientIntensity,this.overloadedAlbedoIntensity,this.overloadedReflectivityIntensity,this.overloadedEmissiveIntensity),this.overloadedReflection=a.Color3.White(),this.overloadedReflectionIntensity=0,this.overloadedMicroSurface=0,this.overloadedMicroSurfaceIntensity=0,this._overloadedMicroSurface=new a.Vector3(this.overloadedMicroSurface,this.overloadedMicroSurfaceIntensity,this.overloadedReflectionIntensity),this.ambientColor=new a.Color3(0,0,0),this.albedoColor=new a.Color3(1,1,1),this.reflectivityColor=new a.Color3(1,1,1),this.reflectionColor=new a.Color3(.5,.5,.5),this.emissiveColor=new a.Color3(0,0,0),this.microSurface=.9,this.indexOfRefraction=.66,this.invertRefractionY=!1,this.linkRefractionWithTransparency=!1,this.linkEmissiveWithAlbedo=!1,this.useLightmapAsShadowmap=!1,this.useEmissiveAsIllumination=!1,this.useAlphaFromAlbedoTexture=!1,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useScalarInLinearSpace=!1,this.usePhysicalLightFalloff=!0,this.useRadianceOverAlpha=!0,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this._renderTargets=new a.SmartArray(16),this._worldViewProjectionMatrix=a.Matrix.Zero(),this._globalAmbientColor=new a.Color3(0,0,0),this._tempColor=new a.Color3,this._defines=new b,this._cachedDefines=new b,this._myScene=null,this._myShadowGenerator=null,this._cachedDefines.BonesPerMesh=-1,this.getRenderTargetTextures=function(){return f._renderTargets.reset(),f.reflectionTexture&&f.reflectionTexture.isRenderTarget&&f._renderTargets.push(f.reflectionTexture),f.refractionTexture&&f.refractionTexture.isRenderTarget&&f._renderTargets.push(f.refractionTexture),f._renderTargets}}return __extends(d,c),Object.defineProperty(d.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(a){this._useLogarithmicDepth=a&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),d.prototype.needAlphaBlending=function(){return this.linkRefractionWithTransparency?!1:this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromAlbedoTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},d.prototype.needAlphaTesting=function(){return this.linkRefractionWithTransparency?!1:null!=this.albedoTexture&&this.albedoTexture.hasAlpha},d.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this.albedoTexture&&this.albedoTexture.hasAlpha&&this.useAlphaFromAlbedoTexture},d.prototype.getAlphaTestTexture=function(){return this.albedoTexture},d.prototype._checkCache=function(a,b,c){return b?this._defines.INSTANCES!==c?!1:!(!b._materialDefines||!b._materialDefines.isEqual(this._defines)):!0},d.prototype.convertColorToLinearSpaceToRef=function(a,b){d.convertColorToLinearSpaceToRef(a,b,this.useScalarInLinearSpace)},d.convertColorToLinearSpaceToRef=function(a,b,c){c?(b.r=a.r,b.g=a.g,b.b=a.b):a.toLinearSpaceToRef(b)},d.BindLights=function(b,c,e,f,g,h,i){for(var j=0,k=!1,l=0;l<b.lights.length;l++){var m=b.lights[l];if(m.isEnabled()&&m.canAffectMesh(c)&&(a.MaterialHelper.BindLightProperties(m,e,j),this.convertColorToLinearSpaceToRef(m.diffuse,d._scaledAlbedo,g),d._scaledAlbedo.scaleToRef(m.intensity,d._scaledAlbedo),e.setColor4("vLightDiffuse"+j,d._scaledAlbedo,i?m.radius:m.range),f.SPECULARTERM&&(this.convertColorToLinearSpaceToRef(m.specular,d._scaledReflectivity,g),d._scaledReflectivity.scaleToRef(m.intensity,d._scaledReflectivity),e.setColor3("vLightSpecular"+j,d._scaledReflectivity)),b.shadowsEnabled&&(k=a.MaterialHelper.BindLightShadow(m,b,c,j,e,k)),j++,j===h))break}},d.prototype.isReady=function(c,d){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var e=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===e.getRenderId()&&this._checkCache(e,c,d))return!0;var f=e.getEngine(),g=!1,h=!1;if(this._defines.reset(),e.texturesEnabled){if(e.texturesEnabled){if(e.getEngine().getCaps().textureLOD&&(this._defines.LODBASEDMICROSFURACE=!0),this.albedoTexture&&a.StandardMaterial.DiffuseTextureEnabled){if(!this.albedoTexture.isReady())return!1;h=!0,this._defines.ALBEDO=!0}if(this.ambientTexture&&a.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;h=!0,this._defines.AMBIENT=!0}if(this.opacityTexture&&a.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;h=!0,this._defines.OPACITY=!0,this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0)}if(this.reflectionTexture&&a.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(g=!0,this._defines.REFLECTION=!0,this.reflectionTexture.coordinatesMode===a.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case a.Texture.CUBIC_MODE:case a.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case a.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case a.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case a.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case a.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case a.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case a.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0}this.reflectionTexture instanceof a.HDRCubeTexture&&this.reflectionTexture&&(this._defines.USESPHERICALFROMREFLECTIONMAP=!0,g=!0,this.reflectionTexture.isPMREM&&(this._defines.USEPMREMREFLECTION=!0))}if(this.lightmapTexture&&a.StandardMaterial.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;h=!0,this._defines.LIGHTMAP=!0,this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.emissiveTexture&&a.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;h=!0,this._defines.EMISSIVE=!0}if(this.reflectivityTexture&&a.StandardMaterial.SpecularTextureEnabled){if(!this.reflectivityTexture.isReady())return!1;h=!0,this._defines.REFLECTIVITY=!0,this._defines.MICROSURFACEFROMREFLECTIVITYMAP=this.useMicroSurfaceFromReflectivityMapAlpha,this._defines.MICROSURFACEAUTOMATIC=this.useAutoMicroSurfaceFromReflectivityMap}}if(e.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&a.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap){if(!this.bumpTexture.isReady())return!1;h=!0,this._defines.BUMP=!0,this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0)),this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0),this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&a.StandardMaterial.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;h=!0,this._defines.REFRACTION=!0,this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube,this.linkRefractionWithTransparency&&(this._defines.LINKREFRACTIONTOTRANSPARENCY=!0),this.refractionTexture instanceof a.HDRCubeTexture&&(this._defines.REFRACTIONMAPINLINEARSPACE=!0,this.refractionTexture.isPMREM&&(this._defines.USEPMREMREFRACTION=!0))}if(this.cameraColorGradingTexture){if(!this.cameraColorGradingTexture.isReady())return!1;this._defines.CAMERACOLORGRADING=!0}}if(e.clipPlane&&(this._defines.CLIPPLANE=!0),f.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromAlbedoTexture()&&(this._defines.ALPHAFROMALBEDO=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithAlbedo&&(this._defines.LINKEMISSIVEWITHALBEDO=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),1!=this.cameraContrast&&(this._defines.CAMERACONTRAST=!0),1!=this.cameraExposure&&(this._defines.CAMERATONEMAP=!0),this.cameraColorCurves&&(this._defines.CAMERACOLORCURVES=!0),1==this.overloadedShadeIntensity&&1==this.overloadedShadowIntensity||(this._defines.OVERLOADEDSHADOWVALUES=!0),(this.overloadedMicroSurfaceIntensity>0||this.overloadedEmissiveIntensity>0||this.overloadedReflectivityIntensity>0||this.overloadedAlbedoIntensity>0||this.overloadedAmbientIntensity>0||this.overloadedReflectionIntensity>0)&&(this._defines.OVERLOADEDVALUES=!0),(this.pointsCloud||e.forcePointsCloud)&&(this._defines.POINTSIZE=!0),e.fogEnabled&&c&&c.applyFog&&e.fogMode!==a.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),e.lightsEnabled&&!this.disableLighting&&(g=a.MaterialHelper.PrepareDefinesForLights(e,c,this._defines,this.maxSimultaneousLights)||g),a.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled)&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),g=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),this.usePhysicalLightFalloff&&(this._defines.USEPHYSICALLIGHTFALLOFF=!0),this.useRadianceOverAlpha&&(this._defines.RADIANCEOVERALPHA=!0),c&&(g&&c.isVerticesDataPresent(a.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),h&&(c.isVerticesDataPresent(a.VertexBuffer.UVKind)&&(this._defines.UV1=!0),c.isVerticesDataPresent(a.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),c.useVertexColors&&c.isVerticesDataPresent(a.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,c.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),c.useBones&&c.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=c.numBoneInfluencers,this._defines.BonesPerMesh=c.skeleton.bones.length+1),d&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),e.resetCachedMaterial();var i=new a.EffectFallbacks;this._defines.REFLECTION&&i.addFallback(0,"REFLECTION"),this._defines.REFRACTION&&i.addFallback(0,"REFRACTION"),this._defines.REFLECTIVITY&&i.addFallback(0,"REFLECTIVITY"),this._defines.BUMP&&i.addFallback(0,"BUMP"),this._defines.PARALLAX&&i.addFallback(1,"PARALLAX"),this._defines.PARALLAXOCCLUSION&&i.addFallback(0,"PARALLAXOCCLUSION"),this._defines.SPECULAROVERALPHA&&i.addFallback(0,"SPECULAROVERALPHA"),this._defines.FOG&&i.addFallback(1,"FOG"),this._defines.POINTSIZE&&i.addFallback(0,"POINTSIZE"),this._defines.LOGARITHMICDEPTH&&i.addFallback(0,"LOGARITHMICDEPTH"),a.MaterialHelper.HandleFallbacksForShadows(this._defines,i,this.maxSimultaneousLights),this._defines.SPECULARTERM&&i.addFallback(0,"SPECULARTERM"),this._defines.OPACITYFRESNEL&&i.addFallback(1,"OPACITYFRESNEL"),this._defines.EMISSIVEFRESNEL&&i.addFallback(2,"EMISSIVEFRESNEL"),this._defines.FRESNEL&&i.addFallback(3,"FRESNEL"),this._defines.NUM_BONE_INFLUENCERS>0&&i.addCPUSkinningFallback(0,c);var j=[a.VertexBuffer.PositionKind];this._defines.NORMAL&&j.push(a.VertexBuffer.NormalKind),this._defines.UV1&&j.push(a.VertexBuffer.UVKind),this._defines.UV2&&j.push(a.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&j.push(a.VertexBuffer.ColorKind),a.MaterialHelper.PrepareAttributesForBones(j,c,this._defines,i),a.MaterialHelper.PrepareAttributesForInstances(j,this._defines);var k="pbr";e.getEngine().getCaps().standardDerivatives||(k="legacypbr");var l=this._defines.toString(),m=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vReflectivityInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","depthValues","opacityParts","emissiveLeftColor","emissiveRightColor","vLightingIntensity","vOverloadedShadowIntensity","vOverloadedIntensity","vOverloadedAlbedo","vOverloadedReflection","vOverloadedReflectivity","vOverloadedEmissive","vOverloadedMicroSurface","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vMicrosurfaceTextureLods","vCameraInfos","vCameraColorGradingInfos","vCameraColorGradingScaleOffset"],n=["albedoSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","reflectivitySampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","cameraColorGrading2DSampler"];a.ColorCurves.PrepareUniforms(m),a.MaterialHelper.PrepareUniformsAndSamplersList(m,n,this._defines,this.maxSimultaneousLights),this._effect=e.getEngine().createEffect(k,j,m,n,l,i,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights})}return this._effect.isReady()?(this._renderId=e.getRenderId(),this._wasPreviouslyReady=!0,c&&(c._materialDefines||(c._materialDefines=new b),this._defines.cloneTo(c._materialDefines)),!0):!1},d.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null),this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null),c.prototype.unbind.call(this)},d.prototype.bindOnlyWorldMatrix=function(a){this._effect.setMatrix("world",a)},d.prototype.bind=function(b,e){if(this._myScene=this.getScene(),this.bindOnlyWorldMatrix(b),a.MaterialHelper.BindBonesParameters(e,this._effect),
this._myScene.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",this._myScene.getTransformMatrix()),a.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new a.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this._myScene.texturesEnabled){if(this.albedoTexture&&a.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("albedoSampler",this.albedoTexture),this._effect.setFloat2("vAlbedoInfos",this.albedoTexture.coordinatesIndex,this.albedoTexture.level),this._effect.setMatrix("albedoMatrix",this.albedoTexture.getTextureMatrix())),this.ambientTexture&&a.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&a.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&a.StandardMaterial.ReflectionTextureEnabled&&(this._microsurfaceTextureLods.x=Math.round(Math.log(this.reflectionTexture.getSize().width)*Math.LOG2E),this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,0),this._defines.USESPHERICALFROMREFLECTIONMAP&&(this._effect.setFloat3("vSphericalX",this.reflectionTexture.sphericalPolynomial.x.x,this.reflectionTexture.sphericalPolynomial.x.y,this.reflectionTexture.sphericalPolynomial.x.z),this._effect.setFloat3("vSphericalY",this.reflectionTexture.sphericalPolynomial.y.x,this.reflectionTexture.sphericalPolynomial.y.y,this.reflectionTexture.sphericalPolynomial.y.z),this._effect.setFloat3("vSphericalZ",this.reflectionTexture.sphericalPolynomial.z.x,this.reflectionTexture.sphericalPolynomial.z.y,this.reflectionTexture.sphericalPolynomial.z.z),this._effect.setFloat3("vSphericalXX",this.reflectionTexture.sphericalPolynomial.xx.x,this.reflectionTexture.sphericalPolynomial.xx.y,this.reflectionTexture.sphericalPolynomial.xx.z),this._effect.setFloat3("vSphericalYY",this.reflectionTexture.sphericalPolynomial.yy.x,this.reflectionTexture.sphericalPolynomial.yy.y,this.reflectionTexture.sphericalPolynomial.yy.z),this._effect.setFloat3("vSphericalZZ",this.reflectionTexture.sphericalPolynomial.zz.x,this.reflectionTexture.sphericalPolynomial.zz.y,this.reflectionTexture.sphericalPolynomial.zz.z),this._effect.setFloat3("vSphericalXY",this.reflectionTexture.sphericalPolynomial.xy.x,this.reflectionTexture.sphericalPolynomial.xy.y,this.reflectionTexture.sphericalPolynomial.xy.z),this._effect.setFloat3("vSphericalYZ",this.reflectionTexture.sphericalPolynomial.yz.x,this.reflectionTexture.sphericalPolynomial.yz.y,this.reflectionTexture.sphericalPolynomial.yz.z),this._effect.setFloat3("vSphericalZX",this.reflectionTexture.sphericalPolynomial.zx.x,this.reflectionTexture.sphericalPolynomial.zx.y,this.reflectionTexture.sphericalPolynomial.zx.z))),this.emissiveTexture&&a.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&a.StandardMaterial.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.reflectivityTexture&&a.StandardMaterial.SpecularTextureEnabled&&(this._effect.setTexture("reflectivitySampler",this.reflectivityTexture),this._effect.setFloat2("vReflectivityInfos",this.reflectivityTexture.coordinatesIndex,this.reflectivityTexture.level),this._effect.setMatrix("reflectivityMatrix",this.reflectivityTexture.getTextureMatrix())),this.bumpTexture&&this._myScene.getEngine().getCaps().standardDerivatives&&a.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&a.StandardMaterial.RefractionTextureEnabled){this._microsurfaceTextureLods.y=Math.round(Math.log(this.refractionTexture.getSize().width)*Math.LOG2E);var f=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(f=this.refractionTexture.depth)),this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,f,this.invertRefractionY?-1:1)}if((this.reflectionTexture||this.refractionTexture)&&this._effect.setFloat2("vMicrosurfaceTextureLods",this._microsurfaceTextureLods.x,this._microsurfaceTextureLods.y),this.cameraColorGradingTexture){this._effect.setTexture("cameraColorGrading2DSampler",this.cameraColorGradingTexture),this._cameraColorGradingInfos.x=this.cameraColorGradingTexture.level,this._cameraColorGradingInfos.y=this.cameraColorGradingTexture.getSize().height,this._cameraColorGradingInfos.z=this._cameraColorGradingInfos.y-1,this._cameraColorGradingInfos.w=1/this._cameraColorGradingInfos.y,this._effect.setFloat4("vCameraColorGradingInfos",this._cameraColorGradingInfos.x,this._cameraColorGradingInfos.y,this._cameraColorGradingInfos.z,this._cameraColorGradingInfos.w);var g=this._cameraColorGradingInfos.w/this._cameraColorGradingInfos.y,h=1/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.x=this._cameraColorGradingInfos.z*g,this._cameraColorGradingScaleOffset.y=this._cameraColorGradingInfos.z/this._cameraColorGradingInfos.y,this._cameraColorGradingScaleOffset.z=.5*g,this._cameraColorGradingScaleOffset.w=.5*h,this._effect.setFloat4("vCameraColorGradingScaleOffset",this._cameraColorGradingScaleOffset.x,this._cameraColorGradingScaleOffset.y,this._cameraColorGradingScaleOffset.z,this._cameraColorGradingScaleOffset.w)}}a.MaterialHelper.BindClipPlane(this._effect,this._myScene),this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),this._myScene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this.convertColorToLinearSpaceToRef(this.reflectivityColor,d._scaledReflectivity),this._effect.setVector3("vEyePosition",this._myScene._mirroredCameraPosition?this._myScene._mirroredCameraPosition:this._myScene.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._effect.setColor4("vReflectivityColor",d._scaledReflectivity,this.microSurface),this.convertColorToLinearSpaceToRef(this.emissiveColor,d._scaledEmissive),this._effect.setColor3("vEmissiveColor",d._scaledEmissive),this.convertColorToLinearSpaceToRef(this.reflectionColor,d._scaledReflection),this._effect.setColor3("vReflectionColor",d._scaledReflection)}this._myScene.getCachedMaterial()===this&&this.isFrozen||(this.convertColorToLinearSpaceToRef(this.albedoColor,d._scaledAlbedo),this._effect.setColor4("vAlbedoColor",d._scaledAlbedo,this.alpha*e.visibility),this._myScene.lightsEnabled&&!this.disableLighting&&d.BindLights(this._myScene,e,this._effect,this._defines,this.useScalarInLinearSpace,this.maxSimultaneousLights,this.usePhysicalLightFalloff),(this._myScene.fogEnabled&&e.applyFog&&this._myScene.fogMode!==a.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",this._myScene.getViewMatrix()),a.MaterialHelper.BindFogParameters(this._myScene,e,this._effect),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=this.emissiveIntensity,this._lightingInfos.z=this.environmentIntensity,this._lightingInfos.w=this.specularIntensity,this._effect.setVector4("vLightingIntensity",this._lightingInfos),this._overloadedShadowInfos.x=this.overloadedShadowIntensity,this._overloadedShadowInfos.y=this.overloadedShadeIntensity,this._effect.setVector4("vOverloadedShadowIntensity",this._overloadedShadowInfos),this._cameraInfos.x=this.cameraExposure,this._cameraInfos.y=this.cameraContrast,this._effect.setVector4("vCameraInfos",this._cameraInfos),this.cameraColorCurves&&a.ColorCurves.Bind(this.cameraColorCurves,this._effect),this._overloadedIntensity.x=this.overloadedAmbientIntensity,this._overloadedIntensity.y=this.overloadedAlbedoIntensity,this._overloadedIntensity.z=this.overloadedReflectivityIntensity,this._overloadedIntensity.w=this.overloadedEmissiveIntensity,this._effect.setVector4("vOverloadedIntensity",this._overloadedIntensity),this.convertColorToLinearSpaceToRef(this.overloadedAmbient,this._tempColor),this._effect.setColor3("vOverloadedAmbient",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedAlbedo,this._tempColor),this._effect.setColor3("vOverloadedAlbedo",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflectivity,this._tempColor),this._effect.setColor3("vOverloadedReflectivity",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedEmissive,this._tempColor),this._effect.setColor3("vOverloadedEmissive",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflection,this._tempColor),this._effect.setColor3("vOverloadedReflection",this._tempColor),this._overloadedMicroSurface.x=this.overloadedMicroSurface,this._overloadedMicroSurface.y=this.overloadedMicroSurfaceIntensity,this._overloadedMicroSurface.z=this.overloadedReflectionIntensity,this._effect.setVector3("vOverloadedMicroSurface",this._overloadedMicroSurface),a.MaterialHelper.BindLogDepth(this._defines,this._effect,this._myScene)),c.prototype.bind.call(this,b,e),this._myScene=null},d.prototype.getAnimatables=function(){var a=[];return this.albedoTexture&&this.albedoTexture.animations&&this.albedoTexture.animations.length>0&&a.push(this.albedoTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&a.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&a.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&a.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&a.push(this.emissiveTexture),this.reflectivityTexture&&this.reflectivityTexture.animations&&this.reflectivityTexture.animations.length>0&&a.push(this.reflectivityTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&a.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&this.lightmapTexture.animations.length>0&&a.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&this.refractionTexture.animations.length>0&&a.push(this.refractionTexture),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.animations&&this.cameraColorGradingTexture.animations.length>0&&a.push(this.cameraColorGradingTexture),a},d.prototype.dispose=function(a,b){b&&(this.albedoTexture&&this.albedoTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.reflectivityTexture&&this.reflectivityTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose(),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.dispose()),c.prototype.dispose.call(this,a,b)},d.prototype.clone=function(b){var c=this;return a.SerializationHelper.Clone(function(){return new d(b,c.getScene())},this)},d.prototype.serialize=function(){var b=a.SerializationHelper.Serialize(this);return b.customType="BABYLON.PBRMaterial",b},d.Parse=function(b,c,e){return a.SerializationHelper.Parse(function(){return new d(b.name,c)},b,c,e)},d._scaledAlbedo=new a.Color3,d._scaledReflectivity=new a.Color3,d._scaledEmissive=new a.Color3,d._scaledReflection=new a.Color3,__decorate([a.serialize()],d.prototype,"directIntensity",void 0),__decorate([a.serialize()],d.prototype,"emissiveIntensity",void 0),__decorate([a.serialize()],d.prototype,"environmentIntensity",void 0),__decorate([a.serialize()],d.prototype,"specularIntensity",void 0),__decorate([a.serialize()],d.prototype,"disableBumpMap",void 0),__decorate([a.serialize()],d.prototype,"overloadedShadowIntensity",void 0),__decorate([a.serialize()],d.prototype,"overloadedShadeIntensity",void 0),__decorate([a.serialize()],d.prototype,"cameraExposure",void 0),__decorate([a.serialize()],d.prototype,"cameraContrast",void 0),__decorate([a.serializeAsTexture()],d.prototype,"cameraColorGradingTexture",void 0),__decorate([a.serializeAsColorCurves()],d.prototype,"cameraColorCurves",void 0),__decorate([a.serializeAsColor3()],d.prototype,"overloadedAmbient",void 0),__decorate([a.serialize()],d.prototype,"overloadedAmbientIntensity",void 0),__decorate([a.serializeAsColor3()],d.prototype,"overloadedAlbedo",void 0),__decorate([a.serialize()],d.prototype,"overloadedAlbedoIntensity",void 0),__decorate([a.serializeAsColor3()],d.prototype,"overloadedReflectivity",void 0),__decorate([a.serialize()],d.prototype,"overloadedReflectivityIntensity",void 0),__decorate([a.serializeAsColor3()],d.prototype,"overloadedEmissive",void 0),__decorate([a.serialize()],d.prototype,"overloadedEmissiveIntensity",void 0),__decorate([a.serializeAsColor3()],d.prototype,"overloadedReflection",void 0),__decorate([a.serialize()],d.prototype,"overloadedReflectionIntensity",void 0),__decorate([a.serialize()],d.prototype,"overloadedMicroSurface",void 0),__decorate([a.serialize()],d.prototype,"overloadedMicroSurfaceIntensity",void 0),__decorate([a.serializeAsTexture()],d.prototype,"albedoTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"ambientTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"opacityTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"reflectionTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"emissiveTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"reflectivityTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"bumpTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"lightmapTexture",void 0),__decorate([a.serializeAsTexture()],d.prototype,"refractionTexture",void 0),__decorate([a.serializeAsColor3("ambient")],d.prototype,"ambientColor",void 0),__decorate([a.serializeAsColor3("albedo")],d.prototype,"albedoColor",void 0),__decorate([a.serializeAsColor3("reflectivity")],d.prototype,"reflectivityColor",void 0),__decorate([a.serializeAsColor3("reflection")],d.prototype,"reflectionColor",void 0),__decorate([a.serializeAsColor3("emissive")],d.prototype,"emissiveColor",void 0),__decorate([a.serialize()],d.prototype,"microSurface",void 0),__decorate([a.serialize()],d.prototype,"indexOfRefraction",void 0),__decorate([a.serialize()],d.prototype,"invertRefractionY",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"opacityFresnelParameters",void 0),__decorate([a.serializeAsFresnelParameters()],d.prototype,"emissiveFresnelParameters",void 0),__decorate([a.serialize()],d.prototype,"linkRefractionWithTransparency",void 0),__decorate([a.serialize()],d.prototype,"linkEmissiveWithAlbedo",void 0),__decorate([a.serialize()],d.prototype,"useLightmapAsShadowmap",void 0),__decorate([a.serialize()],d.prototype,"useEmissiveAsIllumination",void 0),__decorate([a.serialize()],d.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([a.serialize()],d.prototype,"useSpecularOverAlpha",void 0),__decorate([a.serialize()],d.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([a.serialize()],d.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([a.serialize()],d.prototype,"useScalarInLinearSpace",void 0),__decorate([a.serialize()],d.prototype,"usePhysicalLightFalloff",void 0),__decorate([a.serialize()],d.prototype,"useRadianceOverAlpha",void 0),__decorate([a.serialize()],d.prototype,"useParallax",void 0),__decorate([a.serialize()],d.prototype,"useParallaxOcclusion",void 0),__decorate([a.serialize()],d.prototype,"parallaxScaleBias",void 0),__decorate([a.serialize()],d.prototype,"disableLighting",void 0),__decorate([a.serialize()],d.prototype,"maxSimultaneousLights",void 0),__decorate([a.serialize()],d.prototype,"invertNormalMapX",void 0),__decorate([a.serialize()],d.prototype,"invertNormalMapY",void 0),__decorate([a.serialize()],d.prototype,"useLogarithmicDepth",null),d}(a.Material);a.PBRMaterial=c}(BABYLON||(BABYLON={}));var BABYLON;!function(a){var b=function(){function b(b){var c=this;this._transformationMatrix=a.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._skeletonViewers=new Array,this._identityMatrix=a.Matrix.Identity(),this.axisRatio=.02,this.accentColor="orange",this._scene=b,this._syncPositions=function(){var a=c._scene.getEngine(),b=a.getRenderingCanvasClientRect();c._showUI&&(c._statsDiv.style.left=b.width-410+"px",c._statsDiv.style.top=b.height-290+"px",c._statsDiv.style.width="400px",c._statsDiv.style.height="auto",c._statsSubsetDiv.style.maxHeight="240px",c._optionsDiv.style.left="0px",c._optionsDiv.style.top="10px",c._optionsDiv.style.width="200px",c._optionsDiv.style.height="auto",c._optionsSubsetDiv.style.maxHeight=b.height-225+"px",c._logDiv.style.left="0px",c._logDiv.style.top=b.height-170+"px",c._logDiv.style.width="600px",c._logDiv.style.height="160px",c._treeDiv.style.left=b.width-310+"px",c._treeDiv.style.top="10px",c._treeDiv.style.width="300px",c._treeDiv.style.height="auto",c._treeSubsetDiv.style.maxHeight=b.height-340+"px"),c._globalDiv.style.left=b.left+"px",c._globalDiv.style.top=b.top+"px",c._drawingCanvas.style.left="0px",c._drawingCanvas.style.top="0px",c._drawingCanvas.style.width=a.getRenderWidth()+"px",c._drawingCanvas.style.height=a.getRenderHeight()+"px";var d=window.devicePixelRatio||1,e=c._drawingContext,f=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;c._ratio=d/f,c._drawingCanvas.width=a.getRenderWidth()*c._ratio,c._drawingCanvas.height=a.getRenderHeight()*c._ratio},this._onCanvasClick=function(a){c._clickPosition={x:a.clientX*c._ratio,y:a.clientY*c._ratio}},this._syncUI=function(){c._showUI&&(c._displayStatistics?(c._displayStats(),c._statsDiv.style.display=""):c._statsDiv.style.display="none",c._displayLogs?c._logDiv.style.display="":c._logDiv.style.display="none",c._displayTree?(c._treeDiv.style.display="",c._needToRefreshMeshesTree&&(c._needToRefreshMeshesTree=!1,c._refreshMeshesTreeContent())):c._treeDiv.style.display="none")},this._syncData=function(){if(c._labelsEnabled||!c._showUI){c._camera.getViewMatrix().multiplyToRef(c._camera.getProjectionMatrix(),c._transformationMatrix),c._drawingContext.clearRect(0,0,c._drawingCanvas.width,c._drawingCanvas.height);var b,d,e=c._scene.getEngine(),f=c._camera.viewport,g=f.toGlobal(e.getRenderWidth(),e.getRenderHeight()),h=c._camera.getActiveMeshes();for(b=0;b<h.length;b++){var i=h.data[b],j=i.getBoundingInfo().boundingSphere.center;d=a.Vector3.Project(j,i.getWorldMatrix(),c._transformationMatrix,g),(i.renderOverlay||c.shouldDisplayAxis&&c.shouldDisplayAxis(i))&&c._renderAxis(d,i,g),c.shouldDisplayLabel&&!c.shouldDisplayLabel(i)||c._renderLabel(i.name,d,12,function(){i.renderOverlay=!i.renderOverlay},function(){return i.renderOverlay?"red":"black"})}var k=c._scene.cameras;for(b=0;b<k.length;b++){var l=k[b];l!==c._camera&&(d=a.Vector3.Project(a.Vector3.Zero(),l.getWorldMatrix(),c._transformationMatrix,g),c.shouldDisplayLabel&&!c.shouldDisplayLabel(l)||c._renderLabel(l.name,d,12,function(){c._camera.detachControl(e.getRenderingCanvas()),c._camera=l,c._camera.attachControl(e.getRenderingCanvas())},function(){return"purple"}))}var m=c._scene.lights;for(b=0;b<m.length;b++){var n=m[b];n.position&&(d=a.Vector3.Project(n.getAbsolutePosition(),c._identityMatrix,c._transformationMatrix,g),c.shouldDisplayLabel&&!c.shouldDisplayLabel(n)||c._renderLabel(n.name,d,-20,function(){n.setEnabled(!n.isEnabled())},function(){return n.isEnabled()?"orange":"gray"}))}}c._clickPosition=void 0}}return b.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var a=this._scene.meshes.slice(0,this._scene.meshes.length);a.sort(function(a,b){return a.name===b.name?0:a.name>b.name?1:-1});for(var b=0;b<a.length;b++){var c=a[b];c.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,c.name,c.getTotalVertices()+" verts",c.isVisible,function(a,b){b.isVisible=a.checked},c)}},b.prototype._renderSingleAxis=function(a,b,c,d,e){this._drawingContext.beginPath(),this._drawingContext.moveTo(a.x,a.y),this._drawingContext.lineTo(b.x,b.y),this._drawingContext.strokeStyle=e,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font="normal 14px Segoe UI",this._drawingContext.fillStyle=e,this._drawingContext.fillText(d,c.x,c.y)},b.prototype._renderAxis=function(b,c,d){var e=c.getBoundingInfo().boundingSphere.center,f=c.getWorldMatrix(),g=a.Vector3.UnprojectFromTransform(b.add(new a.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),d.width,d.height,f,this._transformationMatrix),h=g.subtract(e).length(),i=a.Vector3.Project(e.add(new a.Vector3(h,0,0)),f,this._transformationMatrix,d),j=a.Vector3.Project(e.add(new a.Vector3(1.5*h,0,0)),f,this._transformationMatrix,d);this._renderSingleAxis(b,i,j,"x","#FF0000");var k=a.Vector3.Project(e.add(new a.Vector3(0,h,0)),f,this._transformationMatrix,d),l=a.Vector3.Project(e.add(new a.Vector3(0,1.5*h,0)),f,this._transformationMatrix,d);this._renderSingleAxis(b,k,l,"y","#00FF00");var m=a.Vector3.Project(e.add(new a.Vector3(0,0,h)),f,this._transformationMatrix,d),n=a.Vector3.Project(e.add(new a.Vector3(0,0,1.5*h)),f,this._transformationMatrix,d);this._renderSingleAxis(b,m,n,"z","#0000FF")},b.prototype._renderLabel=function(a,b,c,d,e){if(b.z>0&&b.z<1){this._drawingContext.font="normal 12px Segoe UI";var f=this._drawingContext.measureText(a),g=b.x-f.width/2,h=b.y,i=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(i.left*this._ratio+g-5,i.top*this._ratio+h-c-12,f.width+10,17)&&d(),this._drawingContext.beginPath(),this._drawingContext.rect(g-5,h-c-12,f.width+10,17),this._drawingContext.fillStyle=e(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle="#FFFFFF",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle="#FFFFFF",this._drawingContext.fillText(a,g,h-c),this._drawingContext.beginPath(),this._drawingContext.arc(b.x,h,5,0,2*Math.PI,!1),this._drawingContext.fill()}},b.prototype._isClickInsideRect=function(a,b,c,d){return this._clickPosition?this._clickPosition.x<a||this._clickPosition.x>a+c?!1:!(this._clickPosition.y<b||this._clickPosition.y>b+d):!1},b.prototype.isVisible=function(){return this._enabled},b.prototype.hide=function(){if(this._enabled){this._enabled=!1;var b=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),this._rootElement.removeChild(this._globalDiv),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,a.StandardMaterial.DiffuseTextureEnabled=!0,a.StandardMaterial.AmbientTextureEnabled=!0,a.StandardMaterial.SpecularTextureEnabled=!0,a.StandardMaterial.EmissiveTextureEnabled=!0,a.StandardMaterial.BumpTextureEnabled=!0,a.StandardMaterial.OpacityTextureEnabled=!0,a.StandardMaterial.ReflectionTextureEnabled=!0,a.StandardMaterial.LightmapTextureEnabled=!0,a.StandardMaterial.RefractionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,this._scene.probesEnabled=!0,b.getRenderingCanvas().removeEventListener("click",this._onCanvasClick),this._clearSkeletonViewers()}},b.prototype._clearSkeletonViewers=function(){for(var a=0;a<this._skeletonViewers.length;a++)this._skeletonViewers[a].dispose();this._skeletonViewers=[]},b.prototype.show=function(a,b,c){if(void 0===a&&(a=!0),void 0===b&&(b=null),void 0===c&&(c=null),!this._enabled){this._enabled=!0,b?this._camera=b:this._camera=this._scene.activeCamera,this._showUI=a;var d=this._scene.getEngine();this._globalDiv=document.createElement("div"),this._rootElement=c||document.body,this._rootElement.appendChild(this._globalDiv),this._generateDOMelements(),d.getRenderingCanvas().addEventListener("click",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},b.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var a=0;a<this._scene.meshes.length;a++){var b=this._scene.meshes[a];b.renderOverlay=!1}},b.prototype._generateheader=function(a,b){var c=document.createElement("div");c.innerHTML=b+"&nbsp;",c.style.textAlign="right",c.style.width="100%",c.style.color="white",c.style.backgroundColor="Black",c.style.padding="5px 5px 4px 0px",c.style.marginLeft="-5px",c.style.fontWeight="bold",a.appendChild(c)},b.prototype._generateTexBox=function(a,b,c){var d=document.createElement("label");d.style.display="inline",d.innerHTML=b,d.style.color=c,a.appendChild(d),a.appendChild(document.createElement("br"))},b.prototype._generateAdvancedCheckBox=function(a,b,c,d,e,f){void 0===f&&(f=null);var g=document.createElement("label");g.style.display="inline";var h=document.createElement("input");h.type="checkbox",h.checked=d,h.style.display="inline",h.style.margin="0px 5px 0px 0px",h.style.verticalAlign="sub",h.addEventListener("change",function(a){e(a.target,f)}),g.appendChild(h);var i=document.createElement("span"),j=document.createElement("span"),k=document.createElement("span");k.style.cssFloat="right",j.innerHTML=b,k.innerHTML=c,k.style.fontSize="12px",k.style.maxWidth="200px",i.appendChild(j),i.appendChild(k),g.appendChild(i),a.appendChild(g),a.appendChild(document.createElement("br"))},b.prototype._generateCheckBox=function(a,b,c,d,e){void 0===e&&(e=null);var f=document.createElement("label");f.style.display="inline";var g=document.createElement("input");g.type="checkbox",g.checked=c,g.style.display="inline",g.style.margin="0px 5px 0px 0px",g.style.verticalAlign="sub",g.addEventListener("change",function(a){d(a.target,e)}),f.appendChild(g),f.appendChild(document.createTextNode(b)),a.appendChild(f),a.appendChild(document.createElement("br"))},b.prototype._generateButton=function(a,b,c,d){void 0===d&&(d=null);var e=document.createElement("button");e.innerHTML=b,e.style.height="24px",e.style.width="150px",e.style.marginBottom="5px",e.style.color="#444444",e.style.border="1px solid white",e.className="debugLayerButton",e.addEventListener("click",function(a){c(a.target,d)}),a.appendChild(e),a.appendChild(document.createElement("br"))},b.prototype._generateRadio=function(a,b,c,d,e,f){void 0===f&&(f=null);var g=document.createElement("label");g.style.display="inline";var h=document.createElement("input");h.type="radio",h.name=c,h.checked=d,h.style.display="inline",h.style.margin="0px 5px 0px 0px",h.style.verticalAlign="sub",h.addEventListener("change",function(a){e(a.target,f)}),g.appendChild(h),g.appendChild(document.createTextNode(b)),a.appendChild(g),a.appendChild(document.createElement("br"))},b.prototype._generateDOMelements=function(){var b=this;if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize="14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingCanvas.style.backgroundColor="transparent",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var c="rgba(128, 128, 128, 0.4)",d="rgb(180, 180, 180) solid 1px";this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border=d,this._statsDiv.style.position="absolute",this._statsDiv.style.background=c,this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border=d,this._treeDiv.style.position="absolute",this._treeDiv.style.background=c,this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border=d,this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background=c,this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=a.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),a.Tools.OnNewCacheEntry=function(a){b._logSubsetDiv.innerHTML=a+b._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border=d,this._optionsDiv.style.position="absolute",this._optionsDiv.style.background=c,this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),
this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight="200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(a){b._displayStatistics=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(a){b._displayLogs=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(a){b._displayTree=a.checked,b._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(a){b._scene.forceShowBoundingBoxes=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(a){b._labelsEnabled=a.checked,b._labelsEnabled||b._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,"Generate user marks (F12)",a.Tools.PerformanceLogLevel===a.Tools.PerformanceUserMarkLogLevel,function(b){b.checked?a.Tools.PerformanceLogLevel=a.Tools.PerformanceUserMarkLogLevel:a.Tools.PerformanceLogLevel=a.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(a){a.checked&&(b._scene.forceWireframe=!1,b._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(a){a.checked&&(b._scene.forceWireframe=!0,b._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(a){a.checked&&(b._scene.forceWireframe=!1,b._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",a.StandardMaterial.DiffuseTextureEnabled,function(b){a.StandardMaterial.DiffuseTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",a.StandardMaterial.AmbientTextureEnabled,function(b){a.StandardMaterial.AmbientTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",a.StandardMaterial.SpecularTextureEnabled,function(b){a.StandardMaterial.SpecularTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",a.StandardMaterial.EmissiveTextureEnabled,function(b){a.StandardMaterial.EmissiveTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",a.StandardMaterial.BumpTextureEnabled,function(b){a.StandardMaterial.BumpTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",a.StandardMaterial.OpacityTextureEnabled,function(b){a.StandardMaterial.OpacityTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",a.StandardMaterial.ReflectionTextureEnabled,function(b){a.StandardMaterial.ReflectionTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Refraction",a.StandardMaterial.RefractionTextureEnabled,function(b){a.StandardMaterial.RefractionTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lightmap",a.StandardMaterial.LightmapTextureEnabled,function(b){a.StandardMaterial.LightmapTextureEnabled=b.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",a.StandardMaterial.FresnelEnabled,function(b){a.StandardMaterial.FresnelEnabled=b.checked}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(a){b._scene.animationsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",this._scene.collisionsEnabled,function(a){b._scene.collisionsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(a){b._scene.fogEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(a){b._scene.lensFlaresEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(a){b._scene.lightsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Particles",this._scene.particlesEnabled,function(a){b._scene.particlesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(a){b._scene.postProcessesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Probes",this._scene.probesEnabled,function(a){b._scene.probesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(a){b._scene.proceduralTexturesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(a){b._scene.renderTargetsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(a){b._scene.shadowsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(a){b._scene.skeletonsEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,function(a){b._scene.spritesEnabled=a.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(a){b._scene.texturesEnabled=a.checked}),a.AudioEngine&&a.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(a){a.checked&&(b._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(a){a.checked&&(b._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(a){b._scene.audioEnabled=!a.checked})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Viewers:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",!1,function(c){if(!c.checked)return void b._clearSkeletonViewers();for(var d=0;d<b._scene.meshes.length;d++){var e=b._scene.meshes[d];if(e.skeleton){for(var f=!1,g=0;g<b._skeletonViewers.length;g++)if(b._skeletonViewers[g].skeleton===e.skeleton){f=!0;break}if(f)continue;var h=new a.Debug.SkeletonViewer(e.skeleton,e,b._scene);h.isEnabled=!0,b._skeletonViewers.push(h)}}}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(a){b._scene.dumpNextRenderTargets=!0}),this._generateButton(this._optionsSubsetDiv,"Run SceneOptimizer",function(c){a.SceneOptimizer.OptimizeAsync(b._scene)}),this._generateButton(this._optionsSubsetDiv,"Log camera object",function(a){b._camera?console.log(b._camera):console.warn("No camera defined, or debug layer created before camera creation!")}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},b.prototype._displayStats=function(){var b=this._scene,c=b.getEngine(),d=c.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+a.Engine.Version+" - <b>"+a.Tools.Format(c.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+b.meshes.length+"<br>Total lights: "+b.lights.length+"<br>Total vertices: "+b.getTotalVertices()+"<br>Total materials: "+b.materials.length+"<br>Total textures: "+b.textures.length+"<br>Active meshes: "+b.getActiveMeshes().length+"<br>Active indices: "+b.getActiveIndices()+"<br>Active bones: "+b.getActiveBones()+"<br>Active particles: "+b.getActiveParticles()+"<br><b>Draw calls: "+c.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+a.Tools.Format(b.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+a.Tools.Format(b.getRenderTargetsDuration())+" ms<br>Particles: "+a.Tools.Format(b.getParticlesDuration())+" ms<br>Sprites: "+a.Tools.Format(b.getSpritesDuration())+" ms<br><br>Render: <b>"+a.Tools.Format(b.getRenderDuration())+" ms</b><br>Frame: "+a.Tools.Format(b.getLastFrameDuration())+" ms<br>Potential FPS: "+a.Tools.Format(1e3/b.getLastFrameDuration(),0)+"<br>Resolution: "+c.getRenderWidth()+"x"+c.getRenderHeight()+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(c.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(c.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+(c.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(c.getCaps().textureFloat?"Yes":"No")+"<br><br>32bits indices: "+(c.getCaps().uintIndices?"Yes":"No")+"<br>Fragment depth: "+(c.getCaps().fragmentDepthSupported?"Yes":"No")+"<br>High precision shaders: "+(c.getCaps().highPrecisionShaderSupported?"Yes":"No")+"<br>Draw buffers: "+(c.getCaps().drawBuffersExtension?"Yes":"No")+"<br></div><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Caps.</b><br>Max textures units: "+c.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+c.getCaps().maxTextureSize+"<br>Max anisotropy: "+c.getCaps().maxAnisotropy+"<br><b>Info</b><br>WebGL feature level: "+c.webGLVersion+"<br>"+d.version+"<br></div><br>"+d.renderer+"<br>",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this.customStatsFunction())},b}();a.DebugLayer=b}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}",blurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",colorPixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",colorVertexShader:"\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",defaultPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec2 diffuseUV=vDiffuseUV;\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,diffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}",defaultVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",
displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",fxaaPixelShader:"#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}",hdrPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",legacydefaultPixelShader:"#define MAP_PROJECTION 4.\n\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\nuniform vec2 vReflectionInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 normalW=normalize(vNormalW);\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\nglossiness=vSpecularColor.a;\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..3]\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n\nfloat alpha=vDiffuseColor.a;\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nspecularColor=texture2D(specularSampler,vSpecularUV).rgb*vSpecularInfos.y;\n#endif\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",legacydefaultVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform mat4 reflectionMatrix;\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 coords=vec3(view*vec4(worldNormal,0.0));\nreturn vec3(reflectionMatrix*vec4(coords,1.0));\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn position;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef REFLECTION\nvReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),vNormalW);\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",legacypbrPixelShader:"precision mediump float;\n\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vAlbedoColor;\nuniform vec3 vReflectionColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#ifdef CAMERACOLORGRADING\nuniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;\n#endif\n\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution= vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance,alpha);\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor,cameraColorGrading2DSampler,vCameraColorGradingInfos,vCameraColorGradingScaleOffset);\n#endif\ngl_FragColor=finalColor;\n}",legacypbrVertexShader:"precision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",
linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",outlinePixelShader:"uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",pbrPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}",pbrVertexShader:"precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",shadowMapPixelShader:"vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=pack(depth);\n#endif\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",sprite2dPixelShader:"varying vec2 vUV;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a == 0.05) {\ndiscard;\n}\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",
spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a<0.05)\ndiscard;\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvec4 pos;\npos.xy=floor(pos2.xy*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"},BABYLON.Effect.IncludesShadersStore={bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpFragment:"#ifdef BUMP\nvec2 bumpUV=vBumpUV;\n#endif\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,bumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nvec2 uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,bumpUV,vBumpInfos.z);\n#else\nvec2 uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\ndiffuseUV+=uvOffset;\nbumpUV+=uvOffset;\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,bumpUV);\n#endif",bumpFragmentFunctions:"#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",colorCurves:"const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}",colorCurvesDefinition:"uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;",colorGrading:"vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}",colorGradingDefinition:"uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",fogVertex:"#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying float fFogDistance;\n#endif",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif",helperFunctions:"mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",lightFragment:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}",pbrLightFunctionsCall:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif",
pbrShadowFunctions:"\n#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",shadowsFragmentFunctions:"#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif",shadowsVertexDeclaration:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"},BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:!(o.z-i>e.z)},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:!!e(s,r,this.basePointWorld,this.velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.removeMesh=function(o){delete this._meshes[o]},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o.prototype.removeGeometry=function(o){delete this._geometries[o]},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?(0===e.x&&0===e.y&&0===e.z||this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i=e.subMeshes,r=i.length;if(!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;r>s;s++){var l=i[s];r>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){var i=this,r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};try{for(var t in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(t)&&this._collisionCache.addGeometry(e.updatedGeometries[t]);for(var s in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(s)&&this._collisionCache.addMesh(e.updatedMeshes[s]);e.removedGeometries.forEach(function(o){i._collisionCache.removeGeometry(o)}),e.removedMeshes.forEach(function(o){i._collisionCache.removeMesh(o)})}catch(l){r.error=o.WorkerReplyType.UNKNOWN_ERROR}postMessage(r,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh&&o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?(0===i.x&&0===i.y&&0===i.z||t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var i=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1.401298e-45);var r=t-i;return r>=-n&&n>=r},t.ToHex=function(t){var i=t.toString(16);return 15>=t?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t}();t.MathTools=i;var n=function(){function n(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.getClassName=function(){return"Color3"},n.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},n.prototype.toColor4=function(t){return void 0===t&&(t=1),new r(this.r,this.g,this.b,t)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},n.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},n.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},n.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},n.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)},n.prototype.toLinearSpace=function(){var t=new n;return this.toLinearSpaceToRef(t),t},n.prototype.toLinearSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToLinearSpace),i.g=Math.pow(this.g,t.ToLinearSpace),i.b=Math.pow(this.b,t.ToLinearSpace),this},n.prototype.toGammaSpace=function(){var t=new n;return this.toGammaSpaceToRef(t),t},n.prototype.toGammaSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToGammaSpace),i.g=Math.pow(this.g,t.ToGammaSpace),i.b=Math.pow(this.b,t.ToGammaSpace),this},n.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new n(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16);return n.FromInts(i,r,o)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1],t[i+2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var o=t.r+(i.r-t.r)*r,s=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(o,s,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}();t.Color3=n;var r=function(){function t(t,i,n,r){this.r=t,this.g=i,this.b=n,this.a=r}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0),t=397*t^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0,o=255*this.a|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)+i.ToHex(o)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),r=parseInt(i.substring(3,5),16),o=parseInt(i.substring(5,7),16),s=parseInt(i.substring(7,9),16);return t.FromInts(n,r,o,s)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return t.LerpToRef(i,n,r,o),o},t.LerpToRef=function(t,i,n,r){r.r=t.r+(i.r-t.r)*n,r.g=t.g+(i.g-t.g)*n,r.b=t.b+(i.b-t.b)*n,r.a=t.a+(i.a-t.a)*n},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,r,o){return new t(i/255,n/255,r/255,o/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],r=0;r<t.length;r+=3){var o=r/3*4;n[o]=t[r],n[o+1]=t[r+1],n[o+2]=t[r+2],n[o+3]=1}return n}return t},t}();t.Color4=r;var o=function(){function n(t,i){this.x=t,this.y=i}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.getClassName=function(){return"Vector2"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h);return new n(a,u)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;return s=s>r.y?r.y:s,s=s<i.y?i.y:s,new n(o,s)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y;return new n(c,p)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r;return new n(o,s)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.Normalize=function(t){var i=t.clone();return i.normalize(),i},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,o=t.y<i.y?t.y:i.y;return new n(r,o)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,o=t.y>i.y?t.y:i.y;return new n(r,o)},n.Transform=function(t,i){var r=n.Zero();return n.TransformToRef(t,i,r),r},n.TransformToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+i.m[13];n.x=r,n.y=o},n.PointInTriangle=function(t,i,n,r){var o=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),s=0>o?-1:1,e=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*s,h=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return e>0&&h>0&&2*o*s>e+h},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y;return n*n+r*r},n.DistanceOfPointFromSegment=function(t,i,r){var o=n.DistanceSquared(i,r);if(0===o)return n.Distance(t,i);var s=r.subtract(i),e=Math.max(0,Math.min(1,n.Dot(t.subtract(i),s)/o)),h=i.add(s.multiplyByFloats(e,e));return n.Distance(t,h)},n}();t.Vector2=o;var s=function(){function n(t,i,n){this.x=t,this.y=i,this.z=n}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},n.prototype.toQuaternion=function(){var t=new a(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),n=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),o=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),e=Math.sin(.5*this.y);return t.x=r*e,t.y=-o*e,t.z=n*s,t.w=i*s,t},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},n.prototype.subtractFromFloats=function(t,i,r){return new n(this.x-t,this.y-i,this.z-r)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-n,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)},n.prototype.equalsToFloats=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},n.GetClipFactor=function(t,i,r,o){var s=n.Dot(t,r)-o,e=n.Dot(i,r)-o,h=s/(s-e);return h},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromFloatArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatsToRef=function(t,i,n,r){r.x=t,r.y=i,r.z=n},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(t,i){var r=n.Zero();return n.TransformCoordinatesToRef(t,i,r),r},n.TransformCoordinatesToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];n.x=r/e,n.y=o/e,n.z=s/e},n.TransformCoordinatesFromFloatsToRef=function(t,i,n,r,o){var s=t*r.m[0]+i*r.m[4]+n*r.m[8]+r.m[12],e=t*r.m[1]+i*r.m[5]+n*r.m[9]+r.m[13],h=t*r.m[2]+i*r.m[6]+n*r.m[10]+r.m[14],a=t*r.m[3]+i*r.m[7]+n*r.m[11]+r.m[15];o.x=s/a,o.y=e/a,o.z=h/a},n.TransformNormal=function(t,i){var r=n.Zero();return n.TransformNormalToRef(t,i,r),r},n.TransformNormalToRef=function(t,i,n){n.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],n.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],n.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},n.TransformNormalFromFloatsToRef=function(t,i,n,r,o){o.x=t*r.m[0]+i*r.m[4]+n*r.m[8],o.y=t*r.m[1]+i*r.m[5]+n*r.m[9],o.z=t*r.m[2]+i*r.m[6]+n*r.m[10]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h),m=.5*(2*i.z+(-t.z+r.z)*s+(2*t.z-5*i.z+4*r.z-o.z)*e+(-t.z+3*i.z-3*r.z+o.z)*h);return new n(a,u,m)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;s=s>r.y?r.y:s,s=s<i.y?i.y:s;var e=t.z;return e=e>r.z?r.z:e,e=e<i.z?i.z:e,new n(o,s,e)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y,f=t.z*a+r.z*u+i.z*m+o.z*y;return new n(c,p,f)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r,e=t.z+(i.z-t.z)*r;return new n(o,s,e)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.Cross=function(t,i){var r=n.Zero();return n.CrossToRef(t,i,r),r},n.CrossToRef=function(t,i,n){M.Vector3[0].x=t.y*i.z-t.z*i.y,M.Vector3[0].y=t.z*i.x-t.x*i.z,M.Vector3[0].z=t.x*i.y-t.y*i.x,n.copyFrom(M.Vector3[0])},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Project=function(t,i,r,o){var s=o.width,e=o.height,h=o.x,a=o.y,m=u.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+a,0,1),y=i.multiply(r).multiply(m);return n.TransformCoordinates(t,y)},n.UnprojectFromTransform=function(t,r,o,s,e){var h=s.multiply(e);h.invert(),t.x=t.x/r*2-1,t.y=-(t.y/o*2-1);var a=n.TransformCoordinates(t,h),u=t.x*h.m[3]+t.y*h.m[7]+t.z*h.m[11]+h.m[15];return i.WithinEpsilon(u,1)&&(a=a.scale(1/u)),a},n.Unproject=function(t,r,o,s,e,h){var a=s.multiply(e).multiply(h);a.invert();var u=new n(t.x/r*2-1,-(t.y/o*2-1),t.z),m=n.TransformCoordinates(u,a),y=u.x*a.m[3]+u.y*a.m[7]+u.z*a.m[11]+a.m[15];return i.WithinEpsilon(y,1)&&(m=m.scale(1/y)),m},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z;return n*n+r*r+o*o},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n.RotationFromAxis=function(t,i,r){var o=n.Zero();return n.RotationFromAxisToRef(t,i,r,o),o},n.RotationFromAxisToRef=function(r,o,s,e){var h=r.normalize(),a=s.normalize(),u=p.X,m=p.Y,y=0,c=0,f=0,l=0,x=0,z=0,w=0,v=-1,d=0,g=M.Vector3[0],T=0,R=M.Vector3[1];i.WithinEpsilon(a.z,0,t.Epsilon)?z=1:i.WithinEpsilon(a.x,0,t.Epsilon)?l=1:(w=a.z/a.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),R.x=l,R.y=x,R.z=z,R.normalize(),n.CrossToRef(h,R,g),g.normalize(),n.Dot(a,g)<0&&(v=1),T=n.Dot(h,R),T=Math.min(1,Math.max(-1,T)),f=Math.acos(T)*v,n.Dot(R,u)<0&&(f=Math.PI+f,R=R.scaleInPlace(-1),d++);var _=M.Vector3[2],b=M.Vector3[3];l=0,x=0,z=0,v=-1,i.WithinEpsilon(a.z,0,t.Epsilon)?l=1:(w=R.z/R.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),_.x=l,_.y=x,_.z=z,_.normalize(),n.CrossToRef(_,R,b),b.normalize(),n.CrossToRef(a,_,g),g.normalize(),n.Dot(R,g)<0&&(v=1),T=n.Dot(a,_),T=Math.min(1,Math.max(-1,T)),c=Math.acos(T)*v,n.Dot(b,m)<0&&(c=Math.PI+c,d++),v=-1,n.CrossToRef(u,R,g),g.normalize(),n.Dot(g,m)<0&&(v=1),T=n.Dot(R,u),T=Math.min(1,Math.max(-1,T)),y=-Math.acos(T)*v,0>T&&2>d&&(y=Math.PI+y),e.x=c,e.y=y,e.z=f},n}();t.Vector3=s;var e=function(){function n(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},n.prototype.getClassName=function(){return"Vector4"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},n.prototype.subtractFromFloats=function(t,i,r,o){return new n(this.x-t,this.y-i,this.z-r,this.w-o)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-n,o.w=this.w-r,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z,-this.w)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)&&i.WithinEpsilon(this.w,n.w,r)},n.prototype.equalsToFloats=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},n.prototype.multiplyByFloats=function(t,i,r,o){return new n(this.x*t,this.y*i,this.z*r,this.w*o)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},n.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatsToRef=function(t,i,n,r,o){o.x=t,o.y=i,o.z=n,o.w=r},n.Zero=function(){return new n(0,0,0,0)},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z,s=t.w-i.w;return n*n+r*r+o*o+s*s},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n}();t.Vector4=e;var h=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){var n=new t(this.width+i.width,this.height+i.height);return n},t.prototype.substract=function(i){var n=new t(this.width-i.width,this.height-i.height);return n},t.Lerp=function(i,n,r){var o=i.width+(n.width-i.width)*r,s=i.height+(n.height-i.height)*r;return new t(o,s)},t}();t.Size=h;var a=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(n,r,o,s),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var i=new t(-this.x,-this.y,-this.z,this.w);return i},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=s.Zero();return this.toEulerAnglesToRef(i,t),i},t.prototype.toEulerAnglesToRef=function(t,i){void 0===i&&(i="YZX");var n,r,o,s=this.x,e=this.y,h=this.z,a=this.w;switch(i){case"YZX":var u=s*e+h*a;if(u>.499&&(n=2*Math.atan2(s,a),r=Math.PI/2,o=0),-.499>u&&(n=-2*Math.atan2(s,a),r=-Math.PI/2,o=0),isNaN(n)){var m=s*s,y=e*e,c=h*h;n=Math.atan2(2*e*a-2*s*h,1-2*y-2*c),r=Math.asin(2*u),o=Math.atan2(2*s*a-2*e*h,1-2*m-2*c)}break;default:throw new Error("Euler order "+i+" not supported yet.")}return t.y=n,t.z=r,t.x=o,this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,n=this.y*this.y,r=this.z*this.z,o=this.x*this.y,s=this.z*this.w,e=this.z*this.x,h=this.y*this.w,a=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(n+r),t.m[1]=2*(o+s),t.m[2]=2*(e-h),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(r+i),t.m[6]=2*(a+u),t.m[7]=0,t.m[8]=2*(e+h),t.m[9]=2*(a-u),t.m[10]=1-2*(n+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,r=t.m,o=r[0],s=r[4],e=r[8],h=r[1],a=r[5],u=r[9],m=r[2],y=r[6],c=r[10],p=o+a+c;p>0?(n=.5/Math.sqrt(p+1),i.w=.25/n,i.x=(y-u)*n,i.y=(e-m)*n,i.z=(h-s)*n):o>a&&o>c?(n=2*Math.sqrt(1+o-a-c),i.w=(y-u)/n,i.x=.25*n,i.y=(s+h)/n,i.z=(e+m)/n):a>c?(n=2*Math.sqrt(1+a-o-c),i.w=(e-m)/n,i.x=(s+h)/n,i.y=.25*n,i.z=(u+y)/n):(n=2*Math.sqrt(1+c-o-a),i.w=(h-s)/n,i.x=(e+m)/n,i.y=(u+y)/n,i.z=.25*n)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,n){var r=new t,o=Math.sin(n/2);return i.normalize(),r.w=Math.cos(n/2),r.x=i.x*o,r.y=i.y*o,r.z=i.z*o,r},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){var o=.5*n,s=.5*i,e=.5*t,h=Math.sin(o),a=Math.cos(o),u=Math.sin(s),m=Math.cos(s),y=Math.sin(e),c=Math.cos(e);r.x=c*u*a+y*m*h,r.y=y*m*a-c*u*h,r.z=c*m*h-y*u*a,r.w=c*m*a+y*u*h},t.RotationAlphaBetaGamma=function(i,n,r){var o=new t;return t.RotationAlphaBetaGammaToRef(i,n,r,o),o},t.RotationAlphaBetaGammaToRef=function(t,i,n,r){var o=.5*(n+t),s=.5*(n-t),e=.5*i;r.x=Math.cos(s)*Math.sin(e),r.y=Math.sin(s)*Math.sin(e),r.z=Math.sin(o)*Math.cos(e),r.w=Math.cos(o)*Math.cos(e)},t.Slerp=function(i,n,r){var o,s,e=r,h=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w,a=!1;if(0>h&&(a=!0,h=-h),h>.999999)s=1-e,o=a?-e:e;else{var u=Math.acos(h),m=1/Math.sin(u);s=Math.sin((1-e)*u)*m,o=a?-Math.sin(e*u)*m:Math.sin(e*u)*m}return new t(s*i.x+o*n.x,s*i.y+o*n.y,s*i.z+o*n.z,s*i.w+o*n.w)},t}();t.Quaternion=a;var u=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},t.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],n=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],o=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*n)-this.m[1]*(this.m[4]*t-this.m[6]*r+this.m[7]*o)+this.m[2]*(this.m[4]*i-this.m[5]*r+this.m[7]*s)-this.m[3]*(this.m[4]*n-this.m[5]*o+this.m[6]*s)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=0;16>n;n++)i.m[n]=this.m[n]+t.m[n];return this},t.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},t.prototype.invertToRef=function(t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],e=this.m[5],h=this.m[6],a=this.m[7],u=this.m[8],m=this.m[9],y=this.m[10],c=this.m[11],p=this.m[12],f=this.m[13],l=this.m[14],x=this.m[15],z=y*x-c*l,w=m*x-c*f,v=m*l-y*f,d=u*x-c*p,g=u*l-y*p,T=u*f-m*p,R=e*z-h*w+a*v,_=-(s*z-h*d+a*g),M=s*w-e*d+a*T,b=-(s*v-e*g+h*T),F=1/(i*R+n*_+r*M+o*b),A=h*x-a*l,L=e*x-a*f,P=e*l-h*f,C=s*x-a*p,Z=s*l-h*p,S=s*f-e*p,I=h*c-a*y,q=e*c-a*m,H=e*y-h*m,N=s*c-a*u,V=s*y-h*u,D=s*m-e*u;return t.m[0]=R*F,t.m[4]=_*F,t.m[8]=M*F,t.m[12]=b*F,t.m[1]=-(n*z-r*w+o*v)*F,t.m[5]=(i*z-r*d+o*g)*F,t.m[9]=-(i*w-n*d+o*T)*F,t.m[13]=(i*v-n*g+r*T)*F,t.m[2]=(n*A-r*L+o*P)*F,t.m[6]=-(i*A-r*C+o*Z)*F,t.m[10]=(i*L-n*C+o*S)*F,t.m[14]=-(i*P-n*Z+r*S)*F,t.m[3]=-(n*I-r*q+o*H)*F,t.m[7]=(i*I-r*N+o*V)*F,t.m[11]=-(i*q-n*N+o*D)*F,t.m[15]=(i*H-n*V+r*D)*F,this},t.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},t.prototype.getTranslation=function(){return new s(this.m[12],this.m[13],this.m[14])},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var n=0;16>n;n++)t[i+n]=this.m[n];return this},t.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},t.prototype.multiplyToArray=function(t,i,n){var r=this.m[0],o=this.m[1],s=this.m[2],e=this.m[3],h=this.m[4],a=this.m[5],u=this.m[6],m=this.m[7],y=this.m[8],c=this.m[9],p=this.m[10],f=this.m[11],l=this.m[12],x=this.m[13],z=this.m[14],w=this.m[15],v=t.m[0],d=t.m[1],g=t.m[2],T=t.m[3],R=t.m[4],_=t.m[5],M=t.m[6],b=t.m[7],F=t.m[8],A=t.m[9],L=t.m[10],P=t.m[11],C=t.m[12],Z=t.m[13],S=t.m[14],I=t.m[15];return i[n]=r*v+o*R+s*F+e*C,i[n+1]=r*d+o*_+s*A+e*Z,i[n+2]=r*g+o*M+s*L+e*S,i[n+3]=r*T+o*b+s*P+e*I,i[n+4]=h*v+a*R+u*F+m*C,i[n+5]=h*d+a*_+u*A+m*Z,i[n+6]=h*g+a*M+u*L+m*S,i[n+7]=h*T+a*b+u*P+m*I,i[n+8]=y*v+c*R+p*F+f*C,\ni[n+9]=y*d+c*_+p*A+f*Z,i[n+10]=y*g+c*M+p*L+f*S,i[n+11]=y*T+c*b+p*P+f*I,i[n+12]=l*v+x*R+z*F+w*C,i[n+13]=l*d+x*_+z*A+w*Z,i[n+14]=l*g+x*M+z*L+w*S,i[n+15]=l*T+x*b+z*P+w*I,this},t.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this.m[0]||0,i=1;16>i;i++)t=397*t^(this.m[i]||0);return t},t.prototype.decompose=function(n,r,o){o.x=this.m[12],o.y=this.m[13],o.z=this.m[14];var s=i.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,e=i.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=i.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(n.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),n.y=e*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),n.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===n.x||0===n.y||0===n.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var u=t.FromValues(this.m[0]/n.x,this.m[1]/n.x,this.m[2]/n.x,0,this.m[4]/n.y,this.m[5]/n.y,this.m[6]/n.y,0,this.m[8]/n.z,this.m[9]/n.z,this.m[10]/n.z,0,0,0,0,1);return a.FromRotationMatrixToRef(u,r),!0},t.FromArray=function(i,n){var r=new t;return n||(n=0),t.FromArrayToRef(i,n,r),r},t.FromArrayToRef=function(t,i,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]},t.FromFloat32ArrayToRefScaled=function(t,i,n,r){for(var o=0;16>o;o++)r.m[o]=t[o+i]*n},t.FromValuesToRef=function(t,i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){x.m[0]=t,x.m[1]=i,x.m[2]=n,x.m[3]=r,x.m[4]=o,x.m[5]=s,x.m[6]=e,x.m[7]=h,x.m[8]=a,x.m[9]=u,x.m[10]=m,x.m[11]=y,x.m[12]=c,x.m[13]=p,x.m[14]=f,x.m[15]=l},t.prototype.getRow=function(t){if(0>t||t>3)return null;var i=4*t;return new e(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},t.prototype.setRow=function(t,i){if(0>t||t>3)return this;var n=4*t;return this.m[n+0]=i.x,this.m[n+1]=i.y,this.m[n+2]=i.z,this.m[n+3]=i.w,this},t.FromValues=function(i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){var z=new t;return z.m[0]=i,z.m[1]=n,z.m[2]=r,z.m[3]=o,z.m[4]=s,z.m[5]=e,z.m[6]=h,z.m[7]=a,z.m[8]=u,z.m[9]=m,z.m[10]=y,z.m[11]=c,z.m[12]=p,z.m[13]=f,z.m[14]=l,z.m[15]=x,z},t.Compose=function(i,n,r){var o=t.FromValues(i.x,0,0,0,0,i.y,0,0,0,0,i.z,0,0,0,0,1),s=t.Identity();return n.toRotationMatrix(s),o=o.multiply(s),o.setTranslation(r),o},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=r,i.m[10]=r,i.m[9]=-n,i.m[6]=n,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=r,i.m[2]=-n,i.m[8]=n,i.m[10]=r,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=r,i.m[1]=n,i.m[4]=-n,i.m[5]=r,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationAxis=function(i,n){var r=t.Zero();return t.RotationAxisToRef(i,n,r),r},t.RotationAxisToRef=function(t,i,n){var r=Math.sin(-i),o=Math.cos(-i),s=1-o;t.normalize(),n.m[0]=t.x*t.x*s+o,n.m[1]=t.x*t.y*s-t.z*r,n.m[2]=t.x*t.z*s+t.y*r,n.m[3]=0,n.m[4]=t.y*t.x*s+t.z*r,n.m[5]=t.y*t.y*s+o,n.m[6]=t.y*t.z*s-t.x*r,n.m[7]=0,n.m[8]=t.z*t.x*s-t.y*r,n.m[9]=t.z*t.y*s+t.x*r,n.m[10]=t.z*t.z*s+o,n.m[11]=0,n.m[15]=1},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){a.RotationYawPitchRollToRef(t,i,n,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(i,n,r){var o=t.Zero();return t.ScalingToRef(i,n,r,o),o},t.ScalingToRef=function(t,i,n,r){r.m[0]=t,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=i,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=n,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(i,n,r){var o=t.Identity();return t.TranslationToRef(i,n,r,o),o},t.TranslationToRef=function(i,n,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1,o)},t.Lerp=function(i,n,r){for(var o=t.Zero(),s=0;16>s;s++)o.m[s]=i.m[s]*(1-r)+n.m[s]*r;return o},t.DecomposeLerp=function(i,n,r){var o=new s(0,0,0),e=new a,h=new s(0,0,0);i.decompose(o,e,h);var u=new s(0,0,0),m=new a,y=new s(0,0,0);n.decompose(u,m,y);var c=s.Lerp(o,u,r),p=a.Slerp(e,m,r),f=s.Lerp(h,y,r);return t.Compose(c,p,f)},t.LookAtLH=function(i,n,r){var o=t.Zero();return t.LookAtLHToRef(i,n,r,o),o},t.LookAtLHToRef=function(i,n,r,o){n.subtractToRef(i,this._zAxis),this._zAxis.normalize(),s.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),s.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-s.Dot(this._xAxis,i),h=-s.Dot(this._yAxis,i),a=-s.Dot(this._zAxis,i);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,h,a,1,o)},t.OrthoLH=function(i,n,r,o){var s=t.Zero();return t.OrthoLHToRef(i,n,r,o,s),s},t.OrthoLHToRef=function(i,n,r,o,s){var e=2/i,h=2/n,a=1/(o-r),u=r/(r-o);t.FromValuesToRef(e,0,0,0,0,h,0,0,0,0,a,0,0,0,u,1,s)},t.OrthoOffCenterLH=function(i,n,r,o,s,e){var h=t.Zero();return t.OrthoOffCenterLHToRef(i,n,r,o,s,e,h),h},t.OrthoOffCenterLHToRef=function(t,i,n,r,o,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(r-n),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(o-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(r+n)/(n-r),e.m[14]=o/(o-s),e.m[15]=1},t.PerspectiveLH=function(i,n,r,o){var s=t.Zero();return s.m[0]=2*r/i,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*r/n,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-o/(r-o),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=r*o/(r-o),s},t.PerspectiveFovLH=function(i,n,r,o){var s=t.Zero();return t.PerspectiveFovLHToRef(i,n,r,o,s),s},t.PerspectiveFovLHToRef=function(t,i,n,r,o,s){void 0===s&&(s=!0);var e=1/Math.tan(.5*t);s?o.m[0]=e/i:o.m[0]=e,o.m[1]=o.m[2]=o.m[3]=0,s?o.m[5]=e:o.m[5]=e*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-r/(n-r),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r)},t.GetFinalMatrix=function(i,n,r,o,s,e){var h=i.width,a=i.height,u=i.x,m=i.y,y=t.FromValues(h/2,0,0,0,0,-a/2,0,0,0,0,e-s,0,u+h/2,a/2+m,s,1);return n.multiply(r).multiply(o).multiply(y)},t.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},t.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},t.Transpose=function(i){var n=new t;return n.m[0]=i.m[0],n.m[1]=i.m[4],n.m[2]=i.m[8],n.m[3]=i.m[12],n.m[4]=i.m[1],n.m[5]=i.m[5],n.m[6]=i.m[9],n.m[7]=i.m[13],n.m[8]=i.m[2],n.m[9]=i.m[6],n.m[10]=i.m[10],n.m[11]=i.m[14],n.m[12]=i.m[3],n.m[13]=i.m[7],n.m[14]=i.m[11],n.m[15]=i.m[15],n},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(t,i){t.normalize();var n=t.normal.x,r=t.normal.y,o=t.normal.z,s=-2*n,e=-2*r,h=-2*o;i.m[0]=s*n+1,i.m[1]=e*n,i.m[2]=h*n,i.m[3]=0,i.m[4]=s*r,i.m[5]=e*r+1,i.m[6]=h*r,i.m[7]=0,i.m[8]=s*o,i.m[9]=e*o,i.m[10]=h*o+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=h*t.d,i.m[15]=1},t._tempQuaternion=new a,t._xAxis=s.Zero(),t._yAxis=s.Zero(),t._zAxis=s.Zero(),t}();t.Matrix=u;var m=function(){function t(t,i,n,r){this.normal=new s(t,i,n),this.d=r}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=u.Transpose(i),r=this.normal.x,o=this.normal.y,s=this.normal.z,e=this.d,h=r*n.m[0]+o*n.m[1]+s*n.m[2]+e*n.m[3],a=r*n.m[4]+o*n.m[5]+s*n.m[6]+e*n.m[7],m=r*n.m[8]+o*n.m[9]+s*n.m[10]+e*n.m[11],y=r*n.m[12]+o*n.m[13]+s*n.m[14]+e*n.m[15];return new t(h,a,m,y)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var r,o=i.x-t.x,s=i.y-t.y,e=i.z-t.z,h=n.x-t.x,a=n.y-t.y,u=n.z-t.z,m=s*u-e*a,y=e*h-o*u,c=o*a-s*h,p=Math.sqrt(m*m+y*y+c*c);return r=0!==p?1/p:0,this.normal.x=m*r,this.normal.y=y*r,this.normal.z=c*r,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var n=s.Dot(this.normal,t);return i>=n},t.prototype.signedDistanceTo=function(t){return s.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,r){var o=new t(0,0,0,0);return o.copyFromPoints(i,n,r),o},t.FromPositionAndNormal=function(i,n){var r=new t(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*i.x+n.y*i.y+n.z*i.z),r},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var r=-(i.x*t.x+i.y*t.y+i.z*t.z);return s.Dot(n,i)+r},t}();t.Plane=m;var y=function(){function t(t,i,n,r){this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t}();t.Viewport=y;var c=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],r=0;6>r;r++)n.push(new m(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=c,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var p=(t.Space,function(){function t(){}return t.X=new s(1,0,0),t.Y=new s(0,1,0),t.Z=new s(0,0,1),t}());t.Axis=p;var f=function(){function t(){}return t.interpolate=function(t,i,n,r,o){for(var s=1-3*r+3*i,e=3*r-6*i,h=3*i,a=t,u=0;5>u;u++){var m=a*a,y=m*a,c=s*y+e*m+h*a,p=1/(3*s*m+2*e*a+h);a-=(c-t)*p,a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*n+3*(1-a)*Math.pow(a,2)*o+Math.pow(a,3)},t}();t.BezierCurve=f,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var l=t.Orientation,x=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,n){var r=n.subtract(i),o=Math.atan2(r.y,r.x);return new t(o)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=x;var z=function(){function t(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,h=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new o((s*(i.y-n.y)-e*(t.y-i.y))/h,((t.x-i.x)*e-(i.x-n.x)*s)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),u=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-a>180&&(u-=360),-180>u-a&&(u+=360),m-u>180&&(m-=360),-180>m-u&&(m+=360),this.orientation=0>u-a?l.CW:l.CCW,this.angle=x.FromDegrees(this.orientation===l.CW?a-m:m-a)}return t}();t.Arc2=z;var w=function(){function t(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o(t,i))}return t.prototype.addLineTo=function(t,i){if(closed)return this;var n=new o(t,i),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},t.prototype.addArcTo=function(t,i,n,r,s){if(void 0===s&&(s=36),closed)return this;var e=this._points[this._points.length-1],h=new o(t,i),a=new o(n,r),u=new z(e,h,a),m=u.angle.radians()/s;u.orientation===l.CW&&(m*=-1);for(var y=u.startAngle.radians()+m,c=0;s>c;c++){var p=Math.cos(y)*u.radius+u.centerPoint.x,f=Math.sin(y)*u.radius+u.centerPoint.y;this.addLineTo(p,f),y+=m}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],n=this._points[0];t+=n.subtract(i).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return o.Zero();for(var i=t*this.length(),n=0,r=0;r<this._points.length;r++){var s=(r+1)%this._points.length,e=this._points[r],h=this._points[s],a=h.subtract(e),u=a.length()+n;if(i>=n&&u>=i){var m=a.normalize(),y=i-n;return new o(e.x+m.x*y,e.y+m.y*y)}n=u}return o.Zero()},t.StartingAt=function(i,n){return new t(i,n)},t}();t.Path2=w;var v=function(){function n(t,i,n){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<t.length;r++)this._curve[r]=t[r].clone();this._raw=n||!1,this._compute(i)}return n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(t,i){for(var n=0;n<t.length;n++)this._curve[n].x=t[n].x,this._curve[n].y=t[n].y,this._curve[n].z=t[n].z;return this._compute(i),this},n.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var n=this._tangents[0],r=this._normalVector(this._curve[0],n,t);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=s.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,e,h,a,u=1;i>u;u++)o=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=o.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),h=this._tangents[u],a=this._binormals[u-1],this._normals[u]=s.Cross(a,h),this._raw||this._normals[u].normalize(),this._binormals[u]=s.Cross(h,this._normals[u]),this._raw||this._binormals[u].normalize()},n.prototype._getFirstNonNullVector=function(t){for(var i=1,n=this._curve[t+i].subtract(this._curve[t]);0===n.length()&&t+i+1<this._curve.length;)i++,n=this._curve[t+i].subtract(this._curve[t]);return n},n.prototype._getLastNonNullVector=function(t){for(var i=1,n=this._curve[t].subtract(this._curve[t-i]);0===n.length()&&t>i+1;)i++,n=this._curve[t].subtract(this._curve[t-i]);return n},n.prototype._normalVector=function(n,r,o){var e;if(void 0===o||null===o){var h;i.WithinEpsilon(r.y,1,t.Epsilon)?i.WithinEpsilon(r.x,1,t.Epsilon)?i.WithinEpsilon(r.z,1,t.Epsilon)||(h=new s(0,0,1)):h=new s(1,0,0):h=new s(0,-1,0),e=s.Cross(r,h)}else e=s.Cross(r,o),s.CrossToRef(e,r,e);return e.normalize(),e},n}();t.Path3D=v;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,n,r,o){o=o>2?o:3;for(var e=new Array,h=function(t,i,n,r){var o=(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*r;return o},a=0;o>=a;a++)e.push(new s(h(a/o,i.x,n.x,r.x),h(a/o,i.y,n.y,r.y),h(a/o,i.z,n.z,r.z)));return new t(e)},t.CreateCubicBezier=function(i,n,r,o,e){e=e>3?e:4;for(var h=new Array,a=function(t,i,n,r,o){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*r+t*t*t*o;return s},u=0;e>=u;u++)h.push(new s(a(u/e,i.x,n.x,r.x,o.x),a(u/e,i.y,n.y,r.y,o.y),a(u/e,i.z,n.z,r.z,o.z)));return new t(h)},t.CreateHermiteSpline=function(i,n,r,o,e){for(var h=new Array,a=1/e,u=0;e>=u;u++)h.push(s.Hermite(i,n,r,o,u*a));return new t(h)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var n=this._points[this._points.length-1],r=this._points.slice(),o=i.getPoints(),s=1;s<o.length;s++)r.push(o[s].subtract(o[0]).add(n));var e=new t(r);return e},t.prototype._computeLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i},t}();t.Curve3=d;var g=function(){function t(){this.L00=s.Zero(),this.L1_1=s.Zero(),this.L10=s.Zero(),this.L11=s.Zero(),this.L2_2=s.Zero(),this.L2_1=s.Zero(),this.L20=s.Zero(),this.L21=s.Zero(),this.L22=s.Zero()}return t.prototype.addLight=function(t,i,n){var r=new s(i.r,i.g,i.b),o=r.scale(n);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(t){this.L00=this.L00.scale(t),this.L1_1=this.L1_1.scale(t),this.L10=this.L10.scale(t),this.L11=this.L11.scale(t),this.L2_2=this.L2_2.scale(t),this.L2_1=this.L2_1.scale(t),this.L20=this.L20.scale(t),this.L21=this.L21.scale(t),this.L22=this.L22.scale(t)},t}();t.SphericalHarmonics=g;var T=function(){function t(){this.x=s.Zero(),this.y=s.Zero(),this.z=s.Zero(),this.xx=s.Zero(),this.yy=s.Zero(),this.zz=s.Zero(),this.xy=s.Zero(),this.yz=s.Zero(),this.zx=s.Zero()}return t.prototype.addAmbient=function(t){var i=new s(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(i){var n=new t;return n.x=i.L11.scale(1.02333),n.y=i.L1_1.scale(1.02333),n.z=i.L10.scale(1.02333),n.xx=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).add(i.L22.scale(.429043)),n.yy=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).subtract(i.L22.scale(.429043)),n.zz=i.L00.scale(.886277).add(i.L20.scale(.495417)),n.yz=i.L2_1.scale(.858086),n.zx=i.L21.scale(.858086),n.xy=i.L2_2.scale(.858086),n},t}();t.SphericalPolynomial=T;var R=function(){function t(t,i){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=R;var _=function(){function t(t,i,n){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),void 0===n&&(n=o.Zero()),this.position=t,this.normal=i,this.uv=n}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=_;var M=function(){function t(){}return t.Color3=[n.Black(),n.Black(),n.Black()],t.Vector2=[o.Zero(),o.Zero(),o.Zero()],t.Vector3=[s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero()],t.Vector4=[e.Zero(),e.Zero(),e.Zero()],t.Quaternion=[new a(0,0,0,0)],t.Matrix=[u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero()],t}();t.Tmp=M}(BABYLON||(BABYLON={}));',
("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);